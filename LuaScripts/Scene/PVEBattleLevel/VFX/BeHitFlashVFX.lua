---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1022.
--- DateTime: 2023/8/30 20:54
---被击闪光的效果
--TODO 注意，这个效果不支持VFXManager管理
local BeHitFlashVFX = BaseClass("BeHitFlashVFX")

local Hit_Flash_Effect_TotalFrame = 5 --整个效果总帧数

function BeHitFlashVFX:__init(materials)
    self.m_materials = materials
    self.m_playing = false
    self.m_currentFrame = Hit_Flash_Effect_TotalFrame
end

function BeHitFlashVFX:Play()
    self.m_playing = true
    self.m_currentFrame = 0
end

function BeHitFlashVFX:OnUpdate(deltaTime)
    if not self.m_playing then
        return
    end

    if self.m_currentFrame > Hit_Flash_Effect_TotalFrame then
        self.m_playing = false
        return
    end

    self.m_currentFrame = Mathf.Clamp(self.m_currentFrame,0,Hit_Flash_Effect_TotalFrame)

    local ratio = (Hit_Flash_Effect_TotalFrame - self.m_currentFrame) / Hit_Flash_Effect_TotalFrame

    self:SetMaterialValue(ratio)

    self.m_currentFrame = self.m_currentFrame + 1
end

function BeHitFlashVFX:SetMaterialValue(ratio)
    if self.m_materials == nil then
        return
    end

    for _, material in ipairs(self.m_materials) do
        material:SetFloat("_Fresnel_Intensity",ratio)
    end
end

function BeHitFlashVFX:Destroy()
    self:SetMaterialValue(0,0)
    self.m_materials = nil
end


return BeHitFlashVFX