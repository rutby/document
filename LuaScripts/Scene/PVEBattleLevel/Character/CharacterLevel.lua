---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2024/1/2 14:16
---

local CharacterLevel = BaseClass("CharacterLevel")

local level_path = "Root/Level"
local camp_bg_path = "Root/CampBg"
local camp_path = "Root/Camp"

function CharacterLevel:__init(player)
    self.player = player
end

function CharacterLevel:Destroy()
    self.player = nil
end

function CharacterLevel:Create(scale, callback)
    self.req = CS.GameEntry.Resource:InstantiateAsync("Assets/Main/Prefabs/PVE/PveHero_LevelBar.prefab")
    self.req:completed('+',function(req)
        self.gameObject = req.gameObject
        self.transform = self.gameObject.transform
        self.transform:SetParent(self.player.topBarTransform)
        self.transform:Set_localPosition(0, 0, 0)
        self.transform:Set_localScale(scale, scale, scale)
        self.transform.rotation = PveActorMgr:GetInstance():GetCameraRotation()

        -- component define
        self.level_text = self.transform:Find(level_path):GetComponent(typeof(CS.TMPro.TextMeshPro))
        self.camp_bg_sprite = self.transform:Find(camp_bg_path):GetComponent(typeof(CS.UnityEngine.SpriteRenderer))
        self.camp_sprite = self.transform:Find(camp_path):GetComponent(typeof(CS.UnityEngine.SpriteRenderer))

        if callback then
            callback()
        end
    end)
end

function CharacterLevel:Destroy()
    if self.req then
        self.req:Destroy()
    end
end

function CharacterLevel:SetLevel(level)
    self.level_text.text = "Lv." .. level
end

function CharacterLevel:SetCamp(camp)
    if camp == -1 then
        self.camp_sprite:LoadSprite(string.format(LoadPath.UITroopsNew, "ui_camp_monster"))
    else
        self.camp_sprite:LoadSprite(string.format(LoadPath.UITroopsNew, "ui_camp_" .. camp))
    end
end

function CharacterLevel:SetIsSelf(isSelf)
    if isSelf then
        self.camp_bg_sprite:LoadSprite(string.format(LoadPath.UIPve, "pve_img_fighting_camp01"))
    else
        self.camp_bg_sprite:LoadSprite(string.format(LoadPath.UIPve, "pve_img_fighting_camp02"))
    end
end

return CharacterLevel