---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by qiyonghui.
--- DateTime: 2023/6/6 17:11
---CharacterShowerState 洗澡状态机
local CharacterBaseState = require("Scene.PVEBattleLevel.Character.State.CharacterBaseState")
---@class CharacterShowerState | CharacterBaseState
local CharacterShowerState = BaseClass("CharacterShowerState",CharacterBaseState)
local CharacterStateType = require("Scene.PVEBattleLevel.Character.State.CharacterStateType")

function CharacterShowerState:OnEnter()
    self.m_totalTime = LuaEntry.DataConfig:TryGetNum("shower", "k4")--洗澡动画播放时长x秒
    self.batheTimer = 0
    self.m_owner:RevertBaseParts()
    self.m_owner:PlayAnim("shower")
    self:AddTimer()
end

function CharacterShowerState:AddTimer()
    self:DeleteTimer()
    self.timer = TimerManager:GetInstance():GetTimer(1, self.Tick , self, false, false, false)
    self.timer:Start()
end

function CharacterShowerState:DeleteTimer()
    if self.timer ~= nil then
        self.timer:Stop()
        self.timer = nil
    end
end

function CharacterShowerState:Tick()
    self.batheTimer = self.batheTimer + 1
    if self.batheTimer >= self.m_totalTime then
        self.batheTimer = 0
        self:OnExit()
    end
end

function CharacterShowerState:OnExit()
    self.m_owner:RevertParts()
    self:DeleteTimer()
    self:OnStateComplete()
end

function CharacterShowerState:AllowStopByType(type)
    return CharacterStateType.Die == type
end

return CharacterShowerState