---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1022.
--- DateTime: 2022/11/15 15:39
---
--local Hero = require("Scene.PVEBattleLevel.Character.Hero")
local CharacterStateType = require("Scene.PVEBattleLevel.Character.State.CharacterStateType")
local CharacterBaseState = require("Scene.PVEBattleLevel.Character.State.CharacterBaseState")
local CharacterInertialIdleState = BaseClass("CharacterInertialIdleState",CharacterBaseState)

function CharacterInertialIdleState:OnEnter()
    self.lastType = self.m_data.type
    self.isCollect = self.lastType == CharacterStateType.Collect and self.m_data.isCollectTools
    if self.isCollect then
        self.m_owner:PlayAnim(PlayerAnimationName.CutIdle)
        self:AddTimer()
    elseif self.lastType == CharacterStateType.Attack then
        if self.m_owner:IsSneak() then
            self.m_owner:PlayAnim(self.m_owner:GetDefaultAnimName())
        else
            local anim = self.m_owner:GetEquipAnim(self.m_owner.info:GetInertialIdle(), PlayerAnimationName.Idle_KongShou)
            self.m_owner:PlayAnim(anim)
        end
        self:AddTimer()
    else
        --不需要连贯待机
        self:OnExit()
    end
end

function CharacterInertialIdleState:AddTimer()
    self.timer = TimerManager:GetInstance():GetTimer(5,function()
        self:OnExit()
    end)
    self.timer:Start()
end

function CharacterInertialIdleState:RemoveTimer()
    if self.timer ~= nil then
        self.timer:Stop()
        self.timer = nil
    end
end

function CharacterInertialIdleState:OnExit()
    self.m_owner:ResetWeapon()
    self:RemoveTimer()
    self:OnStateComplete()
end

function CharacterInertialIdleState:PrepareStateExit()
    if self.m_owner ~= nil then
        self.m_owner:ResetWeapon()
    end
end

function CharacterInertialIdleState:ChangeCharacterState()
    self:OnExit()
end

function CharacterInertialIdleState:Destroy()
    CharacterBaseState.Destroy(self)
    self:RemoveTimer()
end

return CharacterInertialIdleState