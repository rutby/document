---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2023/4/19 15:10
---
local MissileAttackEffectManager = BaseClass("MissileAttackEffectManager", Singleton)
local MissileAttackEffect = require "Scene.MissileAttackEffect.MissileAttackEffect"
local ResourceManager = CS.GameEntry.Resource

local function __init(self)
    self.allEffect = {}
    self:AddListener()
end

local function __delete(self)
    self.allEffect = nil
    self:RemoveListener()
end

--local function MonsterRewardCreateSignal(data)
--    local pointId = tonumber(data)
--    MissileAttackEffectManager:GetInstance():ShowOneEffect(pointId)
--end

local function AddListener(self)
    --EventManager:GetInstance():AddListener(EventId.MonsterRewardCreate, self.MonsterRewardCreateSignal)
end

local function RemoveListener(self)
    --EventManager:GetInstance():RemoveListener(EventId.MonsterRewardCreate, self.MonsterRewardCreateSignal)
end

local function ShowOneEffect(self, pointId)
    if self.allEffect[pointId] ~= nil then
        return
    end
    local request = ResourceManager:InstantiateAsync("Assets/Main/Prefabs/PVELevel/BombAttack.prefab")
    self.allEffect[pointId] = request
    request:completed('+', function()
        if request.isError then
            self.allEffect[pointId] =nil
            return
        end
        if CS.SceneManager.World==nil then
            request:Destroy()
            self.allEffect[pointId] = nil
            return
        end
        request.gameObject:SetActive(true)
        request.gameObject.transform:Set_localScale(ResetScale.x, ResetScale.y, ResetScale.z)

        local buildEffect = MissileAttackEffect.New()
        buildEffect:OnCreate(request)
        local param = {}
        param.pointId= pointId
        param.request = request
        buildEffect:ReInit(param)
    end)
end


local function RemoveOneEffect(self,pointId)
    if self.allEffect[pointId]~=nil then
        self.allEffect[pointId]:Destroy()
    end
    self.allEffect[pointId] =nil
end

MissileAttackEffectManager.__init = __init
MissileAttackEffectManager.__delete = __delete
MissileAttackEffectManager.RemoveOneEffect = RemoveOneEffect
--MissileAttackEffectManager.MonsterRewardCreateSignal = MonsterRewardCreateSignal
MissileAttackEffectManager.AddListener = AddListener
MissileAttackEffectManager.RemoveListener = RemoveListener
MissileAttackEffectManager.ShowOneEffect = ShowOneEffect
return MissileAttackEffectManager