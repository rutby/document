---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/9/19 20:39
---
local WorldBattleMineDamage = BaseClass("WorldBattleMineDamage")
local default_show_time = 2
local Localization = CS.GameEntry.Localization
--创建
local function OnCreate(self,go)
    if go ~= nil then
        self.request = go
        self.gameObject = go.gameObject
        self.transform = go.gameObject.transform
    end
    self:ComponentDefine()
end

-- 销毁
local function OnDestroy(self)
    self:RemoveTimer()
    self:ComponentDestroy()
end

local function ComponentDefine(self)
    self.isDoAnim = false
    self.simpleAnim = self.transform:GetComponentInChildren(typeof(CS.SimpleAnimation),true)
    self.des_name = self.transform:Find("num"):GetComponent(typeof(CS.SuperTextMesh))
    self.__update_handle = function() self:Update() end
    UpdateManager:GetInstance():AddUpdate(self.__update_handle)
end

local function ComponentDestroy(self)
    self.arrowTrans = nil
    self.addArrow = nil
    self.decArrow = nil
end
local function RemoveTimer(self)
    if self.__update_handle~=nil then
        UpdateManager:GetInstance():RemoveUpdate(self.__update_handle)
        self.__update_handle = nil
    end
end

local function ReInit(self,param)
    if IsNull(self.gameObject) then
        return
    end
    self.data = param
    local posV3 = SceneUtils.TileIndexToWorld(param.pointId)
    self.transform.position = posV3
    self.des_name.text = self.data.name.." -"..string.GetFormattedSeperatorNum(math.floor(self.data.damageNum))
    --local nameWidth = self.des_name:GetWidth()
    --local v3 = Vector3.New(self.des_name.gameObject.transform.position.x+(nameWidth*2/3),self.arrowTrans.transform.position.y,self.arrowTrans.transform.position.z)
    --self.arrowTrans.transform.position = v3

    self.curTime =0
    self.isDoAnim = true
    self.simpleAnim:Play("normal")
    self.simpleAnim:PlayQueued("show")
    self:Update()
end


local function Update(self)
    if self.isDoAnim then
        self.curTime = self.curTime+Time.deltaTime
        if self.curTime > default_show_time then
            self.isDoAnim = false
            WorldBattleMineDamageManager:GetInstance():RemoveOneEffect(self.data.uuid)
        end
    end
end


WorldBattleMineDamage.OnCreate = OnCreate
WorldBattleMineDamage.OnDestroy = OnDestroy
WorldBattleMineDamage.ComponentDefine = ComponentDefine
WorldBattleMineDamage.ComponentDestroy = ComponentDestroy
WorldBattleMineDamage.Update = Update
WorldBattleMineDamage.RemoveTimer =RemoveTimer
WorldBattleMineDamage.ReInit = ReInit
return WorldBattleMineDamage