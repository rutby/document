---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 24224.
--- DateTime: 2022/12/23 16:29
---
local WorldDesertGiveUpEffect = BaseClass("WorldDesertGiveUpEffect")
local Localization = CS.GameEntry.Localization
--创建
local function OnCreate(self,go)
    if go ~= nil then
        self.request = go
        self.gameObject = go.gameObject
        self.transform = go.gameObject.transform
        self.time_text = self.transform:Find("ModelGo/Transform/name"):GetComponent(typeof(CS.SuperTextMesh))
        self.isDoAnim = false
        self.timer_action = function() self:UpdateTime() end
        self:AddTimer()
    end
    
end

-- 销毁
local function OnDestroy(self)
    self:RemoveTimer()
end


local function ReInit(self,uuid,pointId,endTime)
    if IsNull(self.gameObject) then
        return
    end
    self.uuid =uuid
    self.pointId =pointId
    self.endTime = endTime
    local posV3 = SceneUtils.TileIndexToWorld(self.pointId,ForceChangeScene.World)
    self.transform.position = posV3
    self.isDoAnim = true
    self:UpdateTime()
end

local function RemoveTimer(self)
    if self.timer ~= nil then
        self.timer:Stop()
        self.timer = nil
    end
end

local function AddTimer(self)
    if self.timer == nil then
        self.timer = TimerManager:GetInstance():GetTimer(1, self.timer_action , self, false,false,false)
    end

    self.timer:Start()
end

local function UpdateTime(self)
    if self.isDoAnim then
        local curTime = UITimeManager:GetInstance():GetServerTime()
        local timeLeft = self.endTime - curTime
        if timeLeft>0 then
            if IsNull(self.time_text) ==false then
                self.time_text.text = UITimeManager:GetInstance():MilliSecondToFmtStringWithoutHour(timeLeft)
            end
        else
            if IsNull(self.time_text) ==false then
                self.time_text.text= "00:00"
            end

            self.isDoAnim = false
        end
    end
end


WorldDesertGiveUpEffect.OnCreate = OnCreate
WorldDesertGiveUpEffect.OnDestroy = OnDestroy
WorldDesertGiveUpEffect.ReInit = ReInit
WorldDesertGiveUpEffect.RemoveTimer = RemoveTimer
WorldDesertGiveUpEffect.UpdateTime = UpdateTime
WorldDesertGiveUpEffect.AddTimer = AddTimer
return WorldDesertGiveUpEffect