---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 24224.
--- DateTime: 2022/12/23 16:28
---
local WorldDesertProtectEffect = BaseClass("WorldDesertProtectEffect")
local Localization = CS.GameEntry.Localization
--创建
local function OnCreate(self,go)
    if go ~= nil then
        self.request = go
        self.gameObject = go.gameObject
        self.transform = go.gameObject.transform
        self.isDoAnim = false
        self.timer_action = function() self:UpdateTime() end
        self:AddTimer()
    end
end

-- 销毁
local function OnDestroy(self)
    self:RemoveTimer()
end

local function RemoveTimer(self)
    if self.timer ~= nil then
        self.timer:Stop()
        self.timer = nil
    end
end

local function AddTimer(self)
    if self.timer == nil then
        self.timer = TimerManager:GetInstance():GetTimer(1, self.timer_action , self, false,false,false)
    end

    self.timer:Start()
end

local function ReInit(self,uuid,pointId,endTime)
    if IsNull(self.gameObject) then
        return
    end
    self.uuid =uuid
    self.pointId =pointId
    self.endTime = endTime
    local posV3 = SceneUtils.TileIndexToWorld(self.pointId)
    self.transform.position = posV3
    self.isDoAnim = true
    self:UpdateTime()
end

local function UpdateTime(self)
    if self.isDoAnim then
        local curTime = UITimeManager:GetInstance():GetServerTime()
        local timeLeft = self.endTime - curTime
        if timeLeft<=0 then 
            self.isDoAnim = false
            WorldDesertEffectManager:GetInstance():RemoveProtectEffect(self.uuid)
        end
    end
end

WorldDesertProtectEffect.OnCreate = OnCreate
WorldDesertProtectEffect.OnDestroy = OnDestroy
WorldDesertProtectEffect.ReInit = ReInit
WorldDesertProtectEffect.UpdateTime = UpdateTime
WorldDesertProtectEffect.RemoveTimer = RemoveTimer
WorldDesertProtectEffect.AddTimer = AddTimer
return WorldDesertProtectEffect