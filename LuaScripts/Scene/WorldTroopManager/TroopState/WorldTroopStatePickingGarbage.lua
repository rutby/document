---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 27/3/2024 下午2:22
---
local base = WorldTroopStateBase
local WorldTroopStatePickingGarbage = BaseClass("WorldTroopStatePickingGarbage",WorldTroopStateBase)
local Const = require"Scene.WorldTroopManager.Const"
local TotalTime = 2
function WorldTroopStatePickingGarbage:__init(worldTroop,stateMachine)
    base.__init(self,worldTroop,stateMachine)
end

function  WorldTroopStatePickingGarbage:__delete()
    base.__delete(self)
end
function WorldTroopStatePickingGarbage:OnStateEnter()
    if self.worldTroop == nil then
        return
    end
    local normalized = Vector3.Normalize(self.worldTroop:GetDefenderPosition() - self.worldTroop:GetPosition())
    if normalized.x == 0 and normalized.y ==0 and normalized.z == 0 then
    else
        self.worldTroop:SetRotation(Quaternion.LookRotation(normalized,Vector3.up))
    end
    self.worldTroop:PlayAnim(Const.WorldTroopAnim.Anim_Idle)
    self.worldTroop:TroopUnitsBirthThenPickGarbage(false)
    --WorldTroopManager:GetInstance():UpdateListRemove(self.worldTroop:GetMarchUUID())
    --self:OnTroopChange()
end

function WorldTroopStatePickingGarbage:OnStateLeave()

end

function WorldTroopStatePickingGarbage:OnStateUpdate()
end

function WorldTroopStatePickingGarbage:OnTroopChange()
    if self.worldTroop == nil then
        return
    end
    if self.worldTroop:GetMarchStatus() ~= MarchStatus.PICKING
            or self.worldTroop:GetMarchStatus() ~= MarchStatus.SAMPLING then
        self.worldTroop:ShowJunkMan()
        self.worldTroop:TroopUnitPickBack()
        TimerManager:GetInstance():DelayInvoke(function()
            self:ChangeState(Const.WorldTroopState.Move)
        end, 2)
        
    end
end
return WorldTroopStatePickingGarbage