---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 27/3/2024 下午2:21
---
local base = WorldTroopStateBase
local WorldTroopStateStartAttack = BaseClass("WorldTroopStateStartAttack",WorldTroopStateBase)
local Const = require"Scene.WorldTroopManager.Const"
function WorldTroopStateStartAttack:__init(worldTroop, stateMachine)
    base.__init(self, worldTroop, stateMachine)
end

function WorldTroopStateStartAttack:__delete()
    base.__delete(self)
end
function WorldTroopStateStartAttack:OnStateEnter()
    if self.worldTroop == nil then
        return
    end
    self.targetPos = self.worldTroop:GetMarchTargetPos()
    self.worldTroop:SetRotationRoot()
    local normalized = Vector3.Normalize(self.worldTroop:GetDefenderPosition() - self.worldTroop:GetPosition())
    if normalized.x == 0 and normalized.y ==0 and normalized.z == 0 then
    else
        self.worldTroop:SetRotation(Quaternion.LookRotation(normalized,Vector3.up))
    end
    EventManager:GetInstance():Broadcast(EventId.HideTroopName,self.worldTroop:GetMarchUUID())
    EventManager:GetInstance():Broadcast(EventId.ShowTroopHeadInBattle,self.worldTroop:GetMarchUUID())
    WorldTroopManager:GetInstance():UpdateListRemove(self.worldTroop:GetMarchUUID())
    self:ChangeState(Const.WorldTroopState.Attack)
end



return WorldTroopStateStartAttack