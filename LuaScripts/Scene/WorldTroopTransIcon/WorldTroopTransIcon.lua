---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 24224.
--- DateTime: 2022/6/13 20:35
---
local WorldTroopTransIcon = BaseClass("WorldTroopTransIcon")
local time_text_path = "PosGo/TimeText"
--创建
local function OnCreate(self,go)
    if go ~= nil then
        self.request = go
        self.gameObject = go.gameObject
        self.transform = go.gameObject.transform
    end
    self:ComponentDefine()
end

-- 销毁
local function OnDestroy(self)
    self:RemoveTimer()
    self:ComponentDestroy()
end

local function ComponentDefine(self)
    self.time_text = self.transform:Find(time_text_path):GetComponent(typeof(CS.SuperTextMesh))
    self.slider = self.transform:GetComponent(typeof(CS.ChangeSceneCircleSlider))
    self.isDoAnim = false
    self.timer_action = function() self:UpdateTime() end
    self:AddTimer()
end

local function ComponentDestroy(self)
    self.time_text = nil
    self.slider = nil
end

local function RemoveTimer(self)
    if self.timer ~= nil then
        self.timer:Stop()
        self.timer = nil
    end
end

local function AddTimer(self)
    if self.timer == nil then
        self.timer = TimerManager:GetInstance():GetTimer(1, self.timer_action , self, false,false,false)
    end

    self.timer:Start()
end


local function SetShowTime(self,uuid,startTime,endTime)
    self.uuid = uuid
    self.startTime = startTime
    self.endTime = endTime
    self.slider:Init(self.startTime,self.endTime)
    self.isDoAnim = true
    self:UpdateTime()
end

local function UpdateTime(self)
    if self.isDoAnim then
        local curTime = UITimeManager:GetInstance():GetServerTime()
        local timeLeft = self.endTime - curTime
        if timeLeft>0 then
            if IsNull(self.time_text) ==false then
                self.time_text.text = UITimeManager:GetInstance():MilliSecondToFmtString(timeLeft)
            end
            
        else
            if IsNull(self.time_text) ==false then
                self.time_text.text= "00:00:00"
            end
            self.isDoAnim = false
            WorldTroopTransIconManager:GetInstance():RemoveOneEffect(self.uuid)
        end
    end
end


WorldTroopTransIcon.OnCreate = OnCreate
WorldTroopTransIcon.OnDestroy = OnDestroy
WorldTroopTransIcon.ComponentDefine = ComponentDefine
WorldTroopTransIcon.ComponentDestroy = ComponentDestroy
WorldTroopTransIcon.AddTimer = AddTimer
WorldTroopTransIcon.SetShowTime = SetShowTime
WorldTroopTransIcon.UpdateTime = UpdateTime
WorldTroopTransIcon.RemoveTimer =RemoveTimer
return WorldTroopTransIcon