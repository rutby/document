---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2022/11/7 11:13
---

local effect_prefab = "Assets/_Art/Effect/prefab/scene/Build/XuanQu/VFX_caodi_keanzhi_fanwei.prefab"
local MineRootPlaceEffect = require "Scene.MineRootPlaceEffect.MineRootPlaceEffect"
local MineRootPlaceEffectManager = BaseClass("MineRootPlaceEffectManager")
local ResourceManager = CS.GameEntry.Resource

local function __init(self)
    self.effect = {}
    self.effectRequest = {}
    self.currentShowPointIndex = -1
    self.buildId = -1
end

local function __delete(self)
    self.effect = {}
    self.effectRequest = {}
    self.currentShowPointIndex = -1
    self.buildId = -1
end

local function AddPlaceEffectsAround(self, pointIndex, buildId, buildUuid)
    if pointIndex == self.currentShowPointIndex then
        return
    end
    self:RemoveAllEffects()
    self.buildId = buildId
    self.buildUuid = buildUuid
    self.currentShowPointIndex = pointIndex
    local allShowPoints = self:GetAllShowAroundPointIndex()
    table.walk(allShowPoints, function (_, v)
        self:AddOneEffect(v)
    end)
end

local function RemoveAllEffects(self)
    table.walk(self.effect, function (k, v)
        v:OnDestroy()
    end)
    self.effect = {}
    table.walk(self.effectRequest, function (k, v)
        v:Destroy()
    end)
    self.effectRequest = {}
    self.currentShowPointIndex = -1
    self.buildId = -1
end

local function GetAllShowAroundPointIndex(self)
  
end

local function AddOneEffect(self, pointIndex)
    if self.effect[pointIndex] ~= nil or self.effectRequest[pointIndex] ~= nil then
        return
    end
    local request = ResourceManager:InstantiateAsync(effect_prefab)
    self.effectRequest[pointIndex] = request
    request:completed('+', function()
        if request.isError then
            return
        end
        request.gameObject:SetActive(true)
        --request.gameObject.transform:Set_localScale(ResetScale.x, ResetScale.y, ResetScale.z)
        local mineEffect = MineRootPlaceEffect.New()
        mineEffect:OnCreate(request)
        mineEffect:ReInit(pointIndex)
        self.effect[pointIndex] = mineEffect
    end)

end

MineRootPlaceEffectManager.__init = __init
MineRootPlaceEffectManager.__delete = __delete
MineRootPlaceEffectManager.AddPlaceEffectsAround = AddPlaceEffectsAround
MineRootPlaceEffectManager.RemoveAllEffects = RemoveAllEffects
MineRootPlaceEffectManager.GetAllShowAroundPointIndex = GetAllShowAroundPointIndex
MineRootPlaceEffectManager.AddOneEffect = AddOneEffect

return MineRootPlaceEffectManager