---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by wsf.
--- DateTime: 2023/12/15 4:11 PM
---
local HeroDieState = BaseClass("HeroDieState")

function HeroDieState:__init(unit)
    self.unit = unit---@type Scene.LWBattle.BarrageBattle.Unit.Member
    
    self.animLength = self.unit:GetAnimLength("dead")
    self.animLength = self.animLength > 0 and self.animLength or 2
end

function HeroDieState:__delete()
    self.unit = nil

    if self.timer then
        self.timer:Stop()
        self.timer=nil
    end
end

function HeroDieState:OnEnter()
    self.unit:RewindAndPlaySimpleAnim("dead") --播放死亡动画
    if self.unit.HideHpBar then
        self.unit:HideHpBar()
    end
    self.unit.transform:SetParent(nil)
    if self.unit.team then
        self.unit.team:RemoveMemberWithoutUnit(self.unit) --仅从小队移除数据，不从manager中移除
    end
    self.unit.logic:OnMemberDeath(self.unit)
    
    self.timer = TimerManager:DelayInvoke(function()
        self.unit.logic:RemoveUnit(self.unit.guid) --unitMgr清理unit的view层
    end, self.animLength)
end

function HeroDieState:OnExit()
    
end

function HeroDieState:OnUpdate()
    
end

return HeroDieState