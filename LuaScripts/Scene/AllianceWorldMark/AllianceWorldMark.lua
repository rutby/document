---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2021/9/8 10:39
---
local AllianceWorldMark = BaseClass("AllianceWorldMark")
local Localization = CS.GameEntry.Localization

local icon_path = "mark/UIAlliance_mark_sanjiao"
local name_path = "mark/Arrow/nameBg/name"-- "Arrow/nameBg/name"--
local nameBg_path = "mark/Arrow/nameBg"-- "Arrow/nameBg"--
local nameBgArrow_path = "mark/Arrow"-- "Arrow"--

local function OnCreate(self, req)
    if req ~= nil then
        self.request = req
        self.gameObject = req.gameObject
        self.transform = req.gameObject.transform
    end
    self:ComponentDefine()
end

--[[
local function StartTimer(self)
    if not self.timer then
        self.timer = TimerManager:GetInstance():GetTimer(0.1, self.TimerAction , self, false,false,false)
        self.timer:Start()
    end    
end

local function TimerAction(self)
    if self.scaleTrans then
        self.scaleTrans.localScale = ResetScale * CS.SceneManager.World:GetLodDistance() * 0.04 
    end
end

local function DelTimer(self)
    if self.timer ~= nil then
        self.timer:Stop()
        self.timer = nil
    end
end
--]]

local function ComponentDefine(self)
    if not self.componentDefined then
        self.markIcon = self.transform:Find(icon_path):GetComponent(typeof(CS.UnityEngine.SpriteRenderer))
        self.nameBg = self.transform:Find(nameBg_path):GetComponent(typeof(CS.UnityEngine.SpriteRenderer))
        self.nameBgArrow = self.transform:Find(nameBgArrow_path):GetComponent(typeof(CS.UnityEngine.SpriteRenderer))
        
        self.markName = self.transform:Find(name_path):GetComponent(typeof(CS.SuperTextMesh))
        self.componentDefined = true
    end
end

local function ShowMark(self, markData)
    self.markData = markData
    --pos
    local edgeL = self.markData.pos % 10
    local tempPoint = (self.markData.pos - edgeL) / 10
    local worldPos = BuildingUtils.GetBuildModelCenterVec(tempPoint, edgeL)
    --local posY = self:GetPosY(self.markData.type)
    local v3 = Vector3.New(worldPos.x, worldPos.y, worldPos.z)
    self.transform.position = v3
    --icon
    if self.markIcon then
        local iconPath = self.GetMarkIcon(markData.type)
        --self.markIcon:LoadSprite(iconPath)
    end
    if self.markName then
        if markData.name ~= "" then
            local nameArr = string.split(markData.name, ";")
            local showName = #nameArr == 2 and Localization:GetString(nameArr[2]) or nameArr[1]
            self.markName.gameObject:SetActive(true)
            self.markName.text = showName
            local tempWidth = self.markName:GetWidth()
            self.nameBg.size = Vector2.New(tempWidth + 1, 0.6)
        else
            self.markName.gameObject:SetActive(false)
        end
    end
    --]]

    self:SetOrderInLayer()
end

local function GetMarkIcon(markType)
    local iconName = AllianceMarkIconName[markType]
    --if markType == MarkType.Alliance_Attack then
    --    iconName = "UIAlliance_mark_gangji"
    --elseif markType == MarkType.Alliance_Sun then
    --    iconName = "UIAlliance_mark_fangyu"
    --elseif markType == MarkType.Alliance_LuckyClover then
    --    iconName = "UIAlliance_mark_sanjiao"
    --end
    
    return string.format(LoadPath.AllianceMark, iconName)
end

local function SetOrderInLayer(self)
    --local baseOrder = self.markData.type * 5 
    --self.markIcon.sortingOrder = baseOrder
    --self.nameBg.sortingOrder = baseOrder
    --self.nameBgArrow.sortingOrder = baseOrder + 1
    --self.markName.sortingOrder = baseOrder + 2
end

local function GetPosY(self, type)
    return (type - 4) * 0.6
end


AllianceWorldMark.OnCreate = OnCreate
AllianceWorldMark.ShowMark = ShowMark
AllianceWorldMark.ComponentDefine = ComponentDefine
AllianceWorldMark.GetMarkIcon = GetMarkIcon
AllianceWorldMark.SetOrderInLayer = SetOrderInLayer
AllianceWorldMark.GetPosY = GetPosY

return AllianceWorldMark