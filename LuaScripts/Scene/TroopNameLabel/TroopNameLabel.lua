---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2021/8/27 16:38
---
local TroopNameLabel = BaseClass("TroopNameLabel")
local player_name_path = "Transform/name"
local player_select_path = "Transform/SettleIcon"
local troop_icon_path  ="Transform/SettleIcon/SettleIcon"
local wait_icon_path = "Transform/waitIcon"
--创建
local function OnCreate(self,go)
    if go ~= nil then
        self.request = go
        self.gameObject = go.gameObject
        self.transform = go.gameObject.transform
    end
    self:ComponentDefine()
end

-- 销毁
local function OnDestroy(self)
    self:ComponentDestroy()
end

local function ComponentDefine(self)
    self.player_select = self.transform:Find(player_select_path).gameObject
    self.troop_icon = self.transform:Find(troop_icon_path):GetComponent(typeof(CS.UnityEngine.SpriteRenderer))
    self.player_name = self.transform:Find(player_name_path):GetComponent(typeof(CS.SuperTextMesh))
    self.wait_icon = self.transform:Find(wait_icon_path).gameObject
    self.curIconState = TroopIconShowState.Hide
    self.player_select:SetActive(false)
    self.wait_icon:SetActive(false)
end

local function ComponentDestroy(self)
    self.player_select = nil
    self.name_bg = nil
    self.player_name = nil
end

local function SetLodType(self, lodType)
    if IsNull(self.gameObject) == true then
        return
    end
    local adjuster = self.gameObject:GetComponent(typeof(CS.AutoAdjustLod))
    if adjuster ~= nil then
        adjuster:SetLodType(lodType)
    end
end

local function SetLodTypeByMarchInfo(self, marchInfo)
    if marchInfo.ownerUid == LuaEntry.Player.uid then
        self:SetLodType(LodType.TroopSelf)
    elseif not string.IsNullOrEmpty(marchInfo.allianceUid) and LuaEntry.Player.allianceId == marchInfo.allianceUid then
        self:SetLodType(LodType.TroopAlly)
    else
        self:SetLodType(LodType.TroopOther)
    end
end

local function SetName(self,marchInfo)
    if IsNull(self.player_name) == true then
        return
    end
    local selfAllianceId = LuaEntry.Player.allianceId
    local name = ""
    local isCrossServer = false
    if marchInfo.allianceAbbr~=nil and marchInfo.allianceAbbr~="" then
        name = "["..marchInfo.allianceAbbr.."]"..marchInfo.ownerName
    else
        name = marchInfo.ownerName
    end
    if marchInfo.srcServer~=nil and marchInfo.srcServer>0 and marchInfo.srcServer ~= LuaEntry.Player:GetSelfServerId() then
        isCrossServer = true
        name = "#"..marchInfo.srcServer.." "..name
    end
    self.player_name.text = name
    if marchInfo.ownerUid == LuaEntry.Player.uid then
        self.player_name.color32 = WorldGreenColor32
    elseif selfAllianceId~=nil and selfAllianceId~="" and selfAllianceId == marchInfo.allianceUid then
        self.player_name.color32 = WorldBlueColor32
    else
        if isCrossServer ==true then
            self.player_name.color32 = WorldRedColor32
        elseif DataCenter.WorldNewsDataManager:GetIsAttackerByUid(marchInfo.ownerUid)==true then
            self.player_name.color32 = WorldRedColor32
        elseif DataCenter.GloryManager:GetIsFightServer(marchInfo.srcServer) == true then
            self.player_name.color32 = WorldRedColor32
        elseif LuaEntry.Player.serverType == ServerType.EDEN_SERVER then
            if marchInfo.allianceUid~=nil and marchInfo.allianceUid~="" and DataCenter.GloryManager:IsSameCampByAllianceId(marchInfo.allianceUid) ==true then
                self.player_name.color32 = WorldYellowColor32
            else
                self.player_name.color32 = WorldRedColor32
            end
        else
            local fightAllianceId = DataCenter.AllianceCompeteDataManager:GetFightAllianceId()
            if fightAllianceId~=nil and fightAllianceId~="" and fightAllianceId == marchInfo.allianceUid then
                self.player_name.color32 = WorldRedColor32
            else
                self.player_name.color32 = WorldWhiteColor32
            end
        end
        
    end
end

local function ShowIcon(self,state)
    if IsNull(self.troop_icon) == true then
        return
    end
    if IsNull(self.player_select) == true then
        return
    end
    if IsNull(self.wait_icon) == true then
        return
    end
    if self.curIconState ~= state then
        self.curIconState =  state
        if self.curIconState == TroopIconShowState.Idle then
            self.player_select:SetActive(true)
            self.wait_icon:SetActive(false)
            self.troop_icon:LoadSprite("Assets/Main/Sprites/UI/Common/New/Common_icon_march_station")
        elseif self.curIconState == TroopIconShowState.Broken then
            self.player_select:SetActive(true)
            self.wait_icon:SetActive(false)
            self.troop_icon:LoadSprite("Assets/Main/Sprites/UI/Common/New/Common_icon_march_fail")
        else
            if self.curIconState == TroopIconShowState.Wait then
                self.wait_icon:SetActive(true)
            else
                self.wait_icon:SetActive(false)
            end
            self.player_select:SetActive(false)
        end
    end
end


TroopNameLabel.OnCreate = OnCreate
TroopNameLabel.OnDestroy = OnDestroy
TroopNameLabel.ComponentDefine = ComponentDefine
TroopNameLabel.ComponentDestroy = ComponentDestroy
TroopNameLabel.SetLodType = SetLodType
TroopNameLabel.SetLodTypeByMarchInfo = SetLodTypeByMarchInfo
TroopNameLabel.SetName = SetName
TroopNameLabel.ShowIcon = ShowIcon
return TroopNameLabel