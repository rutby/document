---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by mac.
--- DateTime: 9/28/21 12:28 PM
---
local UITextMeshProUGUIEx = BaseClass("UITextMeshProUGUIEx", UIBaseComponent)
local base = UIBaseComponent
local UnityTextMeshProEx = typeof(CS.TextMeshProUGUIEx)

-- 创建
local function OnCreate(self)
    base.OnCreate(self)
    -- Unity侧原生组件
    self.unity_tmpro = self.gameObject:GetComponent(UnityTextMeshProEx)
    self._print = false--是否在打印
    self._isAddSpeedPrint = false
    self.print_timer_callback = function() 
        self:OnPrintTimerCallBack()
    end
    self.print_total_num = 0
    self.print_current_num = 0
    self.print_finish_callback = nil--外部打印完成回调
end

-- 获取文本
local function GetText(self)
    return self.unity_tmpro.text
end

-- 设置文本
local function SetText(self, text)
    self.unity_tmpro:Native_SetText(text)
end

local function SetLocalText(self, dialogId, ...)
    self.unity_tmpro:SetLocalText(dialogId, ...)
end

-- 销毁
local function OnDestroy(self)
    self:RemovePrintTime()
    self._print = false--是否在打印
    if self.unity_tmpro then
        self.unity_tmpro.onPointerClick = nil
        self.unity_tmpro = nil
    end
    base.OnDestroy(self)
end

local function SetColor(self,value)
    self.unity_tmpro.color = value
end

local function GetColor(self)
    return self.unity_tmpro.color
end

local function GetWidth(self)
    return self.unity_tmpro.preferredWidth
end

local function GetHeight(self)
    return self.unity_tmpro.preferredHeight
end

local function GetLinkInfo(self)
    return self.unity_tmpro.textInfo.linkInfo
end

local function OnPointerClick(self,onPointerClick)
    self.unity_tmpro.onPointerClick = onPointerClick
end

local function SetPreferSize(self, value)
    self.rectTransform.sizeDelta = value
end

local function SetColorRGBA(self,r,g,b,a)
    self.unity_tmpro:Set_color(r, g, b, a)
end

local function GetColorRGBA(self)
    return self.unity_tmpro:Get_color()
end

local function SetAlignment( self,_alignment )
    self.unity_tmpro.alignment = _alignment
end

local function SetFontSize(self, size )
    self.unity_tmpro.fontSize = size
end

local function SetMaterial(self, material)
    self.unity_tmpro.fontMaterial = material
end

local function SetColorGradient(self, topLeftColor, topRightColor, bottomLeftColor, bottomRightColor)
    local colorGradient = self.unity_tmpro.colorGradient
    colorGradient.topLeft = topLeftColor
    colorGradient.topRight = topRightColor
    colorGradient.bottomLeft = bottomLeftColor
    colorGradient.bottomRight = bottomRightColor
    self.unity_tmpro.colorGradient = colorGradient
end

function UITextMeshProUGUIEx:PlayPrint(callback)
    self.print_finish_callback = callback
    self._print = true
    self._isAddSpeedPrint = false
    self.unity_tmpro:ForceMeshUpdate()
    self.print_total_num = self.unity_tmpro.textInfo.characterCount
    self.print_current_num = 0
    self.unity_tmpro.maxVisibleCharacters = self.print_current_num
    self:AddPrintTime(PrintSpeed)
end

function UITextMeshProUGUIEx:OnPrintCompleteCallBack()
    self:RemovePrintTime()
    self._print = false
    self._isAddSpeedPrint = false
    if self.print_finish_callback ~= nil then
        self.print_finish_callback()
        self.print_finish_callback = nil
    end
end

function UITextMeshProUGUIEx:AddSpeedPrint()
    if self._print then
        if not self._isAddSpeedPrint then
            self._isAddSpeedPrint = true
            self:AddPrintTime(PrintAddSpeed)
        end
        return true
    end
    return false
end

function UITextMeshProUGUIEx:AddPrintTime(time)
    self:RemovePrintTime()
    self.print_timer = TimerManager:GetInstance():GetTimer(time, self.print_timer_callback, nil, false, false, false)
    self.print_timer:Start()
end

function UITextMeshProUGUIEx:RemovePrintTime()
    if self.print_timer ~= nil then
        self.print_timer:Stop()
        self.print_timer = nil
    end
end

function UITextMeshProUGUIEx:OnPrintTimerCallBack()
    if self.print_current_num >= self.print_total_num then
        self.unity_tmpro.maxVisibleCharacters = self.print_total_num
        self:OnPrintCompleteCallBack()
    else
        self.unity_tmpro.maxVisibleCharacters = self.print_current_num
        self.print_current_num = self.print_current_num + 1
    end
end

function UITextMeshProUGUIEx:SetMinVisibleCharacters()
    self.unity_tmpro.maxVisibleCharacters = 0
end
   
UITextMeshProUGUIEx.OnCreate = OnCreate
UITextMeshProUGUIEx.GetText = GetText
UITextMeshProUGUIEx.SetText = SetText
UITextMeshProUGUIEx.OnDestroy = OnDestroy
UITextMeshProUGUIEx.SetColor = SetColor
UITextMeshProUGUIEx.GetWidth = GetWidth
UITextMeshProUGUIEx.GetHeight = GetHeight
UITextMeshProUGUIEx.GetColor = GetColor
UITextMeshProUGUIEx.GetLinkInfo = GetLinkInfo
UITextMeshProUGUIEx.OnPointerClick = OnPointerClick
UITextMeshProUGUIEx.SetPreferSize = SetPreferSize
UITextMeshProUGUIEx.SetLocalText = SetLocalText
UITextMeshProUGUIEx.SetColorRGBA = SetColorRGBA
UITextMeshProUGUIEx.GetColorRGBA = GetColorRGBA
UITextMeshProUGUIEx.SetAlignment = SetAlignment
UITextMeshProUGUIEx.SetFontSize = SetFontSize
UITextMeshProUGUIEx.SetMaterial = SetMaterial
UITextMeshProUGUIEx.SetColorGradient = SetColorGradient
return UITextMeshProUGUIEx