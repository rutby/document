---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 4/3/2024 下午12:27
---
local LoadingStateBase = require("Loading.LoadingState.LoadingStateBase")
local AppUpdateState = BaseClass("AppUpdateState", LoadingStateBase)
local GameEntry = CS.GameEntry
local Const = require("Loading.Const")

function AppUpdateState:__init(startupLoading)
    LoadingStateBase:__init(startupLoading)
end

function AppUpdateState:OnEnter(args)
    self:ShowAppUpgradeMessage()
end

function AppUpdateState:OnExit()

end

function AppUpdateState:OnUpdate()

end

function AppUpdateState:ShowAppUpgradeMessage(s)
    local str = GameEntry.GlobalData.analyticID == "market_global" and "GOOGLE" or GameEntry.GlobalData.analyticID;
    local content = GameEntry.Localization:GetString("129013", str);

    if GameEntry.GlobalData.updateType == 1 then
        UIUtil.ShowMessage(content, 2, "110003", "", function()
            if not GameEntry.GlobalData.downloadurl.IsNullOrEmpty() then
                CS.UnityEngine.Application.OpenURL(GameEntry.GlobalData.downloadurl)
            end
        end, function()
            GameEntry.GlobalData.updateType = 0;
            self._startupLoading:SetState(Const.LoadingState.PushInit);
        end)
    elseif GameEntry.GlobalData.updateType == 2 then
        UIUtil.ShowMessage(content, 1, "110003", "", function()
            if not GameEntry.GlobalData.downloadurl.IsNullOrEmpty() then
                CS.UnityEngine.Application.OpenURL(GameEntry.GlobalData.downloadurl)
            end
        end, function()
            if not GameEntry.GlobalData.downloadurl.IsNullOrEmpty() then
                CS.UnityEngine.Application.OpenURL(GameEntry.GlobalData.downloadurl)
            end
        end)
    end
end

return AppUpdateState