---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 4/3/2024 上午11:34
---
local LoadingStateBase = require("Loading.LoadingState.LoadingStateBase")
local LoadDataTableState = BaseClass("LoadDataTableState", LoadingStateBase)
local GameEntry = CS.GameEntry
local Const = require("Loading.Const")

function LoadDataTableState:__init(startupLoading)
    LoadingStateBase:__init(startupLoading)
end

function LoadDataTableState:OnEnter(args)
    self._stateTime = 0

    GameEntry.pb:Reload();
    --GameEntry.Localization.Language = GameEntry.Setting.UserLanguage;
    --GameEntry.Localization:LoadDictionary("Dialog");
end

function LoadDataTableState:OnExit()

end

function LoadDataTableState:OnUpdate()
    self._stateTime = self._stateTime + Time.deltaTime

    if GameEntry.Localization.IsInitDone and GameEntry.pb.IsInitDone then
        if GameEntry.Localization.IsInitSuccess and GameEntry.pb.IsInitSuccess then
            self._startupLoading:StartConnect()
        else
            self._startupLoading:SetState(Const.LoadingState.LoadingError, Const.LoginErrorCode.ERROR_LOAD_DATATABLE);
        end
    elseif self._stateTime > 60 then
        self._startupLoading:SetState(Const.LoadingState.LoadingError, Const.LoginErrorCode.ERROR_LOAD_DATATABLE_TIMEOUT);
    end
end

return LoadDataTableState