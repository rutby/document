---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by guqu.
--- DateTime: 2020/9/7 15:49
---
local AllianceGiftDataManager = BaseClass("AllianceGiftDataManager");

local function __init(self)
    self.curLevel = 1
    self.curExp = 0
    self.curMaxExp =0
    self.giftNum = 0
    self.giftInfoList ={}
end
local function __delete(self)
    self.curLevel = nil
    self.curExp = nil
    self.curMaxExp =nil
    self.giftNum = nil
    self.giftInfoList =nil
end

local function UpdateGiftInfoList(self,message)
    if message["info"]~=nil then
        self.giftInfoList = {}
        table.walk(message["info"],function (k,v)
            local info = AllianceGiftData.New()
            info:ParseData(v)
            --local tempGiftType = GetTableData(TableName.AllianceGiftGroup,info.groupId, "type")
            --info.rewardType = tempGiftType
            if info.uuid ~=nil and info.uuid~="" then
                self.giftInfoList[info.uuid] =info
            end
        end)
    end
end

local function RetBaseData(self,message)
    if message["onLevel"]~=nil then
        self.curLevel = message["onLevel"]
    end
    if message["onCurrExp"]~=nil then
        self.curExp = message["onCurrExp"]
    end
    if message["onMaxExp"]~=nil then
        self.curMaxExp = message["onMaxExp"]
    end
end

local function UpdateGiftNum(self,count)
    if count >0 then
        self.giftNum = count
    else
        self.giftNum = 0
    end
    EventManager:GetInstance():Broadcast(EventId.UpdateMainAllianceRedCount)
end

local function RemoveAllianceGiftData(self,uuid)
    self.giftInfoList[uuid] =nil
end

local function RemoveAllReceiveGift(self,type)
    local deleteList ={}
    table.walk(self.giftInfoList,function(k,v)
        if v.receiveState == 1 and v.rewardType == type then
            table.insert(deleteList,v.uuid)
        end
    end)
    table.walk(deleteList,function(k,v)
        self:RemoveAllianceGiftData(v)
    end)
end

local function SetGiftReceive(self,uuid, time)
    if self.giftInfoList[uuid]~=nil then
        self.giftInfoList[uuid].receiveState = 1
        
        if time then
            self.giftInfoList[uuid].receiveTime = time
        end
    end
end

local function SetAllGiftReceiveByType(self,type)
    table.walk(self.giftInfoList,function(k,v)
        local giftType = LocalController:instance():getStrValue("alliance_gift_group", v.groupId, "type")
        if tonumber(giftType) == type then
            self:SetGiftReceive(v.uuid)
        end
    end)
end
local function RetGiftInfo(self,message)
    if message["uuid"]~=nil then
        local uuid = message["uuid"]
        if self.giftInfoList[uuid]~=nil and message["info"]~=nil then
            self.giftInfoList[uuid].reward = message["info"]
        end
    end
end

local function GetGiftInfoList(self,type)
    local list = {}
    table.walk(self.giftInfoList,function(k,v)
        if type == nil then
            list[v.uuid] = v
        elseif v.rewardType == type then
            list[v.uuid] = v
        end
    end)
    return list
end
local function GetGiftDataByUuid(self,uuid)
    return self.giftInfoList[uuid]
end

local function GetCurLevel(self)
    return self.curLevel
end
local function GetCurExp(self)
    return self.curExp
end
local function GetMaxExp(self)
    return self.curMaxExp
end
local function GetGiftNum(self)
    return self.giftNum
end

local function SetCurLevel(self,level)
    self.curLevel =level
end


AllianceGiftDataManager.__init = __init
AllianceGiftDataManager.__delete = __delete
AllianceGiftDataManager.UpdateGiftInfoList = UpdateGiftInfoList
AllianceGiftDataManager.RetBaseData = RetBaseData
AllianceGiftDataManager.RetGiftInfo = RetGiftInfo
AllianceGiftDataManager.UpdateGiftNum = UpdateGiftNum
AllianceGiftDataManager.RemoveAllianceGiftData = RemoveAllianceGiftData
AllianceGiftDataManager.GetGiftInfoList =GetGiftInfoList
AllianceGiftDataManager.GetCurLevel =GetCurLevel
AllianceGiftDataManager.GetCurExp =GetCurExp
AllianceGiftDataManager.GetMaxExp =GetMaxExp
AllianceGiftDataManager.GetGiftNum =GetGiftNum
AllianceGiftDataManager.GetGiftDataByUuid =GetGiftDataByUuid
AllianceGiftDataManager.RemoveAllReceiveGift = RemoveAllReceiveGift
AllianceGiftDataManager.SetCurLevel =SetCurLevel
AllianceGiftDataManager.SetGiftReceive =SetGiftReceive
AllianceGiftDataManager.SetAllGiftReceiveByType =SetAllGiftReceiveByType
return AllianceGiftDataManager