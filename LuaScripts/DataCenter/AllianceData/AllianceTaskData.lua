---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2022/3/29 21:34
---
---
local AllianceTaskData = BaseClass("AllianceTaskData")

local function __init(self)
    self.taskId = 0
    self.curProg = 0
    self.startTime = 0
    self.endTime = 0--任务结束时间
    self.finishTime = 0--任务完成时间
    self.rewards = {}
    --下面两个字段在任务未完成 或者未达到领奖条件时不发
    self.rewardRank = 5
    self.state = 0--1 可领奖 2 已经领奖
end

local function __delete(self)
    self.taskId = nil
    self.curProg = nil
    self.startTime = nil
    self.endTime = nil--任务结束时间
    self.finishTime = nil--任务完成时间
    self.rewards = nil
    self.rewardRank = nil
    self.state = nil
end

local function ParseData(self,message)
    if message.taskId then
        self.taskId = message.taskId
    end
    if message.num then
        self.curProg = message.num
    end
    if message.startTime then
        self.startTime = message.startTime
    end
    if message.endTime then
        self.endTime = message.endTime
    end
    if message.finishTime then
        self.finishTime = message.finishTime
    end
    if message.rewardArr then
        self.rewards = message.rewardArr
    end
    if message.rewardRank then
        self.rewardRank = message.rewardRank
    end
    if message.state then
        self.state = message.state
    end
    
end

local function SetTaskClaimed(self)
    self.state = 2
    self.finishTime = UITimeManager:GetInstance():GetServerTime()
end

--未开始1，正在进行2，已完成3，已结束4
local function GetTaskStatus(self)
    if self.finishTime and self.finishTime > 0 then
        return 3, self.finishTime
    else
        local serverTime = UITimeManager:GetInstance():GetServerTime()
        if self.startTime > serverTime then
            return 1, self.startTime
        elseif self.endTime < serverTime then
            return 4, self.endTime
        else
            return 2, self.endTime
        end
    end
    
end

local function CheckIfCanClaim(self)
    local tempStatus = self:GetTaskStatus()
    if (tempStatus == 3) and self.state == 1 then
        return true
    end
end


AllianceTaskData.__init = __init
AllianceTaskData.__delete = __delete
AllianceTaskData.ParseData = ParseData
AllianceTaskData.SetTaskClaimed = SetTaskClaimed
AllianceTaskData.GetTaskStatus = GetTaskStatus
AllianceTaskData.CheckIfCanClaim = CheckIfCanClaim


return AllianceTaskData