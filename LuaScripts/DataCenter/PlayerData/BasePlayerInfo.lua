---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by guqu.
--- DateTime: 2020/8/27 18:38
--
--- BasePlayerInfo基础类
-- 主要是用来处理其他玩家的基础属性
-- bug fixed: 这里加一个过期时间，否则其他用户刷新数据了。代码还在缓存就的信息，就会出错
-- 其实这个理论上不需要缓存。目前过期时间设置为30

local BasePlayerInfo = BaseClass("BasePlayerInfo")

local function __init(self)
	self.moodStr=""
    self.uid = ""
    self.picVer =0
    self.pic =""
    self.name = ""
    self.allianceId = ""
    self.alAbbr = ""
    self.allianceName = ""
    self.playerPower =0
    self.armyKill = 0
	self.serverId = 0
	self.baseLevel = 1
    self.mainBuildPointId = 0
    self.mainBuildUuid = 0
    self.buildingPower = 0
    self.sciencePower = 0
    self.armyPower = 0
    self.heroPower = 0
    self.playerMaxPower = 0
    self.battleWin = 0
    self.battleLose = 0
    self.armyDead = 0
    self.scoutCount = 0
    self.armyKill = 0
	self.updateTime = 0		
    self.monthCardEndTime = -1
    self.level = 0
    self.exp = 0
    self.careerType = CareerType.None
    self.careerLv = 0
    self.countryFlag = DefaultNation
    self.alIcon = "1;1;1;1"--联盟旗帜（背景；背景色；前景；前景色）
    self.headSkinId = nil
    self.headSkinET = nil
    self.sex = SexType.None
    self.positionId = 0--官职
    self.exploitRank = 0 --功勋等级
end

local function __delete(self)
	self.moodStr=nil
    self.uid = nil
    self.picVer = nil
    self.pic =nil
    self.name = nil
    self.allianceId = nil
    self.alAbbr = nil
    self.allianceName = nil
    self.playerPower =nil
    self.armyKill = nil
	self.serverId = nil
	self.baseLevel = nil
    self.mainBuildPointId =nil
    self.mainBuildUuid = nil
    self.buildingPower = nil
    self.sciencePower = nil
    self.armyPower = nil
    self.heroPower = nil
    self.playerMaxPower = nil
    self.battleWin = nil
    self.battleLose = nil
    self.armyDead = nil
    self.scoutCount = nil
    self.armyKill = nil
	self.updateTime = nil
    self.monthCardEndTime = nil
    self.level = nil
    self.exp = nil
    self.careerType = nil
    self.careerLv = nil
    self.countryFlag = nil
    self.alIcon=nil
    self.headSkinId = nil
    self.headSkinET = nil
    self.sex = SexType.None
    self.positionId = 0--官职
    self.exploitRank = nil
end

local function ParseData(self, message)
    if message ==nil then
        return
    end
    if message["uid"]~=nil  then
        self.uid = message["uid"]
    end
    if message["name"]~=nil  then
        self.name = message["name"]
    end
    if message["picVer"]~=nil  then
        self.picVer = message["picVer"]
    end
    if message["pic"]~=nil  then
        self.pic = message["pic"]
    end
    if message["allianceId"]~=nil  then
        self.allianceId = message["allianceId"]
    end
    if message["abbr"]~=nil  then
        self.alAbbr = message["abbr"]
    end
    if message["allianceName"]~=nil  then
        self.allianceName = message["allianceName"]
    end
    if message["power"]~=nil  then
        self.power = message["power"]
    end
 
	if message["armyKill"]~=nil  then
        self.armyKill = message["armyKill"]
    end
	if message["moodStr"]~=nil then
	   self.moodStr=message["moodStr"]
	end

    if message["monthCardEndTime"]~=nil then
        self.monthCardEndTime=message["monthCardEndTime"]
    end
	
	if message.baseLevel then
		self.baseLevel = message.baseLevel
	end
	
	if message.serverId then
		self.serverId = message.serverId
	end

    if message.mainBuildPointId~=nil then
        self.mainBuildPointId = message.mainBuildPointId
    end
    if message.mainBuildUuid~=nil then
        self.mainBuildUuid = message.mainBuildUuid
    end

    if message["buildingPower"]~=nil  then
        self.buildingPower = message["buildingPower"]
    end
    if message["sciencePower"]~=nil  then
        self.sciencePower = message["sciencePower"]
    end
    if message["armyPower"]~=nil  then
        self.armyPower =message["armyPower"]
    end
    if message["heroPower"]~=nil  then
        self.heroPower = message["heroPower"]
    end
    if message["playerMaxPower"]~=nil  then
        self.playerMaxPower = message["playerMaxPower"]
    end
    if message["battleWin"]~=nil  then
        self.battleWin = message["battleWin"]
    end
    if message["battleLose"]~=nil  then
        self.battleLose =message["battleLose"]
    end
    if message["armyDead"]~=nil  then
        self.armyDead = message["armyDead"]
    end
    if message["scoutCount"]~=nil  then
        self.scoutCount = message["scoutCount"]
    end
    if message["countryflag"] then
        self.countryFlag = message["countryflag"]
    end
    
    if message["armyKill"]~=nil  then
        self.armyKill = message["armyKill"]
    end
    
    if message["level"]~=nil  then
        self.level = message["level"]
    end
    
    if message["exp"]~=nil  then
        self.exp = message["exp"]
    end
    
    if message["careerType"]~=nil  then
        self.careerType = message["careerType"]
    end
    
    if message["careerLv"]~=nil  then
        self.careerLv = message["careerLv"]
    end

    if message["alIcon"]~=nil then
        self.alIcon = string.IsNullOrEmpty(message["alIcon"]) and "1;1;1;1" or message["alIcon"]
    end

    if message["headSkinId"] ~= nil  then
        self.headSkinId = message["headSkinId"]
    end
    if message["headSkinET"] ~= nil  then
        self.headSkinET = message["headSkinET"]
    end
    if message["sex"] ~= nil  then
        self.sex = message["sex"]
    end
    if message["positionId"] ~= nil  then
        self.positionId = tonumber(message["positionId"])
    end
    if message["exploitRank"] ~= nil then
        self.exploitRank = message["exploitRank"]
    end
end

local function ChangeMoodStr(self,str)
	self.moodStr =str
end

local function ChangeSelfName(self,name)
    self.name =name
end

local function GetHeadBgImg(self)
    local serverTimeS = UITimeManager:GetInstance():GetServerSeconds()
    --if self.monthCardEndTime and self.monthCardEndTime > serverTimeS then
    --    headBgImg = "Common_playerbg_golloes"
    --end
    local headBgImg = DataCenter.DecorationDataManager:GetHeadFrame(self.headSkinId, self.headSkinET, self.monthCardEndTime and self.monthCardEndTime > serverTimeS)
    return headBgImg

    --if headBgImg and headBgImg ~= "" then
    --    return string.format(LoadPath.CommonNewPath,headBgImg)
    --end
end

local function GetCountryFlagTemplate(self)
    local country = string.IsNullOrEmpty(self.countryFlag) and DefaultNation or self.countryFlag
    return DataCenter.NationTemplateManager:GetNationTemplate(country)
end

--获取官职
function BasePlayerInfo:GetPositionId()
    return self.positionId
end

BasePlayerInfo.__init = __init
BasePlayerInfo.__delete = __delete
BasePlayerInfo.ParseData = ParseData
BasePlayerInfo.ChangeSelfName = ChangeSelfName
BasePlayerInfo.ChangeMoodStr=ChangeMoodStr
BasePlayerInfo.GetHeadBgImg = GetHeadBgImg
BasePlayerInfo.GetCountryFlagTemplate = GetCountryFlagTemplate
return BasePlayerInfo