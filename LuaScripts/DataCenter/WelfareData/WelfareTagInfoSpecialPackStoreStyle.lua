---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by darcy.
--- DateTime: 2021/5/27 11:05 上午
---

require "DataCenter.WelfareData.WelfareTagInfo"

---@class WelfareTagInfoSpecialPackStoreStyle : WelfareTagInfo 和特殊礼包逻辑都一样，只是表现和 store 一样 
local WelfareTagInfoSpecialPackStoreStyle = BaseClass("WelfareTagInfoSpecialPackStoreStyle", WelfareTagInfo)
local M = WelfareTagInfoSpecialPackStoreStyle


function M:ctor()
    WelfareTagInfo.ctor(self)
    self.packIdList = {}
end

function M:parse(data)
    WelfareTagInfo.parse(self, data)
    local _para1 = data:getValue("para1")
    if _para1 ~= nil and _para1 ~= "" then
        self.packIdList = string.split(_para1, ';')
    end
end

function M:isShow()
    --return true
    local list = self:getPackList(false)
    return list ~= nil and #list > 0 and WelfareTagInfo.isShow(self)
end

---@return GiftPackInfoDefault[]
function M:getPackList(isSort)
    if #self.packIdList <= 0 then
        return {}
    end

    local list = GiftPackageData.getPacks(self.packIdList, isSort)
    for _, v in ipairs(list) do
        v:setTagID(self:getID())
    end
    return list
end

function M:getNameForIcon()
    local list = self:getPackList(true)
    if #list < 1 then
        return ""
    end
    return list[1]:getNameText()
end

function M:getIconName()
    local list = self:getPackList(true)
    if #list < 1 then
        return "close"
    end
    return list[1]:getUIKey()
end

function M:isShowIcon()
    return self:isShow() and WelfareTagInfo.isShowIcon(self)
end

function M:getPopPackList(isSort)
    if #self.packIdList <= 0 then
        return {}
    end

    local list = GiftPackageData.getPopSpecialPacksById(self.packIdList, isSort)
    for _, v in ipairs(list) do
        v:setTagID(self:getID())
    end
    return list
end

---临时测试代码 
--function M:getType()
--    return WelfareTagType.SpecialPackStoreStyle
--end

return M