---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2023/2/24 18:04
---

local EquipmentUtil = {}
local Localization = CS.GameEntry.Localization

local BG_Icon_Path = {
    "Common_img_quality_white",
    "Common_img_quality_green",
    "Common_img_quality_blue",
    "Common_img_quality_purple",
    "Common_img_quality_orange",
}

local Name_Color = {
    Color32.New(1, 1, 1, 1),
    Color32.New(235/255, 250/255, 96/255, 1),
    Color32.New(229/255, 243/255, 255/255, 1),
    Color32.New(255/255, 153/255, 251/255, 1),
    Color32.New(255/255, 202/255, 76/255, 1),
    --Color32.New(255/255, 179/255, 128/255, 1)
}

local Info_Panel_Title_BG = {
    "Personnelcar_img_tips_character1",
    "Personnelcar_img_tips_character2",
    "Personnelcar_img_tips_character3",
    "Personnelcar_img_tips_character4",
    "Personnelcar_img_tips_character5",
}

local Fight_Empty_Icon_Path = {
    "Personnelcar_icon_fight_cucoloris01",
    "Personnelcar_icon_fight_cucoloris02",
    "Personnelcar_icon_fight_cucoloris01",
    "Personnelcar_icon_fight_cucoloris01",
    "Personnelcar_icon_fight_cucoloris01",
}

local Gather_Empty_Icon_Path = {
    "Personnelcar_icon_gather_cucoloris01",
    "Personnelcar_icon_gather_cucoloris02",
    "Personnelcar_icon_gather_cucoloris01",
    "Personnelcar_icon_gather_cucoloris01",
    "Personnelcar_icon_gather_cucoloris01",
}
local empty_pic_path = "Assets/Main/Sprites/UI/UIGarageRefit/%s"

local function GetEquipmentEmptyIcon(suitType, pos)
    if suitType == EquipmentConst.EquipmentSuitType.Equipment_Suit_Type_Fight then
        return string.format(empty_pic_path, Fight_Empty_Icon_Path[pos] or Fight_Empty_Icon_Path[1])
    end
    if suitType == EquipmentConst.EquipmentSuitType.Equipment_Suit_Type_Gather then
        return string.format(empty_pic_path, Gather_Empty_Icon_Path[pos] or Gather_Empty_Icon_Path[1])
    end
    return string.format(empty_pic_path, Fight_Empty_Icon_Path[1])
end

local function GetEquipmentIcon(equipmentId)
    --return string.format(LoadPath.ItemPath, "item210309")
    local template = DataCenter.EquipmentTemplateManager:GetTemplate(equipmentId)
    if template then
        return string.format(LoadPath.UIEquipmentIcons, template.icon)
    end
    return ""
end

local function GetEquipmentQualityBG(equipmentId)
    --return string.format(LoadPath.ItemPath, "Common_img_quality_blue")
    local template = DataCenter.EquipmentTemplateManager:GetTemplate(equipmentId)
    if template then  
        --return string.format(LoadPath.UIEquipmentIcons, "equipment_bg_"..template.color)
        return string.format(LoadPath.ItemPath, BG_Icon_Path[template.color])
    end
    return string.format(LoadPath.ItemPath, "Common_img_quality_empty")
end

local function GetEquipmentAttr(equipmentId)
    local result = {}
    local template = DataCenter.EquipmentTemplateManager:GetTemplate(equipmentId)
    if template then
        for k, v in ipairs(template.attrInfos) do
            local unlockLv = EquipmentUtil.GetQualityUnlockLv(equipmentId, k)
            local param = {}
            param.desc = v.des
            local isUnlock = EquipmentUtil.IsEquipmentAttrUnlock(equipmentId, k)
            if not isUnlock then
                param.isLocked = true
                param.unlockLv = unlockLv + 1
                --param.desc = Localization:GetString(300665, param.unlockLv)..Localization:GetString(v.des)
                param.desc = Localization:GetString(v.des)
                param.value = "("..Localization:GetString(v.unlockTip)..")"
                param.num = EquipmentUtil.GetEffectNumWithType(v.value, v.showType)
            else
                param.value = EquipmentUtil.GetEffectNumWithType(v.value, v.showType)
                param.desc = Localization:GetString(v.des)
            end
            table.insert(result, param)
        end
    end
    return result
end

local function GetEquipmentSuitAttr(suitId, index)
    local suitTemplate = DataCenter.EquipmentSuitTemplateManager:GetTemplate(suitId)
    if suitTemplate == nil or suitTemplate.attrInfos[index] == nil then
        return nil
    end
    return suitTemplate.attrInfos[index]
end

local function GetEquipmentLv1Id(equipmentId) 
    local id = toInt(equipmentId)
    return id // 100 * 100
end

local function GetEffectNumWithType(value, type)
    local addValue = tonumber(value)
    if type == EquipmentConst.EffectShowType.EffectShowType_0 then
        return  "+"..string.GetFormattedPercentStr(value/100)
    elseif type == EquipmentConst.EffectShowType.EffectShowType_1 then
        return "-" .. string.GetFormattedPercentStr(value/100)
    elseif type == EquipmentConst.EffectShowType.EffectShowType_2 then
        return  "+" .. string.GetFormattedSeperatorNum(value)
    elseif type == EquipmentConst.EffectShowType.EffectShowType_3 then
        return  "-" .. string.GetFormattedSeperatorNum(value)
    end
    return ""
end

local function GetEquipmentUnlockAttrNum(color)
    if color == EquipmentConst.EquipmentColor.EquipmentColor_White then
        return 1
    elseif color == EquipmentConst.EquipmentColor.EquipmentColor_Green then
        return 2
    elseif color == EquipmentConst.EquipmentColor.EquipmentColor_Blue or color == EquipmentConst.EquipmentColor.EquipmentColor_Purple then
        return 3
    elseif color == EquipmentConst.EquipmentColor.EquipmentColor_Orange then
        return 4
    end
    return 1
end 

local function GetQualityUnlockLv(equipmentId, index)
    return DataCenter.EquipmentTemplateManager:GetQualityUnlockLv(equipmentId, index)
end

local function IsEquipmentAttrUnlock(equipmentId, index)
    local template = DataCenter.EquipmentTemplateManager:GetTemplate(equipmentId)
    if template then
        return index <= EquipmentUtil.GetEquipmentUnlockAttrNum(template.color)
    end
    return false
end

local ColorText = {100230, 100229, 100228, 100227, 100226}

local function GetColorText(color)
    if ColorText[color] == nil then
        return ColorText[1]
    end
    return ColorText[color]
end

local function IsReachMaxLv(lv)
    return lv >= EquipmentConst.EquipmentMaxLevel
end

local function IsEquipmentSysOpen()
    if not LuaEntry.DataConfig:CheckSwitch("car_equip") then
        return false
    end

    local mainLv = DataCenter.BuildManager.MainLv
    local k1 = LuaEntry.DataConfig:TryGetNum("car_equip", "k1")
    return mainLv >= k1
end

local function GetEquipmentNameColor(color)
    if color > #Name_Color then
        return Name_Color[1]
    end
    return Name_Color[color]
end

local function GetInfoPanelTitleBG(color)
    if color > #Info_Panel_Title_BG then
        return string.format(empty_pic_path, Info_Panel_Title_BG[1])
    end
    return string.format(empty_pic_path, Info_Panel_Title_BG[color])
end

local function EquipmentInfoPanelLeftOrRight(suitType, pos)
    if suitType == EquipmentConst.EquipmentSuitType.Equipment_Suit_Type_Fight then
        if pos == EquipmentConst.Position.Equipment_Position_Body or pos == EquipmentConst.Position.Equipment_Position_Wheel then
            return true, false
        end
    elseif suitType == EquipmentConst.EquipmentSuitType.Equipment_Suit_Type_Gather then
        if pos == EquipmentConst.Position.Equipment_Position_Body then
            return true, false
        end
        if pos == EquipmentConst.Position.Equipment_Position_Energy_Core then
            return false, true
        end
    end
    return false, false
end

local function GetFormationIndexByCarIndex(carIndex) 
    local result = math.modf(carIndex, 100)
    return result
end

local function GetFormationTypeByCarIndex(carIndex)
    local result = math.floor(carIndex / 100)
    return result
end

local function GetCarIndexByFormationIndex(formationType, formationIndex)
    local result = formationType * 100 + formationIndex
    return result
end

local function GetEquipmentTypeByBuildingId(buildingId)
    local result = {}
    if buildingId == BuildingTypes.FUN_BUILD_DEFENCE_CENTER_NEW then
        result[EquipmentConst.EquipmentSuitType.Equipment_Suit_Type_Defence] = 1
    elseif buildingId == BuildingTypes.WORM_HOLE_CROSS then
        result[EquipmentConst.EquipmentSuitType.Equipment_Suit_Type_Defence] = 1
    else
        result[EquipmentConst.EquipmentSuitType.Equipment_Suit_Type_Fight] = 1
        result[EquipmentConst.EquipmentSuitType.Equipment_Suit_Type_Gather] = 1
    end
    return result
end

local function IsNormalCarIndex(carIndex)
    return carIndex ~= nil and carIndex < 100
end

EquipmentUtil.GetEquipmentTypeByBuildingId = GetEquipmentTypeByBuildingId
EquipmentUtil.GetFormationTypeByCarIndex = GetFormationTypeByCarIndex
EquipmentUtil.GetFormationIndexByCarIndex = GetFormationIndexByCarIndex
EquipmentUtil.GetCarIndexByFormationIndex = GetCarIndexByFormationIndex
EquipmentUtil.GetEquipmentIcon = GetEquipmentIcon
EquipmentUtil.GetEquipmentQualityBG = GetEquipmentQualityBG
EquipmentUtil.GetEquipmentAttr = GetEquipmentAttr
EquipmentUtil.GetEquipmentSuitAttr = GetEquipmentSuitAttr
EquipmentUtil.GetEquipmentLv1Id = GetEquipmentLv1Id
EquipmentUtil.GetEffectNumWithType = GetEffectNumWithType
EquipmentUtil.GetEquipmentUnlockAttrNum = GetEquipmentUnlockAttrNum
EquipmentUtil.IsEquipmentAttrUnlock = IsEquipmentAttrUnlock
EquipmentUtil.GetQualityUnlockLv = GetQualityUnlockLv
EquipmentUtil.GetColorText = GetColorText
EquipmentUtil.IsReachMaxLv = IsReachMaxLv
EquipmentUtil.IsEquipmentSysOpen = IsEquipmentSysOpen
EquipmentUtil.GetEquipmentEmptyIcon = GetEquipmentEmptyIcon
EquipmentUtil.GetEquipmentNameColor = GetEquipmentNameColor
EquipmentUtil.GetInfoPanelTitleBG = GetInfoPanelTitleBG
EquipmentUtil.EquipmentInfoPanelLeftOrRight = EquipmentInfoPanelLeftOrRight
EquipmentUtil.IsNormalCarIndex = IsNormalCarIndex

return EquipmentUtil