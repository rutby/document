---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2023/2/24 17:32
---
---

local EquipmentSuitTemplate = BaseClass("EquipmentSuitTemplate")
local EquipmentSuitAttrInfo = require "DataCenter.EquipmentManager.EquipmentSuitAttrInfo"

local function __init(self)
    self.id = 0
    self.type = 0
    self.name = 0
    self.description = 0
    self.attrInfos = {}
    self.includeEquip = {}
    self.order = 0
    self.effect_icon = {}--技能图标名称
end

local function __delete(self)
    self.id = 0
    self.type = 0
    self.name = 0
    self.description = 0
    self.attrInfos = {}
    self.includeEquip = {}
    self.order = 0
    self.effect_icon = {}--技能图标名称
end

local function InitData(self, row)
    self.id = row:getValue("id")
    self.type = row:getValue("type")
    self.name = row:getValue("name")
    self.description = row:getValue("description")
    self.order = row:getValue("order")
    self.attrInfos = {}

    self.effect_icon = {}
    for i = 1, EquipmentConst.MaxSuitAttr, 1 do
        local effectStr = row:getValue("effect_description" .. i)
        local valueVec = {}
        local valueStr = tostring(row:getValue("value"..i))
        if not string.IsNullOrEmpty(valueStr) then
            valueVec = string.split(valueStr, "|")
        end
        local effectConditionStr = tostring(row:getValue("effect_condition"..i))
        local effectConditionMap = {}
        if not string.IsNullOrEmpty(effectConditionStr) then
            local tmpVec = string.split(effectConditionStr, ";")
            if table.count(tmpVec) == 2 then
                effectConditionMap[toInt(tmpVec[1])] = toInt(tmpVec[2])
            end
        end
        
        local unlockTip = row:getValue("unlock_tips"..i)
        local info = EquipmentSuitAttrInfo.New()
        info:InitData(effectStr, valueVec, unlockTip, effectConditionMap)
        table.insert(self.attrInfos, info)

        self.effect_icon[i] = row:getValue("effect_icon" .. i) or ""
    end

    self.includeEquip = {}
    local includeStr = row:getValue("equip")
    if not string.IsNullOrEmpty(includeStr) then
        self.includeEquip = string.string2array_i(includeStr, ";")[1]
    end
end

local function GetAllAttrInfo(self)
    return self.attrInfos
end

local function IsContainsEquipment(self, equipmentId)
    local lv1Id = EquipmentUtil.GetEquipmentLv1Id(equipmentId)
    for _, v in pairs(self.includeEquip) do
        if v == lv1Id then
            return true
        end
    end
    return false
end

--获取套装技能默认图片
function EquipmentSuitTemplate:GetSkillIconNameByIndex(index)
    local result = self.effect_icon[index]
    if result == nil or result == "" then
        result = "Personnelcar_icon_suit_default_01"
    end
    
    return string.format(LoadPath.UIGarageRefit, result)
end

--获取套装技能默认图片
function EquipmentSuitTemplate:GetSkillQualityIconNameByIndex(index)
    local result = self.effect_icon[index]
    if result == nil or result == "" then
        result = "Personnelcar_icon_suit_default_02"
    end

    return string.format(LoadPath.UIGarageRefit, result)
end



EquipmentSuitTemplate.__init = __init
EquipmentSuitTemplate.__delete = __delete
EquipmentSuitTemplate.InitData = InitData
EquipmentSuitTemplate.GetAllAttrInfo = GetAllAttrInfo
EquipmentSuitTemplate.IsContainsEquipment = IsContainsEquipment

return EquipmentSuitTemplate