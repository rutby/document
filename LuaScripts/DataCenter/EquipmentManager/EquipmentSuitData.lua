---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2023/3/1 18:05
---


local EquipmentSuitData = BaseClass("EquipmentSuitData")

local function __init(self)
    self.carIndex = 0
    self.type = 0
    self.equips = {}
    self.effect = {}
    self.formationIndex = 0
    self.formationType = 0
end

local function __delete(self)
    self.carIndex = 0
    self.type = 0
    self.equips = {}
    self.effect = {}
    self.formationIndex = 0
    self.formationType = 0
end

local function ParseData(self, param)
    if param["carIndex"] then
        self.carIndex = param["carIndex"]
        self.formationIndex = EquipmentUtil.GetFormationTypeByCarIndex(self.carIndex)
        self.formationType = EquipmentUtil.GetFormationIndexByCarIndex(self.carIndex)
    end
    if param["type"] then
        self.type = param["type"]
    end
    if param["equips"] then
        self.equips = DeepCopy(param["equips"])
    end
    if param["effect"] then
        for k, v in pairs(param["effect"]) do
            self.effect[toInt(k)] = tonumber(v)
        end
    end
end

local function RemoveEquip(self, equipUid)
    local find = -1
    for k, v in ipairs(self.equips) do
        if v == equipUid then
            find = k
            break
        end
    end
    if find > 0 then
        table.remove(self.equips, find)
    end
end

local function GetEquipmentUidByPos(self, pos)
    for _, v in ipairs(self.equips) do
        local equipData = DataCenter.EquipmentDataManager:GetEquipByUuid(v)
        if equipData ~= nil then
            local template = DataCenter.EquipmentTemplateManager:GetTemplate(equipData.equipId)
            if template and template.position == pos then
                return v
            end
        end
    end
    return nil
end

local function ContainsEquipments(self, equipmentUid)
    for _, v in ipairs(self.equips) do
        if v == equipmentUid then
            return true
        end
    end
    return false
end

local function GetEffectValue(self, effectId) 
    local result = 0
    if self.effect[effectId] then
        result = self.effect[effectId]
    end
    for _, v in ipairs(self.equips) do
        local equipmentData = DataCenter.EquipmentDataManager:GetEquipByUuid(v)
        if equipmentData then
            result = result + equipmentData:GetEffectValue(effectId)
        end
    end
    return result
end

EquipmentSuitData.__init = __init
EquipmentSuitData.__delete = __delete
EquipmentSuitData.ParseData = ParseData
EquipmentSuitData.RemoveEquip = RemoveEquip
EquipmentSuitData.GetEquipmentUidByPos = GetEquipmentUidByPos
EquipmentSuitData.ContainsEquipments = ContainsEquipments
EquipmentSuitData.GetEffectValue = GetEffectValue

return EquipmentSuitData