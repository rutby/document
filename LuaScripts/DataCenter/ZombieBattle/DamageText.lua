---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2024/3/15 10:54
---

local DamageText = BaseClass("DamageText")

local White = Color.New(1,1,1,1)
local White32 = Color.New(255,255,255,255)
local Red32 = Color.New(255,0,0,255)
local Red = Color.New(0.9333333,0,0,1)
local Yellow32 = Color.New(255,221,87,255)
local Yellow = Color.New(1,0.909,0)
local Cyan32 = Color.New(0,255,255,255)--青色
local Purple = Color.New(0.65098,0.42352,0.94117,1)
local Purple32 = Color32.New(167,108,240,255)
local Transparent = Color.New(0,0,0,0)

local Crit_Path = "Assets/Main/Sprites/UI/LWCommon/zyf_tubiao_baoji_bai.png"
local Shield_Path = "Assets/Main/Sprites/UI/LWCommon/Sprite/zyf_guanka_dun.png"

local function __init(self)
    self.req = nil
    self.time = 0
end

local function Create(self)
    self.gameObject = self.req.gameObject
    self.transform = self.gameObject.transform
    self.numText = self.transform:Find("Scale/num"):GetComponent(typeof(CS.SuperTextMesh))
    self.critIcon = self.transform:Find("Scale/num/critIcon"):GetComponent(typeof(CS.UnityEngine.SpriteRenderer))
    self.simpleAnim = self.transform:GetComponent(typeof(CS.SimpleAnimation))
end

local function Destroy(self)
    if self.req then
        self.req:Destroy()
    end
end

local function SetData(self, damage, position, style, damageType, isCritical)
    self.numText.text = "-" .. damage
    local isShield = false
    local scale = 1
    local textColor = White32
    local spriteColor = White
    local iconPath = Crit_Path
    local animName = "fly"
    local hasOffset = false
    local showIcon = false
    if style == DamageTextType.HeroNormalAttack then--英雄普攻伤害
        if isCritical then
            scale = 1.5
            showIcon = true
        end
    elseif style == DamageTextType.ZombieNormalAttack then--丧尸普攻伤害
        textColor = Red32
        spriteColor = Red
        if isCritical then
            scale = 1.5
            showIcon = true
        end
    elseif style == DamageTextType.HeroUltimate then--英雄技能伤害
        textColor = Yellow32
        spriteColor = Yellow
        scale = 1.8
        animName = "hold"
        hasOffset = true
        if isCritical then
            showIcon = true
        end
    elseif style == DamageTextType.ZombieUltimate then--丧尸技能伤害
        textColor = Red32
        spriteColor = Red
        scale = 1.8
        animName = "hold"
        hasOffset = true
        if isCritical then
            showIcon = true
        end
    elseif style == DamageTextType.GetBuff then--倍增门获得buff
        self.numText.text = damage
        animName = "Default"    --BuffFlyText 资源上没有fly动画
    elseif style == DamageTextType.ReduceDamageBuff then--承伤者拥有减伤buff
        isShield = true
        iconPath = Shield_Path
        textColor = Cyan32
        scale = 1.5
        animName = "hold"
        showIcon = true
        hasOffset = true
    elseif style == DamageTextType.Drone then--无人机伤害
        textColor = Purple32
        spriteColor = Purple
        scale = 1.8
        animName = "hold"
        hasOffset = true
        showIcon = true
    elseif style == DamageTextType.Miss then--miss
        self.numText.text = "MISS"
    end

    self.numText.color32 = textColor
    self.simpleAnim:Rewind(animName)
    self.simpleAnim:Play(animName)
    self.transform:Set_localScale(scale,scale,scale)
    if hasOffset then
        self.transform.position = position + Vector3.New(math.random()*3-2,math.random()*1.5+2,0)
    else
        self.transform.position = position
    end
    if showIcon then
        self.critIcon:LoadSprite(iconPath)
        self.critIcon.color = spriteColor
        local strLen = #(self.numText.text)
        self.critIcon.transform:Set_localPosition(-0.3-0.15*strLen,0.1,0)
    else
        self.critIcon.color = Transparent
    end
end

DamageText.__init = __init
DamageText.Create = Create
DamageText.Destroy = Destroy
DamageText.SetData = SetData

return DamageText