---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by w.
--- DateTime: 2022/12/19 13:47
---
local TinyHead = BaseClass("TinyHead");
local Resource = CS.GameEntry.Resource


local TinyHeadPath = "Assets/Main/Prefabs/LWBattle/TinyHead.prefab"


function TinyHead:__init(transform,height)
    self.target = transform
    self.camera = CS.UnityEngine.Camera.main
    self.height = height
    self.myWorldPos = Vector3.zero
end

function TinyHead:__delete()
    self:Destroy()
end

function TinyHead:Destroy()
    if(self.req) then
        self.req:Destroy()
        self.req = nil
    end
    self.target = nil
    self.gameObject = nil
    self.transform = nil
    self.head = nil
end

function TinyHead:LoadAndSetHead(path)
    self.req = Resource:InstantiateAsync(self:GetBarAsset())
    self.req:completed('+', function(req)
        local go = req.gameObject
        local CanvasNormal = UIManager:GetInstance():GetLayer(UILayer["Scene"]["Name"]).gameObject
        go.transform:SetParent(CanvasNormal.transform)
        self.gameObject = go
        self.transform = go.transform
        self.transform:Set_localScale(ResetScale.x, ResetScale.y, ResetScale.z)
        self.transform.position = Vector3.New(-9999,-9999,0)
        self:InitData()
        self:InitComponent()
        self:SetHead(path)
    end)
end


function TinyHead:Load()
    self.req = Resource:InstantiateAsync(self:GetBarAsset())
    self.req:completed('+', function(req)
        local go = req.gameObject
        local CanvasNormal = UIManager:GetInstance():GetLayer(UILayer["Scene"]["Name"]).gameObject
        go.transform:SetParent(CanvasNormal.transform)
        self.gameObject = go
        self.transform = go.transform
        self.transform:Set_localScale(ResetScale.x, ResetScale.y, ResetScale.z)
        self:InitData()
        self:InitComponent()
    end)
end

function TinyHead:InitData()

end

function TinyHead:InitComponent()
    self.head = self.transform:Find("head"):GetComponent(typeof(CS.UnityEngine.UI.Image))
end

function TinyHead:SetHead(path)
    if self.head then
        self.head:LoadSprite(path)
    end
end


function TinyHead:GetBarAsset()
    return TinyHeadPath
end

function TinyHead:Update()
    if self.transform then
        self:UpdatePos()
    end
end

function TinyHead:UpdatePos()
    -- 获取对应位置在屏幕上的坐标位置
    self.myWorldPos.x, self.myWorldPos.y, self.myWorldPos.z = self.target:Get_position()
    self.myWorldPos.y = self.myWorldPos.y + self.height
    self.transform.position = CS.CSUtils.WorldPositionToUISpacePosition(self.myWorldPos)
end

return TinyHead