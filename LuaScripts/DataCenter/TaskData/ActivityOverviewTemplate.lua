---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2022/5/26 15:07
---ActivityOverviewTemplate


local ActivityOverviewTemplate = BaseClass("ActivityOverviewTemplate")

local function __init(self)
    self.id = 0
    self.type = 0
    self.priority = EveryDayPriority.None
    self.unlockLv = 0
    self.unlockLvNew = 0
    self.unlockStory = nil
    self.activityName = ""
    self.activityIcon = ""
    self.activityIconNew = ""
    self.rewards = {}
    self.special_reward = ""
    self.order = 0
    self.unlock_image = ""
    self.invisibleWeekdays = {}
end

local function __delete(self)
    self.id = nil
    self.type = nil
    self.priority = nil
    self.unlockLv = nil
    self.unlockLvNew = nil
    self.unlockStory = nil
    self.activityName = nil
    self.activityIcon = nil
    self.activityIconNew = nil
    self.rewards = nil
    self.special_reward = nil
    self.order = nil
    self.unlock_image = nil
    self.invisibleWeekdays = nil
end

local function InitData(self, row)
    if row == nil then
        return
    end
    
    self.id = tonumber(row:getValue("id"))
    self.type = tonumber(row:getValue("type"))
    self.priority = tonumber(row:getValue("priority")) or EveryDayPriority.None
    self.unlockLv = tonumber(row:getValue("unlock")) or 0
    self.unlockLvNew = tonumber(row:getValue("unlock_new")) or 0
    self.unlockStory = nil
    local unlockLevelStrs = string.split(row:getValue("unlock_level") or "", ";")
    if #unlockLevelStrs == 2 then
        self.unlockStory = { mapId = tonumber(unlockLevelStrs[1]), level = tonumber(unlockLevelStrs[2]) }
    end
    self.activityName = row:getValue("name")
    self.activityIcon = row:getValue("image") or ""
    self.activityIconNew = row:getValue("new_image") or ""
    local strRewards = row:getValue("reward_show") or ""
    self.rewards = string.split(strRewards, ";")
    self.special_reward = row:getValue("special_reward") or ""
    self.order = tonumber(row:getValue("order"))
    local strDays = row:getValue("day_invisible") or ""
    self.unlock_image = row:getValue("unlock_image")
    local arrDays = string.split(strDays, ";")
    self.invisibleWeekdays = {}
    for i, v in ipairs(arrDays) do
        if not string.IsNullOrEmpty(v) then
            table.insert(self.invisibleWeekdays, tonumber(v))
        end
    end
end

local function CheckIfTodayOpen(self)
    local nowT = UITimeManager:GetInstance():GetServerTime()
    local nowWeekday = UITimeManager:GetInstance():GetWeekdayIndex(nowT)
    if table.hasvalue(self.invisibleWeekdays, nowWeekday) then
        return false
    else
        return true
    end
end

local function GetUnlockLv(self)
    if DataCenter.DailyActivityManager:CheckSwitchNew() then
        return self.unlockLvNew
    else
        return self.unlockLv
    end
end

local function GetUnlockStory(self)
    if DataCenter.DailyActivityManager:CheckSwitchNew() then
        return self.unlockStory
    else
        return nil
    end
end

ActivityOverviewTemplate.__init = __init
ActivityOverviewTemplate.__delete = __delete
ActivityOverviewTemplate.InitData = InitData
ActivityOverviewTemplate.CheckIfTodayOpen = CheckIfTodayOpen
ActivityOverviewTemplate.GetUnlockLv = GetUnlockLv
ActivityOverviewTemplate.GetUnlockStory = GetUnlockStory

return ActivityOverviewTemplate