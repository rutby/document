---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by mac.
--- DateTime: 7/28/21 4:29 PM
---
local Localization = CS.GameEntry.Localization
local MailArmyResultBase = require "DataCenter.MailData.BattleReport.MailArmyResultBase"
local MailArmyResult_Building = BaseClass("MailArmyResult_Building", MailArmyResultBase)

function MailArmyResult_Building:InitData(armyResult)
    MailArmyResultBase.InitData(self, armyResult)

    self._isDefeat = armyResult["isDefeat"]
    local armyResultByType = self:GetArmyResultByType(armyResult)
    self._cityLevel = armyResultByType["level"] or 0
    self._buildId = armyResultByType["buildId"] or 0

    local _armyResultBase = armyResultByType["base"]
    if (_armyResultBase == nil) then
        return
    end

    local armyObj = _armyResultBase["armyObj"] or {}
    self._armyObj = self:InitCombatUnitData(armyObj)

    local afterArmyObj = _armyResultBase["afterArmyObj"] or {}
    self._afterArmyObj = self:InitCombatUnitData(afterArmyObj)

    self:CheckArmyObj()
    
    self:InitDestroyValue(_armyResultBase)
    self:InitDamagePercentInfo(_armyResultBase)
end

function MailArmyResult_Building:GetName()
    if self._unitType == BattleType.ALLIANCE_BUILD_GUARD then
        return Localization:GetString("121551")
    elseif self._unitType == BattleType.CITY_GUARD then
        return Localization:GetString("121552")
    elseif self._unitType == BattleType.ALLIANCE_CITY_GUARD then
        return Localization:GetString("121550")
    end
    if (self._unitType == BattleType["Turret"]) then
        local strLevel = ""
        if self._cityLevel > 0 then
            strLevel = Localization:GetString("300665", self._cityLevel)
        end
        return strLevel .. " " .. Localization:GetString("300626")
    else
        local strLevel = ""
        if self._cityLevel > 0 then
            strLevel = Localization:GetString("300665", self._cityLevel)
        end
        return strLevel .. " " ..
                Localization:GetString(GetTableData(DataCenter.BuildTemplateManager:GetTableName(), self._buildId + self._cityLevel,"name"))
    end
end
function MailArmyResult_Building:GetPic()
    return DataCenter.BuildManager:GetBuildIconPath(self._buildId,self._cityLevel)
end

function MailArmyResult_Building:GetBuildId()
    return self._buildId
end
function MailArmyResult_Building:GetName_ForShare()
    local param = {["type"] = "dialog"}
    if self._unitType == BattleType.ALLIANCE_BUILD_GUARD then
        param["name"] = "121551"
    elseif self._unitType == BattleType.CITY_GUARD then
        param["name"] = "121552"
    elseif self._unitType == BattleType.ALLIANCE_CITY_GUARD then
        param["name"] = "121550"
    elseif (self._unitType == BattleType["Turret"]) then
        param["level"] = self._cityLevel
        param["name"] = "300626"
    else
        param["level"] = self._cityLevel
        param["name"] = GetTableData(DataCenter.BuildTemplateManager:GetTableName(), self._buildId + self._cityLevel,"name")
    end
    return param
end

return MailArmyResult_Building