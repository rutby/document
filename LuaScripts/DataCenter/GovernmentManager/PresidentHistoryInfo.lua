---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2023/3/13 16:44
---
local PresidentHistoryInfo = BaseClass("PresidentHistoryInfo")
local PresidentHistoryListInfo = require "DataCenter.GovernmentManager.PresidentHistoryListInfo"

function PresidentHistoryInfo:__init()
    self.historyKings = {}--只增加不删除
    self.serverId = 0
    self.page = 1--从第几个page开始拉取
end

function PresidentHistoryInfo:__delete()
    self.historyKings = {}--只增加不删除
    self.serverId = 0
    self.page = 1--从第几个page开始拉取
end

function PresidentHistoryInfo:ParseData(message)
    if message == nil then
        return
    end
    if message["serverId"] ~= nil then
        local serverId = message["serverId"]
        if serverId ~= self.serverId then
            --全部清空
            self.historyKings = {}
        end
        self.serverId = serverId
    end
    
    if message["historyKings"] then
        for _, v in ipairs(message["historyKings"]) do
            local round = v["round"]
            if self.historyKings[round] == nil then
                local info = PresidentHistoryListInfo.New()
                info:ParseData(v)
                self.historyKings[round] = info
            end
        end
    end
    if message["page"] then
        local page = message["page"]
        if page > self.page then
            self.page = page
        end
    end
end

--获取显示的国王历史列表
function PresidentHistoryInfo:GetShowList()
    local result = {}
    for k,v in pairs(self.historyKings) do
        table.insert(result, v)
    end
    if result[2] ~= nil then
        table.sort(result, function (a, b)
            return b.round < a.round
        end)
    end
    return result
end

--获取需要拉取的page
function PresidentHistoryInfo:GetNeedPage()
    return self.page + 1
end

return PresidentHistoryInfo