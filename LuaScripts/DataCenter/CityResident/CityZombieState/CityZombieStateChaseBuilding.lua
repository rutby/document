---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2024/3/28 15:53
---

local CityZombieStateBase = require "DataCenter.CityResident.CityZombieState.CityZombieStateBase"
local CityZombieStateChaseBuilding = BaseClass("CityZombieStateChaseBuilding", CityZombieStateBase)

local function OnEnter(self)
    self.data:PlayAnim(CityResidentDefines.AnimName.Walk1)
    self.data:SetSpeed(DataCenter.CityResidentManager:GetZombieChaseSpeed())
    
    local pos = DataCenter.CityResidentManager.occupyMgr:TryOccupyAttackBuildPos(self.data.uuid, self.data.targetBUuid)
    if pos then
        local mask = DataCenter.CityResidentManager:GetCurrentCityMask()
        self.data:GoToPos(pos, mask, CityResidentDefines.WayPointFlag.City | CityResidentDefines.WayPointFlag.Zombie, nil, true)
        return
    end
    
    -- 这里已经满员了
    local curTime = UITimeManager:GetInstance():GetServerTime()
    self.data.ignoreBUuidTimeDict[self.data.targetBUuid] = curTime
    self.data:Refresh()
end

local function OnExit(self)
    DataCenter.CityResidentManager.occupyMgr:ReleaseAttackBuildPos(self.data.uuid)
end

local function OnFinish(self)
    self.data:SetState(CityResidentDefines.ZombieState.AttackBuilding)
end

CityZombieStateChaseBuilding.OnEnter = OnEnter
CityZombieStateChaseBuilding.OnExit = OnExit
CityZombieStateChaseBuilding.OnFinish = OnFinish

return CityZombieStateChaseBuilding