---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/12/6 16:13
---

local CityResidentStateBase = require "DataCenter.CityResident.CityResidentState.CityResidentStateBase"
local CityResidentStatePlayDesk = BaseClass("CityResidentStatePlayDesk", CityResidentStateBase)

local function OnEnter(self)
    local tf, fUuid = DataCenter.CityResidentManager.occupyMgr:TryOccupyFurnitureTransform(self.data.uuid, FurnitureType.Desk)
    if tf then
        local duration = DataCenter.FurnitureManager:GetFurnitureLocalNum(fUuid, 1)
        self.data:SetRot(tf.rotation)
        self.data:Idle()
        self.data:ShowTool("")
        self.data:PlayAnim(CityResidentDefines.AnimName.Write)
        self.data:WaitForFinish(duration)
        
        --local offset = Vector3.New(-10, 90, 0)
        --self:ShowFurnitureResidentSlider(fUuid, nil, offset)
        
        EventManager:GetInstance():Broadcast(EventId.CityResidentEnterFurniture, { rUuid = self.data.uuid, fUuid = fUuid })
    end
    self.fUuid = fUuid
end

local function OnExit(self)
    --DataCenter.CityHudManager:Destroy(self.data.uuid, CityHudType.ResidentSlider)
    DataCenter.CityResidentManager.occupyMgr:ReleaseOccupyFurnitureTransform(self.data.uuid)

    EventManager:GetInstance():Broadcast(EventId.CityResidentExitFurniture, { rUuid = self.data.uuid, fUuid = self.fUuid })
end

local function OnFinish(self)
    self.data:Refresh()

    local fUuid = self.fUuid
    local icon = DataCenter.FurnitureManager:GetFurnitureEffectIcon(fUuid)
    local count = DataCenter.FurnitureManager:GetFurnitureLocalNum(fUuid, 2)
    self:ShowFurnitureProductGain(icon, count)
end

CityResidentStatePlayDesk.OnEnter = OnEnter
CityResidentStatePlayDesk.OnExit = OnExit
CityResidentStatePlayDesk.OnFinish = OnFinish

return CityResidentStatePlayDesk