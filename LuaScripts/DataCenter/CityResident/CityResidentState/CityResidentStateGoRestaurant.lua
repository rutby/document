---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/12/20 11:55
---

local CityResidentStateBase = require "DataCenter.CityResident.CityResidentState.CityResidentStateBase"
local CityResidentStateGoRestaurant = BaseClass("CityResidentStateGoRestaurant", CityResidentStateBase)

local function OnEnter(self)
    if self.data.eaten then
        -- 吃过了
        self.data:SetState(CityResidentDefines.State.Rest)
        return
    end
    
    if not self.data.eaten then
        local mealCount = LuaEntry.Resource:GetCntByResType(ResourceType.Meal)
        if mealCount >= 1 then
            local buildData = DataCenter.BuildManager:GetFunbuildByItemID(BuildingTypes.DS_RESTAURANT)
            if buildData then
                local wayPoint = WayPointUtil.GetOneWayPointByMask(buildData.uuid, CityResidentDefines.WayPointFlag.Special)
                if wayPoint then
                    self.data:SetAutoAnim(true)
                    self.data:GoToBuildingPos(buildData.uuid, wayPoint.pos, true)
                    self.data:ShowTool("")
                    return
                end
            end
        end
    end

    -- 没饭吃
    self:TalkNoFood()
    self.data:SetState(CityResidentDefines.State.Rest)
end

local function OnFinish(self)
    local mealCount = LuaEntry.Resource:GetCntByResType(ResourceType.Meal)
    if mealCount >= 1 then
        self.data:SetState(CityResidentDefines.State.GoForMeal)
    else
        self:TalkNoFood()
        self.data:SetState(CityResidentDefines.State.GoToIdle)
    end
end

CityResidentStateGoRestaurant.OnEnter = OnEnter
CityResidentStateGoRestaurant.OnFinish = OnFinish

return CityResidentStateGoRestaurant