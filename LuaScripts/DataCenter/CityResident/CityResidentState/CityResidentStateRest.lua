---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2024/4/11 10:47
---

local CityResidentStateBase = require "DataCenter.CityResident.CityResidentState.CityResidentStateBase"
local CityResidentStateRest = BaseClass("CityResidentStateRest", CityResidentStateBase)

local function OnEnter(self)
    if table.hasvalue(DataCenter.CityResidentManager.overworkUuids, self.data.uuid) then
        self.data:SetState(CityResidentDefines.State.Overwork)
        return
    end
    
    if self.data.drunkEndTime == 0 then
        -- 没喝过酒
        local buildData = DataCenter.BuildManager:GetFunbuildByItemID(BuildingTypes.DS_BAR)
        if buildData and buildData.level > 0 then
            -- 前往酒吧
            self.data:ShowTool("")
            self.data:SetAutoAnim(true)
            local career = self.data:GetCareer()
            if career == CityResidentDefines.Career.Bartender then
                self.data:GoToFurniture(self.data.residentData.fUuid)
                return
            else
                local wayPoint = WayPointUtil.GetOneWayPointByMask(buildData.uuid, CityResidentDefines.WayPointFlag.Special)
                if wayPoint then
                    self.data:GoToBuildingPos(buildData.uuid, wayPoint.pos, false)
                    return
                end
            end
        end
    end

    self.data:SetState(CityResidentDefines.State.GoToIdle)
end

local function OnFinish(self)
    local career = self.data:GetCareer()
    if career == CityResidentDefines.Career.Bartender then
        self.data:SetState(CityResidentDefines.State.BartenderMix)
    else
        self.data:SetState(CityResidentDefines.State.GoBar)
    end
end

CityResidentStateRest.OnEnter = OnEnter
CityResidentStateRest.OnFinish = OnFinish

return CityResidentStateRest