---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/11/23 10:52
---

local CityResidentStateBase = require "DataCenter.CityResident.CityResidentState.CityResidentStateBase"
local CityResidentStateGoForMeal = BaseClass("CityResidentStateGoForMeal", CityResidentStateBase)

local function OnEnter(self)
    local mealCount = LuaEntry.Resource:GetCntByResType(ResourceType.Meal)
    if mealCount >= 1 then
        local tf = DataCenter.CityResidentManager:GetNextFoodWindowTransform()
        if tf then
            local buildData = DataCenter.BuildManager:GetFunbuildByItemID(BuildingTypes.DS_RESTAURANT)
            self.data:SetAutoAnim(true)
            self.data:GoToBuildingPos(buildData.uuid, tf.position, false)
            self.data:ShowTool("")
            self.data.foodWindowTf = tf
            return
        end
    end

    self:TalkNoFood()
    self.data:SetState(CityResidentDefines.State.Rest)
end

local function OnFinish(self)
    self.data.eaten = true
    
    local mealCount = LuaEntry.Resource:GetCntByResType(ResourceType.Meal)
    if mealCount >= 1 then
        self.data:SetState(CityResidentDefines.State.TakeMeal)
    else
        self:TalkNoFood()
        self.data:SetState(CityResidentDefines.State.Rest)
    end
end

CityResidentStateGoForMeal.OnEnter = OnEnter
CityResidentStateGoForMeal.OnFinish = OnFinish

return CityResidentStateGoForMeal