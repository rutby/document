---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/11/23 10:52
---

local CityResidentStateBase = require "DataCenter.CityResident.CityResidentState.CityResidentStateBase"
local CityResidentStateGoToSleep = BaseClass("CityResidentStateGoToSleep", CityResidentStateBase)

local function OnEnter(self)
    if table.hasvalue(DataCenter.CityResidentManager.overworkUuids, self.data.uuid) then
        self.data:SetState(CityResidentDefines.State.Overwork)
        return
    end
    
    local fUuid = DataCenter.CityResidentManager.occupyMgr:TryOccupyBed(self.data.uuid)
    if fUuid ~= 0 then
        self.hasBed = true
        self.data:SetAutoAnim(true)
        self.data:GoToFurniture(fUuid)
    else
        self.hasBed = false
        local pos = DataCenter.CityResidentManager:GetNoBedPos()
        self.data:SetAutoAnim(true)
        self.data:GoToCityPos(pos)
        self.data:ShowTool("")
    end
end

local function OnFinish(self)
    if self.hasBed then
        self.data:SetState(CityResidentDefines.State.Sleep)
    else
        self.data:SetState(CityResidentDefines.State.SleepNoBed)
    end
end

CityResidentStateGoToSleep.OnEnter = OnEnter
CityResidentStateGoToSleep.OnFinish = OnFinish

return CityResidentStateGoToSleep