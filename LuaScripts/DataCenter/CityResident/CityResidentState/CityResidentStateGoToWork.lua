---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/11/23 10:52
---

local CityResidentStateBase = require "DataCenter.CityResident.CityResidentState.CityResidentStateBase"
local CityResidentStateGoToWork = BaseClass("CityResidentStateGoToWork", CityResidentStateBase)

local function OnEnter(self)
    if not self.data.residentData:IsStrike() and self.data.residentData.fUuid ~= 0 then
        local furnitureInfo = DataCenter.FurnitureManager:GetFurnitureByUuid(self.data.residentData.fUuid)
        if furnitureInfo then
            local career = self.data:GetCareer()
            if career == CityResidentDefines.Career.Doctor then
                self.data.sickBedFUuid = DataCenter.CityResidentManager:GetRandomSickBedByBUuid(furnitureInfo.bUuid)
                if self.data.sickBedFUuid ~= 0 then
                    self.data:SetAutoAnim(true)
                    self.data:GoToFurniture(self.data.sickBedFUuid)
                    return
                end
            end

            self.data:ShowTool("")
            self.data:SetAutoAnim(true)
            self.data:GoToFurniture(self.data.residentData.fUuid)
        end
        return
    end
    
    self.data:SetState(CityResidentDefines.State.Rest)
end

local function OnFinish(self)
    local career = self.data:GetCareer()
    local workFlag = CityResidentDefines.WorkWayPointFlag[career]
    if workFlag then
        self.data:SetState(CityResidentDefines.State.GoToWorkWayPoint)
    elseif career == CityResidentDefines.Career.Bartender then
        self.data:SetState(CityResidentDefines.State.BartenderGoSweep)
    else
        self.data:SetState(CityResidentDefines.State.Work)
    end
end

CityResidentStateGoToWork.OnEnter = OnEnter
CityResidentStateGoToWork.OnFinish = OnFinish

return CityResidentStateGoToWork