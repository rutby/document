---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2024/2/26 19:28
---

local CityResidentStateBase = require "DataCenter.CityResident.CityResidentState.CityResidentStateBase"
local CityResidentStateReadyHide = BaseClass("CityResidentStateReadyHide", CityResidentStateBase)
local Localization = CS.GameEntry.Localization

local function OnEnter(self)
    if self.data.immediate then
        -- 引导时立刻消失
        self.data:OnFinish()
        self.data.immediate = false
        return
    end
    local pos = self.data:GetPos()
    if pos.x >= 0 then
        local fromPos, _ = DataCenter.CityResidentManager:GetReadyQueuePos(self.data.readyIndex)
        if fromPos then
            self.data:SetAutoAnim(true)
            self.data:GoToCityPos(fromPos)
            
            if self.data.readyIndex == 1 then
                DataCenter.CityResidentManager:ResidentSpeak(self.data.uuid, Localization:GetString("441050"), 5)
            end
        end
    end
end

local function OnFinish(self)
    self.data:Idle()
    self.data:PlayAnim(CityResidentDefines.AnimName.Idle)
    self.data:SetPos(CityResidentDefines.ResidentReadyHidePos)
end

CityResidentStateReadyHide.OnEnter = OnEnter
CityResidentStateReadyHide.OnFinish = OnFinish

return CityResidentStateReadyHide