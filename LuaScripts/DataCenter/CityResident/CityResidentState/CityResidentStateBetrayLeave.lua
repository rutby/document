---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2024/4/8 11:13
---

local CityResidentStateBase = require "DataCenter.CityResident.CityResidentState.CityResidentStateBase"
local CityResidentStateBetrayLeave = BaseClass("CityResidentStateBetrayLeave", CityResidentStateBase)

local function OnEnter(self)
    local _, toPos = DataCenter.CityResidentManager:GetBetrayPos(self.data.betrayIndex)
    if toPos then
        self.data:ShowTool("")
        self.data:SetAutoAnim(true)
        self.data:GoToCityPos(toPos)
    else
        self:OnFinish()
    end

    if self.data.betrayIndex == 1 then
        -- 小人说话
        local param = {}
        param.type = CityResidentDefines.TalkTriggerType.ResidentBetray
        param.rUuid = self.data.uuid
        DataCenter.CityResidentManager:TryResidentTalk(param)
    end
end

local function OnFinish(self)
    DataCenter.VitaManager:RemoveResidentData(self.data.uuid)
    DataCenter.CityResidentManager:RemoveData(self.data.uuid)
end

CityResidentStateBetrayLeave.OnEnter = OnEnter
CityResidentStateBetrayLeave.OnFinish = OnFinish

return CityResidentStateBetrayLeave