---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/12/6 11:12
---

local CityResidentStateBase = require "DataCenter.CityResident.CityResidentState.CityResidentStateBase"
local CityResidentStateSickSleepHospital = BaseClass("CityResidentStateSickSleepHospital", CityResidentStateBase)

local EnterInterval = 10

local function OnEnter(self)
    local fUuid = self.data.residentData.hUuid
    if fUuid ~= 0 then
        local furnitureTf = DataCenter.FurnitureObjectManager:GetTransformByFurnitureUuid(fUuid)
        if furnitureTf then
            local pos = furnitureTf.position
            pos.y = 0.11
            local eulerAngles = furnitureTf.eulerAngles
            eulerAngles.y = eulerAngles.y - 90
            self.data:SetPos(pos)
            self.data:SetRot(Quaternion.Euler(eulerAngles.x, eulerAngles.y, eulerAngles.z))
            self.data:Idle()
            self.data:PlayAnim(CityResidentDefines.AnimName.SickSleep)

            self.fUuid = fUuid
            self.enterCd = 0
            return
        end
    end
    
    self.data:SetState(CityResidentDefines.State.GoToIdle)
end

local function OnExit(self)
    EventManager:GetInstance():Broadcast(EventId.CityResidentExitFurniture, { rUuid = self.data.uuid, fUuid = self.fUuid })
end

local function OnUpdate(self, deltaTime)
    self.enterCd = self.enterCd - deltaTime
    if self.enterCd <= 0 then
        EventManager:GetInstance():Broadcast(EventId.CityResidentEnterFurniture, { rUuid = self.data.uuid, fUuid = self.fUuid })
        self.enterCd = EnterInterval
    end
end

CityResidentStateSickSleepHospital.OnEnter = OnEnter
CityResidentStateSickSleepHospital.OnExit = OnExit
CityResidentStateSickSleepHospital.OnUpdate = OnUpdate

return CityResidentStateSickSleepHospital