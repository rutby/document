---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/12/6 11:12
---

local CityResidentStateBase = require "DataCenter.CityResident.CityResidentState.CityResidentStateBase"
local CityResidentStateSleepHouse = BaseClass("CityResidentStateSleepHouse", CityResidentStateBase)

local function OnEnter(self)
    local lastState = self.data:GetLastState()
    if lastState == CityResidentDefines.State.SickSleepHospital then
        self.data:SetState(CityResidentDefines.State.SickSleepHospital)
    elseif lastState == CityResidentDefines.State.Sick then
        -- continue
    else
        local fUuid = self.data.residentData.hUuid
        if fUuid == 0 then
            fUuid = DataCenter.CityResidentManager.occupyMgr:TryOccupyBed(self.data.uuid)
        end
        if fUuid ~= 0 then
            self.data:PlayAnim(CityResidentDefines.AnimName.SickWalk)
            self.data:SetSpeed(DataCenter.CityResidentManager:GetResidentWalkSpeed())
            self.data:ShowTool("")
            self.data:SetAutoAnim(false)
            self.data:GoToFurniture(fUuid)
        else
            self.data:SetState(CityResidentDefines.State.GoToIdle)
        end
    end
end

local function OnFinish(self)
    if self.data.residentData.hUuid ~= 0 then
        self.data:SetState(CityResidentDefines.State.SickSleepHospital)
    else
        self.data:SetState(CityResidentDefines.State.SickSleepHouse)
    end
end

CityResidentStateSleepHouse.OnEnter = OnEnter
CityResidentStateSleepHouse.OnFinish = OnFinish

return CityResidentStateSleepHouse