---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2021/10/28 12:05
---
local AllianceCityOccupyInfo = BaseClass("AllianceCityOccupyInfo")

local function __init(self)
    self.cityId = 0
    self.cityLevel = 0
    self.abbr = ""
    self.allianceId = ""
    self.color = 0
    self.cityName = ""
    self.posV2 = nil --中心点位置
end

local function __delete(self)
    self.cityId = nil
    self.cityLevel = 0
    self.abbr = nil
    self.allianceId = nil
    self.cityName = nil
    self.posV2 = nil
end

--local function InitCityId(self,cityId)
--    self.cityId = cityId
--end
local function ParseData(self, message)
    if message ==nil then
        return
    end
    if message["cityId"]~=nil then
        self.cityId = message["cityId"]
    end
    if message["abbr"]~=nil then
        self.abbr = message["abbr"]
    end
    if message["allainceId"]~=nil then
        self.allianceId = message["allainceId"]
    end
    if message["color"]~=nil then
        self.color = message["color"]
    end
    if message["icon"]~=nil then
        local tempTb = string.split(message["icon"], ";")
        self.flagIcon = {
            flagBgIcon = tonumber(tempTb[1]) or 1,
            flagBgColor = tonumber(tempTb[2]) or 1,
            flagFgIcon = tonumber(tempTb[3]) or 1,
            flagFgColor = tonumber(tempTb[4] or 1)
        }
    end

    if self.cityId == THRONE_ID and LuaEntry.Player.serverType == ServerType.NORMAL then
        self.color = -1
    end
    if LuaEntry.Player.serverType == ServerType.EDEN_SERVER then
        if self.allianceId == LuaEntry.Player.allianceId then
            self.color = 1
        elseif DataCenter.GloryManager:IsSameCampByAllianceId(self.allianceId) ==true then
            self.color = 5
        else
            self.color = 4
        end
    end
    if message["cityName"] then
        self.cityName = message["cityName"]
    end
    local size = GetTableData(TableName.WorldCity,self.cityId, "size")
    local location = GetTableData(TableName.WorldCity,self.cityId, "location")
    self.cityLevel = GetTableData(TableName.WorldCity, self.cityId, "level")
    self.posV2 = {}
    self.posV2.x = 0
    self.posV2.y = 0
    if location~=nil and size~=nil then
        local tile = math.floor(size/2)
        local pos = string.split(location,"|")
        if #pos>1 then
            self.posV2.x = tonumber(pos[1])-tile
            self.posV2.y = tonumber(pos[2])-tile
        end
    end
end

AllianceCityOccupyInfo.__init = __init
AllianceCityOccupyInfo.__delete = __delete
AllianceCityOccupyInfo.ParseData = ParseData
return AllianceCityOccupyInfo