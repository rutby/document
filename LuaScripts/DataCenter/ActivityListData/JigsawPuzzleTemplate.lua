---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2022/8/16 15:06
---JigsawPuzzleTemplate


local JigsawPuzzleTemplate = BaseClass("JigsawPuzzleTemplate")

local function __init(self)
    self.id = 0
    self.activityId = 0
    self.name = ""
    self.starNeedTimeS = {0, 0, 0}
    self.jigsawImg = ""
    self.condition = nil
end

local function __delete(self)
    self.id = nil
    self.activityId = nil
    self.name = nil
    self.starNeedTimeS = nil
    self.jigsawImg = nil
    self.condition = nil
end

local function InitData(self,row)
    if row ==nil then
        return
    end
    self.id = tonumber(row:getValue("id"))
    self.activityId = tonumber(row:getValue("activity"))
    self.name = row:getValue("name")
    local starTime = row:getValue("star_time")
    local starTimeArr = string.split(starTime, ";")
    for i = 1, 3 do
        self.starNeedTimeS[i] = tonumber(starTimeArr[i]) or 0 
    end
    self.jigsawImg = row:getValue("image")
    local condition = row:getValue("condition")
    local conditionTb = string.split(condition, ";")
    if #conditionTb == 2 then
        self.condition = {
            type = tonumber(conditionTb[1]),
            value = tonumber(conditionTb[2])
        }
    end
    
end

local function CheckIfUnlocked(self)
    if not self.condition or not self.condition.type or self.condition.type <= 0 then
        return true
    end
    if self.condition.type == 1 then
        local data = DataCenter.ActivityListDataManager:GetActivityDataById(tostring(self.activityId))
        if data and data.startTime then
            local serverTime = UITimeManager:GetInstance():GetServerTime() 
            local unlockT = self.condition.value * 60000 + data.startTime
            if unlockT < serverTime then
                return true
            else
                local needTimeMs = unlockT - serverTime
                local needDay = math.ceil(needTimeMs / (OneDayTime * 1000))
                return false, needDay
            end
        end
    end
end

JigsawPuzzleTemplate.__init = __init
JigsawPuzzleTemplate.__delete = __delete
JigsawPuzzleTemplate.InitData = InitData
JigsawPuzzleTemplate.CheckIfUnlocked = CheckIfUnlocked

return JigsawPuzzleTemplate