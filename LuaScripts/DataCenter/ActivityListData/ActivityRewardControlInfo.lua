---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/5/31 17:44
---

local ActivityRewardControlInfo = BaseClass("ActivityRewardControlInfo")

local function __init(self)
    self.group = 0 -- 组
    self.itemId = 0 -- 道具ID
    self.type = RewardNumControlNumType.Item
    self.times = 0 -- 时间间隔（分钟）
    self.count = 0 -- 已掉落数量
    self.fTime = 0 -- 上次刷新时间
end

local function __delete(self)
    
end

local function ParseServerData(self, serverData)
    local spls = string.split(serverData.itemId, "_")
    self.itemId = tonumber(spls[1])
    self.group = tonumber(spls[2])
    self.type = serverData.type
    self.times = serverData.times
    self.count = serverData.count
    self.fTime = serverData.fTime
end

-- 获取下次刷新时间，毫秒
local function GetRefreshTime(self)
    local duration = self.times * 60000
    if duration < 0 or duration % 86400000 == 0 then
        -- 按整天刷
        local t = UITimeManager:GetInstance():GetTodayZeroServerTime(self.fTime / 1000) * 1000 + 86400000
        return t
    else
        local t = (self.fTime // duration + 1) * duration
        return t
    end
end

local function GetCount(self)
    local curTime = UITimeManager:GetInstance():GetServerTime()
    local refreshTime = self:GetRefreshTime()
    if curTime <= refreshTime then
        return self.count
    else
        return 0
    end
end

ActivityRewardControlInfo.__init = __init
ActivityRewardControlInfo.__delete = __delete

ActivityRewardControlInfo.ParseServerData = ParseServerData
ActivityRewardControlInfo.GetRefreshTime = GetRefreshTime
ActivityRewardControlInfo.GetCount = GetCount

return ActivityRewardControlInfo
