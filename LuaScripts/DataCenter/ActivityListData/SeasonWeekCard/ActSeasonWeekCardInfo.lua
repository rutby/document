---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl.
--- DateTime: 
---
local ActSeasonWeekCardInfo = BaseClass("ActSeasonWeekCardInfo")

local function __init(self)
    self.activityId = 0
    self.freeReward = {}    --每日免费奖励
    self.reward = {}    --每日付费奖励
    self.exchangeId = ""  --周卡礼包Id
    
    self.cardInfo = {}  --可能没有该字段
end

local function __delete(self)

end

local function ParseActInfo(self, message)
    if message==nil then
        return
    end

    if message["activityId"] then
        self.activityId = message["activityId"]
    end
    if message["freeReward"] then
        self.freeReward = DataCenter.RewardManager:ReturnRewardParamForView(message["freeReward"]) --奖励
    end
    if message["reward"] then
        self.reward = DataCenter.RewardManager:ReturnRewardParamForView(message["reward"]) --奖励
    end
    if message["exchangeId"] then
        self.exchangeId = message["exchangeId"]
    end

    if message["cardInfo"] then
        self.cardInfo = {}
        self.cardInfo.startTime = message["cardInfo"]["startTime"]      --周卡开启时间
        self.cardInfo.endTime = message["cardInfo"]["endTime"]      --周卡结束时间
        self.cardInfo.lastReceiveFreeTime = message["cardInfo"]["lastReceiveFreeTime"]      --最后一次领取免费奖励时间
        self.cardInfo.lastReceiveTime = message["cardInfo"]["lastReceiveTime"]      --最后一次领取付费奖励时间
    end
    
end

local function UpdateTime(self,message)
    if message==nil then
        return
    end
    if message["lastReceiveFreeTime"] then
        self.cardInfo.lastReceiveFreeTime = message["lastReceiveFreeTime"]
    end

    if message["lastReceiveTime"] then
        self.cardInfo.lastReceiveTime = message["lastReceiveTime"]
    end
end

local function GetActRed(self)
    local curTime = UITimeManager:GetInstance():GetServerTime()
    local count = 0
    if self.cardInfo and next(self.cardInfo) then
        if self.cardInfo.lastReceiveFreeTime == 0 then
            count = count + 1
        else
            if not UITimeManager:GetInstance():IsSameDayForServer(curTime // 1000, self.cardInfo.lastReceiveFreeTime // 1000) then
                count = count + 1
            end
        end
        if self.cardInfo.endTime and self.cardInfo.endTime ~= 0 and curTime < self.cardInfo.endTime then
            if not UITimeManager:GetInstance():IsSameDayForServer(curTime // 1000, self.cardInfo.lastReceiveTime // 1000) then
                count = count + 1
            end
        end
        return count
    end
    --cardInfo不存在时可以领免费奖励
    return 1
end

ActSeasonWeekCardInfo.__init = __init
ActSeasonWeekCardInfo.__delete = __delete
ActSeasonWeekCardInfo.ParseActInfo = ParseActInfo
ActSeasonWeekCardInfo.UpdateTime = UpdateTime
ActSeasonWeekCardInfo.GetActRed = GetActRed
return ActSeasonWeekCardInfo