---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl
--- DateTime: 
---

local ActivityController = BaseClass("ActivityController");

local function __init(self)

end

local function __delete(self)
end


--配合后端，依次单独请求积分类活动数据
local function SendScoreActivityData(self)
    local nowList = DataCenter.ActivityListDataManager:GetActivityList()
    if nowList ~= nil then
        table.walk(nowList,function (k,v)
            local aId = nil            
            if v.type  == ActivityEnum.ActivityType.Arms then
                aId = v.activityId
            elseif v.type == EnumActivity.AllianceCompete.Type then
                aId = v.activityId
            end
            if aId ~= "" and aId ~= nil then
                self:SendActivitySingleScoreGetCommand(aId)
            end            
        end)
    end
end

--发送请求单个活动数据
local function SendActivitySingleScoreGetCommand(self,activityId)
    SFSNetwork.SendMessage(MsgDefines.ActivityEventInfoGet,tostring(activityId))
end

--请求活动领奖励数据
local function SendActivityGetRewardCommand(self,actId,stage,eventType)
    SFSNetwork.SendMessage(MsgDefines.AcceptPersonalReward,{actId = actId,stage = stage,eventType = eventType})
end

---请求活动列表数据
local function SendGetAllActivityInfo()
   SFSNetwork.SendMessage(MsgDefines.ActivityPanelInfo)
end

--通用获取显示排行榜服务器街接口
function ActivityController:GetRankServerGroupStr(str)
    local result = nil
    if not string.IsNullOrEmpty(str) then
        local severId = LuaEntry.Player:GetSrcServerId()
        --"|"划分有多少组排行榜
        local str1 = string.split_ss_array(str, "|")
        for k, v in ipairs(str1) do
            if result == nil then
                --","划分第二个表示每组包含哪些服
                local spl2 = string.split_ss_array(v, ",")
                if spl2[2] ~= nil then
                    --";"划分每组包含哪些服
                    local spl3 = string.split_ss_array(spl2[2], ";")
                    for k1, v1 in ipairs(spl3) do
                        if result == nil then
                            --"-"划分是不是区间服
                            local spl4 = string.split_ii_array(v1, "-")
                            if spl4[2] == nil then
                                --表示只有一个服
                                if spl4[1] == severId then
                                    result = spl2[2]
                                    break
                                end
                            else
                                --表示区间服
                                if spl4[1] <= severId and spl4[2] >= severId then
                                    result = spl2[2]
                                    break
                                end
                            end
                        else
                            break
                        end
                    end
                end
            else
                break
            end
        end

        if result ~= nil then
            --把；改成，
            result = string.gsub(result, ";", ",")
        end
    end
    return result
end


ActivityController.__init = __init
ActivityController.__delete = __delete
ActivityController.SendScoreActivityData =SendScoreActivityData
ActivityController.SendActivitySingleScoreGetCommand = SendActivitySingleScoreGetCommand
ActivityController.SendActivityGetRewardCommand = SendActivityGetRewardCommand
ActivityController.SendGetAllActivityInfo = SendGetAllActivityInfo
return ActivityController