---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl.
--- DateTime:
---
--[[
购买体力
]]
local ResLackItemBase = require "DataCenter.ResLackTips.ResLackItemBase"
local ResLackItem_BuyPveStamina = BaseClass("ResLackItem_BuyPveStamina", ResLackItemBase)
local Localization = CS.GameEntry.Localization
function ResLackItem_BuyPveStamina:CheckIsOk( _resType, _needCnt )
    self._resType = _resType
    self.targetCount = _needCnt
    return true
end

function ResLackItem_BuyPveStamina:GetBtnName()
    self.costGoldNum = 0
    self.recoverNum  = 0
    local goldStr = LuaEntry.DataConfig:TryGetStr("role_stamina", "k1")
    local strArr = string.split(goldStr,"|")
    local useCount = LuaEntry.Player:GetCurStaminaGoldNum()
    if #strArr>0 then
        local index = math.min(useCount+1,(#strArr))
        local str = strArr[index]
        local arr = string.split(str,";")
        if #arr>=2 then
            self.costGoldNum = tonumber(arr[1])
            self.recoverNum  = tonumber(arr[2])
        end
        return string.GetFormattedSeperatorNum(self.costGoldNum), index
    end
end

function ResLackItem_BuyPveStamina:TodoAction(pos)
    local btnPos = pos
    if LuaEntry.Player.gold >= self.costGoldNum then
        UIUtil.ShowUseDiamondConfirm(TodayNoSecondConfirmType.BuyUseDialog, Localization:GetString("140321",self.costGoldNum), 2, GameDialogDefine.CONFIRM, GameDialogDefine.CANCEL, function()
            SFSNetwork.SendMessage(MsgDefines.UserRecoverPlayerStamina)
            self:FlyReward(btnPos)
        end)
    else
        UIUtil.ShowTipsId(120027)
    end
end

function ResLackItem_BuyPveStamina:FlyReward(pos)
    local icon = DataCenter.RewardManager:GetPicByType(RewardType.FORMATION_STAMINA)
    local num = 5
    local targetPos = UIUtil.GetEnergyIconPos()
    UIUtil.DoFlyCustom(icon, nil, num, pos, targetPos)
end

function ResLackItem_BuyPveStamina:GetBuyNum()
    self.recoverNum  = 0
    local goldStr = LuaEntry.DataConfig:TryGetStr("role_stamina", "k1")
    local strArr = string.split(goldStr,"|")
    local useCount = LuaEntry.Player:GetCurStaminaGoldNum()
    if #strArr>0 then
        local index = math.min(useCount+1,(#strArr))
        local str = strArr[index]
        local arr = string.split(str,";")
        if #arr>=2 then
            self.costGoldNum = tonumber(arr[1])
            self.recoverNum  = tonumber(arr[2])
        end
    end
    return self.recoverNum
end

function ResLackItem_BuyPveStamina:GetConsume()
    local useCount = {}
    local param = {}
    param.itemId = ""
    param.rewardType = RewardType.FORMATION_STAMINA
    param.count = self:GetBuyNum()
    table.insert(useCount, param)
    return useCount
end

return ResLackItem_BuyPveStamina


