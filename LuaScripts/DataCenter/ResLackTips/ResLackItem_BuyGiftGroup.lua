---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl
--- DateTime:
---
--[[
购买礼包(多个道具组)
]]

local ResLackItemBase = require "DataCenter.ResLackTips.ResLackItemBase"
local ResLackItem_BuyGiftGroup = BaseClass("ResLackItem_BuyGiftGroup", ResLackItemBase)
local Localization = CS.GameEntry.Localization
function ResLackItem_BuyGiftGroup:CheckIsOk( _resType, _needCnt )
    local goods = self._config.goods
    local packageTb = GiftPackageData.GetGroupPacks(goods)
    if packageTb and #packageTb > 0 then
        self.packageInfo = packageTb
        return self.packageInfo
    end
    return false
end

function ResLackItem_BuyGiftGroup:InitGroup(index)
    self.giftIndex = {}
end

function ResLackItem_BuyGiftGroup:SetGroup(index)
    table.insert(self.giftIndex,index)
end

function ResLackItem_BuyGiftGroup:GetGroupIndex(index)
    if self.giftIndex then
        for i ,v in pairs(self.giftIndex) do
            if v == index then
                return i
            end
        end
    end
    return 1
end

function ResLackItem_BuyGiftGroup:TodoAction(pos,refresh,lackTab,index)
    DataCenter.PayManager:CallPayment(self.packageInfo[self:GetGroupIndex(index)], UIWindowNames.UIResourceLackNew)
end

function ResLackItem_BuyGiftGroup:GetGiftName(index)
    return Localization:GetString(self.packageInfo[self:GetGroupIndex(index)]:getName())
end

function ResLackItem_BuyGiftGroup:GetGiftPrice(index)
    local price = DataCenter.PayManager:GetDollarText(self.packageInfo[self:GetGroupIndex(index)]:getPrice(), self.packageInfo[self:GetGroupIndex(index)]:getProductID())
    return price
end

function ResLackItem_BuyGiftGroup:GetGiftPercent(index)
    return self.packageInfo[self:GetGroupIndex(index)]:getPercent()
end

function ResLackItem_BuyGiftGroup:GetCellsList(index)
    local listParam = {}
    local info  = self.packageInfo[self:GetGroupIndex(index)]
    
    -- 英雄
    local heroStr = info:getHeroesStr()
    if (not string.IsNullOrEmpty(heroStr)) then
        local arr = string.split(heroStr, ";")
        if (#arr == 2) then
            local param = {}-- UIGiftPackageCell.Param.New()
            param.rewardType = RewardType.HERO
            param.itemId = arr[1]
            param.count = arr[2]
            table.insert(listParam,param)
        end
    end

    -- 普通道具
    local str = info:getItemsStr()
    local _item_use = info:getItemUse()
    if _item_use ~= nil and _item_use ~= "" then
        str = _item_use .. "|" .. str
    end

    local arrMiddle = string.split(str,"|")
    if arrMiddle ~= nil and #arrMiddle > 0 then
        for k,v in ipairs(arrMiddle) do
            local arr = string.split(v,";")
            if arr[1] ~= "" then
                local param = {}-- UIGiftPackageCell.Param.New()
                param.rewardType = RewardType.GOODS
                param.itemId = arr[1]
                local numCount = tonumber(arr[2])
                param.count = string.GetFormattedSeperatorNum(numCount)
                table.insert(listParam,param)
            end
        end
    end

    local goldParam = {}
    local goldNum = tonumber(info:getDiamond())
    if goldNum > 0 then
        goldParam.rewardType = RewardType.GOLD
        goldParam.count = string.GetFormattedSeperatorNum(goldNum)
        goldParam.itemId = ResourceType.Gold
        table.insert(listParam, 2, goldParam)
    end

    local temp = info:GetDiscountTips()
    if temp then
        if temp[4] then
            local replace = temp[4]
            for i ,v in pairs(replace) do
                listParam[i] = v
            end
        end
    end
    
    return listParam
end




return ResLackItem_BuyGiftGroup