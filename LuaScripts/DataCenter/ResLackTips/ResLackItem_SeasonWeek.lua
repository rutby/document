---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 
---

local ResLackItemBase = require "DataCenter.ResLackTips.ResLackItemBase"
local ResLackItem_SeasonWeek = BaseClass("ResLackItem_SeasonWeek", ResLackItemBase)

function ResLackItem_SeasonWeek:CheckIsOk( _resType, _needCnt)
    if  CS.SceneManager.IsInPVE() then
        return false
    end
    local para1 = self._config.para1
    local list = string.split(para1,";")
    for k = 1 ,table.count(list) do
        if DataCenter.ActivityListDataManager:IsActivityOpen(list[k]) then
            local actData = DataCenter.ActSeasonWeekCardData:GetInfoByActId(tonumber(self._config.para1))
            if actData and next(actData) then
                local curTime = UITimeManager:GetInstance():GetServerTime()
                --是否购买了周卡
                if actData.cardInfo and next(actData.cardInfo) then
                    if actData.cardInfo.endTime and actData.cardInfo.endTime ~= 0  and curTime < actData.cardInfo.endTime then
                        if actData.cardInfo.lastReceiveTime == 0 then
                            return true
                        else
                            --上次领奖与现在是同一天，不可再领奖
                            if not UITimeManager:GetInstance():IsSameDayForServer(curTime // 1000, actData.cardInfo.lastReceiveTime // 1000) then
                                return true
                            end
                        end
                    end
                else
                    return true
                end
            end
        end
    end
  
    return false
end

function ResLackItem_SeasonWeek:TodoAction()
    GoToUtil.CloseAllWindows()
    UIManager:GetInstance():OpenWindow(UIWindowNames.UIActivityCenterTable, { anim = true, UIMainAnim = UIMainAnimType.AllHide }, self._config.para1)
end

return ResLackItem_SeasonWeek