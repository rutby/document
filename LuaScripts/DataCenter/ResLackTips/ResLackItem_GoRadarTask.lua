---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl.
--- DateTime:
--[[
资源道具不足
跳转到雷达
]]

local ResLackItemBase = require "DataCenter.ResLackTips.ResLackItemBase"
local ResLackItem_GoRadarTask = BaseClass("ResLackItem_GoRadarTask", ResLackItemBase)
local Localization = CS.GameEntry.Localization
--1=木头，2=石头

function ResLackItem_GoRadarTask:CheckIsOk( _resType, _needCnt)
    if  CS.SceneManager.IsInPVE() then
        return false
    end
    local list = DataCenter.RadarCenterDataManager:GetDetectEventInfoUuids()
    local result = {}
    local function GetOneEventData(uuid)
        local data = DataCenter.RadarCenterDataManager:GetDetectEventInfo(uuid)
        if data == nil then
            return nil
        end

        local template = DataCenter.DetectEventTemplateManager:GetDetectEventTemplate(data.eventId)
        if template == nil then
            return nil
        end
        local param = {}
        param.uuid = uuid
        param.eventId = tonumber(data.eventId)
        param.template = template
        return param
    end
    table.walk(list, function (k, v)
        local param = GetOneEventData(v)
        if param ~= nil then
            table.insert(result, param)
        end
    end)

    local para1 = self._config:getValue("para1")
    if (string.IsNullOrEmpty(para1)) then
        for i = 1, #result do
            self.eventUuid = result[i].uuid
            return true
        end
    else
        for i = 1, #result do
            local type2 = result[i].template:getValue("type2")
            if type2 ~= "" and tonumber(para1) == tonumber(type2) then
                self.eventUuid = result[i].uuid
                return true
            end
        end
    end
    return false
end

function ResLackItem_GoRadarTask:TodoAction()
    local para1 = self._config:getValue("para1")
    --if (string.IsNullOrEmpty(para1)) then
    --    GoToUtil.CloseAllWindows()
    --    local list = DataCenter.BuildManager:GetAllBuildingByItemIdWithoutPickUp(BuildingTypes.FUN_BUILD_RADAR_CENTER)
    --    if list ~= nil and table.count(list) > 0 then
    --        for k,v in pairs(list) do
    --            local buildData = DataCenter.BuildManager:GetBuildingDataByUuid(v.uuid)
    --            local worldPointPos = SceneUtils.TileIndexToWorld(buildData.pointId,ForceChangeScene.City)
    --            ResLackItemBase:TodoAction(SceneManagerSceneID.City,worldPointPos,nil,nil,function()
    --                local bubbleObj =  DataCenter.BuildBubbleManager:GetBubbleObjByBubbleTypeAndBuildId(BuildBubbleType.DetectEvent ,BuildingTypes.FUN_BUILD_RADAR_CENTER)
    --                if bubbleObj then
    --                    WorldArrowManager:GetInstance():ShowArrowEffect(0,bubbleObj.transform.position,ArrowType.Building)
    --                end
    --            end)
    --            break
    --        end
    --    end
    --else
    --    GoToUtil.GoRadarProbe(nil,tonumber(para1))
    --end
    GoToUtil.GoRadarProbe(nil,nil, nil)
end

return ResLackItem_GoRadarTask