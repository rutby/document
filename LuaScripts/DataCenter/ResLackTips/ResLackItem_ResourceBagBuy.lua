---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl
--- DateTime: 2021/11/24 14:14
---
--[[
直接购买资源道具
]]

local ResLackItemBase = require "DataCenter.ResLackTips.ResLackItemBase"
local ResLackItem_ResourceBagBuy = BaseClass("ResLackItem_ResourceBagBuy", ResLackItemBase)
local Localization = CS.GameEntry.Localization
function ResLackItem_ResourceBagBuy:CheckIsOk( _resType, _needCnt )
    self._resType = _resType
    self.targetCount = _needCnt
    return true
end

function ResLackItem_ResourceBagBuy:TodoAction(pos,isRefresh,lacktab)
    local res = {}
    res[self._resType] = self.needCount
    if LuaEntry.Player.gold >= self.spendGold then
        UIUtil.ShowUseDiamondConfirm(TodayNoSecondConfirmType.BuyUseDialog,Localization:GetString(GameDialogDefine.SPEND_SOMETHING_BUY_SOMETHING,string.GetFormattedSeperatorNum(self.spendGold)..Localization:GetString(GameDialogDefine.DIAMOND),
                string.GetFormattedSeperatorNum(self.needCount),DataCenter.ResourceManager:GetResourceNameByType(self._resType)), 2,GameDialogDefine.CONFIRM, GameDialogDefine.CANCEL,
                function()
                    SFSNetwork.SendMessage(MsgDefines.BuyItemAndResource, res)
                end, function() end)
    else
        GoToUtil.CloseAllWindows()
        GoToUtil.GotoPayTips()
    end
end

function ResLackItem_ResourceBagBuy:UpdateCount(_needCnt)
    self.targetCount = _needCnt
end

function ResLackItem_ResourceBagBuy:GetBtnName()
    self.needCount = self.targetCount
    --if self._resType ~= ResourceType.Water then
        local own = LuaEntry.Resource:GetCntByResType(self._resType)
        if own > 0 then
            self.needCount = self.targetCount - own
        end
    --end
    self.spendGold = CommonUtil.GetResGoldByType(self._resType,self.needCount)
    return string.GetFormattedSeperatorNum(self.spendGold)
end

function ResLackItem_ResourceBagBuy:GetBuyNum()
    return self.needCount
end

return ResLackItem_ResourceBagBuy