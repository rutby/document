---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/10/18 14:16
---

local WatchAdTemplate = BaseClass("WatchAdTemplate")

local Platform =
{
    Android = "android",
    IOS = "ios",
}

local Advertiser =
{
    Google = "google",
    Unity = "unity",
}

local PackageName =
{
    BuildMaster = "buildmaster",
    XCity = "xcity",
}

local function __init(self)
    self.id = 0
    self.type = 0
    self.location = 0
    self.limit_times = 0
    self.ad_ids = {}
    self.ad_id = ""
    self.adv = ""
end

local function InitData(self,row)
    if row == nil then
        return
    end

    self.id = tonumber(row:getValue("id")) or 0
    self.type = tonumber(row:getValue("type")) or 0
    self.location = tonumber(row:getValue("location")) or 0
    self.limit_times = tonumber(row:getValue("limit_times")) or 0
    self.ad_ids = {}
    for _, plt in pairs(Platform) do
        self.ad_ids[plt] = {}
        for _, adv in pairs(Advertiser) do
            self.ad_ids[plt][adv] = {}
            for _, pck in pairs(PackageName) do
                self.ad_ids[plt][adv][pck] = row:getValue(string.format("%s_%s_%s", plt, adv, pck)) or ""
            end
        end
    end
    self.ad_id = ""
    self.adv = ""
end

local function GetAdId(self)
    if string.IsNullOrEmpty(self.ad_id) then
        local plt,adv, pck
        if CS.SDKManager.IS_UNITY_ANDROID() then
            plt = Platform.Android
        elseif CS.SDKManager.IS_UNITY_IOS() then
            plt = Platform.IOS
        else
            plt = ""
        end
        if LuaEntry.DataConfig:CheckSwitch("watch_ad_aps_shop_google") then
            adv = Advertiser.Google
        elseif LuaEntry.DataConfig:CheckSwitch("watch_ad_aps_shop_unity") then
            adv = Advertiser.Unity
        else
            adv = ""
        end
        self.adv = adv
        if CommonUtil.IsXCity() then
            pck = PackageName.XCity
        else
            pck = PackageName.BuildMaster
        end
        if self.ad_ids[plt] and self.ad_ids[plt][adv] and self.ad_ids[plt][adv][pck] then
            self.ad_id = self.ad_ids[plt][adv][pck]
        end
    end
    return self.ad_id,self.adv
end

local function HasAd(self)
    if CS.SDKManager.IS_UNITY_EDITOR() then
        return false
    else
        local ad_id,adv = self:GetAdId()
        return not string.IsNullOrEmpty(ad_id)
    end
end

WatchAdTemplate.__init = __init
WatchAdTemplate.InitData = InitData
WatchAdTemplate.GetAdId = GetAdId
WatchAdTemplate.HasAd = HasAd

return WatchAdTemplate