---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/6/30 19:15
---

-- 专精技能：升级地块
local OpLandmine = BaseClass("OpLandmine", OpMasterySkillBase)
local base = OpMasterySkillBase

local function Init(self, uuid)
    self.skill = MasterySkill.UpgradeDesert
    base.Init(self, uuid)
end

local function CanShow(self)
    if not base.CanShow(self) then
        return false
    end
    local levelDiff = DataCenter.DesertDataManager:GetLevelDifference(self.desertData.desertId, self.desertData.oriDesertId)
    if levelDiff > 0 then
        return false
    end
    local template = DataCenter.DesertTemplateManager:GetTemplate(self.desertData.desertId)
    if template then
        local level_up_id  = template.level_up_id
        if level_up_id>0 then
            return true
        end
    end
    return false
end
 
local function OnClick(self, view, item)
    if self.state == MasterySkillState.Normal then
        DataCenter.MasteryManager:TryUseSkill(self.skill, { dUuid = self.desertData.uuid, serverId = self.desertData.serverId }, function()
            view:Close()
        end)
    elseif self.state == MasterySkillState.Locked then
        DataCenter.MasteryManager:ShowHome(self.template.home, self.template.group)
    end
end

OpLandmine.Init = Init
OpLandmine.CanShow = CanShow
OpLandmine.OnClick = OnClick

return OpLandmine