---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by guqu.
--- DateTime: 2020/9/14 10:47
---
local PushAlHelpNewMessage = BaseClass("PushAlHelpNewMessage", SFSBaseMessage)
local base = SFSBaseMessage
local function OnCreate(self)
    base.OnCreate(self)
end

local function HandleMessage(self, t)
    base.HandleMessage(self, t)
    if t["senderId"]~=nil and t["senderId"]~= LuaEntry.Player.uid then
        DataCenter.AllianceHelpDataManager:SetHelpNum(DataCenter.AllianceHelpDataManager:GetHelpNum() +1)
        EventManager:GetInstance():Broadcast(EventId.UpdateAllianceHelpNum)
        local myAllianceCenterUuid = DataCenter.BuildManager:GetFunbuildByItemID(BuildingTypes.FUND_BUILD_ALLIANCE_CENTER)
        if myAllianceCenterUuid and myAllianceCenterUuid.uuid then
            EventManager:GetInstance():Broadcast(EventId.AllianceMemberNeedHelp, myAllianceCenterUuid.uuid)
        end
    else
        local uuid = t["content"]
        local helpType = t["helpType"]
        local queueType= t["queueType"]
        if helpType == AllianceHelpType.Building then
            DataCenter.BuildManager:OnAllianceCallHelp(uuid)
            EventManager:GetInstance():Broadcast(EventId.AllianceBuildHelpNew,uuid)
        elseif helpType == AllianceHelpType.FIX_BUILDING then
            DataCenter.BuildManager:OnAllianceCallFixHelp(uuid)
            EventManager:GetInstance():Broadcast(EventId.AllianceBuildHelpNew,uuid)
        elseif helpType == AllianceHelpType.Queue then
            DataCenter.QueueDataManager:OnAllianceCallHelp(uuid)
            EventManager:GetInstance():Broadcast(EventId.AllianceQueueHelpNew,queueType)
        end
    end
end

PushAlHelpNewMessage.OnCreate = OnCreate
PushAlHelpNewMessage.HandleMessage = HandleMessage

return PushAlHelpNewMessage