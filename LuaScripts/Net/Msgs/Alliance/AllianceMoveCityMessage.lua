---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2022/6/24 12:04
---AllianceMoveCityMessage


local AllianceMoveCityMessage = BaseClass("AllianceMoveCityMessage", SFSBaseMessage)
local base = SFSBaseMessage
local Localization = CS.GameEntry.Localization

local function OnCreate(self, costType, isInviteMove)
    base.OnCreate(self)
    self.sfsObj:PutInt("costType", costType)
    local byInvite = isInviteMove and 1 or 0
    self.sfsObj:PutInt("byInvite", byInvite)
end

local function HandleMessage(self, t)
    base.HandleMessage(self, t)
    local errCode =  t["errorCode"]
    if errCode ~= nil then
        UIUtil.ShowTipsId(errCode)
    else
        if t.result then
            if t.result == 1 then
                GoToUtil.CloseAllWindows()
                
                local inviteType = DataCenter.AllianceBaseDataManager:GetAlMoveInvite(UIWindowNames.UIMain)
                DataCenter.AllianceBaseDataManager:SetInviteResponded(inviteType)
                DataCenter.BuildManager:WorldMvHandle(t)
                if t["lastFreeMoveTime"] then
                    LuaEntry.Player:SetLastFreeMvTime(t["lastFreeMoveTime"])
                end
                if t["gold"] then
                    LuaEntry.Player.gold = t["gold"]
                    EventManager:GetInstance():Broadcast(EventId.UpdateGold)
                end
            elseif t.result == 2 then
                if t.byInvite and t.byInvite == 1 then
                    local allianceInfo = DataCenter.AllianceBaseDataManager:GetAllianceBaseData()
                    if allianceInfo and not string.IsNullOrEmpty(allianceInfo.leaderUid) then
                        UIUtil.ShowMessage(Localization:GetString("391081"),1, "390086", "", function()
                            local userId = allianceInfo.leaderUid
                            local roomId = ChatManager2:GetInstance().Room:GetPrivateRoomByUserId(userId)
                            local param = {}
                            param["roomId"] = roomId
                            param["userId"] = userId
                            param["username"] = allianceInfo.leaderName
                            GoToUtil.GotoOpenView(UIWindowNames.UIChatNew,{anim = false, hideTop = true, UIMainAnim = UIMainAnimType.AllHide},param)
                        end)
                    end
                else
                    UIUtil.ShowTipsId(391081)
                end
            end
        end
    end
    EventManager:GetInstance():Broadcast(EventId.SetMovingUI,UIMovingType.Close)
end

AllianceMoveCityMessage.OnCreate = OnCreate
AllianceMoveCityMessage.HandleMessage = HandleMessage

return AllianceMoveCityMessage