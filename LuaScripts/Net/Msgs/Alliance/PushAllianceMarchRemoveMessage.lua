---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by guqu.
--- DateTime: 2020/8/10 16:02
---
local PushAllianceMarchRemoveMessage = BaseClass("PushAllianceMarchRemoveMessage", SFSBaseMessage)
-- 基类，用来调用基类方法
local base = SFSBaseMessage
local Localization = CS.GameEntry.Localization
local function OnCreate(self)
    base.OnCreate(self)
end

local function HandleMessage(self, t)
    base.HandleMessage(self, t)
    if t["teamUuid"]~=nil then
        local data = DataCenter.AllianceWarDataManager:GetAllianceWarDataByUuid(t["teamUuid"])
        if data then
            local time = math.max(data.waitTime,data.marchTime)
            if not next(data.memberList) or time > UITimeManager:GetInstance():GetServerTime() then
                if LuaEntry.Player.allianceId == data.attackAllianceId then
                    UIUtil.ShowTips(Localization:GetString("390786",data.attackName))
                end
            end
            local targetUid = data.targetUid
            
            DataCenter.AllianceWarDataManager:DeleteAllianceWarDataByUuid(t["teamUuid"])
            
            EventManager:GetInstance():Broadcast(EventId.ALLIANCE_WAR_DELETE,t["teamUuid"])
        end
    end
end

PushAllianceMarchRemoveMessage.OnCreate = OnCreate
PushAllianceMarchRemoveMessage.HandleMessage = HandleMessage

return PushAllianceMarchRemoveMessage