---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by guqu.
--- DateTime: 2020/9/8 11:01
---
local AllianceGiftGetRewardMessage = BaseClass("AllianceGiftGetRewardMessage", SFSBaseMessage)
local base = SFSBaseMessage
local Localization = CS.GameEntry.Localization
local function OnCreate(self,uuid,type)
    base.OnCreate(self)
    self.sfsObj:PutUtfString("uuid", uuid)
    self.sfsObj:PutInt("type", type)
end

local function HandleMessage(self, t)
    base.HandleMessage(self, t)
    local errCode =  t["errorCode"]
    if errCode ~= nil then
        UIUtil.ShowTipsId(errCode) 
    else
        if t["receiveResult"]~=nil then
            local receiveResult = t["receiveResult"]
            if receiveResult==1 then
                if t["uuid"]~=nil then
                    local uuid = t["uuid"]
                    if t["receiveTime"] then
                        DataCenter.AllianceGiftDataManager:SetGiftReceive(uuid, t["receiveTime"])
                    end
                    DataCenter.AllianceGiftDataManager:RetBaseData(t)
                    if t["allianceNewMail"]~=nil then
                        DataCenter.AllianceGiftDataManager:UpdateGiftNum(t["allianceNewMail"])
                        EventManager:GetInstance():Broadcast(EventId.UpdateAllianceGiftNum)
                    end
                    --DataCenter.AllianceGiftDataManager:RemoveAllianceGiftData(uuid)
                end
                if t["info"]~=nil then
                    local list = t["info"]
                    local tempMsg = {}
                    tempMsg.reward = {}
                    
                    table.walk(list,function(k,v)
                        if v["type"]== 11 then
                            local addScore = v["value"]
                            local accPoint = DataCenter.AllianceShopDataManager:GetAccPoint()
                            DataCenter.AllianceShopDataManager:SetAccPoint(accPoint+addScore)
                        end
                        table.insert(tempMsg.reward, v)
                    end)
                    --用飘飞动画代替了
                    --DataCenter.RewardManager:ShowCommonReward(tempMsg)
                end
                EventManager:GetInstance():Broadcast(EventId.GetOneAllianceGift)
                --UIUtil.ShowTipsId(170003) 
            end
        end
    end
end

AllianceGiftGetRewardMessage.OnCreate = OnCreate
AllianceGiftGetRewardMessage.HandleMessage = HandleMessage

return AllianceGiftGetRewardMessage