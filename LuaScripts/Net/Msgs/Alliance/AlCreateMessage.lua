---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by guqu.
--- DateTime: 2020/10/13 17:58
---
local AlCreateMessage = BaseClass("AlCreateMessage", SFSBaseMessage)
local base = SFSBaseMessage
local Localization = CS.GameEntry.Localization

local function OnCreate(self,name,intro,icon, language, abbr, country, chooseLeader, isApply)
    base.OnCreate(self)
    if not  string.IsNullOrEmpty(name) then
        self.sfsObj:PutUtfString("name", name)
    end
    if not string.IsNullOrEmpty(intro) then
        self.sfsObj:PutUtfString("intro", intro)
    end
    if not string.IsNullOrEmpty(icon) then
        self.sfsObj:PutUtfString("icon", icon)
    end
    if not string.IsNullOrEmpty(language) then
        self.sfsObj:PutUtfString("language", tostring(language))
    else
        local curLanguage = Localization:GetLanguage()
        local languageId = SuportedLanguagesLocalName[curLanguage]
        self.sfsObj:PutUtfString("language", languageId)
    end
    if not string.IsNullOrEmpty(abbr) then
        self.sfsObj:PutUtfString("abbr", abbr)
    end
    if not string.IsNullOrEmpty(country) then
        self.sfsObj:PutUtfString("country", country)
    end
    chooseLeader = chooseLeader and 1 or 0
    self.sfsObj:PutInt("chooseLeader", chooseLeader)

    local recruitTotal = isApply and 1 or 0
    self.sfsObj:PutInt("recruitTotal", recruitTotal)
end

local function HandleMessage(self, t)
    base.HandleMessage(self, t)
    local errCode =  t["errorCode"]
    if errCode ~= nil then
        UIUtil.ShowTipsId(errCode) 
    else
        if t["gold"]~=nil then
            LuaEntry.Player.gold = t["gold"]
            EventManager:GetInstance():Broadcast(EventId.UpdateGold)
        end
        if t["resource"] ~= nil then
            LuaEntry.Resource:UpdateResource(t["resource"])
        end
        if t["alliance"]~=nil then
            DataCenter.AllianceBaseDataManager:UpdateAllianceBaseData(t)
        end
		if t["lastUpdateTime"] then
			LuaEntry.Player:SetLastUpdateTime(t["lastUpdateTime"])
		end
        UIUtil.ShowTipsId(390007) 
        EventManager:GetInstance():Broadcast(EventId.AllianceCreateSuccess)
    end

end

AlCreateMessage.OnCreate = OnCreate
AlCreateMessage.HandleMessage = HandleMessage

return AlCreateMessage