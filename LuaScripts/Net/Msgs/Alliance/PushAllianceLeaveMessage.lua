---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2021/7/19 21:39
---
local PushAllianceLeaveMessage = BaseClass("PushAllianceLeaveMessage", SFSBaseMessage)
local base = SFSBaseMessage
local Localization = CS.GameEntry.Localization

local function OnCreate(self)
    base.OnCreate(self)
end

local function HandleMessage(self, t)
    base.HandleMessage(self, t)
	local errCode = t["errorCode"]
	if errCode ~= nil then
		UIUtil.ShowTipsId(errCode)
	else
		DataCenter.AllianceBaseDataManager:ResetAllianceData()
		DataCenter.AllianceRedPacketManager:ClearRedPacket()
		DataCenter.AllianceMainManager:ClearAllianceLog()
		DataCenter.AllianceCityLogManager:ClearAllianceLog()
		EventManager:GetInstance():Broadcast(EventId.AllianceQuitOK)
		local reason = t["reason"]
		local needTip = true
		if not string.IsNullOrEmpty(reason) and (reason == "Kick_By_Merge" or reason == "Kick_By_Recommend") then
			needTip = false
		end
		if needTip then
			UIUtil.ShowMessage(Localization:GetString("390868"),1,"110006",nil,function ()
				UIManager:GetInstance():OpenWindow(UIWindowNames.UIJoinOrCreateAlliance,1)
			end,nil,nil)
		end
		-- 更新联盟信息之后再更新
		if t["lastUpdateTime"] then
			LuaEntry.Player:SetLastUpdateTime(t["lastUpdateTime"])
		end
	end
end

PushAllianceLeaveMessage.OnCreate = OnCreate
PushAllianceLeaveMessage.HandleMessage = HandleMessage

return PushAllianceLeaveMessage
