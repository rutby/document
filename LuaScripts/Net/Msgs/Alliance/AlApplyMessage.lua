---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by guqu.
--- DateTime: 2020/7/27 21:14
---
local AlApplyMessage = BaseClass("AlApplyMessage", SFSBaseMessage)
local base = SFSBaseMessage
local Localization = CS.GameEntry.Localization

local function OnCreate(self,allianceId,applyType,language)
    base.OnCreate(self)
    self.applyType = applyType
    self.alUid = allianceId
    self.sfsObj:PutUtfString("allianceId", allianceId)
    self.sfsObj:PutInt("applyType", applyType)
    self.sfsObj:PutUtfString("playerlabel", "")
    self.sfsObj:PutUtfString("language", language)
    self.sfsObj:PutUtfString("playerSelf","")
    self.sfsObj:PutInt("isRedpack",0)
end

local function HandleMessage(self, t)
    base.HandleMessage(self, t)
    local errCode =  t["errorCode"]
    if errCode ~= nil then
        UIUtil.ShowTipsId(errCode) 
    elseif t["resultCode"]~=nil then
        if t["resultCode"] == "allianceFull" then
            UIUtil.ShowMessage(Localization:GetString("E100070"))
        end
    elseif t["alliance_apply_not_qualified"]~=nil then
        local label = t["alliance_apply_not_qualified"]
        UIUtil.ShowMessage(Localization:GetString(label))
    else
        if t["applyType"]~=nil and t["allianceId"]~=nil then
            local applyType = t["applyType"]
            local allianceId = t["allianceId"]
            if t["join"]~=nil and applyType == 0 then
                if t["join"]==false then
                    UIUtil.ShowMessage(Localization:GetString("E100088"))
                end
            end
            if t["alliance"]~=nil then
                DataCenter.AllianceBaseDataManager:UpdateAllianceBaseData(t)
                local allianceData = DataCenter.AllianceBaseDataManager:GetAllianceBaseData()
                local str = Localization:GetString("390084", allianceData.allianceName)
                UIUtil.ShowTips(str);
                DataCenter.AllianceBaseDataManager:ResetAlMoveInviteInfo()
                DataCenter.AllianceBaseDataManager:AddBacktoMainCallback(function()
                    DataCenter.AllianceBaseDataManager:OpenMoveCityTipWithReq()
                end)
                EventManager:GetInstance():Broadcast(EventId.RefreshAlMoveInviteTip)
            end

            if applyType ==1 then
                DataCenter.AllianceTempListManager:ApplyAllianceByUid(allianceId)
                EventManager:GetInstance():Broadcast(EventId.CLICK_ALLIANCE_ITEM,allianceId)
            end
        end
        
        
    end

end

AlApplyMessage.OnCreate = OnCreate
AlApplyMessage.HandleMessage = HandleMessage

return AlApplyMessage