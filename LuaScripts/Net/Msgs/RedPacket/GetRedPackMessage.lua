---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl
--- DateTime: 2022/2/22 
---领取红包
local GetRedPackMessage = BaseClass("GetRedPackMessage", SFSBaseMessage)
-- 基类，用来调用基类方法
local base = SFSBaseMessage
local Localization = CS.GameEntry.Localization
local function OnCreate(self,param)
    base.OnCreate(self)
    self.sfsObj:PutUtfString("uuid",tostring(param.redPacketId))
    self.sfsObj:PutLong("serverId",tonumber(param.serverId))
    if param.isViewOnly then
        self.sfsObj:PutLong("info",1)
    end
end

local function HandleMessage(self, t)
    base.HandleMessage(self, t)
    if t["errorCode"] ~= nil then
        UIUtil.ShowTipsId(t["errorCode"])
        return
    end
    DataCenter.AllianceRedPacketManager:UpdateRecordByUUid(t)
    if UIManager:GetInstance():IsWindowOpen(UIWindowNames.UIRedenvelopeReceive) then
        local redPack = t["redPack"]
        if redPack.curPeople >= redPack.totalPeople then
            UIUtil.ShowTipsId(391120)
        end
        UIManager:GetInstance():DestroyWindow(UIWindowNames.UIRedenvelopeReceive)
    end
    local isReceive = false
    if UIManager:GetInstance():IsWindowOpen(UIWindowNames.UIRedenvelopeView)  then
        local redData = DataCenter.AllianceRedPacketManager:GetRedPacketByUUid(t.redPack.uuid)
        if redData.status == RedPacketState.ALREADY_GET then
            isReceive = true
        end
    end
    if t["getGold"] then
        isReceive = true
    end
    UIManager:GetInstance():OpenWindow(UIWindowNames.UIRedenvelopeReceiveInfo,{ anim = true},t.redPack.uuid,isReceive)
end

GetRedPackMessage.OnCreate = OnCreate
GetRedPackMessage.HandleMessage = HandleMessage

return GetRedPackMessage