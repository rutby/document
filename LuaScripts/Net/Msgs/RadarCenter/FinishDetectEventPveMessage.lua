---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2024/1/9 18:19
---

local FinishDetectEventPveMessage = BaseClass("FinishDetectEventPveMessage", SFSBaseMessage)
local base = SFSBaseMessage

local function OnCreate(self, uuid, heroes, formations, pass)
    base.OnCreate(self)
    self.sfsObj:PutLong("uuid", uuid)

    if heroes then
        local heroArray = SFSArray.New()
        for _, v in pairs(heroes) do
            local obj = SFSObject.New()
            obj:PutInt("index", v.index)
            obj:PutLong("uuid", v.uuid)
            heroArray:AddSFSObject(obj)
        end
        self.sfsObj:PutSFSArray("heroes", heroArray)
    end

    if formations then
        local formationArray = SFSArray.New()
        for armyId, count in pairs(formations) do
            local obj = SFSObject.New()
            obj:PutUtfString("armyId", armyId)
            obj:PutInt("count", count)
            formationArray:AddSFSObject(obj)
        end
        self.sfsObj:PutSFSArray("formations", formationArray)
    end

    if pass then
        self.sfsObj:PutInt("pass", pass)
    end
end

local function HandleMessage(self, message)
    base.HandleMessage(self, message)

    local battleContent = ""
    if message["battleContent"] then
        battleContent = message["battleContent"]
    elseif message["battleContentArr"] then
        for _, v in ipairs(message["battleContentArr"]) do
            battleContent = battleContent .. v
        end
    end

    local detailContent = ""
    if message["detailContent"] then
        detailContent = message["detailContent"]
    elseif message["detailContentArr"] then
        for _, v in ipairs(message["detailContentArr"]) do
            detailContent = detailContent .. v
        end
    end

    PveActorMgr:GetInstance():ParseData(battleContent, detailContent)
end

FinishDetectEventPveMessage.OnCreate = OnCreate
FinishDetectEventPveMessage.HandleMessage = HandleMessage

return FinishDetectEventPveMessage