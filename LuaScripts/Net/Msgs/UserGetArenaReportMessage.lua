---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2022/6/29 18:47
---
local UserGetArenaReportMessage = BaseClass("UserGetArenaReportMessage", SFSBaseMessage)
local base = SFSBaseMessage
local MailInfo = require "DataCenter.MailData.MailInfo"
local function OnCreate(self, uuid)
    base.OnCreate(self)
    self.sfsObj:PutLong("uuid", uuid)
end

local function HandleMessage(self, t)
    base.HandleMessage(self, t)
    if t["errorCode"] ~= nil then
        UIUtil.ShowTips(Localization:GetString(t["errorCode"]))
    else
        local mailInfo = MailInfo.New()
        local message = {}
        local battleContent = ""
        if (t["content"] ~= nil) then
            battleContent = t["content"]
        elseif t["contentArr"] ~= nil then
            local tabCnt = table.count(t["contentArr"])
            if (tabCnt > 0) then
                for i = 1, tabCnt do
                    battleContent = battleContent .. t["contentArr"][i]
                end
            end
        end
        message.contents = "{\"b\":{},\"obj\":{\"battleContent\":\""..battleContent.."\"}}"
        message.type = MailType.NEW_FIGHT_ARENA
        message.title = "{\"h\":{}}"
        message.uid = 0
        local pb_BattleReport = PBController.ParsePb1(battleContent, "protobuf.BattleReport") or {}
        message.createTime = pb_BattleReport.startTime
        mailInfo:ParseBaseData(message)
        local mailExt = mailInfo:GetMailExt()
        local version = mailExt:GetVersion()
        if version==nil or version<=0 then
            UIUtil.ShowTipsId(390843)
            return
        end 
        if mailExt.showRoundList == nil or table.count(mailExt.showRoundList) == 0 then
            UIUtil.ShowTipsId(390508)
            mailInfo = nil
        end
        if mailInfo ~= nil then
            UIManager:GetInstance():OpenWindow(UIWindowNames.UIShareMail, NormalBlurPanelAnim,mailInfo,nil,PlayBackEndJumpType.Arena, battleContent)
        end
    end

end

UserGetArenaReportMessage.OnCreate = OnCreate
UserGetArenaReportMessage.HandleMessage = HandleMessage

return UserGetArenaReportMessage