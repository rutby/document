---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhangliheng.
--- DateTime: 8/5/21 6:38 PM
---


local UpdatePicMessage = BaseClass("UpdatePicMessage", SFSBaseMessage)
local base = SFSBaseMessage
local Localization = CS.GameEntry.Localization

local function OnCreate(self)
    base.OnCreate(self)
end

local function HandleMessage(self, message)
    base.HandleMessage(self, message)

    if message["errorCode"] ~= nil then
        local lang = Localization:GetString(message["errorCode"], message["expireTime"])
        UIUtil.ShowTips(lang or message["errorCode"])
        LuaEntry.Player:UploadPicEnd()

        return
    end


    if LuaEntry.Player == nil then
        Logger.LogError('UpdatePicMessage LuaEntry.Player is nil!')
        UIUtil.ShowTipsId(120239) --120239=头像上传失败，请重试！
        LuaEntry.Player:UploadPicEnd()
        return
    end
    
    LuaEntry.Player:UpdatePic(message)
    local picVer = LuaEntry.Player.picVer

    LuaEntry.Player:UploadPicEnd()
    if picVer < 1000000 then
        UIUtil.ShowTipsId(280100)
        EventManager:GetInstance():Broadcast(EventId.UpdatePlayerHeadIcon)
    elseif picVer >2000000 and picVer <= 3000000 then
        UIUtil.ShowTipsId(120100)
    end
    DataCenter.ChangeNameAndPicManager:CheckSendGetUploadPicActivityInfo()
    --UIManager:GetInstance():DestroyWindow(UIWindowNames.UIPlayerHeadIconSelect)
end

UpdatePicMessage.OnCreate = OnCreate
UpdatePicMessage.HandleMessage = HandleMessage

return UpdatePicMessage