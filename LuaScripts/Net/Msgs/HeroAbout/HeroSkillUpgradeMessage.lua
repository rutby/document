---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhangliheng.
--- DateTime: 7/29/21 2:26 PM
---


local HeroSkillUpgradeMessage = BaseClass("HeroSkillUpgradeMessage", SFSBaseMessage)
local base = SFSBaseMessage
local Localization = CS.GameEntry.Localization


local function OnCreate(self, heroUuid, skillId)
    base.OnCreate(self)

    self.sfsObj:PutLong("heroUuid", heroUuid)
    self.sfsObj:PutLong("skillId", skillId)
end

local function HandleMessage(self, message)
    base.HandleMessage(self, message)

    if message["errorCode"] ~= nil then
        local lang = Localization:GetString(message["errorCode"])
        UIUtil.ShowTips(lang or message["errorCode"])
        return
    end

    local hero = message["hero"]
    if hero ~= nil then
        local uuid = hero["uuid"]
        local power = 0
        local heroData = DataCenter.HeroDataManager:GetHeroByUuid(uuid)
        if heroData ~= nil then
            power = HeroUtils.GetHeroPower(heroData)
        end
        DataCenter.HeroDataManager:UpdateOneHero(hero)
        heroData = DataCenter.HeroDataManager:GetHeroByUuid(uuid)
        if heroData ~= nil then
            power = HeroUtils.GetHeroPower(heroData) - power
        end
        if power > 0 then
            GoToUtil.ShowPower({power = power})
        end
    end

    local heroUuid = message['heroUuid']
    local skillId  = message['skillId']
    local level    = message['level']

    local heroData = DataCenter.HeroDataManager:GetHeroByUuid(heroUuid)
    if heroData ~= nil then
        heroData:UpdateSkillLevel(skillId, level)
    end
    if message['upSkillNum'] ~= nil then
        heroData:SetUpSkillNum(message['upSkillNum'])
    end

    EventManager:GetInstance():Broadcast(EventId.SkillUpgradeEnd, message)
    EventManager:GetInstance():Broadcast(EventId.HeroStationUpdate)
    EventManager:GetInstance():Broadcast(EventId.RefreshHeroEffectSkill)
end

HeroSkillUpgradeMessage.OnCreate = OnCreate
HeroSkillUpgradeMessage.HandleMessage = HandleMessage

return HeroSkillUpgradeMessage