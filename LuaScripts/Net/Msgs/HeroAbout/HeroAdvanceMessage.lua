---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhangliheng.
--- DateTime: 6/25/21 5:58 PM
---
--- 英雄升阶协议

local HeroAdvanceMessage = BaseClass("HeroAdvanceMessage", SFSBaseMessage)
local base = SFSBaseMessage
local Localization = CS.GameEntry.Localization

local function OnCreate(self, heroUuid, dict)
    base.OnCreate(self)

    self.sfsObj:PutLong("uuid", heroUuid)
    
    local arr = SFSArray.New()
    for heroId, num in pairs(dict) do
        local one = SFSObject.New()
        one:PutInt("heroId", heroId)
        one:PutInt("num", num)
        arr:AddSFSObject(one)
    end
    self.sfsObj:PutSFSArray("costPosters", arr)
end

local function HandleMessage(self, message)
    base.HandleMessage(self, message)

    if message["errorCode"] ~= nil then
        local lang = Localization:GetString(message["errorCode"])
        UIUtil.ShowTips(lang or message["errorCode"])
        return
    end
    SoundUtil.PlayEffect(SoundAssets.Music_Effect_Hero_Upgrade1)
    HeroAdvanceController:GetInstance():OnHandleHeroAdvance(message)
    EventManager:GetInstance():Broadcast(EventId.CheckPubBubble, true)
    DataCenter.HeroStationManager:CheckStationEffectOldVal()

    local retItems = message["retItem"]
    if retItems ~= nil and table.count(retItems) > 0 then
        UIManager:GetInstance():OpenWindow(UIWindowNames.UIHeroResetSuccess, nil, retItems, true)
    end

end

HeroAdvanceMessage.OnCreate = OnCreate
HeroAdvanceMessage.HandleMessage = HandleMessage

return HeroAdvanceMessage