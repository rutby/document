---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhangliheng.
--- DateTime: 9/23/21 11:42 AM
---
--- 英雄等级突破
---


local HeroLvBeyondMessage = BaseClass("HeroLvBeyondMessage", SFSBaseMessage)
local base = SFSBaseMessage
local Localization = CS.GameEntry.Localization

local function OnCreate(self, heroUuid)
    base.OnCreate(self)
    self.sfsObj:PutLong('uuid', heroUuid)
end

local function HandleMessage(self, message)
    base.HandleMessage(self, message)

    if message['errorCode'] ~= nil then
        local lang = Localization:GetString(message['errorCode'])
        UIUtil.ShowTips(lang or message['errorCode'])
        return
    end
    SoundUtil.PlayEffect(SoundAssets.Music_Effect_Hero_Upgrade3)
    --更新资源
    local res = message['resource']
    if res ~= nil then
        LuaEntry.Resource:UpdateResource(res)
    end
    
    local hero = message['hero']
    if hero ~= nil then
        local uuid = hero["uuid"]
        local power = 0
        local heroData = DataCenter.HeroDataManager:GetHeroByUuid(uuid)
        if heroData ~= nil then
            power = HeroUtils.GetHeroPower(heroData)
        end
        DataCenter.HeroDataManager:UpdateOneHero(hero)
        heroData = DataCenter.HeroDataManager:GetHeroByUuid(uuid)
        if heroData ~= nil then
            power = HeroUtils.GetHeroPower(heroData) - power
        end
        if power > 0 then
            GoToUtil.ShowPower({power = power})
        end
        EventManager:GetInstance():Broadcast(EventId.HeroLvUpSuccess, uuid)
        EventManager:GetInstance():Broadcast(EventId.HeroBeyondSuccess, uuid)
    end
    EventManager:GetInstance():Broadcast(EventId.HeroStationUpdate)
    EventManager:GetInstance():Broadcast(EventId.RefreshHeroEffectSkill)
    UIUtil.ShowTipsId(120062) 
end

HeroLvBeyondMessage.OnCreate = OnCreate
HeroLvBeyondMessage.HandleMessage = HandleMessage

return HeroLvBeyondMessage