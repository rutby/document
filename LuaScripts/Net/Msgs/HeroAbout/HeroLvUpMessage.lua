---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhangliheng.
--- DateTime: 6/29/21 10:26 AM
---
--- 英雄升级协议


local HeroLvUpMessage = BaseClass("HeroLvUpMessage", SFSBaseMessage)
local base = SFSBaseMessage
local Localization = CS.GameEntry.Localization

local function OnCreate(self, heroUuid, num)
    base.OnCreate(self)

    self.sfsObj:PutLong("heroUid", heroUuid)
    self.sfsObj:PutInt("num", num)
end

local function HandleMessage(self, message)
    base.HandleMessage(self, message)
    
    --if message["errorCode"] ~= nil then
    --    local lang = Localization:GetString(message["errorCode"])
    --    UIUtil.ShowTips(lang or message["errorCode"])
    --    return
    --end

    local hero = message
    if hero ~= nil then
        local uuid = hero["uuid"]
        local power = 0
        local heroData = DataCenter.HeroDataManager:GetHeroByUuid(uuid)
        if heroData ~= nil then
            power = HeroUtils.GetHeroPower(heroData)
        end
        DataCenter.HeroDataManager:UpdateOneHero(hero)
        heroData = DataCenter.HeroDataManager:GetHeroByUuid(uuid)
        if heroData ~= nil then
            power = HeroUtils.GetHeroPower(heroData) - power
        end
        if power > 0 then
            GoToUtil.ShowPower({power = power})
        end
        EventManager:GetInstance():Broadcast(EventId.HeroLvUpSuccess, uuid)
    end
    
    EventManager:GetInstance():Broadcast(EventId.HeroStationUpdate)
    DataCenter.HeroStationManager:CheckStationEffectOldVal()
end

HeroLvUpMessage.OnCreate = OnCreate
HeroLvUpMessage.HandleMessage = HandleMessage

return HeroLvUpMessage