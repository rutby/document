---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by mac.
--- DateTime: 8/18/21 6:58 PM
---
local MailGetReportDetailMessage = BaseClass("MailGetReportDetailMessage", SFSBaseMessage)
local Localization = CS.GameEntry.Localization

local base = SFSBaseMessage

--[[
    这个地方有个问题
    没有办法附带自己的数据
]]

local mailId = ""
local roundIdx = 1
local mailInfo = {}

local function OnCreate(self, reportId, _mailId, _roundIdx, _mailInfo)
    base.OnCreate(self)
    mailId = _mailId
    roundIdx = _roundIdx
    mailInfo = _mailInfo
    if reportId ~= nil then
        self.sfsObj:PutLong("fightReportUuid", reportId)
    end
end

local function HandleMessage(self, t)
    base.HandleMessage(self, t)
    Logger.Log(t)
    local errCode =  t["errorCode"]
    if errCode ~= nil then
        UIUtil.ShowTipsId(errCode) 
        return
    end
    if (t == nil) then
        return
    end
    local param = {}
    param["contents"] = ""
    if (t["contents"] ~= nil) then
        param["contents"] = t["contents"]
    elseif t["contentsArr"] ~= nil then
        local tabCnt = table.count(t["contentsArr"])
        if (tabCnt > 0) then
            for i = 1, tabCnt do
                param["contents"] = param["contents"] .. t["contentsArr"][i]
            end
        end
    end
    if (string.IsNullOrEmpty(param["contents"])) then
        UIUtil.ShowTipsId(311133)
        return
    end
    if PveActorMgr:GetInstance():GetIsInPlayBackPveState() then
        PveActorMgr:GetInstance():ParsePlayBackData(param["contents"])
    else
        param["mailId"] = mailId
        param["roundIdx"] = roundIdx
        param["mailInfo"] = mailInfo
        EventManager:GetInstance():Broadcast(EventId.Event_ShowBattleReportDetail, param)
    end
end

MailGetReportDetailMessage.OnCreate = OnCreate
MailGetReportDetailMessage.HandleMessage = HandleMessage

return MailGetReportDetailMessage