---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/6/25 15:55
---
local UserRewardStaminaBubbleMessage = BaseClass("UserRewardStaminaBubbleMessage", SFSBaseMessage)
local base = SFSBaseMessage
local Localization = CS.GameEntry.Localization
local function OnCreate(self)
    base.OnCreate(self)
end

local function HandleMessage(self, t)
    base.HandleMessage(self, t)
    if t["errorCode"] ~= nil then
        UIUtil.ShowTips(Localization:GetString(t["errorCode"]))
    else
        if t["reward"] ~= nil then
            local rewardList = DataCenter.RewardManager:ReturnRewardParamForMessage(t["reward"])
            if rewardList ~= nil then
                table.walk(rewardList, function (_, v)
                    --应要求全都飘到左上角的箱子
                    local pic = DataCenter.RewardManager:GetPicByType(v.rewardType, v.itemId)
                    local flyPos =Vector3:New(0,0,0)
                    local num = v.count
                    num = math.min(num, 3)
                    local totalW = Screen.width
                    local totalH = Screen.height
                    local screenPos = Vector3.New(totalW / 2, totalH / 2, 0)
                    UIUtil.DoFly(tonumber(RewardType.GOODS), num, pic, screenPos, flyPos)
                end)
            end
            --TimerManager:GetInstance():DelayInvoke(function()
                for k,v in pairs(t["reward"]) do
                    DataCenter.RewardManager:AddOneReward(v)
                end
            --end, 1.5)
            DataCenter.StaminaBallManager:GetStaminaDataRequest()
        end
    end

end

UserRewardStaminaBubbleMessage.OnCreate = OnCreate
UserRewardStaminaBubbleMessage.HandleMessage = HandleMessage

return UserRewardStaminaBubbleMessage