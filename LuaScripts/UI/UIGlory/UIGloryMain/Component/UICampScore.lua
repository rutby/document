---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/3/1 11:21
---

local UICampScore = BaseClass("UICampScore", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self._title_txt = self:AddComponent(UIText, "SafeArea/UIGlorySFive/Title")
    self._desc_txt = self:AddComponent(UIText, "SafeArea/UIGlorySFive/Desc")
    self._intro_btn = self:AddComponent(UIButton,"SafeArea/UIGlorySFive/Title/Btn_Intro")
    self._intro_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnClickIntro()
    end)

    self._camp1_txt = self:AddComponent(UIText, "SafeArea/UIGlorySFive/Rect_Camp1/Txt_Camp1")
    self._camp2_txt = self:AddComponent(UIText, "SafeArea/UIGlorySFive/Rect_Camp2/Txt_Camp2")
    self._desc1_txt = self:AddComponent(UIText, "SafeArea/UIGlorySFive/Rect_Camp1/Txt_Des1")
    self._desc2_txt = self:AddComponent(UIText, "SafeArea/UIGlorySFive/Rect_Camp2/Txt_Des2")
    self._campScore1_txt = self:AddComponent(UIText, "SafeArea/UIGlorySFive/Rect_Camp1/Txt_CampScore1")
    self._campScore2_txt = self:AddComponent(UIText, "SafeArea/UIGlorySFive/Rect_Camp2/Txt_CampScore2")

    self._selfCamp1_rect = self:AddComponent(UIBaseContainer, "SafeArea/UIGlorySFive/Rect_Camp1/Rect_SelfCamp1")
    self._selfCamp2_rect = self:AddComponent(UIBaseContainer, "SafeArea/UIGlorySFive/Rect_Camp2/Rect_SelfCamp2")
    self._selfCamp1_txt = self:AddComponent(UIText, "SafeArea/UIGlorySFive/Rect_Camp1/Rect_SelfCamp1/Txt_SelfCamp1")
    self._selfCamp2_txt = self:AddComponent(UIText, "SafeArea/UIGlorySFive/Rect_Camp2/Rect_SelfCamp2/Txt_SelfCamp2")

    self._win1_rect = self:AddComponent(UIBaseContainer, "SafeArea/UIGlorySFive/Rect_Camp1/Rect_Win1")
    self._win2_rect = self:AddComponent(UIBaseContainer, "SafeArea/UIGlorySFive/Rect_Camp2/Rect_Win2")
end

local function ComponentDestroy(self)

end

local function DataDefine(self)

end

local function DataDestroy(self)

end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function OnAddListener(self)
    base.OnAddListener(self)
    self:AddUIListener(EventId.EdenCampScore, self.RefreshScore)
end

local function OnRemoveListener(self)
    self:RemoveUIListener(EventId.EdenCampScore, self.RefreshScore)
    base.OnRemoveListener(self)
end

local function SetData(self, actId)
   -- DataCenter.ActivityListDataManager:SetActivityVisitedEndTime(actId)
    self.activityData = DataCenter.ActivityListDataManager:GetActivityDataById(actId)
    self._title_txt:SetLocalText(self.activityData.name)
    self._desc_txt:SetLocalText(self.activityData.desc_info)
    self._camp1_txt:SetLocalText(111064)
    self._camp2_txt:SetLocalText(111063)
    self._desc1_txt:SetLocalText(111141)
    self._desc2_txt:SetLocalText(111141)
    self._selfCamp1_txt:SetLocalText(111148)
    self._selfCamp2_txt:SetLocalText(111148)
    
    SFSNetwork.SendMessage(MsgDefines.GetEdenCampScore)

    local selfCamp = DataCenter.RobotWarsManager:GetSelfCamp()
    if selfCamp and selfCamp ~= -1 then
        self._selfCamp1_rect:SetActive(selfCamp == 1)
        self._selfCamp2_rect:SetActive(selfCamp == 2)
    end
    
    self._campScore1_txt:SetText("0")
    self._campScore2_txt:SetText("0")
end

local function RefreshScore(self)
    local campScore = DataCenter.GloryManager:GetSFiveCampScore()
    if campScore and table.count(campScore) > 0 then
        local score1,score2 = 0
        local lastOccupyTime1,lastOccupyTime2 = 0
        for i = 1, table.count(campScore) do
            if campScore[i].camp == 1 then
                score1 = campScore[i].score
                lastOccupyTime1 = campScore[i].lastOccupyTime
                self._campScore1_txt:SetText(campScore[i].score)
            elseif campScore[i].camp == 2 then
                score2 = campScore[i].score
                lastOccupyTime2 = campScore[i].lastOccupyTime
                self._campScore2_txt:SetText(campScore[i].score)
            end
        end
        if score1 == score2 and score1 ~= 0 then
            self._win1_rect:SetActive(lastOccupyTime1 < lastOccupyTime2)
            self._win2_rect:SetActive(lastOccupyTime2 < lastOccupyTime1)
        else
            if score1 == 0 and score2 == 0 then
                self._win1_rect:SetActive(false)
                self._win2_rect:SetActive(false)
            else
                self._win1_rect:SetActive(score1 > score2)
                self._win2_rect:SetActive(score2 > score1)
            end
        end
    end
end

local function OnClickIntro(self)
    local param = {}
    param.type = "desc"
    param.desc = Localization:GetString("111153")
    param.alignObject = self._intro_btn
    UIManager:GetInstance():OpenWindow(UIWindowNames.UIItemTips, { anim = true }, param)
end

UICampScore.OnCreate= OnCreate
UICampScore.OnDestroy = OnDestroy
UICampScore.ComponentDefine = ComponentDefine
UICampScore.ComponentDestroy = ComponentDestroy
UICampScore.DataDefine = DataDefine
UICampScore.DataDestroy = DataDestroy
UICampScore.OnEnable = OnEnable
UICampScore.OnDisable = OnDisable
UICampScore.OnAddListener = OnAddListener
UICampScore.OnRemoveListener = OnRemoveListener

UICampScore.SetData = SetData
UICampScore.RefreshScore = RefreshScore
UICampScore.OnClickIntro = OnClickIntro

return UICampScore