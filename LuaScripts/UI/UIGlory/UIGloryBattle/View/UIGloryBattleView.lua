---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/2/28 10:54
---

local UIGloryBattle = BaseClass("UIGloryBattle", UIBaseView)
local base = UIBaseView
local UIGloryBtnList = require "UI.UIGlory.Component.UIGloryBtnList"
local UIGloryBattlePrepare = require "UI.UIGlory.UIGloryBattle.Component.UIGloryBattlePrepare"
local UIGloryBattleStart = require "UI.UIGlory.UIGloryBattle.Component.UIGloryBattleStart"
local Localization = CS.GameEntry.Localization

local back_path = "SafeArea/Back"
local prepare_path = "SafeArea/UIGloryBattlePrepare"
local start_path = "SafeArea/UIGloryBattleStart"
local btn_list_path = "SafeArea/UIGloryBtnList"

local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
    self:ReInit()
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function ComponentDefine(self)
    self.back_btn = self:AddComponent(UIButton, back_path)
    self.back_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.prepare = self:AddComponent(UIGloryBattlePrepare, prepare_path)
    self.start = self:AddComponent(UIGloryBattleStart, start_path)
    self.btn_list = self:AddComponent(UIGloryBtnList, btn_list_path)
    self.btn_list:SetMissileEnable(true)
end

local function ComponentDestroy(self)
    self.back_btn = nil
    self.prepare = nil
    self.start = nil
    self.btn_list = nil
end

local function DataDefine(self)

end

local function DataDestroy(self)

end

local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function ReInit(self)
    self:Refresh()
end

local function Refresh(self)
    local seasonId = DataCenter.SeasonDataManager:GetSeasonId()
    self.btn_list:SetSeasonId(seasonId)
    local period = DataCenter.GloryManager:GetPeriod()
    if period == GloryPeriod.Prepare then
        self.prepare:SetActive(true)
        self.start:SetActive(false)
        self.btn_list:ShowRecord(false)
        self.btn_list:ShowDeclareRecord(true)
        self.btn_list:ShowRest(true)
    elseif period == GloryPeriod.Start then
        local battleState = DataCenter.GloryManager:GetBattleState()
        if battleState == GloryBattleState.None then
            self.prepare:SetActive(true)
            self.start:SetActive(false)
            self.btn_list:ShowRecord(false)
            self.btn_list:ShowDeclareRecord(true)
            self.btn_list:ShowRest(true)
        elseif battleState == GloryBattleState.Before then
            self.prepare:SetActive(true)
            self.start:SetActive(false)
            self.btn_list:ShowRecord(true)
            self.btn_list:ShowDeclareRecord(false)
            self.btn_list:ShowRest(false)
        elseif battleState == GloryBattleState.Ongoing or battleState == GloryBattleState.After then
            self.prepare:SetActive(false)
            self.start:SetActive(true)
            self.btn_list:ShowRecord(true)
            self.btn_list:ShowDeclareRecord(false)
            self.btn_list:ShowRest(false)
        end
    end
end

UIGloryBattle.OnCreate = OnCreate
UIGloryBattle.OnDestroy = OnDestroy
UIGloryBattle.OnEnable = OnEnable
UIGloryBattle.OnDisable = OnDisable
UIGloryBattle.ComponentDefine = ComponentDefine
UIGloryBattle.ComponentDestroy = ComponentDestroy
UIGloryBattle.DataDefine = DataDefine
UIGloryBattle.DataDestroy = DataDestroy
UIGloryBattle.OnAddListener = OnAddListener
UIGloryBattle.OnRemoveListener = OnRemoveListener

UIGloryBattle.ReInit = ReInit
UIGloryBattle.Refresh = Refresh

return UIGloryBattle