---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by w.
--- DateTime: 2022/12/20 11:57
---
---
local TopStageBarCell = BaseClass("TopStageBarCell",UIBaseContainer)
local base = UIBaseContainer--Variable
local Const = require("Scene.LWBattle.Const")

local UnityRectTransform = typeof(CS.UnityEngine.RectTransform)

function TopStageBarCell:OnCreate()
    base.OnCreate(self)
    self.nameTxt = self:AddComponent(UIText, "IconArea/Text")
    self.icon_img = self:AddComponent(UIImage, "IconArea/Icon")
    self.icon_bg = self:AddComponent(UIImage, "IconArea")
    self.rectTransform = self.transform:GetComponent(UnityRectTransform)
    self.barArea = self.transform:Find("BarArea")
    self.fg = self.transform:Find("BarArea/BarFg"):GetComponent(UnityRectTransform)
end

function TopStageBarCell:OnDestroy()
    self.nameTxt = nil
    self.icon_img = nil
    self.rectTransform = nil
    self.barArea = nil
    self.fg = nil
    base.OnDestroy(self)
end

function TopStageBarCell:RefreshData(stageId,percent,order,showBar)
    self.stageMeta = LocalController:instance():getLine(LuaEntry.Player:GetABTestTableName(TableName.LW_Stage),stageId)
    self.winParam = string.split(self.stageMeta.win_condition,"|")
    self.winType = tonumber(self.winParam[1])
    self.nameTxt:SetText(order) 
    self:LoadIcon()
    if showBar then
        self.barArea.gameObject:SetActive(true)
        self:SetBar(percent)
        self.rectTransform:Set_sizeDelta(100,40)
    else 
        self.barArea.gameObject:SetActive(false)
        self.rectTransform:Set_sizeDelta(0,40)
    end
end

function TopStageBarCell:LoadIcon()
    local spriteName = ""
    local winType = self.winType
    if winType == Const.StageWinType.KillTargetMonster then
        spriteName = "Assets/Main/Sprites/UI/UIZombieBattleMain/guanqia_cfm_tubiao_1"
    elseif winType == Const.StageWinType.KillMonster then
        spriteName = "Assets/Main/Sprites/UI/UIZombieBattleMain/guanqia_cfm_tubiao_1"
    elseif winType == Const.StageWinType.WayPoint then
        spriteName = "Assets/Main/Sprites/UI/UIZombieBattleMain/guanqia_cfm_tubiao_3"
    elseif winType == Const.StageWinType.Time then
        spriteName = "Assets/Main/Sprites/UI/UIZombieBattleMain/guanqia_cfm_tubiao_2"
    elseif winType == Const.StageWinType.KillBoss then
        spriteName = "Assets/Main/Sprites/UI/UIZombieBattleMain/guanqia_cfm_tubiao_4"
    end
    self.icon_img:LoadSprite(spriteName)
end

function TopStageBarCell:SetBar(percent)
    self.fg:Set_sizeDelta(percent * 118, 22)
end



return TopStageBarCell