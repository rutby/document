---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2021/9/15 16:38
---UISetPlayerNationView

local base = UIBaseView--Variable
local UISetPlayerNationView = BaseClass("UISetPlayerNationView", base)--Variable
local Localization = CS.GameEntry.Localization
local SetPlayerNationItem = require "UI.UISetPlayerNation.Component.SetPlayerNationItem"

local title_path = "UICommonMidPopUpTitle/bg_mid/titleText"
local closeBtn_path = "UICommonMidPopUpTitle/bg_mid/CloseBtn"
local panelCloseBtn_path = "UICommonMidPopUpTitle/panel"
local svNation_path = "ImgBg/ScrollView"
local content_path = "ImgBg/ScrollView/Content"
local confirmBtn_path = "ImgBg/confirmBtn"
local confirmBtnTxt_path = "ImgBg/confirmBtn/confirmBtnTxt"

local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
    self:RefreshAll()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.titleN = self:AddComponent(UITextMeshProUGUIEx, title_path)
    self.titleN:SetLocalText(143589)
    self.closeBtnN = self:AddComponent(UIButton, closeBtn_path)
    self.closeBtnN:SetOnClick(function()
        self:OnClickCloseBtn()
    end)
    self.panelCloseBtn = self:AddComponent(UIButton, panelCloseBtn_path)
    self.panelCloseBtn:SetOnClick(function()
        self:OnClickCloseBtn()
    end)
    self.svNationN = self:AddComponent(UIBaseContainer, svNation_path)
    self.contentN = self:AddComponent(GridInfinityScrollView, content_path)
    local bindFunc1 = BindCallback(self, self.OnInitScroll)
    local bindFunc2 = BindCallback(self, self.OnUpdateScroll)
    local bindFunc3 = BindCallback(self, self.OnDestroyScrollItem)
    self.contentN:Init(bindFunc1,bindFunc2, bindFunc3)
    self.confirmBtnN = self:AddComponent(UIButton, confirmBtn_path)
    self.confirmBtnN:SetOnClick(function()
        self:OnClickConfirmBtn()
    end)
    self.confirmBtnTxtN = self:AddComponent(UITextMeshProUGUIEx, confirmBtnTxt_path)
    self.confirmBtnTxtN:SetLocalText(110006)
end

local function ComponentDestroy(self)
    self.titleN = nil
    self.closeBtnN = nil
    self.svNationN = nil
    self.contentN = nil
end

local function DataDefine(self)
    self.nationItems = {}
    self.nationList = nil
    self.curSelected = nil
end

local function DataDestroy(self)
    self.nationList = nil
    self.nationItems = nil
    self.curSelected = nil
end

--[[
local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end
--]]

local function RefreshAll(self)
    local param = self:GetUserData()
    self.cacheNation = param and param.nation or nil
    local tempNation = (param and param.nation) and param.nation or DefaultNation
    local nationTemplate = DataCenter.NationTemplateManager:GetNationTemplate(tempNation)
    self.curSelected = nationTemplate.nation
    self.selectCallBack = (param and param.callback) and param.callback or nil
    
    self.nationList = self.ctrl:GetAllNationsSorted()
    
    self.contentN:SetItemCount(#self.nationList)
end

local function OnInitScroll(self,go,index)
    local item = self.svNationN:AddComponent(SetPlayerNationItem, go)
    self.nationItems[go] = item
end

local function OnUpdateScroll(self,go,index)
    local nation = self.nationList[index + 1]
    go.name = nation.nation
    local cellItem = self.nationItems[go]
    if not cellItem then
        return
    end
    cellItem:SetItem(nation, self.curSelected)
end

local function OnDestroyScrollItem(self,go, index)

end

local function OnSelectNation(self, nationType)
    self.curSelected = nationType
    for i, v in pairs(self.nationItems) do
        v:RefreshSelectStatus(self.curSelected)
    end
end

local function OnClickCloseBtn(self)
    self.ctrl:CloseSelf()
end

local function OnClickConfirmBtn(self)
    if self.cacheNation ~= self.curSelected and self.selectCallBack then
        self.selectCallBack(self.curSelected)
    end
    self.ctrl:CloseSelf()
end


UISetPlayerNationView.OnCreate = OnCreate 
UISetPlayerNationView.OnDestroy = OnDestroy
--UISetPlayerNationView.OnAddListener = OnAddListener
--UISetPlayerNationView.OnRemoveListener = OnRemoveListener
UISetPlayerNationView.ComponentDefine = ComponentDefine
UISetPlayerNationView.ComponentDestroy = ComponentDestroy
UISetPlayerNationView.DataDefine = DataDefine
UISetPlayerNationView.DataDestroy = DataDestroy

UISetPlayerNationView.RefreshAll = RefreshAll
UISetPlayerNationView.OnInitScroll = OnInitScroll
UISetPlayerNationView.OnUpdateScroll = OnUpdateScroll
UISetPlayerNationView.OnDestroyScrollItem = OnDestroyScrollItem
UISetPlayerNationView.OnClickCloseBtn = OnClickCloseBtn
UISetPlayerNationView.OnSelectNation = OnSelectNation
UISetPlayerNationView.OnClickConfirmBtn = OnClickConfirmBtn

return UISetPlayerNationView