---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1020.
--- DateTime: 2023/4/11 16:10
---

local AlContributeBoxItem = BaseClass("AlContributeBoxItem",UIBaseContainer)
local base = UIBaseContainer
local UICommonItem = require "UI.UICommonItem.UICommonItem"

local boxItem_path = "box"
local rewardItem_path = "box/rewardItem"
local resItem_btn_path = "box/rewardItem/clickBtn"
local txtNeedScore_path = "box/txtNeedScore"
local effN_path = "box/cliamEff"
local claimedN_path = "box/claimed"
local claimBtnN_path = "box/claimBtn"
local imgLock_path = "box/claimedBg"

local processSlider_path = "Slider"

-- 创建 
function AlContributeBoxItem : OnCreate()
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

-- 销毁
function AlContributeBoxItem : OnDestroy()
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

--变量的定义
function AlContributeBoxItem : DataDefine()
    self.index = nil
end

--变量的销毁
function AlContributeBoxItem : DataDestroy()
    self.index = nil
end

--控件的定义
function AlContributeBoxItem : ComponentDefine()
    self.boxItem = self:AddComponent(UIBaseContainer, boxItem_path)
    self.rewardItem = self:AddComponent(UICommonItem, rewardItem_path)
    self.txtNeedScore = self:AddComponent(UIText, txtNeedScore_path)
    self.effN = self:AddComponent(UIBaseContainer, effN_path)
    self.claimedN = self:AddComponent(UIBaseContainer, claimedN_path)
    self.claimBtnN = self:AddComponent(UIButton, claimBtnN_path)
    self.claimBtnN:SetOnClick(function()
        self:OnClickClaimBtn(self.index - 1)
    end)
    self.scoreSlider = self:AddComponent(UISlider, processSlider_path)
    self.imgLock = self:AddComponent(UIImage, imgLock_path)
    
    self.resItem_btn = self:AddComponent(UIButton,resItem_btn_path)
    self.resItem_btn:SetOnClick(function()
        self:OnClickRes()
    end)
end

--控件的销毁
function AlContributeBoxItem : ComponentDestroy()
end

function AlContributeBoxItem : SetItem(index, scoreItemInfo)
    self.index = index

    if scoreItemInfo.showSlider then
        self.scoreSlider:SetActive(true)
        self.scoreSlider:SetValue(scoreItemInfo.process)
    else
        self.scoreSlider:SetActive(false)
    end
    self.scoreItemInfo = scoreItemInfo
    if scoreItemInfo.showBoxItem then
        self.boxItem:SetActive(true)
        self.txtNeedScore:SetActive(true)
        local unLock = scoreItemInfo["unLock"]
        self.imgLock:SetActive(not unLock)
        self.rewardItem:ReInit(scoreItemInfo.reward)
        self.txtNeedScore:SetText(scoreItemInfo.needScore)
        if scoreItemInfo.state == 1 then         -- 积分未达到不可领取
            self.claimedN:SetActive(false)
            self.claimBtnN:SetActive(false)
            self.effN:SetActive(false)
        elseif scoreItemInfo.state == 2 then     -- 积分达到且未领取
            self.claimedN:SetActive(false)
            self.claimBtnN:SetActive(true and unLock)
            self.effN:SetActive(true and unLock)
        else                                    -- 积分达到且已领取
            self.claimBtnN:SetActive(false)
            self.effN:SetActive(false)
            self.claimedN:SetActive(true)
        end
    else
        self.boxItem:SetActive(false)
        self.txtNeedScore:SetActive(false)
    end
end

function AlContributeBoxItem : OnClickClaimBtn(rewardIndex)
    DataCenter.AlContributeManager:ClaimBoxReq(rewardIndex)
    self.claimBtnN:SetActive(false)
    self.effN:SetActive(false)
    self.claimedN:SetActive(true)
    self.view:OnGetReward(self.index)
end

function AlContributeBoxItem:OnClickRes()
    if self.scoreItemInfo and not self.scoreItemInfo.unLock then
        UIUtil.ShowTipsId(372868)
    end
end

return AlContributeBoxItem