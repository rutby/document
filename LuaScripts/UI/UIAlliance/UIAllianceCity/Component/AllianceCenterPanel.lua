---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/2/22 10:43
---
local base = UIBaseContainer--Variable
local AllianceCenterPanel = BaseClass("AllianceCenterPanel", base)--Variable
local Localization = CS.GameEntry.Localization
local AllianceCenterItem = require "UI.UIAlliance.UIAllianceCity.Component.AllianceCenterItem"

local infoBtn_path = "Top/infoBtn"
local desc_path = "Top/desc"
local mineSr_path = "ScrollView"

local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ClearItemCell()
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.infoBtnN = self:AddComponent(UIButton, infoBtn_path)
    self.infoBtnN:SetOnClick(function()
        self:OnClickInfoBtn()
    end)
    self.descN = self:AddComponent(UITextMeshProUGUIEx, desc_path)
    self.descN:SetLocalText(302027)
    self.ScrollView = self:AddComponent(UIScrollView, mineSr_path)
    self.ScrollView:SetOnItemMoveIn(function(itemObj, index)
        self:OnItemMoveIn(itemObj, index)
    end)
    self.ScrollView:SetOnItemMoveOut(function(itemObj, index)
        self:OnItemMoveOut(itemObj, index)
    end)
end

local function ComponentDestroy(self)
    self.infoBtnN = nil
    self.descN = nil
end

local function DataDefine(self)
    self.mineTemplateList = {}
end

local function DataDestroy(self)
    self.mineTemplateList = nil
end


local function OnAddListener(self)
    base.OnAddListener(self)
    self:AddUIListener(EventId.AllianceCenterUpdate, self.RefreshData)
    self:AddUIListener(EventId.OnUpdateOneAllianceCenter,self.RefreshData)
    self:AddUIListener(EventId.OnDeleteOneAllianceCenter,self.RefreshData)
    self:AddUIListener(EventId.OnRecvAllianceStorageInfo, self.RefreshRes)
end

local function OnRemoveListener(self)
    self:RemoveUIListener(EventId.AllianceCenterUpdate, self.RefreshData)
    self:RemoveUIListener(EventId.OnUpdateOneAllianceCenter,self.RefreshData)
    self:RemoveUIListener(EventId.OnDeleteOneAllianceCenter,self.RefreshData)
    self:RemoveUIListener(EventId.OnRecvAllianceStorageInfo, self.RefreshRes)
    base.OnRemoveListener(self)
end



local function ShowPanel(self,selectPos)
    self.selectPos = selectPos
    DataCenter.AllianceStorageManager:CheckAllianceStorage()
    DataCenter.AllianceMineManager:RequestAllianceMineInfo(true)
    self:RefreshData()
end

local function RefreshData(self)
    self:ClearItemCell()
    self.mineTemplateList = DataCenter.AllianceMineManager:GetAlCenterBuildList()
    if self.mineTemplateList~=nil and #self.mineTemplateList>0 then
        self.ScrollView:SetTotalCount(#self.mineTemplateList)
        self.ScrollView:RefillCells()
    end
end

local function RefreshRes(self)
    if self.cellList~=nil then
        for k,v in pairs(self.cellList) do
            v:RefreshRes()
        end
    end
end

local function OnItemMoveIn(self,itemObj, index)
    itemObj.name = tostring(index)
    local cellItem = self.ScrollView:AddComponent(AllianceCenterItem, itemObj)
    cellItem:SetItemShow(self.mineTemplateList[index])
    cellItem:SetSelectPos(self.selectPos)
    self.cellList[index] = cellItem
end

local function OnItemMoveOut(self, itemObj, index)
    self.ScrollView:RemoveComponent(itemObj.name, AllianceCenterItem)
    self.cellList[index] = nil
end


local function ClearItemCell(self)
    self.ScrollView:ClearCells()
    self.ScrollView:RemoveComponents(AllianceCenterItem)
    self.mineTemplateList = {}
    self.cellList = {}
end


local function OnClickInfoBtn(self)
    UIUtil.ShowIntro(Localization:GetString("302741"), Localization:GetString("302027"), Localization:GetString("302742"))
end

AllianceCenterPanel.OnCreate = OnCreate
AllianceCenterPanel.OnDestroy = OnDestroy
AllianceCenterPanel.OnAddListener = OnAddListener
AllianceCenterPanel.OnRemoveListener = OnRemoveListener
AllianceCenterPanel.ComponentDefine = ComponentDefine
AllianceCenterPanel.ComponentDestroy = ComponentDestroy
AllianceCenterPanel.DataDefine = DataDefine
AllianceCenterPanel.DataDestroy = DataDestroy

AllianceCenterPanel.ShowPanel = ShowPanel
AllianceCenterPanel.OnItemMoveIn = OnItemMoveIn
AllianceCenterPanel.OnItemMoveOut = OnItemMoveOut
AllianceCenterPanel.ClearItemCell = ClearItemCell
AllianceCenterPanel.OnClickInfoBtn = OnClickInfoBtn
AllianceCenterPanel.RefreshData = RefreshData
AllianceCenterPanel.RefreshRes = RefreshRes
return AllianceCenterPanel