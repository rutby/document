---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2022/12/9 13:26
---AllianceMinePanel.lua

local base = UIBaseContainer--Variable
local AllianceMinePanel = BaseClass("AllianceMinePanel", base)--Variable
local Localization = CS.GameEntry.Localization
local AllianceMineItem = require "UI.UIAlliance.UIAllianceCity.Component.AllianceMineItem"

local infoBtn_path = "Top/infoBtn"
local desc_path = "Top/desc"
local mineSr_path = "ScrollView"

local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ClearItemCell()
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.infoBtnN = self:AddComponent(UIButton, infoBtn_path)
    self.infoBtnN:SetOnClick(function()
        self:OnClickInfoBtn()
    end)
    self.descN = self:AddComponent(UITextMeshProUGUIEx, desc_path)
    self.descN:SetLocalText(300749)
    self.ScrollView = self:AddComponent(UIScrollView, mineSr_path)
    self.ScrollView:SetOnItemMoveIn(function(itemObj, index)
        self:OnItemMoveIn(itemObj, index)
    end)
    self.ScrollView:SetOnItemMoveOut(function(itemObj, index)
        self:OnItemMoveOut(itemObj, index)
    end)
end

local function ComponentDestroy(self)
    self.infoBtnN = nil
    self.descN = nil
end

local function DataDefine(self)
    self.mineTemplateList = {}
end

local function DataDestroy(self)
    self.mineTemplateList = nil
end


local function OnAddListener(self)
    base.OnAddListener(self)
    self:AddUIListener(EventId.UpateAllAllianceMineList, self.RefreshData)

end

local function OnRemoveListener(self)
    self:RemoveUIListener(EventId.UpateAllAllianceMineList, self.RefreshData)
    base.OnRemoveListener(self)
end



local function ShowPanel(self)
    DataCenter.AllianceMineManager:RequestAllianceMineInfo(true)
    self:RefreshData()
end

local function RefreshData(self)
    self:ClearItemCell()
    self.mineTemplateList = DataCenter.AllianceMineManager:GetAlMineBuildList()
    if self.mineTemplateList~=nil and #self.mineTemplateList>0 then
        self.ScrollView:SetTotalCount(#self.mineTemplateList)
        self.ScrollView:RefillCells()
    end
end

local function OnItemMoveIn(self,itemObj, index)
    itemObj.name = tostring(index)
    local cellItem = self.ScrollView:AddComponent(AllianceMineItem, itemObj)
    cellItem:SetItemShow(self.mineTemplateList[index])
end

local function OnItemMoveOut(self, itemObj, index)
    self.ScrollView:RemoveComponent(itemObj.name, AllianceMineItem)
end


local function ClearItemCell(self)
    self.ScrollView:ClearCells()
    self.ScrollView:RemoveComponents(AllianceMineItem)
    self.mineTemplateList = {}
end


local function OnClickInfoBtn(self)
    UIUtil.ShowIntro(Localization:GetString("300747"), Localization:GetString("302027"), Localization:GetString("300748"))
end

AllianceMinePanel.OnCreate = OnCreate
AllianceMinePanel.OnDestroy = OnDestroy
AllianceMinePanel.OnAddListener = OnAddListener
AllianceMinePanel.OnRemoveListener = OnRemoveListener
AllianceMinePanel.ComponentDefine = ComponentDefine
AllianceMinePanel.ComponentDestroy = ComponentDestroy
AllianceMinePanel.DataDefine = DataDefine
AllianceMinePanel.DataDestroy = DataDestroy

AllianceMinePanel.ShowPanel = ShowPanel
AllianceMinePanel.OnItemMoveIn = OnItemMoveIn
AllianceMinePanel.OnItemMoveOut = OnItemMoveOut
AllianceMinePanel.ClearItemCell = ClearItemCell
AllianceMinePanel.OnClickInfoBtn = OnClickInfoBtn
AllianceMinePanel.RefreshData = RefreshData
return AllianceMinePanel
