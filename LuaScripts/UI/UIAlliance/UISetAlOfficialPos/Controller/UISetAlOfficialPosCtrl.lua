---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2021/9/15 16:38
---
local UISetAlOfficialPosCtrl = BaseClass("UISetAlOfficialPosCtrl", UIBaseCtrl)
local Localization = CS.GameEntry.Localization

local function CloseSelf(self)
    UIManager.Instance:DestroyWindow(UIWindowNames.UISetAlOfficialPos,{ anim = true})
end

local function Close(self)
    UIManager.Instance:DestroyWindowByLayer(UILayer.Normal, false)
end


local function GetMemberListByRank(self,rank)
    local showList ={}
    local list = DataCenter.AllianceMemberDataManager:GetAllianceMemberListByRank(rank)

    if list~=nil then
        table.walk(list,function (k,v)
            local oneData ={}
            oneData.name = v.name
            oneData.power =v.power
            oneData.uid =v.uid
            oneData.rank =v.rank
            oneData.pic = v.pic or ""
            oneData.picVer = v.picVer or 0
            oneData.headBg = v:GetHeadBgImg()
            oneData.isSelfAlliance = true
            if v.rank==4 then
                local officialNum = ""
                if oneData.isSelfAlliance then
                    officialNum = DataCenter.AllianceMemberDataManager:GetOfficialByUid(v.uid)
                else
                    officialNum = DataCenter.AllianceTempListManager:GetOfficialByUid(v.uid)
                end
                if officialNum =="" then
                    oneData.officialPic = "Assets/Main/Sprites/UI/UIRank/btn_PlusXS"
                    oneData.officialNum =0
                elseif officialNum =="1" then
                    oneData.officialPic = "Assets/Main/Sprites/UI/UIAlliance/UIAlliance_icon_office1"
                    oneData.officialNum =1
                elseif officialNum =="2" then
                    oneData.officialPic = "Assets/Main/Sprites/UI/UIAlliance/UIAlliance_icon_office2"
                    oneData.officialNum =2
                elseif officialNum =="3" then
                    oneData.officialPic = "Assets/Main/Sprites/UI/UIAlliance/UIAlliance_icon_office3"
                    oneData.officialNum =3
                elseif officialNum =="4" then
                    oneData.officialPic = "Assets/Main/Sprites/UI/UIAlliance/UIAlliance_icon_office4"
                    oneData.officialNum =4
                end
            end
            oneData.online_time =""
            if oneData.isSelfAlliance then
                oneData.isOnline = v.online
                if v.online then
                    oneData.online_time = Localization:GetString("390188")
                else
                    local deltaTime  = UITimeManager:GetInstance():GetServerTime()-v.offLineTime
                    if deltaTime>24*60*60*1000 then
                        local day = math.floor(deltaTime/(24*60*60*1000))
                        oneData.online_time = Localization:GetString("390506",day)
                    elseif deltaTime>60*60*1000 then
                        local hour = math.floor(deltaTime/(60*60*1000))
                        oneData.online_time = Localization:GetString("390505",hour)
                    elseif deltaTime>60*1000 then
                        local minute = math.floor(deltaTime/(60*1000))
                        oneData.online_time = Localization:GetString("390504",minute)
                    else
                        oneData.online_time = Localization:GetString("390504",1)
                    end
                end
                oneData.isInactive = v:CheckIfIsInactivePlayer()
            end

            table.insert(showList,oneData)
        end)

    end
    return showList
end


UISetAlOfficialPosCtrl.CloseSelf = CloseSelf
UISetAlOfficialPosCtrl.Close = Close
UISetAlOfficialPosCtrl.GetMemberListByRank = GetMemberListByRank
return UISetAlOfficialPosCtrl