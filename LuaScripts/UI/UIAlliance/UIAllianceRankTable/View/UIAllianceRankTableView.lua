---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by guqu.
--- DateTime: 2020/11/16 20:13
---
local AllianceRankSimpleItem = require "UI.UIAlliance.UIAllianceRankTable.Component.AllianceRankSimpleItem"
local UIAllianceRankTableView = BaseClass("UIAllianceRankTableView",UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization

local txt_title_path ="ImgBg/TxtTitle"
local close_btn_path = "ImgBg/BtnClose"
local content_path = "ImgBg/ScrollView/Viewport/Content"
local return_btn_path = "Panel"

local function OnCreate(self)
    base.OnCreate(self)
    self.title = self:AddComponent(UIText,txt_title_path)
    self.title:SetLocalText(390267) 
    self.close_btn = self:AddComponent(UIButton, close_btn_path)
    self.close_btn:SetOnClick(function()  
        self.ctrl:CloseSelf()
    end)
    self.return_btn = self:AddComponent(UIButton, return_btn_path)
    self.return_btn:SetOnClick(function()  
        self.ctrl:CloseSelf()
    end)
    self.content = self:AddComponent(UIBaseContainer,content_path)
    self.item_prefab = self.transform:Find("AllianceRankSimpleItem").gameObject
    self.item_prefab:GameObjectCreatePool();
    self.rankList={}
end

local function OnDestroy(self)
    self.item_prefab.gameObject:GameObjectRecycleAll()
    self.item_prefab = nil
    self.title = nil
    self.content = nil
    self.item_prefab = nil
    self.return_btn =nil
    self.close_btn = nil
    self.rankList=nil
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
    self:OnRefresh()
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function OnRefresh(self)
    local list = self.ctrl:GetRankTypeList()
    if list~=nil then
        for i = 1, table.length(list) do
            --复制基础prefab，每次循环创建一次
            local curType = list[i].type
            if self.rankList[curType] ==nil then
                local item = self.item_prefab:GameObjectSpawn(self.content.transform)
                item.name = curType
                self.rankList[curType] = self.content:AddComponent(AllianceRankSimpleItem,item.name)
                self.rankList[curType]:InitByType(list[i])
            end
            self.rankList[curType]:RefreshData(list[i])
        end
    end
end

local function OnAddListener(self)
    base.OnAddListener(self)
    --self:AddUIListener(EventId.PlayerRank, self.OnRefresh)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
    --self:RemoveUIListener(EventId.PlayerRank, self.OnRefresh)
end


UIAllianceRankTableView.OnCreate = OnCreate
UIAllianceRankTableView.OnDestroy = OnDestroy
UIAllianceRankTableView.OnRefresh = OnRefresh
UIAllianceRankTableView.OnEnable = OnEnable
UIAllianceRankTableView.OnDisable = OnDisable
UIAllianceRankTableView.OnAddListener = OnAddListener
UIAllianceRankTableView.OnRemoveListener = OnRemoveListener

return UIAllianceRankTableView