---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/3/8 21:10
---
local AttackerCell = BaseClass("AttackerCell",UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

local service_path = "serviceTxt"
local name_path = "NameTxt"
local btn_path = "Button"
local icon_path ="UIPlayerHead/HeadIcon"
local headFg_path = "UIPlayerHead/Foreground"
local pos_path ="posTxt"
local function OnCreate(self)
    base.OnCreate(self)
    self.service_txt = self:AddComponent(UITextMeshProUGUIEx,service_path)
    self.name_txt = self:AddComponent(UITextMeshProUGUIEx,name_path)
    self.power_txt = self:AddComponent(UITextMeshProUGUIEx,"power")
    self.pos = self:AddComponent(UITextMeshProUGUIEx,pos_path)
    self.btn = self:AddComponent(UIButton, btn_path)
    self.btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnClick()
    end)
    self.icon = self:AddComponent(UIPlayerHead, icon_path)
    self.headFg = self:AddComponent(UIImage, headFg_path)
end

-- 销毁
local function OnDestroy(self)
    self.service_txt = nil
    self.name_txt = nil
    self.select_obj = nil
    self.btn = nil
    base.OnDestroy(self)
end

-- 显示
local function OnEnable(self)
    base.OnEnable(self)
end

-- 隐藏
local function OnDisable(self)
    base.OnDisable(self)
end


local function SetSelect(self,select)
    self.select_obj:SetActive(select)
end

local function SetItemShow(self,data)
    self.uid = data.uid
    local abbr = data.alAbbr
    local name = data.name
    local service = data.serverId
    local newName = ""
    if abbr~=nil and abbr~="" then
        newName = "["..abbr.."]"..name
    else
        newName = name
    end
    -- if data.serverId~=nil then
    --     service = "#"..data.serverId
    -- end
    self.service_txt:SetText("#"..service)
    self.name_txt:SetText(newName)
    self.power_txt:SetText(string.GetFormattedSeperatorNum(data.power))
    local userId = data.uid
    local userPic = data.pic
    local userPicVer = data.picVer
    self.icon:SetData(userId, userPic, userPicVer,true)
    local headBg = data:GetHeadBgImg()
    if headBg~=nil then
        self.headFg:SetActive(true)
        self.headFg:LoadSprite(headBg)
    else
        self.headFg:SetActive(false)
    end
    self.point = data.mainBuildPoint
    if data.mainBuildPoint~=nil and data.mainBuildPoint>0 then
        local pos = SceneUtils.IndexToTilePos(data.mainBuildPoint, ForceChangeScene.World)
        self.pos:SetLocalText(300015,pos.x,pos.y)
    else
        self.pos:SetLocalText(300015,"-","-")
    end
end
local function OnClick(self)
    if self.point~=nil and self.point>0 then
        local worldPointPos = SceneUtils.TileIndexToWorld(self.point,ForceChangeScene.World)
        GoToUtil.CloseAllWindows()
        GoToUtil.GotoWorldPos(worldPointPos,nil,nil,function()
            local position = {}
            position.x = worldPointPos.x-2
            position.y = worldPointPos.y
            position.z = worldPointPos.z-2
            WorldArrowManager:GetInstance():ShowArrowEffect(0,position,ArrowType.Building)
        end)
    else
        UIUtil.ShowTipsId(450118)
    end
    --if self.uid~=nil and self.uid~="" then
    --    if self.uid ~= LuaEntry.Player.uid then
    --        UIManager:GetInstance():OpenWindow(UIWindowNames.UIOtherPlayerInfo,{ anim = true},self.uid)
    --    else
    --        UIManager:GetInstance():OpenWindow(UIWindowNames.UIPlayerInfo,{ anim = true},LuaEntry.Player.uid)
    --    end
    --end
    
end

AttackerCell.OnCreate = OnCreate
AttackerCell.OnClick = OnClick
AttackerCell.OnDestroy = OnDestroy
AttackerCell.OnEnable = OnEnable
AttackerCell.OnDisable = OnDisable
AttackerCell.SetItemShow = SetItemShow
AttackerCell.SetSelect = SetSelect

return AttackerCell