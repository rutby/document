---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/3/8 21:03
---
local AttackerCell = require "UI.UIAlliance.UIAllianceWarMainTable.Component.AttackerCell"
local UIHeroTipView = require "UI.UIHero2.UIHeroTip.View.UIHeroTipView"
local AttackerView = BaseClass("AttackerView",UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local scroll_path = "ScrollView"
local set_btn_path = "SetBtn"
local info_btn_path = "info_btn"
local function OnCreate(self)
    base.OnCreate(self)
    self.ScrollView = self:AddComponent(UIScrollView, scroll_path)
    self.ScrollView:SetOnItemMoveIn(function(itemObj, index)
        self:OnItemMoveIn(itemObj, index)
    end)
    self.ScrollView:SetOnItemMoveOut(function(itemObj, index)
        self:OnItemMoveOut(itemObj, index)
    end)
    --self._set_btn = self:AddComponent(UIButton,set_btn_path)
    --self._set_btn:SetOnClick(function()
    --    SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
    --    self:OnClickWorld()
    --end)
    --self._set_btn_txt = self:AddComponent(UITextMeshProUGUIEx,"SetBtn/getTxt")
    --self._set_btn_txt:SetText(Localization:GetString("104325"))
    self.des_obj = self:AddComponent(UIBaseContainer,"desBg")
    self._des_txt = self:AddComponent(UITextMeshProUGUIEx,"desBg/desTxt")
    self._des_txt:SetText(Localization:GetString("450058"))
    self.showDatalist ={}
    self.selectList = {}
    self.info_btn = self:AddComponent(UIButton, info_btn_path)
    self.info_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnInfoBtnClick()
    end)
end

local function OnDestroy(self)
    self:ClearScroll()
    base.OnDestroy(self)
end


local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function InitData(self)
    DataCenter.WorldNewsDataManager:SendRequest()
    DataCenter.WorldNewsDataManager:ResetShowAttackRedDot()
end

local function OnAddListener(self)
    base.OnAddListener(self)
    self:AddUIListener(EventId.AttackerInfoUpdate, self.RefreshList)

end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
    self:RemoveUIListener(EventId.AttackerInfoUpdate, self.RefreshList)
end

local function RefreshList(self)
    self:ClearScroll()
    self.showDatalist = DataCenter.WorldNewsDataManager:GetAllNeedShowAttacker()
    if #self.showDatalist > 0 then
        --self.des_obj:SetActive(true)
        self.ScrollView:SetTotalCount(#self.showDatalist)
        self.ScrollView:RefillCells()
        self.view:RefreshAttackEmpty(false)
    else
        --self.des_obj:SetActive(false)
        self.view:RefreshAttackEmpty(true)
    end
end


local function ClearScroll(self)
    self.ScrollView:ClearCells()
    self.ScrollView:RemoveComponents(AttackerCell)
    self.showDatalist = {}
end

local function OnItemMoveIn(self,itemObj, index)
    itemObj.name = tostring(index)
    local cellItem = self.ScrollView:AddComponent(AttackerCell, itemObj)
    cellItem:SetItemShow(self.showDatalist[index])
end

local function OnItemMoveOut(self, itemObj, index)
    self.ScrollView:RemoveComponent(itemObj.name, AttackerCell)
end

local function OnInfoBtnClick(self)
    local scaleFactor = UIManager:GetInstance():GetScaleFactor()
    local position = self.info_btn.transform.position + Vector3.New(0, -50, 0) * scaleFactor
    local param = UIHeroTipView.Param.New()
    param.content = Localization:GetString("104324")
    param.dir = UIHeroTipView.Direction.BELOW
    param.defWidth = 350
    param.pivot = 0.85
    param.position = position
    UIManager:GetInstance():OpenWindow(UIWindowNames.UIHeroTip, { anim = false }, param)
end

--local function OnClickWorld(self)
--    GoToUtil.CloseAllWindows()
--    GoToUtil.GotoWorldPos(SceneUtils.TileIndexToWorld(LuaEntry.Player:GetMainWorldPos(),ForceChangeScene.World),nil,0.02,function()
--    end,LuaEntry.Player:GetSelfServerId())
--end
AttackerView.OnCreate= OnCreate
AttackerView.OnDestroy = OnDestroy
AttackerView.OnEnable = OnEnable
AttackerView.OnDisable = OnDisable
AttackerView.OnAddListener = OnAddListener
AttackerView.OnRemoveListener = OnRemoveListener
AttackerView.RefreshList = RefreshList
AttackerView.ClearScroll = ClearScroll
AttackerView.OnItemMoveIn = OnItemMoveIn
AttackerView.OnInfoBtnClick = OnInfoBtnClick
AttackerView.OnItemMoveOut = OnItemMoveOut
AttackerView.OnClickWorld = OnClickWorld
AttackerView.InitData = InitData
return AttackerView