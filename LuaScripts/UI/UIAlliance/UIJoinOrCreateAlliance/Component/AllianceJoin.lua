---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/12/27 20:15
---
local AllianceItem = require "UI.UIAlliance.UIJoinOrCreateAlliance.Component.AllianceItem"
local AllianceJoin = BaseClass("AllianceJoin",UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

local scroll_path = "Join/ScrollView"
local input_path = "Join/InputField"
local search_btn_path = "Join/BtnSearch"
--local place_holder_txt_path = "Join/InputField/Placeholder"
local emptyTxt_path = "TxtEmpty"
local placeholder_path = "Join/InputField/Text Area/Placeholder"

local function OnCreate(self)
    base.OnCreate(self)
    
    self.input = self:AddComponent(UITMPInput,input_path)
    self.input:SetOnEndEdit(function (value)
        self:IptOnValueChange(value)
    end)

    self.search_btn = self:AddComponent(UIButton, search_btn_path)
    self.search_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnClickSearch()
    end)
    self.ScrollView = self:AddComponent(UIScrollView, scroll_path)
    self.ScrollView:SetOnItemMoveIn(function(itemObj, index)
        self:OnAllianceItemMoveIn(itemObj, index)
    end)
    self.ScrollView:SetOnItemMoveOut(function(itemObj, index)
        self:OnAllianceItemMoveOut(itemObj, index)
    end)
    self.EmptyTxt = self:AddComponent(UITextMeshProUGUIEx, emptyTxt_path)
    self.EmptyTxt:SetLocalText(390856)
    self.inputValue = ""
    self.alliance_list = {}
    
    self.placeholder = self:AddComponent(UITextMeshProUGUIEx, placeholder_path)
    self.placeholder:SetLocalText(280026)
end

local function SetShowType(self,checkType)
    self.checkType = checkType
end
local function OnDestroy(self)
    self:ClearScroll()
    self.ScrollView = nil
    self.inputValue = nil
    base.OnDestroy(self)
end

local function RefreshAllianceList(self)
    self:ClearScroll(self)
    self.alliance_list = self.view.ctrl:GetAllianceIdList()

    if #self.alliance_list <= 0 then
        self.EmptyTxt:SetActive(true)
        return
    end

    self.EmptyTxt:SetActive(false)

    if #self.alliance_list>0 then
        self.ScrollView:SetTotalCount(#self.alliance_list)
        self.ScrollView:RefillCells()
    end
end


local function OnEnable(self)
    base.OnEnable(self)
    self.view.ctrl:InitData()
    self.inputValue = self.input:GetText()
end

local function OnDisable(self)
    self:ClearScroll()
    base.OnDisable(self)

end

local function OnAllianceItemMoveIn(self,itemObj, index)
    itemObj.name = tostring(index)
    local cellItem = self.ScrollView:AddComponent(AllianceItem, itemObj)
    cellItem:SetItemShow(self.alliance_list[index],self.checkType)
end

local function OnAllianceItemMoveOut(self, itemObj, index)
    self.ScrollView:RemoveComponent(itemObj.name, AllianceItem)
end

local function ClearScroll(self)
    self.ScrollView:ClearCells()
    self.ScrollView:RemoveComponents(AllianceItem)
end

local function OnAddListener(self)
    base.OnAddListener(self)
    self:AddUIListener(EventId.SearchAllianceSuccess, self.RefreshAllianceList)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
    self:RemoveUIListener(EventId.SearchAllianceSuccess, self.RefreshAllianceList)
end

local function IptOnValueChange(self,value)
    self.inputValue = value
    if string.IsNullOrEmpty(self.input:GetText()) then
        self.view.ctrl:SendSearchMessageToServer(1,1,self.inputValue,0)
    end
end
local function OnClickSearch(self)
    if self.inputValue ==nil or self.inputValue=="" then
        self.currentAllianceId = ""
        self.view.ctrl:SendSearchMessageToServer(1,1,"",0, true)
    else
        self.view.ctrl:SendSearchMessageToServer(1,1,self.inputValue,0)
    end
end

AllianceJoin.OnCreate= OnCreate
AllianceJoin.OnDestroy = OnDestroy
AllianceJoin.RefreshAllianceList = RefreshAllianceList
AllianceJoin.RefreshAllianceContent = RefreshAllianceContent
AllianceJoin.OnEnable = OnEnable
AllianceJoin.OnDisable = OnDisable
AllianceJoin.OnAllianceItemMoveIn = OnAllianceItemMoveIn
AllianceJoin.OnAllianceItemMoveOut = OnAllianceItemMoveOut
AllianceJoin.ClearScroll = ClearScroll
AllianceJoin.OnAddListener = OnAddListener
AllianceJoin.OnRemoveListener = OnRemoveListener
AllianceJoin.IptOnValueChange = IptOnValueChange
AllianceJoin.OnClickSearch = OnClickSearch
AllianceJoin.SetShowType = SetShowType
return AllianceJoin