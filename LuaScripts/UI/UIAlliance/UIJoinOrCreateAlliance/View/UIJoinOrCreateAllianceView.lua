---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by guqu.
--- DateTime: 2020/10/14 17:21
---
local UIJoinOrCreateAllianceView = BaseClass("UIJoinOrCreateAllianceView",UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization
local AllianceJoin = require"UI.UIAlliance.UIJoinOrCreateAlliance.Component.AllianceJoin"
local CreateAlliance = require"UI.UIAlliance.UIJoinOrCreateAlliance.Component.CreateAlliance"
local close_btn_path = "fullTop/CloseBtn"
local txt_title_path ="fullTop/imgTitle/Common_img_title/titleText"
local join_obj_path = "JoinObj"
local create_obj_path = "CreateObj"
local toggle_path = "ToggleGroup/Toggle"
local toggleCount = 2
local function OnCreate(self)
    base.OnCreate(self)
    self.curTabType = self:GetUserData()
    self.curType = 0--0,加入联盟;1,联盟列表 
    
    self.txt_title = self:AddComponent(UITextMeshProUGUIEx, txt_title_path)
    self.txt_title:SetLocalText(390002)
    self.joinObj = self:AddComponent(AllianceJoin,join_obj_path)
    self.joinObj:SetShowType(self.curType)
    self.createObj = self:AddComponent(CreateAlliance,create_obj_path)
    self.close_btn = self:AddComponent(UIButton, close_btn_path)
    self.close_btn:SetOnClick(function()  
        self.ctrl:CloseSelf()
    end)
    self.toggle1 = self:AddComponent(UIToggle,toggle_path..1)
    self.toggle2 = self:AddComponent(UIToggle,toggle_path..2)
    self.toggle1:SetIsOn(self.curTabType==1)
    self.toggle1:SetOnValueChanged(function(tf)
        if tf then
            SoundUtil.PlayEffect(SoundAssets.Music_Effect_common_switch)
            self:ToggleControlBorS(1)
        end
    end)
    self.toggle2:SetIsOn(self.curTabType==2)
    self.toggle2:SetOnValueChanged(function(tf)
        if tf then
            SoundUtil.PlayEffect(SoundAssets.Music_Effect_common_switch)
            self:ToggleControlBorS(2)
        end
    end)
    self.toggleList = {}
    for i=1,toggleCount do
        local toggle = {}
        toggle.checkMark = self:AddComponent(UIImage, toggle_path..i.."/Background/Checkmark"..i)
        toggle.checkMark:SetActive(i == self.curTabType)
        toggle.text = self:AddComponent(UITextMeshProUGUIEx, toggle_path..i.."/text"..i)
        toggle.text:SetText(self.ctrl:GetItemTypeName(i))
        toggle.text:SetActive(i ~= self.curTabType)
        toggle.checkText = self:AddComponent(UITextMeshProUGUI, toggle_path..i.."/checkText"..i)
        toggle.checkText:SetText(self.ctrl:GetItemTypeName(i))
        toggle.checkText:SetActive(i == self.curTabType)
        table.insert(self.toggleList, toggle)
    end
    DataCenter.SecondConfirmManager:SetNoShowSecondConfirm(NoSecondConfirmType.JoinAlliance, true)
    EventManager:GetInstance():Broadcast(EventId.UpdateMainAllianceRedCount)
end

local function OnDestroy(self)
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
    self:ReFreshList()
end

local function OnDisable(self)
    base.OnDisable(self)
end

--页签切换
local function ToggleControlBorS(self,index)
    if self.curTabType == index then
        return
    end
    self.curTabType = index
    for i=1,toggleCount do
        local toggle = self.toggleList[i]
        toggle.checkMark:SetActive(i == index)
        toggle.text:SetActive(i ~= index)
        toggle.checkText:SetActive(i == index)
    end
    self:ReFreshList()
end
local function ReFreshList(self)
    if self.curTabType == 1 then
        self.createObj:SetActive(false)
        self.joinObj:SetActive(true)
    else
        self.joinObj:SetActive(false)
        self.createObj:SetActive(true)
    end
end

local function OnAddListener(self)
    base.OnAddListener(self)
    self:AddUIListener(EventId.AllianceApplySuccess, self.OnJoinAllianceBack)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
    self:RemoveUIListener(EventId.AllianceApplySuccess, self.OnJoinAllianceBack)
end

local function OnJoinAllianceBack(self)
    self.ctrl:CloseSelf()
end
UIJoinOrCreateAllianceView.OnCreate= OnCreate
UIJoinOrCreateAllianceView.OnDestroy = OnDestroy
UIJoinOrCreateAllianceView.OnEnable = OnEnable
UIJoinOrCreateAllianceView.OnDisable = OnDisable
UIJoinOrCreateAllianceView.ToggleControlBorS = ToggleControlBorS
UIJoinOrCreateAllianceView.OnAddListener = OnAddListener
UIJoinOrCreateAllianceView.OnRemoveListener = OnRemoveListener
UIJoinOrCreateAllianceView.OnJoinAllianceBack = OnJoinAllianceBack
UIJoinOrCreateAllianceView.ReFreshList =ReFreshList
return UIJoinOrCreateAllianceView