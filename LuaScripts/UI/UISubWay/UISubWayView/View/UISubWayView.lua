---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl.
--- DateTime: 
---
local UISubWayItem = require "UI.UISubWay.UISubWayView.Component.UISubWayItem"
local UISubWayView = BaseClass("UISubWayView",UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization
local Data = CS.GameEntry.Data
function UISubWayView:OnCreate()
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

function UISubWayView:ComponentDefine()
    self._close_btn = self:AddComponent(UIButton,"ImgBg/UICommonPopUpTitle/bg_mid/CloseBtn")
    self._close_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    
    self._return_btn = self:AddComponent(UIButton,"ImgBg/UICommonPopUpTitle/panel")
    self._return_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self._title_txt = self:AddComponent(UIText,"ImgBg/UICommonPopUpTitle/bg_mid/titleText")
    self._title_txt:SetLocalText(142507,"")
    self.itemCell = self:AddComponent(UIBaseContainer,"ImgBg/layoutContent/mainContent")
end

function UISubWayView:DataDefine()
end

function UISubWayView:OnDestroy()
    base.OnDestroy(self)
end

function UISubWayView:OnEnable()
    base.OnEnable(self)
    self:ReInit()
end

function UISubWayView:OnDisable()
    base.OnDisable(self)
end

function UISubWayView:OnAddListener()
    base.OnAddListener(self)
    self:AddUIListener(EventId.MarchItemUpdateSelf, self.RefreshCenterList)
end

function UISubWayView:OnRemoveListener()
    base.OnRemoveListener(self)
    self:RemoveUIListener(EventId.MarchItemUpdateSelf,self.RefreshCenterList)
end


function UISubWayView:ReInit()
    self:RefreshCenterList()
end


--正在虫洞的部队
function UISubWayView:RefreshCenterList()
    self:ClearItemCell()
    local list = self.ctrl:GetInWormHoleMarch()
    for i = 1, #list do
        self.itemTab[i] = self:GameObjectInstantiateAsync(UIAssets.UISubWayItem, function(request)
            if request.isError then
                return
            end
            local go = request.gameObject;
            go.transform:SetParent(self.itemCell.transform)
            go.transform:Set_localScale(ResetScale.x, ResetScale.y, ResetScale.z)
            local nameStr = tostring(NameCount)
            go.name = nameStr
            NameCount = NameCount + 1
            go.gameObject:SetActive(true)
            local cell = self.itemCell:AddComponent(UISubWayItem,go.name)
            cell:RefreshData(list[i],i)
            self.itemCellList[i] = cell
        end)
    end
end

function UISubWayView:ClearItemCell()
    self.itemCell:RemoveComponents(UISubWayItem)
    if self.itemTab and next(self.itemTab) then
        for k,v in pairs(self.itemTab) do
            if v ~= nil then
                self:GameObjectDestroy(v)
            end
        end
    end
    self.itemTab ={}
    self.itemCellList = {}
end

return UISubWayView