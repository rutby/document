---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/11/14 21:03
---

local UIVitaMatter = BaseClass("UIVitaMatter", UIBaseView)
local base = UIBaseView

local bg_path = "Bg"
local pic_path = "Bg/Pic"
local icon_bg_path = "Bg/IconBg"
local icon_path = "Bg/IconBg/Icon"
local desc_path = "Bg/Desc"

local PosX1 = -170
local PosX2 = 170
local MoveDuration = 0.3
local ShowDuration = 2.5

local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

local function OnDestroy(self)
    self:DataDestroy()
    self:ComponentDestroy()
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
    self:ReInit()
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function ComponentDefine(self)
    self.bg_image = self:AddComponent(UIImage, bg_path)
    self.pic_image = self:AddComponent(UIImage, pic_path)
    self.icon_bg_image = self:AddComponent(UIImage, icon_bg_path)
    self.icon_image = self:AddComponent(UIImage, icon_path)
    self.desc_text = self:AddComponent(UITextMeshProUGUIEx, desc_path)
end

local function ComponentDestroy(self)

end

local function DataDefine(self)
    self.seq = nil
    self.matter = VitaDefines.Matter.None
end

local function DataDestroy(self)
    if self.seq then
        self.seq:Kill()
        self.seq = nil
    end
end

local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function ReInit(self)
    self:TryNext()
end

local function TryNext(self)
    self.matter = DataCenter.VitaManager:PopMatter()
    if self.matter == VitaDefines.Matter.None then
        self.ctrl:CloseSelf()
    else
        self:Play()
    end
end

local function Play(self)
    if self.seq then
        self.seq:Kill()
    end
    
    local bg = ""
    local pic = ""
    local iconBg = ""
    local icon = ""
    local iconScale = 1
    local desc = 0
    if self.matter == VitaDefines.Matter.Day then
        bg = "Assets/Main/Sprites/UI/UIVita/people_bg_tips_day"
        pic = "Assets/Main/Sprites/UI/UIMain/UIMain_icon_day"
        desc = 430200
    elseif self.matter == VitaDefines.Matter.Night then
        bg = "Assets/Main/Sprites/UI/UIVita/people_bg_tips_night"
        pic = "Assets/Main/Sprites/UI/UIMain/UIMain_icon_night"
        desc = 430201
    elseif self.matter == VitaDefines.Matter.LateAtNight then
        bg = "Assets/Main/Sprites/UI/UIVita/people_bg_tips_sleep"
        pic = "Assets/Main/Sprites/UI/UIMain/UIMain_icon_sleep"
        desc = 430202
    elseif self.matter == VitaDefines.Matter.ResidentQueue then
        bg = "Assets/Main/Sprites/UI/UIVita/people_bg_tips_green"
        iconBg = "Assets/Main/Sprites/UI/UIVita/people_bg_tips_green2"
        icon = "Assets/Main/Sprites/UI/UIMain/survivor_icon_man"
        iconScale = 0.8
        desc = 430240
    elseif self.matter == VitaDefines.Matter.ResidentCome then
        bg = "Assets/Main/Sprites/UI/UIVita/people_bg_tips_green"
        iconBg = "Assets/Main/Sprites/UI/UIVita/people_bg_tips_green2"
        icon = "Assets/Main/Sprites/UI/UIMain/survivor_icon_man"
        iconScale = 0.8
        desc = 430203
    elseif self.matter == VitaDefines.Matter.ResidentIll then
        bg = "Assets/Main/Sprites/UI/UIVita/people_bg_tips_red"
        iconBg = "Assets/Main/Sprites/UI/UIVita/people_bg_tips_red2"
        icon = "Assets/Main/Sprites/UI/UIVita/people_icon_tips_sick"
        desc = 430204
    elseif self.matter == VitaDefines.Matter.ResidentCure then
        bg = "Assets/Main/Sprites/UI/UIVita/people_bg_tips_green"
        iconBg = "Assets/Main/Sprites/UI/UIVita/people_bg_tips_green2"
        icon = "Assets/Main/Sprites/UI/UIVita/people_icon_tips_cured"
        desc = 430205
    elseif self.matter == VitaDefines.Matter.ResidentSickDie then
        bg = "Assets/Main/Sprites/UI/UIVita/people_bg_tips_red"
        iconBg = "Assets/Main/Sprites/UI/UIVita/people_bg_tips_red2"
        icon = "Assets/Main/Sprites/UI/UIVita/people_icon_tips_died"
        desc = 430206
    elseif self.matter == VitaDefines.Matter.ResidentDie then
        bg = "Assets/Main/Sprites/UI/UIVita/people_bg_tips_red"
        iconBg = "Assets/Main/Sprites/UI/UIVita/people_bg_tips_red2"
        icon = "Assets/Main/Sprites/UI/UIVita/people_icon_tips_died"
        desc = 470165
    end
    self.bg_image:LoadSprite(bg)
    if pic ~= "" then
        self.pic_image:SetActive(true)
        self.pic_image:LoadSprite(pic)
    else
        self.pic_image:SetActive(false)
    end
    if icon ~= "" then
        self.icon_bg_image:SetActive(true)
        self.icon_bg_image:LoadSprite(iconBg)
        self.icon_image:LoadSprite(icon)
        self.icon_image.transform.localScale = ResetScale * iconScale
    else
        self.icon_bg_image:SetActive(false)
    end
    self.desc_text:SetLocalText(desc)
    
    self.seq = DOTween.Sequence()
    :Append(self.bg_image.rectTransform:DOAnchorPosX(PosX2, MoveDuration))
    :AppendInterval(ShowDuration)
    :Append(self.bg_image.rectTransform:DOAnchorPosX(PosX1, MoveDuration))
    :AppendCallback(function()
        self:TryNext()
    end)
end

UIVitaMatter.OnCreate = OnCreate
UIVitaMatter.OnDestroy = OnDestroy
UIVitaMatter.OnEnable = OnEnable
UIVitaMatter.OnDisable = OnDisable
UIVitaMatter.ComponentDefine = ComponentDefine
UIVitaMatter.ComponentDestroy = ComponentDestroy
UIVitaMatter.DataDefine = DataDefine
UIVitaMatter.DataDestroy = DataDestroy
UIVitaMatter.OnAddListener = OnAddListener
UIVitaMatter.OnRemoveListener = OnRemoveListener

UIVitaMatter.ReInit = ReInit
UIVitaMatter.TryNext = TryNext
UIVitaMatter.Play = Play

return UIVitaMatter