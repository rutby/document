---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/11/2 17:33
---

local UIVitaResident = BaseClass("UIVitaResident", UIBaseView)
local base = UIBaseView
local UIVitaResidentWorkPanel = require "UI.UIVita.UIVitaResident.Component.UIVitaResidentWorkPanel"
local UIVitaResidentOverviewPanel = require "UI.UIVita.UIVitaResident.Component.UIVitaResidentOverviewPanel"
local UICommonTab = require "UI.UICommonTab.UICommonTab"
local Localization = CS.GameEntry.Localization

local title_path = "Layout/BG/TitlePart/title_text"
local close2_path = "Layout/BG/TitlePart/Button"
local close_path = "BgBtn"
local tab1_path = "Layout/TabList/Tab1"
local tab1_red_path = "Layout/TabList/Tab1/Tab1Red"
local tab2_path = "Layout/TabList/Tab2"
local work_panel_path = "Layout/BG/WorkPanel"
local overview_panel_path = "Layout/BG/OverviewPanel"

local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

local function OnDestroy(self)
    self:DataDestroy()
    self:ComponentDestroy()
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
    self:ReInit()
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function ComponentDefine(self)
    self.title_text = self:AddComponent(UITextMeshProUGUIEx, title_path)
    self.title_text:SetLocalText(137005)
    self.close_btn2 = self:AddComponent(UIButton, close2_path)
    self.close_btn2:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.close_btn = self:AddComponent(UIButton, close_path)
    self.close_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.tab1 = self:AddComponent(UICommonTab, tab1_path)
    self.tab1:SetName(Localization:GetString("137065"))
    self.tab1:SetSelected(false)
    self.tab1:SetOnClick(function()
        self:OnTab1Click()
    end)
    self.tab1_red_go = self:AddComponent(UIBaseContainer, tab1_red_path)
    self.tab2 = self:AddComponent(UICommonTab, tab2_path)
    self.tab2:SetName(Localization:GetString("137022"))
    self.tab2:SetSelected(false)
    self.tab2:SetOnClick(function()
        self:OnTab2Click()
    end)
    self.work_panel = self:AddComponent(UIVitaResidentWorkPanel, work_panel_path)
    self.overview_panel = self:AddComponent(UIVitaResidentOverviewPanel, overview_panel_path)
end

local function ComponentDestroy(self)

end

local function DataDefine(self)
    self.timer = TimerManager:GetInstance():GetTimer(VitaDefines.RefreshInterval, self.TimerAction, self, false, false, false)
    self.timer:Start()
    self:TimerAction()
    self.playSound = false
end

local function DataDestroy(self)
    if self.timer then
        self.timer:Stop()
        self.timer = nil
    end
    self.playSound = nil
end

local function OnAddListener(self)
    base.OnAddListener(self)
    self:AddUIListener(EventId.VitaDataUpdate, self.RefreshTabRed)
end

local function OnRemoveListener(self)
    self:RemoveUIListener(EventId.VitaDataUpdate, self.RefreshTabRed)
    base.OnRemoveListener(self)
end

local function ReInit(self)
    local tab = self:GetUserData()
    if tab == 1 then
        self:OnTab1Click()
    elseif tab == 2 then
        self:OnTab2Click()
    else
        self:OnTab1Click()
    end
    self:RefreshTabRed()
end

local function RefreshTabRed(self)
    self.tab1_red_go:SetActive(DataCenter.VitaManager:ShowResidentWorkRed())
end

local function TimerAction(self)
    self.work_panel:TimerAction()
    self.overview_panel:TimerAction()
end

local function OnTab1Click(self)
    self:PlaySound()
    self.tab1:SetSelected(true)
    self.tab2:SetSelected(false)
    self.work_panel:SetActive(true)
    self.work_panel:Refresh()
    self.overview_panel:SetActive(false)
end

local function OnTab2Click(self)
    self:PlaySound()
    self.tab1:SetSelected(false)
    self.tab2:SetSelected(true)
    self.work_panel:SetActive(false)
    self.overview_panel:SetActive(true)
    self.overview_panel:Refresh()
end

local function PlaySound(self)
    if self.playSound then
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_common_switch)
    else
        self.playSound = true
    end
end

UIVitaResident.OnCreate = OnCreate
UIVitaResident.OnDestroy = OnDestroy
UIVitaResident.OnEnable = OnEnable
UIVitaResident.OnDisable = OnDisable
UIVitaResident.ComponentDefine = ComponentDefine
UIVitaResident.ComponentDestroy = ComponentDestroy
UIVitaResident.DataDefine = DataDefine
UIVitaResident.DataDestroy = DataDestroy
UIVitaResident.OnAddListener = OnAddListener
UIVitaResident.OnRemoveListener = OnRemoveListener
UIVitaResident.PlaySound = PlaySound


UIVitaResident.ReInit = ReInit
UIVitaResident.RefreshTabRed = RefreshTabRed
UIVitaResident.TimerAction = TimerAction
UIVitaResident.OnTab1Click = OnTab1Click
UIVitaResident.OnTab2Click = OnTab2Click

return UIVitaResident