---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Still4.
--- DateTime: 2021/6/29 16:09
---
local UIPositionTipView = BaseClass("UIPositionTipView", UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization

local bg_path = "UICommonMiniPopUpTitle/panel"
local title_path = "UICommonMiniPopUpTitle/Bg_mid/titleText"
local return_btn_path = "UICommonMiniPopUpTitle/Bg_mid/CloseBtn"
local server_input_path = "ImgBg/serverInputField"
local x_input_path = "ImgBg/xInputField"
local y_input_path = "ImgBg/yInputField"
local btn_path = "ImgBg/gotoBtn"
local goto_txt_path = "ImgBg/gotoBtn/gotoText"
local function OnCreate(self)
    base.OnCreate(self)
    self.return_btn = self:AddComponent(UIButton, return_btn_path)
    self.return_btn:SetOnClick(function()  
        self.ctrl:CloseSelf()
    end)
    self.bg = self:AddComponent(UIButton, bg_path)
    self.bg:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    
    self.server_input = self:AddComponent(UITMPInput, server_input_path)
    self.server_input:SetOnEndEdit(function(value)
        self:IptOnServerValueChange(value)
    end)
    self.x_input = self:AddComponent(UITMPInput, x_input_path)
    self.x_input:SetOnEndEdit(function(value)
        self:IptOnXValueChange(value)
    end)
    self.y_input = self:AddComponent(UITMPInput, y_input_path)
    self.y_input:SetOnEndEdit(function(value)
        self:IptOnYValueChange(value)
    end)
    self.btn = self:AddComponent(UIButton, btn_path)
    self.btn:SetOnClick(function()
        self:OnClickJump()
    end)
    self.title = self:AddComponent(UITextMeshProUGUIEx,title_path)
    self.title:SetLocalText(100171)
    
    self.btn_txt = self:AddComponent(UITextMeshProUGUIEx,goto_txt_path)
    self.btn_txt:SetLocalText(110003)
    
    self.server = -1
    self.x = -1
    self.y = -1
end

local function OnDestroy(self)
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
    self:InitState()
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function InitState(self)
    local data = self.ctrl:GetCurrentState()
    self.server = data.serverId
    self.x = data.x
    self.y = data.y
    self.server_input:SetText(self.server)
    self.x_input:SetText(self.x)
    self.y_input:SetText(self.y)
end

local function IptOnServerValueChange(self, value)
    self.server = toInt(value)
end

local function IptOnXValueChange(self, value)
    self.x = toInt(value)
end

local function IptOnYValueChange(self, value)
    self.y = toInt(value)
end

local function OnClickJump(self)
    if self.ctrl:CheckCanGo(self.server, self.x, self.y) == false then
        UIUtil.ShowTips(Localization:GetString(CS.GameDialogDefine.OUT_UNLOCK_RANGE_REASON,
                CS.SceneManager.World.CurTileCountXMin, CS.SceneManager.World.CurTileCountYMin,
                CS.SceneManager.World.CurTileCountXMax, CS.SceneManager.World.CurTileCountYMax))
    else
        local canSearch = DataCenter.AccountManager:CheckIsInServerList(self.server)
        if canSearch then
            self.view.ctrl:OnJumpClick(self.server, self.x, self.y)
        else
            UIUtil.ShowTipsId(110207)
        end
    end
end

UIPositionTipView.OnCreate = OnCreate
UIPositionTipView.OnDestroy = OnDestroy
UIPositionTipView.InitState = InitState
UIPositionTipView.OnEnable = OnEnable
UIPositionTipView.OnDisable = OnDisable
UIPositionTipView.IptOnServerValueChange = IptOnServerValueChange
UIPositionTipView.IptOnXValueChange = IptOnXValueChange
UIPositionTipView.IptOnYValueChange = IptOnYValueChange
UIPositionTipView.OnClickJump = OnClickJump

return UIPositionTipView