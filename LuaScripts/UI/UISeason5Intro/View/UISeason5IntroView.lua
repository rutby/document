---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/8/3 10:25
---
local base = UIBaseView--Variable
local UISeason5IntroView = BaseClass("UISeason5IntroView", base)--Variable
local Localization = CS.GameEntry.Localization

local anim_path = ""
local title_txt_path = "Txt_title"
local des_txt_path = "step1/Image/Txt_Des"
local enter_btn_path = "step1/Btn_Enter"
local txt_enter_path = "step1/Btn_Enter/Txt_Enter"
local btn_path = "Bg"
local talk_des_path = "step2/TalkBg/TalkDes"
local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
    self:InitData()
end

local function OnDestroy(self)
    if self.timer then
        self.timer:Stop()
        self.timer = nil
    end
    self:ComponentDestroy()
    self:DataDestroy()
    if self.dubId ~= nil then
        CS.GameEntry.Sound:StopSound(self.dubId)
    end
    CommonUtil.PlayGameBgMusic()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.enter_btn = self:AddComponent(UIButton,enter_btn_path)
    self.enter_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnClickEnter()
    end)
    self.txt_enter = self:AddComponent(UIText, txt_enter_path)
    self.txt_enter:SetLocalText(110003)
    self.title_txt = self:AddComponent(UIText, title_txt_path)
    self.title_txt:SetLocalText(111057)
    self.des_txt = self:AddComponent(UIText, des_txt_path)
    self.des_txt:SetLocalText(111058)
    self.talk_des = self:AddComponent(UIText, talk_des_path)
    self.btn = self:AddComponent(UIButton, btn_path)
    self.btn:SetOnClick(function()
        self:OnClickNext()
    end)
    self.anim = self:AddComponent(UISimpleAnimation,anim_path)
    self.canClickNext = true
end

local function ComponentDestroy(self)
end

local function DataDefine(self)

end

local function DataDestroy(self)

end


local function InitData(self)
    SoundUtil.PlayBGMusicByName(SoundAssets.Music_bg_eden_war)
    self.anim:Play("step1")
    self.aniStep = 1
    if self.timer then
        self.timer:Stop()
        self.timer = nil
    end
    self.timer = TimerManager:DelayInvoke(function()
        self:PlayDub("111058")
        if self.timer then
            self.timer:Stop()
            self.timer = nil
        end
    end, 1)
end

local function OnClickEnter(self)
    self.aniStep = 2
    self.talk_des:SetLocalText(111149)
    self.canClickNext = false
    local ret,time = self.anim:PlayAnimationReturnTime("step2")
    if self.timer then
        self.timer:Stop()
        self.timer = nil
    end
    self:PlayDub("111149")
    self.timer = TimerManager:DelayInvoke(function()
        self.canClickNext = true
        if self.timer then
            self.timer:Stop()
            self.timer = nil
        end
    end, time)
end

local function OnClickNext(self)
    if self.canClickNext == false then
        return
    end
    if self.aniStep == 2 then
        self.aniStep = 3
        self.talk_des:SetLocalText(111183)
        self.canClickNext = false
        local ret,time = self.anim:PlayAnimationReturnTime("step3")
        if self.timer then
            self.timer:Stop()
            self.timer = nil
        end
        self:PlayDub("111183")
        self.timer = TimerManager:DelayInvoke(function()
            self.canClickNext = true
            if self.timer then
                self.timer:Stop()
                self.timer = nil
            end
        end, time)
    elseif self.aniStep == 3 then
        self.aniStep = 4
        self.talk_des:SetLocalText(111184)
        self.canClickNext = false
        local ret,time = self.anim:PlayAnimationReturnTime("step4")
        if self.timer then
            self.timer:Stop()
            self.timer = nil
        end
        self:PlayDub("111184")
        self.timer = TimerManager:DelayInvoke(function()
            self.canClickNext = true
            if self.timer then
                self.timer:Stop()
                self.timer = nil
            end
        end, time)
    elseif self.aniStep == 4 then
        self.aniStep = 5
        self.talk_des:SetLocalText(111150)
        self.canClickNext = false
        local ret,time = self.anim:PlayAnimationReturnTime("step5")
        if self.timer then
            self.timer:Stop()
            self.timer = nil
        end
        self:PlayDub("111150")
        self.timer = TimerManager:DelayInvoke(function()
            self.canClickNext = true
            if self.timer then
                self.timer:Stop()
                self.timer = nil
            end
        end, time)
    elseif self.aniStep == 5 then
        self.aniStep = 6
        self.talk_des:SetLocalText(111151)
        self.canClickNext = false
        local ret,time = self.anim:PlayAnimationReturnTime("step6")
        if self.timer then
            self.timer:Stop()
            self.timer = nil
        end
        self:PlayDub("111151")
        self.timer = TimerManager:DelayInvoke(function()
            self.canClickNext = true
            if self.timer then
                self.timer:Stop()
                self.timer = nil
            end
        end, time)
    elseif self.aniStep == 6 then
        local dataInfo = DataCenter.RobotWarsManager:GetActivityInfo()
        if dataInfo ==nil then
            self.ctrl:CloseSelf()
            return
        end
        if LuaEntry.Player:IsInCrossFight()==false then
            if dataInfo.edenMatch and dataInfo.edenMatch.targetServer and dataInfo.edenMatch.targetServer ~= 0 then
                local targetServer = dataInfo.edenMatch.targetServer
                self.ctrl:CloseSelf()
                if CommonUtil.CheckIsLessThanTargetVersion("1.250.521") then
                    UIUtil.ShowVersionMessage()
                else
                    SFSNetwork.SendMessage(MsgDefines.MoveCrossServer,targetServer,0, 2)
                    EventManager:GetInstance():Broadcast(EventId.OnSetEdenUI,UISetEdenType.Open)
                end
            else
                self.ctrl:CloseSelf()
            end
        else
            self.ctrl:CloseSelf()
        end
    end
end

local function PlayDub(self,name)
    if self.dubId ~= nil then
        CS.GameEntry.Sound:StopSound(self.dubId)
    end
    self.dubName = name
    self.dubId = SoundUtil.PlayDub(name)
end

UISeason5IntroView.OnCreate = OnCreate
UISeason5IntroView.OnDestroy = OnDestroy
--UISeason5IntroView.OnAddListener = OnAddListener
--UISeason5IntroView.OnRemoveListener = OnRemoveListener
UISeason5IntroView.ComponentDefine = ComponentDefine
UISeason5IntroView.ComponentDestroy = ComponentDestroy
UISeason5IntroView.DataDefine = DataDefine
UISeason5IntroView.DataDestroy = DataDestroy
UISeason5IntroView.OnClickEnter =OnClickEnter
UISeason5IntroView.InitData = InitData
UISeason5IntroView.OnClickNext = OnClickNext
UISeason5IntroView.PlayDub = PlayDub
return UISeason5IntroView