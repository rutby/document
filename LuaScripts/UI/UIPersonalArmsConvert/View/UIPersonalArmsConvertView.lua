---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl
--- DateTime: 
---
local UIPersonalArmsConvertView = BaseClass("UIPersonalArmsConvertView",UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization
local UIPArmsConvertCell = require "UI.UIPersonalArmsConvert.Component.UIPArmsConvertCell"
function UIPersonalArmsConvertView:OnCreate()
    base.OnCreate(self)
    self.title = self:AddComponent(UITextMeshProUGUIEx,"UICommonMidPopUpTitle/bg_mid/titleText")
    
    self.close_btn = self:AddComponent(UIButton, "UICommonMidPopUpTitle/bg_mid/CloseBtn")
    self.return_btn = self:AddComponent(UIButton, "UICommonMidPopUpTitle/panel")
    self.close_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self.ctrl:CloseSelf()
    end)
    self.return_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self.ctrl:CloseSelf()
    end)
    
    self._scroll_view = self:AddComponent(UIScrollView, "ScrollView")
    self._scroll_view:SetOnItemMoveIn(function(itemObj, index)
        self:OnCreateCell(itemObj, index)
    end)
    self._scroll_view:SetOnItemMoveOut(function(itemObj, index)
        self:OnDeleteCell(itemObj, index)
    end)

    self.intro_btn = self:AddComponent(UIButton, "Btn_Intro")
    self.intro_btn:SetOnClick(function()
        self:OnIntroClick()
    end)
end

function UIPersonalArmsConvertView:OnDestroy()
    self:ClearScroll()
    self.title =nil
    self.close_btn = nil
    self.return_btn =nil
    self.text2 =nil
    self.action1 = nil
    self.closeAction = nil
    self.action2 =nil
    self.title = nil
    self.btn_2 = nil
    self.btn_2_txt = nil
    self.close_btn = nil
    self.return_btn = nil
    self._curNum_txt = nil
    base.OnDestroy(self)
end

function UIPersonalArmsConvertView:OnEnable()
    base.OnEnable(self)
    self:RefreshData()
end

function UIPersonalArmsConvertView:OnDisable()
    base.OnDisable(self)
end

function UIPersonalArmsConvertView:RefreshData()
    self.actId,self.list  = self:GetUserData()
    self.title:SetLocalText(372320)
    if #self.list > 0 then
        self._scroll_view:SetTotalCount(#self.list)
        self._scroll_view:RefillCells()
    end
end

function UIPersonalArmsConvertView:OnCreateCell(itemObj, index)
    itemObj.name = tostring(index)
    local cellItem = self._scroll_view:AddComponent(UIPArmsConvertCell, itemObj)
    cellItem:ReInit(self.list[index],self.actId)
end

function UIPersonalArmsConvertView:OnDeleteCell(itemObj, index)
    self._scroll_view:RemoveComponent(itemObj.name, UIPArmsConvertCell)
end

function UIPersonalArmsConvertView:ClearScroll()
    self._scroll_view:ClearCells()
    self._scroll_view:RemoveComponents(UIPArmsConvertCell)
end

function UIPersonalArmsConvertView:OnIntroClick()
    local strTitle = Localization:GetString("131000")
    local subTitle = ""
    local strContent = Localization:GetString("372324")
    UIUtil.ShowIntro(strTitle, subTitle, strContent)
end

return UIPersonalArmsConvertView