---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl.
--- DateTime: 
---
local UIPArmsConvertCell = BaseClass("UIPArmsConvertCell",UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local UIGray = CS.UIGray
function UIPArmsConvertCell:OnCreate()
    base.OnCreate(self)
	self._subject_rect = self:AddComponent(UIBaseContainer,"Rect_Subject")
    self._subject_img= self:AddComponent(UIImage,"Rect_Subject/Img_Subject")
    self._subject_txt = self:AddComponent(UIText,"Txt_Subject")

    self._inbornState_txt = self:AddComponent(UIText,"Txt_InbornState")
	
    self._convert_btn = self:AddComponent(UIButton, "Btn_Convert")
	self._convert_txt = self:AddComponent(UIText,"Btn_Convert/Txt_Convert")
    self._convert_btn:SetOnClick(function()  
SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnClick()
    end)
end

function UIPArmsConvertCell:OnDestroy()
	self._subject_rect = nil
	self._subject_img= nil
	self._subject_txt = nil
	self._inbornState_txt = nil
	self._convert_btn = nil
	self._convert_txt = nil
    base.OnDestroy(self)
end

function UIPArmsConvertCell:ReInit(param,actId)
	self.param = param
	self.actId = actId
	self._subject_txt:SetLocalText(param.name)
	self._convert_txt:SetLocalText(372321)
	self.state = LuaEntry.Effect:GetGameEffect(param.effectId)
	local str = ""
	if param.effectId == EffectDefine.UNLOCK_ARM_ACT_BUILD then
		str = "Assets/Main/Sprites/ScienceIcons/UITechnology_icon_01.png"
	elseif param.effectId == EffectDefine.UNLOCK_ARM_ACT_SCIENCE then
		str = "Assets/Main/Sprites/ScienceIcons/UITechnology_icon_02.png"
	elseif param.effectId == EffectDefine.UNLOCK_ARM_ACT_HERO then
		str = "Assets/Main/Sprites/ScienceIcons/UITechnology_icon_30.png"
	end
	self._subject_img:LoadSprite(str)
	if self.state == 0 then
		self._inbornState_txt:SetLocalText(372319)
		UIGray.SetGray(self._subject_rect.transform, true)
	else
		self._inbornState_txt:SetLocalText(302213,self.state - param.chooseNum)
		UIGray.SetGray(self._subject_rect.transform, false)
	end
end

function UIPArmsConvertCell:OnClick()
	if self.state == 0 then
		if self.param.effectId == EffectDefine.UNLOCK_ARM_ACT_BUILD then
			return UIUtil.ShowTipsId(372316)
		elseif self.param.effectId == EffectDefine.UNLOCK_ARM_ACT_SCIENCE  then
			return UIUtil.ShowTipsId(372317)
		elseif self.param.effectId == EffectDefine.UNLOCK_ARM_ACT_HERO then
			return UIUtil.ShowTipsId(372318)
		end
	end
	if self.state - self.param.chooseNum ~= 0 then
		UIUtil.ShowMessage(Localization:GetString("372322"), 2, GameDialogDefine.CONFIRM, GameDialogDefine.CANCEL, function()
			SFSNetwork.SendMessage(MsgDefines.ChooseHeroEvent,self.actId,self.param.eventId)
			self.view.ctrl:CloseSelf()
		end)
	else
		UIUtil.ShowTipsId(372323)
	end
	
end

return UIPArmsConvertCell