---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2021/9/15 17:23
---SelectDigFinalRewardItem.lua

local SelectDigFinalRewardItem = BaseClass("SelectDigFinalRewardItem", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local UICommonItem = require "UI.UICommonItem.UICommonItem"

local commonResItem_path = "UICommonItem"
local selectedImg_path = "SelectedImg"
local selectBtn_path = "selectBtn"
local gotTimes_path = "times"


local function OnCreate(self)
    base.OnCreate(self)
    
    self.commonResItemN = self:AddComponent(UICommonItem, commonResItem_path)
    self.selectedImgN = self:AddComponent(UIBaseContainer, selectedImg_path)
    self.selectBtnN = self:AddComponent(UIButton, selectBtn_path)
    self.selectBtnN:SetOnClick(function()
        self:OnClickSelectBtn()
    end)
    self.gotTimesN = self:AddComponent(UIText, gotTimes_path)
end

local function OnDestroy(self)
    self.commonResItemN = nil
    self.selectedImgN = nil
    self.selectBtnN = nil
    self.gotTimesN = nil
    base.OnDestroy(self)
end

--{itemId, count, maxSelectTimes}
local function SetItem(self, finalReward, tempIndex, selectedIndex)
    self.curIndex = tempIndex
    
    local reward = {}
    reward.rewardType = RewardType.GOODS
    reward.itemId = finalReward.itemId
    reward.count = finalReward.count
    self.commonResItemN:ReInit(reward)
    
    local gotTimes = self.view:GetFinalRewardGotTimes(tempIndex)
    self.gotTimesN:SetText(gotTimes .. "/" .. finalReward.maxSelectTimes)
    self.canSelect = gotTimes < finalReward.maxSelectTimes
    
    selectedIndex = self.view:CheckIfCanSelect() and selectedIndex or -1
    self:SetAsSelected(selectedIndex)
end

local function SetAsSelected(self, targetIndex)
    local isSelect = targetIndex == self.curIndex and true or false
    self.selectBtnN:SetActive(not isSelect)
    self.selectedImgN:SetActive(isSelect)
end


local function OnClickSelectBtn(self)
    if not self.view:CheckIfCanSelect() then
        self.commonResItemN:OnBtnClick()
        return
    end
    if not self.canSelect then
        UIUtil.ShowTips(Localization:GetString("372450"))
        return
    end
    self.view:SelectReward(self.curIndex)
end


SelectDigFinalRewardItem.OnCreate = OnCreate
SelectDigFinalRewardItem.OnDestroy = OnDestroy

SelectDigFinalRewardItem.SetItem = SetItem
SelectDigFinalRewardItem.SetAsSelected = SetAsSelected
SelectDigFinalRewardItem.OnClickSelectBtn = OnClickSelectBtn

return SelectDigFinalRewardItem