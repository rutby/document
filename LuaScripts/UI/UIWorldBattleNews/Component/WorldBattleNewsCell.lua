---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2022/3/28 14:51
---
local BattleAllianceCity = require "UI.UIWorldBattleNews.Component.BattleAllianceCity"
local BattleArea = require "UI.UIWorldBattleNews.Component.BattleArea"
local WorldBattleNewsCell = BaseClass("WorldBattleNewsCell",UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local title_txt_path = "Text_title"
local alliance_city_path = "allianceCityObj"
local battle_path = "battleObj"
local button_path = "Button"
local btn_txt_path = "Button/btnTxt"
local function OnCreate(self)
    base.OnCreate(self)
    self.first_txt= self:AddComponent(UIText,title_txt_path)
    self.alliance_city = self:AddComponent(BattleAllianceCity,alliance_city_path)
    self.battle_obj = self:AddComponent(BattleArea,battle_path)
    self.btn = self:AddComponent(UIButton,button_path)
    self.btn:SetOnClick(function()
        self:OnGotoClick()
    end)
    self.btn_txt = self:AddComponent(UIText,btn_txt_path)
    self.btn_txt:SetLocalText(110088)
end

local function SetItemShow(self, data)
    self.data = data
    if self.data.showType == BattleNewsType.Battle then
        self.first_txt:SetLocalText(302152)
        self.alliance_city:SetActive(false)
        self.battle_obj:SetActive(true)
        self.battle_obj:SetData(self.data)
    elseif self.data.showType == BattleNewsType.AllianceCity then
        if self.data.newsType == AllianceCityNewsType.OCCUPY_OCCUPIED_CITY then
            self.first_txt:SetLocalText(302148)
        else
            self.first_txt:SetLocalText(302147)
        end
        self.alliance_city:SetActive(true)
        self.alliance_city:SetData(self.data)
        self.battle_obj:SetActive(false)
    end
end

local function OnGotoClick(self)
    if self.data.showType == BattleNewsType.Battle then
        local pos = self.data.pointId
        GoToUtil.GotoWorldPos(SceneUtils.TileIndexToWorld(pos,ForceChangeScene.World),54,LookAtFocusTime)
        GoToUtil.CloseAllWindows()
    elseif self.data.showType == BattleNewsType.AllianceCity then
        local posStr = GetTableData(TableName.WorldCity, self.data.cityId, 'location')
        local tabPos = string.split(posStr, '|')
        if (table.count(tabPos) ~= 2) then
            return
        end
        local vec2 = {}
        vec2.x = tonumber(tabPos[1])
        vec2.y = tonumber(tabPos[2])
        local pointId = SceneUtils.TilePosToIndex(vec2)
        local str = self.data.cityId..";"..self.data.defColor..";"..self.data.atkColor
        local cityId = self.data.cityId
        local abbr = ""
        if self.data.newsType == AllianceCityNewsType.OCCUPY_OCCUPIED_CITY then
            abbr = self.data.defAbbr
        end
        EventManager:GetInstance():Broadcast(EventId.UINoInput,UINoInputType.ShowNoUI)
        GoToUtil.GotoWorldPos(SceneUtils.TileIndexToWorld(pointId,ForceChangeScene.World), 2000,0.8,function()
            EventManager:GetInstance():Broadcast(EventId.ShowWorldZoneChangeColor,str)
            DataCenter.AllianceCityTipManager:ShowWorldZoneChangeColor(cityId,abbr)
        end)
        self.view.ctrl:CloseSelf()
    end
end

WorldBattleNewsCell.OnCreate = OnCreate
WorldBattleNewsCell.SetItemShow = SetItemShow
WorldBattleNewsCell.OnGotoClick = OnGotoClick
return WorldBattleNewsCell