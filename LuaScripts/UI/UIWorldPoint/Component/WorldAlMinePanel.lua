---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2022/12/11 21:12
---WorldAlMinePanel.lua
local UIHeroTipView = require "UI.UIHero2.UIHeroTip.View.UIHeroTipView"
local WorldAlMinePanel = BaseClass("WorldAlMinePanel", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local WorldAlMinePanel_Collect = require "UI.UIWorldPoint.Component.WorldAlMinePanel_Collect"
local WorldAlMinePanel_Construct = require "UI.UIWorldPoint.Component.WorldAlMinePanel_Construct"

local construct_path = "constructing"
local collect_path = "collecting"

-- 创建
local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

-- 销毁
local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

-- 显示
local function OnEnable(self)
    base.OnEnable(self)
end

-- 隐藏
local function OnDisable(self)
    base.OnDisable(self)
end


--控件的定义
local function ComponentDefine(self)
    self.constructN = self:AddComponent(WorldAlMinePanel_Construct, construct_path)
    
    self.collectN = self:AddComponent(WorldAlMinePanel_Collect, collect_path)
    
end

--控件的销毁
local function ComponentDestroy(self)
    
end

--变量的定义
local function DataDefine(self)
    
end

--变量的销毁
local function DataDestroy(self)
    
end

local function OnAddListener(self)
    base.OnAddListener(self)
end


local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function SetData(self, pointId)
    self.pointId = pointId
    self:RefreshPanel()
end

local function RefreshPanel(self)
    local detail = nil
    local pointInfo = DataCenter.WorldPointManager:GetPointInfo(self.pointId)
    if pointInfo then
        detail = DataCenter.WorldPointDetailManager:GetDetailByPointId(pointInfo.mainIndex)
    end
    if not detail then
        return
    end
    self.mineInfo = detail.alBuilding
    if not self.mineInfo then
        return
    end
    if WorldAllianceBuildUtil.IsAllianceActMineGroup(self.mineInfo.buildId)==true then
        self.constructN:SetActive(false)
        self.collectN:SetActive(true)
        self.collectN:SetData(self.pointId)
    else
        if self.mineInfo.status == AllianceMineStatus.Normal then
            self.constructN:SetActive(false)
            self.collectN:SetActive(true)
            self.collectN:SetData(self.pointId)
        else
            self.collectN:SetActive(false)
            self.constructN:SetActive(true)
            self.constructN:SetData(self.pointId)
        end
    end
    
end

local function CallBacKRefresh(self)
    self.constructN:SetActive(false)
    self.collectN:SetActive(true)
    self.collectN:SetData(self.pointId)
end

local function OnInfoClick(self)
    --local pointInfo = CS.SceneManager.World:GetPointInfo(self.pointId)
    --local detail = nil
    --if pointInfo then
    --    detail = DataCenter.WorldPointDetailManager:GetDetailByPointId(pointInfo.mainIndex)
    --end
    --if not detail then
    --    return
    --end
    --local  mineInfo = detail.alBuilding
    --if mineInfo ==nil then
    --    return
    --end
    --local template = DataCenter.AllianceMineManager:GetAllianceMineTemplate(mineInfo.buildId)
    --if template~=nil then
    --    local scaleFactor = UIManager:GetInstance():GetScaleFactor()
    --    local position = self.view.btn_detail.gameObject.transform.position + Vector3.New(0, -33, 0) * scaleFactor
    --
    --    local param = UIHeroTipView.Param.New()
    --    param.content = Localization:GetString(template.desc)
    --    param.dir = UIHeroTipView.Direction.BELOW
    --    param.defWidth = 200
    --    param.pivot = 0.5
    --    param.position = position
    --    param.deltaX = 0
    --    UIManager:GetInstance():OpenWindow(UIWindowNames.UIHeroTip, { anim = false }, param)
    --end
    UIUtil.ShowIntro(Localization:GetString("300747"), Localization:GetString("302027"), Localization:GetString("300748"))
    self.view.ctrl:CloseSelf()
end
WorldAlMinePanel.OnCreate = OnCreate
WorldAlMinePanel.OnDestroy = OnDestroy
WorldAlMinePanel.OnEnable = OnEnable
WorldAlMinePanel.OnDisable = OnDisable
WorldAlMinePanel.ComponentDefine = ComponentDefine
WorldAlMinePanel.ComponentDestroy = ComponentDestroy
WorldAlMinePanel.DataDefine = DataDefine
WorldAlMinePanel.DataDestroy = DataDestroy
WorldAlMinePanel.OnAddListener = OnAddListener
WorldAlMinePanel.OnRemoveListener = OnRemoveListener

WorldAlMinePanel.SetData = SetData
WorldAlMinePanel.RefreshPanel = RefreshPanel
WorldAlMinePanel.CallBacKRefresh = CallBacKRefresh
WorldAlMinePanel.OnInfoClick= OnInfoClick
return WorldAlMinePanel