---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2022/1/12 18:31
---

local GuideGarbageInfo = BaseClass("GuideGarbageInfo", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

local panel_path = "GuidePanelBG"
local reward_title_path = "GuidePanelBG/Reward_title"
local name_path = "GuidePanelBG/Head/Name_text"
--local reward_cell_path = "GuidePanelBG/Cell"
local cell_container_path = "GuidePanelBG/RewardItemContainer"
local dig_btn_path = "GuidePanelBG/Dig_btn"
local cell_1_path  = "GuidePanelBG/RewardItemContainer/Cell_1"
local cell_2_path  = "GuidePanelBG/RewardItemContainer/Cell_2"
local cell_3_path  = "GuidePanelBG/RewardItemContainer/Cell_3"

local cell_1_icon_path  = "GuidePanelBG/RewardItemContainer/Cell_1/bg_1"
local cell_2_icon_path  = "GuidePanelBG/RewardItemContainer/Cell_2/bg_2"
local cell_3_icon_path  = "GuidePanelBG/RewardItemContainer/Cell_3/bg_3"

local cell_1_num_path  = "GuidePanelBG/RewardItemContainer/Cell_1/bg_1/Item_num_1"
local cell_2_num_path  = "GuidePanelBG/RewardItemContainer/Cell_2/bg_2/Item_num_2"
local cell_3_num_path  = "GuidePanelBG/RewardItemContainer/Cell_3/bg_3/Item_num_3"

local min_panel_width = 500
local max_panel_width = 570

local max_num = 3

-- 创建
local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

-- 销毁
local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

-- 显示
local function OnEnable(self)
    base.OnEnable(self)
end

-- 隐藏
local function OnDisable(self)
    base.OnDisable(self)
end


--控件的定义
local function ComponentDefine(self)
    self.reward_title = self:AddComponent(UITextMeshProUGUIEx, reward_title_path)
    self.reward_title:SetLocalText(130065)
    self.name = self:AddComponent(UITextMeshProUGUIEx, name_path)
    self.name:SetLocalText(104196)
    self.dig_btn = self:AddComponent(UIButton, dig_btn_path)
    self.dig_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnDigClick()
    end)

    self.cell_container = self:AddComponent(UIBaseContainer, cell_container_path)
    self.panel = self:AddComponent(UIImage, panel_path)
    self.cell_1 = self:AddComponent(UIBaseContainer, cell_1_path)
    self.cell_2 = self:AddComponent(UIBaseContainer, cell_2_path)
    self.cell_3 = self:AddComponent(UIBaseContainer, cell_3_path)

    self.cell_icon_1 = self:AddComponent(UIImage, cell_1_icon_path)
    self.cell_icon_2 = self:AddComponent(UIImage, cell_2_icon_path)
    self.cell_icon_3 = self:AddComponent(UIImage, cell_3_icon_path)

    self.cell_num_1 = self:AddComponent(UITextMeshProUGUIEx, cell_1_num_path)
    self.cell_num_2 = self:AddComponent(UITextMeshProUGUIEx, cell_2_num_path)
    self.cell_num_3 = self:AddComponent(UITextMeshProUGUIEx, cell_3_num_path)
    
end

--控件的销毁
local function ComponentDestroy(self)
    self.reward_title = nil
    self.name = nil
    self.dig_btn = nil
    self.cell_container = nil
    self.panel = nil
    self.cell_1 = nil
    self.cell_2 = nil
    self.cell_3 = nil
    self.cell_icon_1 = nil
    self.cell_icon_2 = nil
    self.cell_icon_3 = nil

    self.cell_num_1 = nil
    self.cell_num_2 = nil
    self.cell_num_3 = nil
end

--变量的定义
local function DataDefine(self)
    self.param = nil
end

--变量的销毁
local function DataDestroy(self)
    self.param = nil
end

local function RefreshData(self,param)
    self.data = param
    local index = 1
    while index <= max_num do
        self:RefreshCell(index, param.rewardStr[index])
        index = index + 1
    end
    local _, sy = self.panel.rectTransform:Get_sizeDelta()
    if #param.rewardStr > 2 then
        self.panel.rectTransform:Set_sizeDelta(max_panel_width, sy)
    else
        self.panel.rectTransform:Set_sizeDelta(min_panel_width, sy)
    end
end

local function RefreshCell(self, index, data)
    local cell = self["cell_"..index]
    if cell ~= nil then
        if data ~= nil then
            local icon = self["cell_icon_"..index]
            local num = self["cell_num_"..index]
            cell:SetActive(true)
            if icon ~= nil and num ~= nil then
                icon:LoadSprite(data.iconName)
                num:SetText(tostring(data.count))
            end
        else
            cell:SetActive(false)
        end
    end
end

local function OnDigClick(self)
    if CS.SceneManager:IsInCity() then
        DataCenter.PickGarbageDataManager:AddIndexToGarbageQueue(self.view.ctrl.pointId)
        self.view.ctrl:CloseSelf(false)
        return
    end
end

GuideGarbageInfo.OnCreate = OnCreate
GuideGarbageInfo.OnDestroy = OnDestroy
GuideGarbageInfo.OnEnable = OnEnable
GuideGarbageInfo.OnDisable = OnDisable
GuideGarbageInfo.ComponentDefine = ComponentDefine
GuideGarbageInfo.ComponentDestroy = ComponentDestroy
GuideGarbageInfo.DataDefine = DataDefine
GuideGarbageInfo.DataDestroy = DataDestroy
GuideGarbageInfo.RefreshData = RefreshData
GuideGarbageInfo.RefreshCell = RefreshCell
GuideGarbageInfo.OnDigClick = OnDigClick

return GuideGarbageInfo