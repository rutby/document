---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2021/8/30 17:11
---

local AllianceArmsActivityConditionItem = BaseClass("AllianceArmsActivityConditionItem", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local UIHeroTipsView = require "UI.UIHeroTips.View.UIHeroTipsView"

local desTxt_path = "contentGo/TxtDesc"
local valueTxt_path = "TxtValue"
local divImg_path = "ImgDiv"
local moneyImg_path = "TxtValue/ImgMoney"
local infoBtn_path = "TxtValue/tipBtn"


local function OnCreate(self)
    base.OnCreate(self)
    
    self.desTxt = self:AddComponent(UITextMeshProUGUIEx, desTxt_path)
    self.valueTxt = self:AddComponent(UITextMeshProUGUIEx, valueTxt_path)
    self.divImg = self:AddComponent(UIImage, divImg_path)
    self.moneyImg = self:AddComponent(UIImage, moneyImg_path)
    self.infoBtn = self:AddComponent(UIButton, infoBtn_path)
    self.infoBtn:SetOnClick(function()
        self:OnClickInfoBtn()
    end)
end

local function OnDestroy(self)
    base.OnDestroy(self)
end

local function RefreshData(self, data, index)
    if data == nil then
        Logger.LogError("未查找到score表中group配置准确数据")
        return
    end
    self.data = data
    local id = data.id
    local name = data.name
    local value = data.value
    if value ~= nil and type(value) == "table" and value.Length > 0 then
        --配表解析成array数组,直接传入报错，转换luaTable
        local valueLuaTable = {}
        for i = 1, value.Length do
            table.insert(valueLuaTable , value[i-1])
        end
        local descExpand = CommonUtil.GetNameByParams(name, valueLuaTable)
        self.desTxt:SetText(descExpand)
    elseif data.valueStr ~= nil then
        local valueArr = string.split(data.valueStr , ",")
        local descExpand = CommonUtil.GetNameByParams(name, valueArr)
        self.desTxt:SetText(descExpand)
    else
        self.desTxt:SetLocalText(name,  value) 
    end
    if data.groupId ~= nil and tonumber(data.groupId) == 1 then
        self.valueTxt:SetActive(false)
    else
        self.valueTxt:SetActive(true)
    end
    if string.IsNullOrEmpty(data.points) or tonumber(data.points) == 0 then
        self.valueTxt:SetLocalText(372564)
        self.infoBtn:SetActive(true)
    else
        local num = string.GetFormattedSeperatorNum(data.points)
        self.valueTxt:SetText("+ "..num)
        self.infoBtn:SetActive(false)
    end
    local state = math.fmod(index , 2) == 1
    self.divImg:SetActive(state)
    --[[
    --新增tips逻辑
    if data.tipsArr ~= nil and data.tipsArr.Length > 0 then
        self.tipsStr = ""
        local tipsLeng = data.tipsArr.Length
        for i = 1, tipsLeng do
            local str = Localization:GetString(data.tipsArr[i-1]).."\n"
            self.tipsStr = self.tipsStr..str
        end
        self.tips = data.tips
        self.infoBtn:SetActive(true)
    else
        self.infoBtn:SetActive(false)
    end
    --]]
end

local function OnClickInfoBtn(self)
    local scaleFactor = UIManager:GetInstance():GetScaleFactor()
    local position = self.infoBtn.transform.position + Vector3.New(0, 10, 0) * scaleFactor

    local param = UIHeroTipsView.Param.New()
    param.content = Localization:GetString(self.data.tips)
    param.dir = UIHeroTipsView.Direction.ABOVE
    param.defWidth = 400
    param.pivot = 0.85
    param.position = position
    param.bindObject = self.gameObject
    UIManager:GetInstance():OpenWindow(UIWindowNames.UIHeroTips, { anim = false }, param)
end

AllianceArmsActivityConditionItem.OnCreate = OnCreate
AllianceArmsActivityConditionItem.OnDestroy = OnDestroy
AllianceArmsActivityConditionItem.RefreshData = RefreshData
AllianceArmsActivityConditionItem.OnClickInfoBtn = OnClickInfoBtn

return AllianceArmsActivityConditionItem