---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/5/30 18:36
---

local GolloBoxUse = BaseClass("GolloBoxUse", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

local this_path = ""
local return_path = "UICommonMidPopUpTitle/panel"
local close_path = "UICommonMidPopUpTitle/bg_mid/CloseBtn"
local title_path = "UICommonMidPopUpTitle/bg_mid/titleText"
local desc_path = "Desc"
local sub_path = "Sub"
local add_path = "Add"
local slider_path = "Slider"
local count_path = "Count"
local go_btn_path = "Go"
local go_text_path = "Go/GoText"

local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
    self:Refresh()
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function ComponentDefine(self)
    self.anim = self:AddComponent(UIAnimator, this_path)
    self.return_btn = self:AddComponent(UIButton, return_path)
    self.return_btn:SetOnClick(function()
        self:Hide()
    end)
    self.close_btn = self:AddComponent(UIButton, close_path)
    self.close_btn:SetOnClick(function()
        self:Hide()
    end)
    self.title_text = self:AddComponent(UITextMeshProUGUIEx, title_path)
    self.title_text:SetLocalText(110046)
    self.desc_text = self:AddComponent(UIText, desc_path)
    self.sub_btn = self:AddComponent(UIButton, sub_path)
    self.sub_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Dec)
        self:OnSubClick()
    end)
    self.add_btn = self:AddComponent(UIButton, add_path)
    self.add_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Add)
        self:OnAddClick()
    end)
    self.slider = self:AddComponent(UISlider, slider_path)
    self.slider:SetOnValueChanged(function(value)
        self:OnValueChange(value)
    end)
    self.count_text = self:AddComponent(UIText, count_path)
    self.go_btn = self:AddComponent(UIButton, go_btn_path)
    self.go_btn:SetOnClick(function()
        self:OnGoClick()
    end)
    self.go_text = self:AddComponent(UIText, go_text_path)
    self.go_text:SetLocalText(110046)
end

local function ComponentDestroy(self)
    
end

local function DataDefine(self)
    self.maxCount = 1
    self.count = 0
end

local function DataDestroy(self)
    
end

local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function Show(self)
    self:SetActive(true)
    self.anim:Play("CommonPopup_movein", 0, 0)
end

local function Hide(self)
    self:SetActive(false)
end

local function Refresh(self)
    self.maxCount = 0
    self.count = 1
    self.slider:SetValue(self.count / self.maxCount)
    self:RefreshCount()
end

local function RefreshCount(self)
    self.count_text:SetText(self.count)
    local template = nil
    if template then
        self.desc_text:SetLocalText(110726, Localization:GetString(template.name) .. " x" .. self.count)
    end
end

local function OnValueChange(self)
    self.count = Mathf.Clamp(self.maxCount * self.slider:GetValue(), 1, self.maxCount)
    self.count = Mathf.Round(self.count)
    self:RefreshCount()
end

local function OnSubClick(self)
    self.count = Mathf.Clamp(self.count - 1, 1, self.maxCount)
    self.slider:SetValue(self.count / self.maxCount)
    self:RefreshCount()
end

local function OnAddClick(self)
    self.count = Mathf.Clamp(self.count + 1, 1, self.maxCount)
    self.slider:SetValue(self.count / self.maxCount)
    self:RefreshCount()
end

local function OnGoClick(self)
    
end

GolloBoxUse.OnCreate = OnCreate
GolloBoxUse.OnDestroy = OnDestroy
GolloBoxUse.OnEnable = OnEnable
GolloBoxUse.OnDisable = OnDisable
GolloBoxUse.ComponentDefine = ComponentDefine
GolloBoxUse.ComponentDestroy = ComponentDestroy
GolloBoxUse.DataDefine = DataDefine
GolloBoxUse.DataDestroy = DataDestroy
GolloBoxUse.OnAddListener = OnAddListener
GolloBoxUse.OnRemoveListener = OnRemoveListener

GolloBoxUse.Show = Show
GolloBoxUse.Hide = Hide
GolloBoxUse.Refresh = Refresh
GolloBoxUse.RefreshCount = RefreshCount
GolloBoxUse.OnValueChange = OnValueChange
GolloBoxUse.OnSubClick = OnSubClick
GolloBoxUse.OnAddClick = OnAddClick
GolloBoxUse.OnGoClick = OnGoClick

return GolloBoxUse