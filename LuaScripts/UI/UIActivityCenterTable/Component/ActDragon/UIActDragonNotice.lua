---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl.
--- DateTime: 2023/5/30 10:21
---
local  UIActDragonNotice = BaseClass(" UIActDragonNotice",UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization
function  UIActDragonNotice:OnCreate()
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

function  UIActDragonNotice:ComponentDefine()
    self._actName1_txt = self:AddComponent(UIText,"rect/Top1/Txt_ActName1")
    self._actDesc1_txt = self:AddComponent(UIText,"rect/Top1/Txt_ActDesc1")
    self._element1 = self:AddComponent(UIBaseContainer,"rect/Top1/LayoutElement1")
    self._actTime1_txt = self:AddComponent(UIText,"rect/Top1/LayoutElement1/Txt_ActTime1")
    
    self._rule_btn = self:AddComponent(UIButton,"rect/Rect_BtnList/Btn_Rule")
    self._rule_txt = self:AddComponent(UIText,"rect/Rect_BtnList/Btn_Rule/Txt_Rule")
    self._rule_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:ClickBtnRule()
    end)
    self._stateTips_txt = self:AddComponent(UIText,"rect/Top1/Txt_StateTips")
    
end

function  UIActDragonNotice:ComponentDestroy()
 
end

function  UIActDragonNotice:DataDefine()
    self.timer_actionMars = function(temp)
        self:RefreshTime(temp)
    end
end

function  UIActDragonNotice:OnDestroy()
    self:ComponentDestroy()
    self:DeleteTimer()
    base.OnDestroy(self)
end

function  UIActDragonNotice:OnEnable()
    base.OnEnable(self)
end

function  UIActDragonNotice:OnDisable()
    base.OnDisable(self)
end

function  UIActDragonNotice:SetData(activityId,actId)
    self.activityId = activityId
    self.actListData = DataCenter.ActivityListDataManager:GetActivityDataById(self.activityId)
    self:SetDialog(self.actListData)
    self:RefreshTime()
    self:AddTime()
end

function  UIActDragonNotice:SetDialog(actListData)
    self._actName1_txt:SetLocalText(actListData.name)
    self._actDesc1_txt:SetLocalText(actListData.desc_info)
    self._rule_txt:SetLocalText(376021)
    self._stateTips_txt:SetLocalText(376136)
end

--规则说明
function  UIActDragonNotice:ClickBtnRule()
    UIManager:GetInstance():OpenWindow(UIWindowNames.UIActDragonRule)
end

--{{{
function  UIActDragonNotice:AddTime()
    if self.timer_mars == nil then
        self.timer_mars = TimerManager:GetInstance():GetTimer(1, self.timer_actionMars ,self, false,false,false)
    end
    self.timer_mars:Start()
end

function  UIActDragonNotice:RefreshTime()
    local curTime = UITimeManager:GetInstance():GetServerTime()
    if curTime < self.actListData.endTime then
        self._actTime1_txt:SetText(Localization:GetString("376109")..": "..UITimeManager:GetInstance():MilliSecondToFmtString(self.actListData.endTime - curTime))
    else
        self:DeleteTimer()
    end
end

function  UIActDragonNotice:DeleteTimer()
    if self.timer_mars ~= nil then
        self.timer_mars:Stop()
        self.timer_mars = nil
    end
end
--}}}


return  UIActDragonNotice