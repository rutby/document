---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2023/1/13 18:58
---SeasonPassChallengePanel.lua


local SeasonPassChallengePanel = BaseClass("SeasonPassChallengePanel", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local SeasonPassChallengeItem = require "UI.UIActivityCenterTable.Component.SeasonPass.SeasonPassChallengeItem"

local scrollRect_path = "scrollRect"
local content_path = "scrollRect/Content"

-- 创建
local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

-- 销毁
local function OnDestroy(self)
    self:ClearScroll()
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

--控件的定义
local function ComponentDefine(self)
    self.scrollRectN = self:AddComponent(UIBaseContainer,scrollRect_path)
    self.contentN = self:AddComponent(HorizontalInfinityScrollView, content_path)
    self.listGO = {}
    local bindFunc1 = BindCallback(self, self.OnInitScroll)
    local bindFunc2 = BindCallback(self, self.OnUpdateScroll)
    local bindFunc3 = BindCallback(self, self.OnDestroyScrollItem)
    self.contentN:Init(bindFunc1,bindFunc2, bindFunc3)
    
    --[[
    self.scrollRectN = self:AddComponent(UIScrollRect, scrollRect_path)
    self.contentN = self:AddComponent(GridInfinityScrollView, content_path)
    self.tipsN = self:AddComponent(UIText, tip_path)
    self.tipsN:SetLocalText(150053)
    self.listGO = {}
    local bindFunc1 = BindCallback(self, self.OnInitScroll)
    local bindFunc2 = BindCallback(self, self.OnUpdateScroll)
    local bindFunc3 = BindCallback(self, self.OnDestroyScrollItem)
    self.contentN:Init(bindFunc1,bindFunc2, bindFunc3)
    self.packageIconN = self:AddComponent(UIImage, packageIcon_path)
    self.packageDescN = self:AddComponent(UIText, packageDesc_path)
    self.unlockBtnN = self:AddComponent(UIButton, unlockBtn_path)
    self.unlockBtnN:SetOnClick(function()
        self:OnClickUnlockBtn()
    end)
    self.unlockBtnTxtN = self:AddComponent(UIText, unlockBtnTxt_path)
    --]]
end

--控件的销毁
local function ComponentDestroy(self)

end

--变量的定义
local function DataDefine(self)
    
end

--变量的销毁
local function DataDestroy(self)
    
end

local function OnAddListener(self)
    base.OnAddListener(self)
    self:AddUIListener(EventId.OnSeasonPassTaskRewardUpdate, self.RefreshAll)
end

local function OnRemoveListener(self)
    self:RemoveUIListener(EventId.OnSeasonPassTaskRewardUpdate, self.RefreshAll)
    base.OnRemoveListener(self)
end

local function ShowPanel(self, activityId, flyPos)
    self.activityId = activityId
    self.flyPos = flyPos

    self:RefreshAll()
end

local function RefreshAll(self)
    self.passInfo = DataCenter.SeasonPassManager:GetSeasonPassInfo(self.activityId)
    if not self.passInfo then
        return
    end

    self.taskList = self.passInfo:GetTaskSorted(2)--.challengeTaskList
    self.contentN:SetItemCount(#self.taskList)
    self.contentN:ForceUpdate()
end


local function OnInitScroll(self,go,index)
    local item = self.scrollRectN:AddComponent(SeasonPassChallengeItem, go)
    self.listGO[go] = item
end

local function OnUpdateScroll(self,go,index)
    local sub = self.taskList[index + 1]
    local cellItem = self.listGO[go]
    if sub == nil then
        return
    end
    cellItem:SetData(self.activityId, self.taskList[index + 1], self.flyPos)
end

local function OnDestroyScrollItem(self,go, index)
    
end

local function ClearScroll(self)
    self.scrollRectN:RemoveComponents(SeasonPassChallengeItem)
    self.contentN:DestroyChildNode()
end


SeasonPassChallengePanel.OnCreate = OnCreate
SeasonPassChallengePanel.OnDestroy = OnDestroy
SeasonPassChallengePanel.ComponentDefine = ComponentDefine
SeasonPassChallengePanel.ComponentDestroy = ComponentDestroy
SeasonPassChallengePanel.DataDefine = DataDefine
SeasonPassChallengePanel.DataDestroy = DataDestroy
SeasonPassChallengePanel.OnAddListener = OnAddListener
SeasonPassChallengePanel.OnRemoveListener = OnRemoveListener

SeasonPassChallengePanel.ShowPanel = ShowPanel
SeasonPassChallengePanel.RefreshAll = RefreshAll
SeasonPassChallengePanel.OnInitScroll = OnInitScroll
SeasonPassChallengePanel.OnUpdateScroll = OnUpdateScroll
SeasonPassChallengePanel.OnDestroyScrollItem = OnDestroyScrollItem
SeasonPassChallengePanel.ClearScroll = ClearScroll

return SeasonPassChallengePanel