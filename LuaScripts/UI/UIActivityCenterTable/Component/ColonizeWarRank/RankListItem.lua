---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 
--- DateTime: 
---
local RankListItem = BaseClass("RankListItem",UIBaseContainer)
local base = UIBaseContainer
local AllianceFlagItem = require "UI.UIAlliance.UIAllianceFlag.Component.AllianceFlagItem"

local Localization = CS.GameEntry.Localization
local function OnCreate(self)
    base.OnCreate(self)
    self._allianceLeader_txt = self:AddComponent(UIText,"Txt_AllianceLeader")
    self._name_txt = self:AddComponent(UIText,"Txt_Name")

	self._country_img = self:AddComponent(UIImage,"Img_Country")
    self.num_txt = self:AddComponent(UIText,"numTxt")
    
    self.first_flag = self:AddComponent(UIBaseContainer,"firstImg")
    self.second_flag = self:AddComponent(UIBaseContainer,"secondImg")
    self.third_flag = self:AddComponent(UIBaseContainer,"thirdImg")
	
	self._alliance_rect = self:AddComponent(UIBaseContainer,"allianceFlag")
	self._allianceFlag = self:AddComponent(AllianceFlagItem,"allianceFlag/AllianceFlag")

	self._score_txt = self:AddComponent(UIText,"Txt_Score")

	self._rewardScore_txt = self:AddComponent(UIText,"Txt_RewardScore")
    
    self.player_flag = self:AddComponent(UIBaseContainer,"playerFlag")
	self.player_img =self:AddComponent(UIPlayerHead,"playerFlag/UIPlayerHead/HeadIcon")
	
    self.btn = self:AddComponent(UIButton, "Button")
    self.btn:SetOnClick(function()  
	SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnClick()
    end)
end

local function SetAllianceShow(self, data,rewardArr)
	self.player_flag:SetActive(false)
	self._alliance_rect:SetActive(true)
	self.playerData = nil
	self.allianceData = data
    self.first_flag:SetActive(data.rank ==1)
    self.third_flag:SetActive(data.rank ==3)
    self.second_flag:SetActive(data.rank ==2)
    self.num_txt:SetText(data.rank)
    if self.allianceData.rank>3 then
        self.num_txt:SetActive(true)
    else
        self.num_txt:SetActive(false)
    end
	
	if data.abbr == "" then
		self._name_txt:SetText("-")
		self._allianceLeader_txt:SetText("-")
	else
		local allianceName = ""
		if data.abbr then
			allianceName = Localization:GetString('311026',data.abbr,data.allianceName)
		end
		self._name_txt:SetLocalText(372761,data.serverId,allianceName)
		self._allianceLeader_txt:SetText(data.leader)
	end
	
	self._allianceFlag:SetData(data.icon)

	self._score_txt:SetText(data.score)

	local rewardAddScore = 0
	for i = 1 ,#rewardArr do
		if data.rank >= rewardArr[i].startN and data.rank <= rewardArr[i].endN then
			rewardAddScore = rewardArr[i].addScore
			break
		end
	end
	self._rewardScore_txt:SetText(rewardAddScore)

	if LuaEntry.Player:IsHideCountryFlag() then
		self._country_img:SetActive(false)
	else
		self._country_img:SetActive(true)
		local countryConfig = DataCenter.NationTemplateManager:GetNationTemplate(DefaultNation)
		if self.allianceData.country ~= "" then
			countryConfig = DataCenter.NationTemplateManager:GetNationTemplate(self.allianceData.country)
		end
		self._country_img:LoadSprite(countryConfig:GetNationFlagPath())
	end
end

local function SetPlayerShow(self,data)
	self.player_flag:SetActive(true)
	self._alliance_rect:SetActive(false)
	self._country_img:SetActive(false)
	self.allianceData = nil
	self.playerData = data
	self.first_flag:SetActive(data.rank ==1)
	self.third_flag:SetActive(data.rank ==3)
	self.second_flag:SetActive(data.rank ==2)
	self.num_txt:SetText(data.rank)
	if self.playerData.rank>3 then
		self.num_txt:SetActive(true)
	else
		self.num_txt:SetActive(false)
	end

	self._name_txt:SetText(data.name)
	self.player_img:SetData(data.uid, data.pic, data.picVer)
	self._score_txt:SetText("")
	self._rewardScore_txt:SetText(data.score)
	if data.abbr and data.abbr ~= "" then
		self._allianceLeader_txt:SetLocalText(311026,data.abbr,data.alliancename)
	else
		self._allianceLeader_txt:SetText("-")
	end
end

local function OnClick(self)
	if self.playerData then
		if self.playerData.uid ~= LuaEntry.Player.uid then
			UIManager:GetInstance():OpenWindow(UIWindowNames.UIOtherPlayerInfo,self.playerData.uid)
		else
			UIManager:GetInstance():OpenWindow(UIWindowNames.UIPlayerInfo,LuaEntry.Player.uid)
		end
	elseif self.allianceData then
		local selfAllianceId = ""
		local data = DataCenter.AllianceBaseDataManager:GetAllianceBaseData()
		if data ~= nil then
			selfAllianceId = data.uid
		end
		local allianceId = self.allianceData.allianceId
		if selfAllianceId ~= allianceId then
			UIManager:GetInstance():OpenWindow(UIWindowNames.UIAllianceDetail,{ anim = true, isBlur = true}, self.allianceData.allianceName, allianceId)
		else
			UIManager:GetInstance():OpenWindow(UIWindowNames.UIAllianceMainTable,{ anim = true})
		end
	end
end
local function OnDestroy(self)
    base.OnDestroy(self)
end
RankListItem.OnCreate = OnCreate
RankListItem.SetAllianceShow = SetAllianceShow
RankListItem.SetPlayerShow = SetPlayerShow
RankListItem.OnClick = OnClick
RankListItem.OnDestroy =OnDestroy
return RankListItem