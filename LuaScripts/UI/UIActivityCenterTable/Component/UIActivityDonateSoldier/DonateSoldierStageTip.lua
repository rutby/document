---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2022/9/1 22:11
---

local DonateSoldierStageTip = BaseClass("DonateSoldierStageTip", UIBaseContainer)
local base = UIBaseContainer
local UICommonItem = require "UI.UICommonItem.UICommonItem"
local Localization = CS.GameEntry.Localization

local close_path = "Close"
local root_path = "Root"
local bg_path = "Root/Bg"
local list_path = "Root/Bg/List"

local PADDING = 50

local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.close_btn = self:AddComponent(UIButton, close_path)
    self.close_btn:SetOnClick(function()
        self:OnCloseClick()
    end)
    self.root_anim = self:AddComponent(UIAnimator, root_path)
    self.bg_go = self:AddComponent(UIBaseContainer, bg_path)
    self.list_go = self:AddComponent(UIBaseContainer, list_path)
end

local function ComponentDestroy(self)
    self.close_btn = nil
    self.root_anim = nil
    self.bg_go = nil
    self.list_go = nil
end

local function DataDefine(self)
    self.rewards = nil
    self.reqs = {}
    self.items = {}
end

local function DataDestroy(self)
    self.rewards = nil
    self.reqs = nil
    self.items = nil
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function SetData(self, rewards)
    self.rewards = rewards
    self:Refresh()
end

local function Refresh(self)
    for _, item in ipairs(self.items) do
        item:SetActive(false)
    end
    for i, reward in ipairs(self.rewards) do
        if self.items[i] ~= nil then
            self.items[i]:SetActive(true)
            self.items[i]:ReInit(reward)
        else
            if self.reqs[i] ~= nil then
                self.reqs[i]:Destroy()
            end
            self.reqs[i] = self:GameObjectInstantiateAsync(UIAssets.UICommonItemAct, function(req)
                if req.isError then
                    return
                end
                local go = req.gameObject;
                go.transform:SetParent(self.list_go.transform)
                go.transform:Set_localScale(ResetScale.x, ResetScale.y, ResetScale.z)
                go.name = tostring(i)
                local item = self.list_go:AddComponent(UICommonItem, go.name)
                item:SetActive(true)
                item:ReInit(reward)
                self.items[i] = item
                self:AdjustBg()
            end)
        end
    end
end

local function Show(self)
    self:SetActive(true)
    self.root_anim:Play("CommonPopup_movein", 0, 0)
end

local function SetPosX(self, x)
    local pos = self.root_anim.transform.position
    pos.x = x
    self.root_anim.transform.position = pos
    self:AdjustBg()
end

local function AdjustBg(self)
    CS.UnityEngine.UI.LayoutRebuilder.ForceRebuildLayoutImmediate(self.bg_go.rectTransform)
    --TimerManager:GetInstance():DelayInvoke(function()
    --    local localPos = self.bg_go.rectTransform.localPosition
    --    localPos.x = 0
    --    self.bg_go.rectTransform.localPosition = localPos
    --
    --    local pos = self.bg_go.rectTransform.position
    --    local w = self.bg_go.rectTransform.sizeDelta.x / 2 * GetStandardScale()
    --    local screenWidth = Screen.width --* GetStandardScale()
    --    pos.x = Mathf.Clamp(pos.x, w + PADDING, screenWidth - w - PADDING)
    --    self.bg_go.rectTransform.position = pos
    --end, 0.03)
end

local function OnCloseClick(self)
    self:SetActive(false)
end

DonateSoldierStageTip.OnCreate = OnCreate
DonateSoldierStageTip.OnDestroy = OnDestroy
DonateSoldierStageTip.ComponentDefine = ComponentDefine
DonateSoldierStageTip.ComponentDestroy = ComponentDestroy
DonateSoldierStageTip.DataDefine = DataDefine
DonateSoldierStageTip.DataDestroy = DataDestroy
DonateSoldierStageTip.OnEnable = OnEnable
DonateSoldierStageTip.OnDisable = OnDisable

DonateSoldierStageTip.OnCreateCell = OnCreateCell
DonateSoldierStageTip.OnDeleteCell = OnDeleteCell
DonateSoldierStageTip.ShowScroll = ShowScroll

DonateSoldierStageTip.SetData = SetData
DonateSoldierStageTip.Refresh = Refresh
DonateSoldierStageTip.Show = Show
DonateSoldierStageTip.SetPosX = SetPosX
DonateSoldierStageTip.AdjustBg = AdjustBg
DonateSoldierStageTip.OnCloseClick = OnCloseClick

return DonateSoldierStageTip