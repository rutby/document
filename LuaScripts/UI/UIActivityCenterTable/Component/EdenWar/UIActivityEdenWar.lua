---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl.
--- DateTime: 2021/11/24 17:21
---
local UIActivityEdenWar = BaseClass("UIActivityEdenWar",UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization

local txt_activityName_path = "rect/Txt_ActivityName"
local btn_tips_path = "rect/Btn_Tips"
local txt_tips_path = "rect/Btn_Tips/Txt_Tips"
local btn_alliance_path = "rect/Btn_Alliance"
local txt_alliance_path = "rect/Btn_Alliance/Txt_Alliance"
local txt_alliancetips_path = "rect/Txt_AllianceTips"

local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
end

local function ComponentDefine(self)
    self._activityName_txt = self:AddComponent(UIText,txt_activityName_path)

    self._tips_btn = self:AddComponent(UIButton, btn_tips_path)
    self._tips_txt = self:AddComponent(UIText,txt_tips_path)
    
    self._alliance_btn = self:AddComponent(UIButton,btn_alliance_path)
    self._alliance_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:ClickBtn()
    end)
    self._alliance_txt = self:AddComponent(UIText,txt_alliance_path)
    self._allianceTips_txt = self:AddComponent(UIText,txt_alliancetips_path)
    

    self._tips_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:ClickTip()
    end)
end

local function ComponentDestroy(self)
    self.reward_tab = nil
    self.reward = nil
end

local function OnDestroy(self)
    self:ComponentDestroy()
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function ReInit(self)
    local lv = 1
    local hasAlTerritory = DataCenter.WorldAllianceCityDataManager:CheckIfHasAlCity()
    if hasAlTerritory then
        --如果已有遗迹
        local myAlId = LuaEntry.Player.allianceId
        local myCities = DataCenter.WorldAllianceCityDataManager:GetCitiesByAlId(myAlId)
        if myCities then
            for i = 1, #myCities do
                local config =  DataCenter.AllianceCityTemplateManager:GetTemplate(myCities[i])
                if config.level > lv then
                    lv = config.level
                end
            end
        end
        local maxLv = DataCenter.AllianceCityTemplateManager:GetTemplateMaxLv()
        if lv < maxLv then
            lv = lv + 1
        end
    end
    
    self._activityName_txt:SetLocalText(372103)
    self._tips_txt:SetLocalText(302027)
    
    if LuaEntry.Player:IsInAlliance() then
        self._alliance_txt:SetLocalText(110088)
        self._allianceTips_txt:SetLocalText(372181,tostring(lv))
    else
        self._alliance_txt:SetLocalText(390079)
        self._allianceTips_txt:SetLocalText(372180)
    end
end

local function ClickTip(self)
    UIManager:GetInstance():OpenWindow(UIWindowNames.UIActivityEdenWarTips, { anim = true })
end

local function ClickBtn(self)
    if LuaEntry.Player:IsInAlliance() then
        self.view.ctrl:GoEdenWar()
    else
        local arrow = 1
        GoToUtil.GotoOpenView(UIWindowNames.UIAllianceIntro,{ anim = true,isBlur = true},arrow)
    end
end

UIActivityEdenWar.OnCreate = OnCreate
UIActivityEdenWar.OnDestroy = OnDestroy
UIActivityEdenWar.OnEnable = OnEnable
UIActivityEdenWar.OnDisable = OnDisable
UIActivityEdenWar.ComponentDefine =ComponentDefine
UIActivityEdenWar.DataDefine = DataDefine
UIActivityEdenWar.ComponentDestroy =ComponentDestroy
UIActivityEdenWar.OnAddListener =OnAddListener
UIActivityEdenWar.OnRemoveListener =OnRemoveListener
UIActivityEdenWar.ReInit =ReInit
UIActivityEdenWar.ClickTip = ClickTip
UIActivityEdenWar.ClickBtn = ClickBtn
return UIActivityEdenWar