---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by jinpeng.
--- DateTime: 2023/6/14 20:47
---
---@type ActivityContentBase
local base = UIBaseContainer
---@class DispatchTask : ActivityContentBase
local DispatchTask = BaseClass("DispatchTask",base)
local Localization = CS.GameEntry.Localization
local DispatchTaskItem = require "UI.UIActivityCenterTable.Component.DispatchTask.DispatchTaskItem"
local DispatchTaskStarTip = require "UI.UIActivityCenterTable.Component.DispatchTask.DispatchTaskStarTip"

local intro_btn_path = "rect/ActivityTopGo/IntroBtn"
local txt_act_name_path = "rect/ActivityTopGo/Txt_ActName"
local txt_act_extra_path = "rect/ActivityTopGo/Txt_ActExtra"
local des_ass_path = "rect/ActivityTopGo/Content1/Txt_AssTip"
local des_plu_path ="rect/ActivityTopGo/Content2/Txt_PluTip"
local txt_ass_num_path = "rect/ActivityTopGo/Content1/Txt_AssNum"
local txt_plu_num_path = "rect/ActivityTopGo/Content2/Txt_PluNum"
local toggle1_path = "rect/ActivityTopGo/ToggleGroup/Toggle1"
local toggle2_path = "rect/ActivityTopGo/ToggleGroup/Toggle2"
local scroll_view_path = "rect/CenterGo/ScrollView"
local no_alliance_go_path = "rect/CenterGo/NoAllianceGo"
local empty_go_path = "rect/CenterGo/EmptyGo"
local no_alliance_txt_path = "rect/CenterGo/NoAllianceGo/Txt_ActExtra1"
local join_btn_path = "rect/CenterGo/NoAllianceGo/joinBtn"
local join_txt_path = "rect/CenterGo/NoAllianceGo/joinBtn/1btnTxt"
local red_point_path = "rect/ActivityTopGo/ToggleGroup/Toggle1/RedPointNum"
local red_num_path = "rect/ActivityTopGo/ToggleGroup/Toggle1/RedPointNum/Text"
local red_point_2_path = "rect/ActivityTopGo/ToggleGroup/Toggle2/RedPointNum2"
local red_num_2_path = "rect/ActivityTopGo/ToggleGroup/Toggle2/RedPointNum2/Text2"
local refresh_btn_path = "rect/CenterGo/refreshBtn"
local refresh_btn_txt_path = "rect/CenterGo/refreshBtn/offset/GoText"
local refresh_btn_item_count_path = "rect/CenterGo/refreshBtn/offset/item/itemCount"
local refresh_btn_item_icon_path = "rect/CenterGo/refreshBtn/offset/item/itemCount/itemIcon"
local refresh_btn_goods_icon_path = "rect/CenterGo/refreshBtn/offset/item/itemCount/goodsIcon"

local record_btn_root_path = "rect/ActivityTopGo/BtnList/recordBtn"
local record_btn_path = "rect/ActivityTopGo/BtnList/recordBtn/logBtn"
local record_txt_path = "rect/ActivityTopGo/BtnList/recordBtn/logBtn/logBtnTxt"
local star_btn_path = "rect/ActivityTopGo/BtnList/starBtn/starBtnClickArea"
local star_btn_root_path = "rect/ActivityTopGo/BtnList/starBtn"
local star_btn_txt_path = "rect/ActivityTopGo/BtnList/starBtn/btnTxt"
local star1_path = "rect/ActivityTopGo/BtnList/starBtn/starList/star1"
local star2_path = "rect/ActivityTopGo/BtnList/starBtn/starList/star2"
local star3_path = "rect/ActivityTopGo/BtnList/starBtn/starList/star3"
local star4_path = "rect/ActivityTopGo/BtnList/starBtn/starList/star4"
local star5_path = "rect/ActivityTopGo/BtnList/starBtn/starList/star5"

local tip_root_path = "rect/ActivityTopGo/BtnList/starBtn/btnTxt/TipRoot"
local star_btn_effect_path = "rect/ActivityTopGo/BtnList/starBtn/effect"

function DispatchTask:OnCreate()
    base.OnCreate(self)
    self:ComponentDefine()
end

function DispatchTask:ComponentDefine()
    self.tip_root = self:AddComponent(DispatchTaskStarTip, tip_root_path)
    self.center_go = self:AddComponent(UIBaseContainer,"rect/CenterGo")
    self.refresh_btn_bg = self:AddComponent(UIImage, refresh_btn_path)
    self.refresh_btn_item_icon = self:AddComponent(UIImage, refresh_btn_item_icon_path)
    self.refresh_btn_goods_icon = self:AddComponent(UIImage, refresh_btn_goods_icon_path)
    self.refresh_btn_item_count = self:AddComponent(UITextMeshProUGUIEx, refresh_btn_item_count_path)
    self.refresh_btn = self:AddComponent(UIButton, refresh_btn_path)
    self.refresh_btn:SetOnClick(function()
        CS.GameEntry.Sound:PlayEffect(SoundAssets.Music_Effect_Button)
        self:ClickRefreshBtn()
    end)
    self.refresh_btn_txt = self:AddComponent(UITextMeshProUGUIEx,refresh_btn_txt_path)
    self.refresh_btn_txt:SetLocalText(110028)
    self.intro_btn = self:AddComponent(UIButton, intro_btn_path)
    self.intro_btn:SetOnClick(function()
        CS.GameEntry.Sound:PlayEffect(SoundAssets.Music_Effect_Button)
        self:ClickTip()
    end)
    self.txt_act_name = self:AddComponent(UITextMeshProUGUIEx, txt_act_name_path)
    self.txt_act_extra = self:AddComponent(UITextMeshProUGUIEx, txt_act_extra_path)
    self.des_ass = self:AddComponent(UITextMeshProUGUIEx,des_ass_path)
    self.des_ass:SetLocalText(461012)
    self.des_plu = self:AddComponent(UITextMeshProUGUIEx,des_plu_path)
    self.des_plu:SetLocalText(461013)
    self.txt_ass_num = self:AddComponent(UITextMeshProUGUIEx, txt_ass_num_path)
    self.txt_plu_num = self:AddComponent(UITextMeshProUGUIEx, txt_plu_num_path)
    self.toggle1 = self:AddComponent(UIToggle, toggle1_path)
    self.toggle1.selectName = self.toggle1:AddComponent(UITextMeshProUGUIEx,"checkText")
    self.toggle1.unselectName = self.toggle1:AddComponent(UITextMeshProUGUIEx,"text")
    self.toggle1.arrow = self.toggle1:AddComponent(UIBaseContainer, "Background/Checkmark/arrow")
    self.toggle1.selectName:SetLocalText(461010)
    self.toggle1.unselectName:SetLocalText(461010)
    self.toggle1:SetIsOn(true)
    self.toggle1:SetOnValueChanged(function(tf)
        if tf then
            self:ToggleControlBorS(1)
        end
    end)
    self.toggle2 = self:AddComponent(UIToggle, toggle2_path)
    self.toggle2.selectName = self.toggle2:AddComponent(UITextMeshProUGUIEx,"checkText")
    self.toggle2.unselectName = self.toggle2:AddComponent(UITextMeshProUGUIEx,"text")
    self.toggle2.arrow = self.toggle2:AddComponent(UIBaseContainer, "Background/Checkmark/arrow")
    self.toggle2.selectName:SetLocalText(461011)
    self.toggle2.unselectName:SetLocalText(461011)
    self.toggle2:SetIsOn(false)
    self.toggle2:SetOnValueChanged(function(tf)
        if tf then
            self:ToggleControlBorS(2)
        end
    end)
    self.scroll_view = self:AddComponent(UIScrollView, scroll_view_path)
    self.scroll_view:SetOnItemMoveIn(function(itemObj, index)
        self:OnItemMoveIn(itemObj, index)
    end)
    self.scroll_view:SetOnItemMoveOut(function(itemObj, index)
        self:OnItemMoveOut(itemObj, index)
    end)
    self.record_btn_root = self:AddComponent(UIBaseComponent, record_btn_root_path)
    self.record_btn = self:AddComponent(UIButton, record_btn_path)
    self.record_btn:SetOnClick(function()
        CS.GameEntry.Sound:PlayEffect(SoundAssets.Music_Effect_Button)
        self:ClickRecordBtn()
    end)
    self.record_txt = self:AddComponent(UITextMeshProUGUIEx,record_txt_path)
    self.record_txt:SetLocalText(390061)
    self.star_btn = self:AddComponent(UIButton, star_btn_path)
    self.star_btn_effect = self:AddComponent(UICanvasGroup, star_btn_effect_path)
    self.star_btn_root = self:AddComponent(UIBaseComponent, star_btn_root_path)
    self.star_btn_txt = self:AddComponent(UITextMeshProUGUIEx,star_btn_txt_path)
    self.star_btn_txt:SetLocalText(461018)
    self.no_alliance_go = self:AddComponent(UIBaseContainer, no_alliance_go_path)
    self.empty_go = self:AddComponent(UIBaseContainer, empty_go_path)
    self.empty_txt = self:AddComponent(UITextMeshProUGUIEx, "rect/CenterGo/EmptyGo/Txt_Empty")
    self.no_alliance_txt = self:AddComponent(UITextMeshProUGUIEx,no_alliance_txt_path)
    self.no_alliance_txt:SetLocalText(390536)
    self.join_btn = self:AddComponent(UIButton, join_btn_path)
    self.join_btn:SetOnClick(function()
        CS.GameEntry.Sound:PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnJoinAllianceClick()
    end)
    self.join_txt = self:AddComponent(UITextMeshProUGUIEx,join_txt_path)
    self.join_txt:SetLocalText(111205)
    self.red_point = self:AddComponent(UIImage, red_point_path)
    self.red_num = self:AddComponent(UITextMeshProUGUIEx, red_num_path)

    self.red_point_2 = self:AddComponent(UIImage, red_point_2_path)
    self.red_num_2 = self:AddComponent(UITextMeshProUGUIEx, red_num_2_path)
    self.star1 = self:AddComponent(UIImage, star1_path)
    self.star2 = self:AddComponent(UIImage, star2_path)
    self.star3 = self:AddComponent(UIImage, star3_path)
    self.star4 = self:AddComponent(UIImage, star4_path)
    self.star5 = self:AddComponent(UIImage, star5_path)

    -- 处理星级的按钮和效果
    local starLevel = DataCenter.ActDispatchTaskDataManager:GetCurrentStarLevel()
    self.star_btn_effect_tick = nil
    self.star_btn_effect:SetActive(false)
    if starLevel < 1 then
        self.star_btn_root:SetActive(false)
    else
        self.star_btn:SetOnClick(function()
            CS.GameEntry.Sound:PlayEffect(SoundAssets.Music_Effect_Button)
            self:ClickStarBtn()
        end)
        self.star1:SetActive(starLevel >= 1)
        self.star2:SetActive(starLevel >= 2)
        self.star3:SetActive(starLevel >= 3)
        self.star4:SetActive(starLevel >= 4)
        self.star5:SetActive(starLevel >= 5)
        if starLevel < 5 then
            self.star_btn_effect_tick = 0
            self.star_btn_effect:SetActive(true)
        end
    end

    self.targetJumpUuid = -1
    self:UpdateRefreshButton()
    self.playSound = false
end

function DispatchTask:UpdateRefreshButton()
    local coinCount, itemId, itemCount = DataCenter.ActDispatchTaskDataManager:GetTaskRefreshSetting()
    if coinCount > 0 or itemCount > 0 then
        local item = DataCenter.ItemData:GetItemById(itemId)
        self.refresh_btn:SetActive(true)
        if item and item.count and item.count >= itemCount then
            self.refresh_btn_item_icon:SetActive(true)
            self.refresh_btn_goods_icon:SetActive(false)
            -- （已拥有/消耗）
            self.refresh_btn_item_count:SetText( tostring(item.count).. '/' .. tostring(itemCount) )
            --self.refresh_btn:LoadSprite('Assets/Main/Sprites/UI/LWCommon/Sprite/cfm_tongyong_anniu_3.png')
            self.useItemRefresh = true
            self.useGoodRefresh = false
        else
            self.refresh_btn_item_icon:SetActive(false)
            self.refresh_btn_goods_icon:SetActive(true)
            if LuaEntry.Player.gold < coinCount then
                -- 变红
                self.refresh_btn_item_count:SetText("<color=#E84242>" .. coinCount .. "</color>")
            else
                self.refresh_btn_item_count:SetText(coinCount)
            end
            --self.refresh_btn:LoadSprite('Assets/Main/Sprites/UI/LWCommon/Sprite/cfm_tongyong_anniu_4.png')
            self.useItemRefresh = false
            self.useGoodRefresh = true
        end
    else
        self.refresh_btn:SetActive(false)
    end
end

function DispatchTask:ComponentDestroy()
    self.txt_act_name = nil
    self.txt_act_extra = nil
    self.txt_ass_num = nil
    self.txt_plu_num = nil
    self.toggle1 = nil
    self.toggle2 = nil
    self.scroll_view = nil
    self.record_btn = nil
    self.no_alliance_go = nil
    self.empty_go = nil
    self.join_btn = nil
    self.red_point = nil
    self.red_num = nil
    self.playSound = nil

    self.targetJumpUuid = nil
end

function DispatchTask:OnDestroy()
    self:ClearScroll()
    self:ComponentDestroy()
    base.OnDestroy(self)
end

function DispatchTask:OnEnable()
    base.OnEnable(self)
end

function DispatchTask:OnDisable()
    base.OnDisable(self)
end

function DispatchTask:OnAddListener()
    base.OnAddListener(self)
    self:AddUIListener(EventId.DispatchTaskTodayNumUpdate, self.RefreshTodayNum)
    self:AddUIListener(EventId.DispatchTaskUpdateSingle, self.RefreshSingleTask)
    self:AddUIListener(EventId.DispatchTaskUpdateAlliance, self.RefreshAllianceTask)
    self:AddUIListener(EventId.DispatchGetRealPoint, self.DoGetRealPoint)
    self:AddUIListener(EventId.RefreshItems, self.UpdateRefreshButton)
end

function DispatchTask:OnRemoveListener()
    self:RemoveUIListener(EventId.DispatchTaskTodayNumUpdate, self.RefreshTodayNum)
    self:RemoveUIListener(EventId.DispatchTaskUpdateSingle, self.RefreshSingleTask)
    self:RemoveUIListener(EventId.DispatchTaskUpdateAlliance, self.RefreshAllianceTask)
    self:RemoveUIListener(EventId.DispatchGetRealPoint, self.DoGetRealPoint)
    self:RemoveUIListener(EventId.RefreshItems, self.UpdateRefreshButton)
    base.OnRemoveListener(self)
end

function DispatchTask:Update1000MS()
    if self.star_btn_effect_tick ~= nil then
        self.star_btn_effect_tick = self.star_btn_effect_tick + 1
        if toInt(self.star_btn_effect_tick % 5) == 4 then
            -- 每个周期翻转一次显示状态
            local alpha = self.star_btn_effect:GetAlpha()
            if alpha < 0.01 then
                self.star_btn_effect:FadeIn(1)
            else
                self.star_btn_effect:FadeOut(1)
            end

        end
    end
end

function DispatchTask:SetData(activityId)
    self.activityId = activityId
    if not self.activityId then
        return
    end
    self.playSound = false
    DataCenter.ActDispatchTaskDataManager:SendTaskLogRequest()
    DataCenter.ActivityListDataManager:SetActivityVisitedEndTime(tostring(self.activityId))
    self.data = DataCenter.ActivityListDataManager:GetActivityDataById(activityId)
    DataCenter.ActDispatchTaskDataManager:GetAllSingleTasksFromServer()
    DataCenter.ActDispatchTaskDataManager:GetAllAllianceTasksFromServer()
    self.txt_act_name:SetLocalText(self.data.name)
    self.txt_act_extra:SetLocalText(461008)

    if self.toggle1:GetIsOn() then

        self:ToggleControlBorS(1)
    else
        self:ToggleControlBorS(2)
    end
end

function DispatchTask:ClickTip()
    if self.data ~= nil and self.data.story ~= nil then
        UIUtil.ShowIntro(Localization:GetString(self.data.name), "", Localization:GetString("461009"))
    end
end

function DispatchTask:ClickRecordBtn()
    -- 记录面板
    UIManager:GetInstance():OpenWindow(UIWindowNames.UILWDispatchTaskLog, {anim=true,isBlur = true})
end

function DispatchTask:ClickStarBtn()
    -- 星级面板
    self.tip_root:ShowIt()
end

function DispatchTask:DoTaskRefresh()
    if self.useGoodRefresh then
        UIUtil.ShowUseDiamondConfirm(TodayNoSecondConfirmType.RefreshDispatchTask,Localization:GetString('302372'), 2, GameDialogDefine.CONFIRM, GameDialogDefine.CANCEL,function()
            -- | 字段     | 是否必填 | 类型 | 解释                  | 备注  |
            --| -------- | -------- | ---- | -------------------- | ----- |
            --| costType | 否       | int  | 0 使用道具，1 使用钻石 | 默认 0 |
            SFSNetwork.SendMessage(MsgDefines.DispatchTaskRefresh, 1)
        end)
    else
        SFSNetwork.SendMessage(MsgDefines.DispatchTaskRefresh, 0)
    end
end

function DispatchTask:ClickRefreshBtn()
    if self.showDatalist then
        local canNotRefresh = false
        for _, v in ipairs(self.showDatalist) do
            if v.rewarded ~= 1 then
                canNotRefresh = true
                break
            end
        end
        if canNotRefresh  == false then
            UIUtil.ShowTipsId(461054) 
        end
    end
    -- 刷新按钮
    if self.useGoodRefresh then
        local coinCount, itemId, itemCount = DataCenter.ActDispatchTaskDataManager:GetTaskRefreshSetting()
        if LuaEntry.Player.gold < coinCount then
            UIUtil.ShowTipsId("E100001")
            return
        end
    end
    local hasBestTask = false
    if self.showDatalist then
        for _, v in ipairs(self.showDatalist) do
            if v.completionTime == 0 and v.cfg.color == 5 then
                hasBestTask = true
                break
            end
        end
    end
    -- 如果玩家有未开始派遣的橙色任务，会弹出确认框让玩家二次确认
    if hasBestTask then
        UIUtil.ShowUseDiamondConfirm(TodayNoSecondConfirmType.RefreshBestDispatchTask,Localization:GetString('461059'), 2, GameDialogDefine.CONFIRM, GameDialogDefine.CANCEL,function()
            self:DoTaskRefresh()
        end)
    else
        self:DoTaskRefresh()
    end
end

function DispatchTask:ClearScroll()
    self.scroll_view:ClearCells()
    self.scroll_view:RemoveComponents(DispatchTaskItem)
    self.showDatalist = {}
end

function DispatchTask:OnItemMoveIn(itemObj, index)
    itemObj.name = tostring(index)
    ---@type DispatchTaskItem
    local cellItem = self.scroll_view:AddComponent(DispatchTaskItem, itemObj)
    cellItem:SetData(self.showDatalist[index], self.tab)
end

function DispatchTask:OnItemMoveOut(itemObj, index)
    self.scroll_view:RemoveComponent(itemObj.name, DispatchTaskItem)
end

function DispatchTask:ToggleControlBorS(tab)

    if self.playSound then
        SoundUtil.PlayEffect("Effect_common_switch_2")
    else
        self.playSound = true
    end
    --获取对应数据 刷新列表
    self.toggle1.selectName:SetActive(self.toggle1:GetIsOn())
    self.toggle2.selectName:SetActive(self.toggle2:GetIsOn())
    self.toggle1.unselectName:SetActive(self.toggle1:GetIsOn()==false)
    self.toggle2.unselectName:SetActive(self.toggle2:GetIsOn()==false)
    self.toggle1.arrow:SetActive(self.toggle1:GetIsOn())
    self.toggle2.arrow:SetActive(self.toggle2:GetIsOn())
    self.tab = tab
    --if self.tab ==1 then
    --    DataCenter.ActDispatchTaskDataManager:GetAllSingleTasksFromServer()
    --else
    --    DataCenter.ActDispatchTaskDataManager:GetAllAllianceTasksFromServer()
    --end
    self:RefreshAll()
end

function DispatchTask:RefreshSingleTask()
    if self.tab == 1 then
        self:RefreshAll()
    else
        self:RefreshRedPoint()
    end
end

function DispatchTask:RefreshAllianceTask()
    if self.tab == 2 then
        self:RefreshAll()
    else
        self:RefreshAllianceRedPoint()
    end
end

function DispatchTask:RefreshAll()
    self:ClearScroll()
    self:UpdateRefreshButton()
    --self.record_btn_root:SetActive(self.tab == 1)
    --self.star_btn_root:SetActive(self.tab == 1)
    self.refresh_btn:SetActive(self.tab == 1)

    self:RefreshTodayNum()
    self:RefreshRedPoint()
    self:RefreshAllianceRedPoint()
    -- 判断是否在联盟
    if self.tab == 2 and not LuaEntry.Player:IsInAlliance() then
        self.no_alliance_go:SetActive(true)
        self.scroll_view:SetActive(false)
        return
    end

    self.no_alliance_go:SetActive(false)
    self.scroll_view:SetActive(true)
    CS.UnityEngine.UI.LayoutRebuilder.ForceRebuildLayoutImmediate(self.center_go.rectTransform)
    if self.tab == 1 then
        self.showDatalist = DataCenter.ActDispatchTaskDataManager:GetAllSingleTasks()
        self.empty_txt:SetLocalText(132249)
    else
        self.showDatalist = DataCenter.ActDispatchTaskDataManager:GetAllAllianceTasks()
        self.empty_txt:SetLocalText(461063)
    end
    if #self.showDatalist > 0 then
        self.empty_go:SetActive(false)
        self.scroll_view:SetTotalCount(#self.showDatalist)
        self.scroll_view:RefillCells()
    else
        self.empty_go:SetActive(true)
        self.scroll_view:SetActive(false)
    end
end

function DispatchTask:RefreshTodayNum()
    local mgr = DataCenter.ActDispatchTaskDataManager
    local aid_count = mgr:GetDispatchSetting("aid_count")
    local steal_count = mgr:GetDispatchSetting("steal_count")
    
    local assiNum = mgr:GetTodayAssistNum()
    local assiStr = assiNum
    if aid_count>assiNum then
        assiStr = "<color=#008B00>" .. assiNum .. "</color>"
    end

    local stealNum = mgr:GetTodayStealNum()
    local stealStr = stealNum
    if steal_count>stealNum then
        stealStr = "<color=#008B00>" .. stealNum .. "</color>"
    end
    
    self.txt_ass_num:SetLocalText(150033, assiStr, aid_count)
    self.txt_plu_num:SetLocalText(150033, stealStr, steal_count)
end

--只有个人有
function DispatchTask:RefreshRedPoint()
    DataCenter.ActDispatchTaskDataManager:SetActViewOpened(true)
    local redpointNum = DataCenter.ActDispatchTaskDataManager:GetSingleTaskRedCount(true)
    self.red_point:SetActive(redpointNum > 0)
    if redpointNum > 0 then
        self.red_num:SetText(tostring(redpointNum))
    end
end

function DispatchTask:RefreshAllianceRedPoint()
    local redpointNum = DataCenter.ActDispatchTaskDataManager:GetAllianceTaskRedCount()
    self.red_point_2:SetActive(redpointNum > 0)
    if redpointNum > 0 then
        self.red_num_2:SetText(tostring(redpointNum))
    end
end
function DispatchTask:OnJoinAllianceClick()
    -- 关闭所有面板，跳转加联盟
    self.view.ctrl:CloseSelf()
    if LuaEntry.Player:IsInAlliance() ==false then
        --if LuaEntry.Player.isFirstJoin == FirstJoinAllianceType.Yes then
        --    GoToUtil.GotoOpenView(UIWindowNames.UIAllianceIntro,{ anim = true,isBlur = true})
        --else
            UIManager:GetInstance():OpenWindow(UIWindowNames.UIJoinOrCreateAlliance,1)
        --end
    end
    
    -- jinpeng: 2023-5-8 新规则 只要是首次入盟的玩家，点击联盟建筑上的联盟按钮，或者主界面的联盟按钮，都会弹出UILWAllianceFirstJoinView的界面
    --if LuaEntry.Player:IsFirstJoinAlliance() == true then
    --    UIManager:GetInstance():OpenWindow(UIWindowNames.UILWAllianceFirstJoin, { anim = true })
    --    return
    --end
    --local params = {
    --    guide = false,
    --}
    --UIManager:GetInstance():OpenWindow(UIWindowNames.UILWAlCreateJoin, {anim=true}, params)
end

function DispatchTask:DoGetRealPoint(uuid)
    for k,v in pairs(self.showDatalist) do
        if v.uuid == uuid then
            if v.pointId > 0 then
                local pointId = v.pointId
                GoToUtil.CloseAllWindows()
                GoToUtil.MoveToWorldPointAndOpen(pointId, nil, nil)
                --GoToUtil.GotoWorldPos(SceneUtils.TileIndexToWorld(v.pointId, ForceChangeScene.World))
            end
            break
        end
    end
end

return DispatchTask