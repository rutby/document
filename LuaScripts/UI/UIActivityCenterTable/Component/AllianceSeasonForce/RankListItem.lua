---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 
--- DateTime: 
---
local RankListItem = BaseClass("RankListItem",UIBaseContainer)
local AllianceFlagItem = require "UI.UIAlliance.UIAllianceFlag.Component.AllianceFlagItem"
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

local CampStr = {111064,111063}
local function OnCreate(self)
	base.OnCreate(self)
	self._allianceName_txt = self:AddComponent(UIText,"Txt_AllianceName")
	self._allianceLeader_txt = self:AddComponent(UIText,"Txt_AllianceLeader")

	self._country_img = self:AddComponent(UIImage,"Img_Country")
	self.num_txt = self:AddComponent(UIText,"numTxt")
	
	self._sFiveCamp_txt = self:AddComponent(UIText,"Txt_SFiveCamp")

	self.first_flag = self:AddComponent(UIBaseContainer,"firstImg")
	self.second_flag = self:AddComponent(UIBaseContainer,"secondImg")
	self.third_flag = self:AddComponent(UIBaseContainer,"thirdImg")

	self._seasonForce_txt = self:AddComponent(UIText,"Txt_SeasonForce")

	self._citys_txt = self:AddComponent(UIText,"Txt_Citys")

	self.allianceFlag = self:AddComponent(AllianceFlagItem,"allianceFlag/AllianceFlag")

	self.player_flag = self:AddComponent(UIBaseContainer,"playerFlag")
	self.player_img =self:AddComponent(UIPlayerHead,"playerFlag/UIPlayerHead/HeadIcon")
	self.playerHeadFgN = self:AddComponent(UIImage, "playerFlag/UIPlayerHead/Foreground")

	self.btn = self:AddComponent(UIButton, "Button")
	self.btn:SetOnClick(function()
		SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
		self:OnClick()
	end)
end

local function SetItemShow(self, data,index,isAlliance,rankType)
	self.data = data
	self.isAlliance = isAlliance
	self._sFiveCamp_txt:SetActive(false)
	local seasonId = DataCenter.SeasonDataManager:GetSeasonId()
	if isAlliance then
		self.allianceFlag:SetActive(true)
		self.player_flag:SetActive(false)
		self._seasonForce_txt:SetActive(true)
		self._allianceLeader_txt:SetLocalText(390082,self.data.leader)
		self.allianceFlag:SetData(self.data.icon)
		if seasonId == 1 then
			self._seasonForce_txt:SetText(self.data.force)
			local AlCities = DataCenter.WorldAllianceCityDataManager:GetCitiesByAlId(self.data.uid)
			self._citys_txt:SetText(table.count(AlCities))
			self._allianceName_txt:SetLocalText(311026,self.data.abbr,self.data.allianceName)
		elseif seasonId >= 2 and seasonId < 5 then
			self._seasonForce_txt:SetText(string.GetFormattedSeperatorNum(self.data.power or 0))
			local name = Localization:GetString("311026",self.data.abbr,self.data.allianceName)
			self._allianceName_txt:SetLocalText(372761,data.serverId,name)
			self._citys_txt:SetText(string.GetFormattedSeperatorNum(self.data.score or 0))
		elseif seasonId >= 5 then
			self._citys_txt:SetText(string.GetFormattedSeperatorNum(self.data.force or 0))
			self._seasonForce_txt:SetText(string.GetFormattedSeperatorNum(self.data.power or 0))
			local name = Localization:GetString("311026",self.data.abbr,self.data.allianceName)
			self._allianceName_txt:SetLocalText(372761,data.srcServer,name)
			self._sFiveCamp_txt:SetActive(true)
			self._sFiveCamp_txt:SetLocalText(CampStr[self.data.camp])
		end
	else
		self.allianceFlag:SetActive(false)
		self.player_flag:SetActive(true)
		self._seasonForce_txt:SetActive(false)
		self.player_img:SetData(self.data.uid, self.data.pic, self.data.picVer)

		local headBgImg = DataCenter.DecorationDataManager:GetHeadFrame(self.data.headSkinId, self.data.headSkinET)
		if not string.IsNullOrEmpty(headBgImg) then
			self.playerHeadFgN:SetActive(true)
			self.playerHeadFgN:LoadSprite(headBgImg)
		else
			self.playerHeadFgN:SetActive(false)
		end
		
		if rankType == 3 or rankType == 4 then
			if self.data.abbr and self.data.abbr ~= "" then
				self._allianceLeader_txt:SetLocalText(311026,self.data.abbr,self.data.allianceName)
			else
				self._allianceLeader_txt:SetText("")
			end
			self._citys_txt:SetText(self.data.score)
			self._allianceName_txt:SetLocalText(372761,self.data.serverId,self.data.name)
		else
			self._allianceName_txt:SetText(self.data.name)
			if self.data.allianceAbbr then
				self._allianceLeader_txt:SetLocalText(311026,self.data.allianceAbbr,self.data.allianceName)
			else
				self._allianceLeader_txt:SetText("")
			end

			self._citys_txt:SetText(self.data.force)
		end
		if seasonId == 5 then
			self._sFiveCamp_txt:SetActive(true)
			if self.data.allianceId then
				local camp = DataCenter.GloryManager:GetCampByAllianceId(self.data.allianceId)
				if camp ~= 0 then
					self._sFiveCamp_txt:SetLocalText(CampStr[camp])
				else
					self._sFiveCamp_txt:SetText("")
				end
			end
		end
	end


	self.first_flag:SetActive(index ==1)
	self.third_flag:SetActive(index ==3)
	self.second_flag:SetActive(index ==2)
	self.num_txt:SetText(index)
	if index>3 then
		self.num_txt:SetActive(true)
	else
		self.num_txt:SetActive(false)
	end

	if LuaEntry.Player:IsHideCountryFlag() or seasonId == 5 then
		self._country_img:SetActive(false)
	else
		self._country_img:SetActive(true)
		local countryConfig = DataCenter.NationTemplateManager:GetNationTemplate(DefaultNation)
		if self.data.country ~= "" then
			countryConfig = DataCenter.NationTemplateManager:GetNationTemplate(self.data.country)
		end
		self._country_img:LoadSprite(countryConfig:GetNationFlagPath())
	end
end

local function OnClick(self)
	if self.isAlliance then
		local selfAllianceId = ""
		local data = DataCenter.AllianceBaseDataManager:GetAllianceBaseData()
		if data ~=nil then
			selfAllianceId = data.uid
		end
		local allianceId = self.data.uid or self.data.allianceId
		if selfAllianceId ~= allianceId then
			UIManager:GetInstance():OpenWindow(UIWindowNames.UIAllianceDetail,{ anim = true, isBlur = true}, self.data.allianceName, allianceId)
		else
			UIManager:GetInstance():OpenWindow(UIWindowNames.UIAllianceMainTable,{ anim = true})
		end
	else
		if self.data.uid ~= LuaEntry.Player.uid then
			UIManager:GetInstance():OpenWindow(UIWindowNames.UIOtherPlayerInfo,self.data.uid)
		else
			UIManager:GetInstance():OpenWindow(UIWindowNames.UIPlayerInfo,LuaEntry.Player.uid)
		end
	end
end
local function OnDestroy(self)
	self._name_txt= nil
	self.second_txt = nil
	self.power_txt = nil
	self.num_txt = nil

	self.first_flag = nil
	self.second_flag = nil
	self.third_flag = nil

	self.btn = nil
	base.OnDestroy(self)
end
RankListItem.OnCreate = OnCreate
RankListItem.SetItemShow = SetItemShow
RankListItem.OnClick = OnClick
RankListItem.OnDestroy =OnDestroy
return RankListItem