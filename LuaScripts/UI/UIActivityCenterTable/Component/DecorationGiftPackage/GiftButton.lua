---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2023/2/7 12:19
---

local GiftButton = BaseClass("GiftButton",UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local UIGiftPackagePoint = require "UI.UIGiftPackage.Component.UIGiftPackagePoint"

local btn_path = "Btn"
local num_text_path = "Btn/Btn_Text"
local money_text_path = "Btn/Btn_Text_Money"
local score_path = "Btn/UIGiftPackagePoint"

local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
end

local function ComponentDefine(self)
    self.btn = self:AddComponent(UIButton, btn_path)
    self.num_text = self:AddComponent(UIText, num_text_path)
    self.money_text = self:AddComponent(UIText, money_text_path)
    self.score = self:AddComponent(UIGiftPackagePoint, score_path)
    self.btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnClick()
    end)
end

local function ComponentDestroy(self)

end

local function OnDestroy(self)
    self:ComponentDestroy()
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function OnAddListener(self)
    base.OnAddListener(self)
    self:AddUIListener(EventId.UpdateGiftPackData, self.RefreshView)
end

local function OnRemoveListener(self)
    self:RemoveUIListener(EventId.UpdateGiftPackData, self.RefreshView)
    base.OnRemoveListener(self)
end

local function OnClick(self)
    local packageInfo = GiftPackageData.get(self.giftId)
    if packageInfo then
        DataCenter.PayManager:CallPayment(packageInfo, UIWindowNames.UIResourceBag)
    end
end

local function SetData(self, data, num)
    self.giftId = data
    self.num = num or 1
    self:RefreshView()
end

local function RefreshView(self)
    local packageInfo = GiftPackageData.get(self.giftId)
    if packageInfo then
        self:SetActive(true)
        self.num_text:SetLocalText(320765, self.num)
        local price = DataCenter.PayManager:GetDollarText(packageInfo:getPrice(), packageInfo:getProductID())
        self.money_text:SetText(price)
        --积分
        self.score:RefreshPoint(packageInfo)
    else
        self:SetActive(false)
    end
end

GiftButton.OnCreate = OnCreate
GiftButton.OnDestroy = OnDestroy
GiftButton.OnEnable = OnEnable
GiftButton.OnDisable = OnDisable
GiftButton.ComponentDefine =ComponentDefine
GiftButton.ComponentDestroy =ComponentDestroy
GiftButton.OnAddListener =OnAddListener
GiftButton.OnRemoveListener =OnRemoveListener
GiftButton.SetData = SetData
GiftButton.RefreshView = RefreshView
GiftButton.OnClick = OnClick

return GiftButton