---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 
--- DateTime: 
---
local RankListItem = BaseClass("RankListItem",UIBaseContainer)
local AllianceFlagItem = require "UI.UIAlliance.UIAllianceFlag.Component.AllianceFlagItem"
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local function OnCreate(self)
    base.OnCreate(self)
    self._allianceName_txt = self:AddComponent(UITextMeshProUGUI,"Txt_AllianceName")
    self._allianceLeader_txt = self:AddComponent(UITextMeshProUGUI,"Txt_AllianceLeader")

	self._country_img = self:AddComponent(UIImage,"Img_Country")
    self.num_txt = self:AddComponent(UITextMeshProUGUI,"numTxt")
    
    self.first_flag = self:AddComponent(UIBaseContainer,"firstImg")
    self.second_flag = self:AddComponent(UIBaseContainer,"secondImg")
    self.third_flag = self:AddComponent(UIBaseContainer,"thirdImg")
	
	self._time_txt = self:AddComponent(UITextMeshProUGUI,"Txt_Time")
	
	self._citys_txt = self:AddComponent(UITextMeshProUGUI,"Txt_Citys")

	self.allianceFlag = self:AddComponent(AllianceFlagItem,"allianceFlag/AllianceFlag")
	
	self.player_flag = self:AddComponent(UIBaseContainer,"playerFlag")
	self.player_img =self:AddComponent(UIPlayerHead,"playerFlag/UIPlayerHead/HeadIcon")
	self.playerHeadFg = self:AddComponent(UIImage, "playerFlag/UIPlayerHead/Foreground")
    
    self.btn = self:AddComponent(UIButton, "Button")
    self.btn:SetOnClick(function()  
SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnClick()
    end)
end

local function SetItemShow(self, data,index,isAlliance)
    self.data = data
	self.isAlliance = isAlliance

	self.allianceFlag:SetActive(true)
	self.player_flag:SetActive(false)
	self._allianceName_txt:SetLocalText(311026,self.data.abbr,self.data.alliancename)
	self._allianceLeader_txt:SetLocalText(390082,self.data.leader)
	self.allianceFlag:SetData(self.data.icon)
	self._citys_txt:SetText(string.GetFormattedSeperatorNum(self.data.score or 0))
	local name = Localization:GetString("311026",self.data.abbr,self.data.alliancename)
	self._allianceName_txt:SetLocalText(372761,data.serverId,name)
    self.first_flag:SetActive(index ==1)
    self.third_flag:SetActive(index ==3)
    self.second_flag:SetActive(index ==2)
    self.num_txt:SetText(index)
	if index>3 then
		self.num_txt:SetActive(true)
	else
		self.num_txt:SetActive(false)
	end

	self._time_txt:SetText(UITimeManager:GetInstance():TimeStampToTimeForServerMinute(self.data.reachTime))
	
	if LuaEntry.Player:IsHideCountryFlag() then
		self._country_img:SetActive(false)
	else
		self._country_img:SetActive(true)
		local countryConfig = DataCenter.NationTemplateManager:GetNationTemplate(DefaultNation)
		if self.data.country ~= "" then
			countryConfig = DataCenter.NationTemplateManager:GetNationTemplate(self.data.country)
		end
		self._country_img:LoadSprite(countryConfig:GetNationFlagPath())
	end
end

local function OnClick(self)
	if self.isAlliance then
		local selfAllianceId = ""
		local data = DataCenter.AllianceBaseDataManager:GetAllianceBaseData()
		if data ~=nil then
			selfAllianceId = data.uid
		end
		local allianceId = self.data.uid or self.data.allianceId
		if selfAllianceId ~= allianceId then
			UIManager:GetInstance():OpenWindow(UIWindowNames.UIAllianceDetail,{ anim = true, isBlur = true}, self.data.allianceName, allianceId)
		else
			UIManager:GetInstance():OpenWindow(UIWindowNames.UIAllianceMainTable,{ anim = true})
		end
	else
		if self.data.uid ~= LuaEntry.Player.uid then
			UIManager:GetInstance():OpenWindow(UIWindowNames.UIOtherPlayerInfo,self.data.uid)
		else
			UIManager:GetInstance():OpenWindow(UIWindowNames.UIPlayerInfo,LuaEntry.Player.uid)
		end
	end
end
local function OnDestroy(self)
	self._name_txt= nil
	self.second_txt = nil
	self.power_txt = nil
	self.num_txt = nil

	self.first_flag = nil
	self.second_flag = nil
	self.third_flag = nil
	
	self.btn = nil
    base.OnDestroy(self)
end
RankListItem.OnCreate = OnCreate
RankListItem.SetItemShow = SetItemShow
RankListItem.OnClick = OnClick
RankListItem.OnDestroy =OnDestroy
return RankListItem