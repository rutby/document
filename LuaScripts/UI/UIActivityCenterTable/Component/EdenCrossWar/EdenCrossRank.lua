---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/10/30 11:44
---
local EdenCrossRank = BaseClass("EdenCrossRank", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local EdenCrossRankItem = require "UI.UIActivityCenterTable.Component.EdenCrossWar.EdenCrossRankItem"

-- 创建
function EdenCrossRank:OnCreate()
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

-- 销毁
function EdenCrossRank:OnDestroy()
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

--控件的定义
function EdenCrossRank:ComponentDefine()
    self._selfRank_txt = self:AddComponent(UIText,"selfObj/Txt_SelfRank")
    self._selfAllianceName_txt = self:AddComponent(UIText,"selfObj/Txt_SelfAllianceName")
    self._selfAllianceLeader_txt = self:AddComponent(UIText,"selfObj/Txt_SelfAllianceLeader")
    self._selfForce_txt = self:AddComponent(UIText,"selfObj/Txt_SelfForce")
    self._selfTime_txt = self:AddComponent(UIText,"selfObj/Txt_SelfTime")
    self.player_flag = self:AddComponent(UIBaseContainer,"selfObj/playerFlag")
    self.player_img = self:AddComponent(UIPlayerHead, "selfObj/playerFlag/UIPlayerHead/HeadIcon")
    self.playerHeadFg = self:AddComponent(UIImage, "selfObj/playerFlag/UIPlayerHead/Foreground")
    self.name_des = self:AddComponent(UIText,"select/nameDes")
    self.name_des:SetLocalText(100184)
    self._desertDesc_txt = self:AddComponent(UIText,"select/Txt_DesertDesc")
    self._desertDesc_txt:SetText("")
    self._desertTime_txt = self:AddComponent(UIText,"select/Txt_DesertTime")
    self._desertTime_txt:SetLocalText(111162)
    self.ScrollView = self:AddComponent(UIScrollView, "ScrollView")
    self.ScrollView:SetOnItemMoveIn(function(itemObj, index)
        self:OnRankItemMoveIn(itemObj, index)
    end)
    self.ScrollView:SetOnItemMoveOut(function(itemObj, index)
        self:OnRankItemMoveOut(itemObj, index)
    end)
    self._noRankTips_txt = self:AddComponent(UIText,"Txt_NoRankTips")
    self._noRankTips_txt:SetLocalText(110534)
end

--控件的销毁
function EdenCrossRank:ComponentDestroy()
end

--变量的定义
function EdenCrossRank:DataDefine()

end

--变量的销毁
function EdenCrossRank:DataDestroy()

end

function EdenCrossRank:OnAddListener()
    base.OnAddListener(self)
    self:AddUIListener(EventId.GetEdenMineScoreRank, self.OnRefresh)
end

function EdenCrossRank:OnRemoveListener()
    base.OnRemoveListener(self)
    self:RemoveUIListener(EventId.GetEdenMineScoreRank, self.OnRefresh)
end

function EdenCrossRank:SetData()
    local dataInfo = DataCenter.RobotWarsManager:GetActivityInfo()
    if dataInfo ~=nil then
        if dataInfo.edenMatch and dataInfo.edenMatch.targetServer and dataInfo.edenMatch.targetServer ~= 0 then
            SFSNetwork.SendMessage(MsgDefines.CrossEdenMineServerRank,dataInfo.edenMatch.targetServer)
        end
    end
    self._selfAllianceName_txt:SetText(LuaEntry.Player:GetName())
    local allianceData = DataCenter.AllianceBaseDataManager:GetAllianceBaseData()
    if allianceData~=nil and LuaEntry.Player:IsInAlliance()  then
        self._selfAllianceLeader_txt:SetText("["..allianceData.abbr.."]"..allianceData.allianceName)
    else
        self._selfAllianceLeader_txt:SetText("-")
    end
    self._noRankTips_txt:SetActive(true)
    self.player_flag:SetActive(true)
    self.player_img:SetData(LuaEntry.Player:GetUid(),LuaEntry.Player:GetPic(),LuaEntry.Player.picVer)
    local fgImg = LuaEntry.Player:GetHeadBgImg()
    if not string.IsNullOrEmpty(fgImg) then
        self.playerHeadFg:SetActive(true)
        self.playerHeadFg:LoadSprite(fgImg)
    else
        self.playerHeadFg:SetActive(false)
    end
end

function EdenCrossRank:OnRefresh(message)
    self.rankList = message["rankList"]
    if message["selfRank"] and message["selfRank"] > 0 then
        self._selfRank_txt:SetText(message["selfRank"])
    else
        self._selfRank_txt:SetText(Localization:GetString("361054"))
    end
    self._selfTime_txt:SetText(string.GetFormattedSeperatorNum(message["selfScore"] or 0))
    if self.rankList and table.count(self.rankList) > 0 then
        self._noRankTips_txt:SetActive(false)
        self.ScrollView:SetTotalCount(#self.rankList)
        self.ScrollView:RefillCells()
    else
        self._noRankTips_txt:SetActive(true)
    end
end

function EdenCrossRank:OnRankItemMoveIn(itemObj, index)
    itemObj.name = tostring(index)
    local cellItem = self.ScrollView:AddComponent(EdenCrossRankItem, itemObj)
    cellItem:SetItemShow(self.rankList[index],index)
end

function EdenCrossRank:OnRankItemMoveOut(itemObj, index)
    self.ScrollView:RemoveComponent(itemObj.name, EdenCrossRankItem)
end

function EdenCrossRank:ClearScroll()
    self.ScrollView:ClearCells()
    self.ScrollView:RemoveComponents(EdenCrossRankItem)
end

return EdenCrossRank