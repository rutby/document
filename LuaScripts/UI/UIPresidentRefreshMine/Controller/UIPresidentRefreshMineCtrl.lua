---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2023/4/10 17:08
---


local UIPresidentRefreshMineCtrl = BaseClass("UIPresidentRefreshMineCtrl", UIBaseCtrl)

local function CloseSelf(self)
    UIManager.Instance:DestroyWindow(UIWindowNames.UIPresidentRefreshMine,{anim = true,UIMainAnim = UIMainAnimType.ChangeAllShow})
    --if CS.SceneManager.World then
    --    CS.SceneManager.World:QuitFocus(LookAtFocusTime)
    --end
end

local function GetPanelData(self)
    local result = {}
    result.numPerLine = 1
    local tiles = {}
    result.tiles = tiles
    result.level = DataCenter.PresidentMineRefreshManager:GetMineLevel()
    local k1 = LuaEntry.DataConfig:TryGetStr("wonder_stone_skill", "k1")
    if not string.IsNullOrEmpty(k1) then
        local vec = string.split(k1, "|")
        if vec and table.count(vec) == 2 then
            result.numPerLine = toInt(vec[1])
            local tileTypes = string.split(vec[2], ";")
            local startX = -result.numPerLine + 1
            local startY = 0
            for k, v in ipairs(tileTypes) do
                local para = {}
                local x = startX + math.fmod((k - 1), result.numPerLine)
                local y = startY - math.floor((k - 1) / result.numPerLine)
                para.x = x * 2
                para.z = y * 2
                para.type = toInt(v)
                para.index = k
                local desertId = DataCenter.PresidentMineRefreshManager:GetDesertId(para.type, result.level)
                if desertId ~= nil then
                    local model = GetTableData(TableName.Desert, desertId, "desert_model")
                    local prefabPath =  string.format(LoadPath.Building, model.."None")
                    para.prefabPath = prefabPath
                else
                    para.prefabPath = string.format(LoadPath.Building, "BuildResFlint1None")
                end
                table.insert(tiles, para)
            end
        end
    end
    return result
end

UIPresidentRefreshMineCtrl.CloseSelf = CloseSelf
UIPresidentRefreshMineCtrl.GetPanelData = GetPanelData

return UIPresidentRefreshMineCtrl