---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by guq.
--- DateTime: 2021/4/22 12:05
---
local DecResourceEffect = BaseClass("DecResourceEffect")

local icon_path = "obj/icon"
local num_path = "obj/num"
local ani_path = "obj"

local MoneyColor = Color32.New(250, 180, 45, 255)
local WaterColor = Color32.New(75, 228, 208, 255)
local ElecColor = Color32.New(255, 235, 64, 255)
local MetalColor = Color32.New(106, 176, 255, 255)
local StaminaColor = Color32.New(106, 169, 220, 255)

local function OnCreate(self,go)
    if go~=nil then
        self.request = go
        self.gameObject = go.gameObject
        self.transform = go.gameObject.transform
    end
    self:ComponentDefine()
end
local function ComponentDefine(self)
    self.icon =  self.transform:Find(icon_path):GetComponent(typeof(CS.UnityEngine.SpriteRenderer))
    self.num = self.transform:Find(num_path):GetComponent(typeof(CS.SuperTextMesh))
    self.animator = self.transform:Find(ani_path):GetComponent(typeof(CS.UnityEngine.Animator))
    self.__update_handle = function() self:Update() end
    UpdateManager:GetInstance():AddUpdate(self.__update_handle)
    self.isDoAnim = false
    self.curTime = 0
    self.bUuid = 0
    self.param= {}
end

local function ComponentDestroy(self)
    self.icon = nil
    self.num = nil
    UpdateManager:GetInstance():RemoveUpdate(self.__update_handle)
    self.__update_handle = nil
    self.isDoAnim = nil
    self.curTime = nil
    self.bUuid = nil
    self.param= nil
end

local function OnDestroy(self)
    self:ComponentDestroy()
end

local function ShowPanel(self,param)
    self.param = param
    if not string.IsNullOrEmpty(self.param.icon_name) then
        self.icon:LoadSprite(self.param.icon_name)
    end
    if self.param.desNum>0 then
        self.icon.gameObject:SetActive(false)
    else
        self.icon.gameObject:SetActive(true)
    end
    self.num.text = self.param.desNum
    local numColor = self:GetResNumColor(self.param.resType)
    self.num.color32 = numColor
    self.transform.position = self.param.pos
    self.curTime = 0
    self.endTime = self.animator:GetFloat("DecTime")
    local num = tonumber(self.param.desNum)
    if num ~= nil and num < 0 then
        self.animator:Play("farm_consume_resource_rise",0,0)
    else
        self.animator:Play("farm_item_dec_play",0,0)
    end
    self.isDoAnim = true
    self.bUuid = self.param.bUuid
end

local function Update(self)
    if self.isDoAnim then
        self.curTime = self.curTime + Time.deltaTime
        if self.curTime > self.endTime then
            self.isDoAnim = nil
            DataCenter.DecResourceEffectManager:RemoveOneEffect(self.param)
        end
    end
end

local function GetResNumColor(self, resType)
    if resType == ResourceType.Money then
        return MoneyColor
    elseif resType == ResourceType.Water then
        return WaterColor
    elseif resType == ResourceType.Electricity then
        return ElecColor
    elseif resType == ResourceType.Metal then
        return MetalColor
    elseif resType == ResourceType.FORMATION_STAMINA then
        return StaminaColor
    else
        return WorldWhiteColor32
    end
end

DecResourceEffect.OnCreate = OnCreate
DecResourceEffect.OnDestroy = OnDestroy
DecResourceEffect.ComponentDefine = ComponentDefine
DecResourceEffect.ComponentDestroy = ComponentDestroy
DecResourceEffect.ShowPanel = ShowPanel
DecResourceEffect.Update = Update
DecResourceEffect.GetResNumColor = GetResNumColor
return DecResourceEffect