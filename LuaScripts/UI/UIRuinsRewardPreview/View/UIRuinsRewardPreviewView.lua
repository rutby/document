---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/10/9 16:42
---
local RuinsRewardPreviewItem = require "UI.UIRuinsRewardPreview.Component.RuinsRewardPreviewItem"
local UIRuinsRewardPreviewView = BaseClass("UIRuinsRewardPreviewView",UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization

local txt_title_path ="UICommonPopUpTitle/bg_mid/titleText"
local txt_des_path ="title/Text_des"
local txt_rank_path = "select/Txt_RankNum"
local txt_score_path = "select/Txt_score"
local txt_reward_path = "select/Txt_Reward"
local close_btn_path = "UICommonPopUpTitle/bg_mid/CloseBtn"
local return_btn_path = "UICommonPopUpTitle/panel"
local dropdown_path = "title/Dropdown"
local scrollView_path = "ScrollView"
local function OnCreate(self)
    base.OnCreate(self)
    self.txt_title = self:AddComponent(UITextMeshProUGUIEx, txt_title_path)
    self.txt_title:SetLocalText(111239)
    self.txt_des = self:AddComponent(UITextMeshProUGUIEx, txt_des_path)
    local desStr = Localization:GetString("111248").."(".. Localization:GetString("111256")..")"
    self.txt_des:SetText(desStr)
    self.txt_rank = self:AddComponent(UITextMeshProUGUIEx, txt_rank_path)
    self.txt_rank:SetLocalText(111253)
    self.txt_score = self:AddComponent(UITextMeshProUGUIEx, txt_score_path)
    self.txt_score:SetLocalText(111254)
    self.txt_reward = self:AddComponent(UITextMeshProUGUIEx, txt_reward_path)
    self.txt_reward:SetLocalText(111255)
    self.dropdown = self.transform:Find(dropdown_path):GetComponent(typeof(CS.TMPro.TMP_Dropdown))
    self.dropdown.onValueChanged:AddListener(function()
        self:OnValueChange()
    end)
    self:ShowLayout()
    self.close_btn = self:AddComponent(UIButton, close_btn_path)
    self.close_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)

    self.return_btn = self:AddComponent(UIButton, return_btn_path)
    self.return_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    
    self.selectLevel = 1
    self.showDatalist ={}
    self.ScrollView = self:AddComponent(UIScrollView, scrollView_path)
    self.ScrollView:SetOnItemMoveIn(function(itemObj, index)
        self:OnItemMoveIn(itemObj, index)
    end)
    self.ScrollView:SetOnItemMoveOut(function(itemObj, index)
        self:OnItemMoveOut(itemObj, index)
    end)
end

local function OnDestroy(self)
    self:ClearScroll()
    pcall(function() self.dropdown.onValueChanged:Clear() end)
    self.dropdown = nil
    base.OnDestroy(self)
end

local function ShowLayout(self)
    for i = 0, 6 do
        self.dropdown.options[i].text = Localization:GetString("111261",("Lv."..(i+1)))
    end
    self.dropdown.captionText.text = Localization:GetString("111261","Lv.1")
    
end

local function OnValueChange(self)
    --local str = Localization:GetString("111261","Lv."..(self.dropdown.value+1))
    --self.dropdown.captionText.text = str
    self.selectLevel = (self.dropdown.value+1)
    self:RefreshList()
end

local function OnEnable(self)
    base.OnEnable(self)
    self:RefreshList()
end

local function OnDisable(self)
    base.OnDisable(self)
end


local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function ClearScroll(self)
    self.ScrollView:ClearCells()
    self.ScrollView:RemoveComponents(RuinsRewardPreviewItem)
    self.showDatalist = {}
end

local function OnItemMoveIn(self,itemObj, index)
    itemObj.name = tostring(index)
    local cellItem = self.ScrollView:AddComponent(RuinsRewardPreviewItem, itemObj)
    cellItem:SetItemShow(self.showDatalist[index])
end

local function OnItemMoveOut(self, itemObj, index)
    self.ScrollView:RemoveComponent(itemObj.name, RuinsRewardPreviewItem)
end

local function RefreshList(self)
    self:ClearScroll()
    self.showDatalist = self.ctrl:GetRewardList(self.selectLevel)
    if #self.showDatalist>0 then
        self.ScrollView:SetTotalCount(#self.showDatalist)
        self.ScrollView:RefillCells()
    end
end

UIRuinsRewardPreviewView.OnCreate= OnCreate
UIRuinsRewardPreviewView.OnDestroy = OnDestroy
UIRuinsRewardPreviewView.OnEnable = OnEnable
UIRuinsRewardPreviewView.OnDisable = OnDisable
UIRuinsRewardPreviewView.OnAddListener = OnAddListener
UIRuinsRewardPreviewView.OnRemoveListener = OnRemoveListener
UIRuinsRewardPreviewView.RefreshList = RefreshList
UIRuinsRewardPreviewView.ClearScroll =ClearScroll
UIRuinsRewardPreviewView.OnItemMoveIn = OnItemMoveIn
UIRuinsRewardPreviewView.OnItemMoveOut =OnItemMoveOut
UIRuinsRewardPreviewView.ShowLayout =ShowLayout
UIRuinsRewardPreviewView.OnValueChange = OnValueChange
return UIRuinsRewardPreviewView