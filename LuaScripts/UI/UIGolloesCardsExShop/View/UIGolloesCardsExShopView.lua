---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl
--- DateTime:
--- 
local UIGolloesCardsExShopView = BaseClass("UIGolloesCardsExShopView", UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization
local UIGolloesCardsShopCell = require "UI.UIActivityCenterTable.Component.GolloesCards.UIGolloesCardsShopCell"
function UIGolloesCardsExShopView:OnCreate()
    base.OnCreate(self)
    
    self._title_txt = self:AddComponent(UITextMeshProUGUIEx,"UICommonPopUpTitle/bg_mid/titleText")
    self._title_txt:SetLocalText(372290)
    
    self._close_btn = self:AddComponent(UIButton,"UICommonPopUpTitle/bg_mid/CloseBtn")
    self._close_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)

    self.scroll_view = self:AddComponent(UIScrollView, "ImgBg/Rect_Exchange/ScrollView_Shop")
    self.content = self:AddComponent(UIBaseContainer,"ImgBg/Rect_Exchange/ScrollView_Shop/Viewport/Content")
    self.scroll_view:SetOnItemMoveIn(function(itemObj, index)
        self:OnItemMoveIn(itemObj, index)
    end)
    self.scroll_view:SetOnItemMoveOut(function(itemObj, index)
        self:OnItemMoveOut(itemObj, index)
    end)

    self._icon_img = self:AddComponent(UIImage,"ImgBg/Rect_Exchange/Rect_Item/Img_Icon")
    self._ownNum_txt = self:AddComponent(UITextMeshProUGUIEx,"ImgBg/Rect_Exchange/Rect_Item/Txt_OwnNum")

    self._itemTips_txt = self:AddComponent(UITextMeshProUGUIEx,"ImgBg/Rect_Exchange/Txt_ItemTips")
end

function UIGolloesCardsExShopView:OnDestroy()
    self:ClearScroll()
    self.scroll_view = nil
    self._icon_img = nil
    self._ownNum_txt = nil
    self._itemTips_txt = nil
    base.OnDestroy(self)
end

function UIGolloesCardsExShopView:OnEnable()
    base.OnEnable(self)
    local actId = self:GetUserData()
    self:RefreshShop(actId)
end

function UIGolloesCardsExShopView:OnDisable()
    base.OnDisable(self)
end

function UIGolloesCardsExShopView:OnAddListener()
    base.OnAddListener(self)
    self:AddUIListener(EventId.UpdateOneCommonShop, self.OnRefresh)
    self:AddUIListener(EventId.OnBuyCommonGoodsSucc, self.OnRefreshGood)
end

function UIGolloesCardsExShopView:OnRemoveListener()
    base.OnRemoveListener(self)
    self:RemoveUIListener(EventId.UpdateOneCommonShop, self.OnRefresh)
    self:RemoveUIListener(EventId.OnBuyCommonGoodsSucc, self.OnRefreshGood)
end

function UIGolloesCardsExShopView:RefreshShop(actId)
    self.activityId = actId
    self._itemTips_txt:SetLocalText(372300)
    SFSNetwork.SendMessage(MsgDefines.GetCommonShopInfo, CommonShopType.GolloesShop)
end

function UIGolloesCardsExShopView:OnRefresh()
    self.goodsList = DataCenter.CommonShopManager:GetGoodsListByShopType(CommonShopType.GolloesShop)
    if #self.goodsList >0 then
        self:ClearScroll()
        self.scroll_view:SetTotalCount(#self.goodsList)
        self.scroll_view:RefillCells()
        --self.content:SetAnchoredPosition({x = -495,y = 1})
    end
    --local itemId = self.goodsList[1].currencyId
    local itemTemplate = DataCenter.ItemTemplateManager:GetItemTemplate(240003)
    local itemData = DataCenter.ItemData:GetItemById(240003)
    local itemCount = itemData and itemData.count or 0
    self._ownNum_txt:SetText(itemCount)
    self._icon_img:LoadSprite(string.format(LoadPath.ItemPath, itemTemplate.icon))
end

function UIGolloesCardsExShopView:OnRefreshGood()
    self.goodsList = DataCenter.CommonShopManager:GetGoodsListByShopType(CommonShopType.GolloesShop)
    local itemData = DataCenter.ItemData:GetItemById(240003)
    local itemCount = itemData and itemData.count or 0
    self._ownNum_txt:SetText(itemCount)
end

function UIGolloesCardsExShopView:OnItemMoveIn(itemObj, index)
    itemObj.name = tostring(index)
    local cellItem = self.scroll_view:AddComponent(UIGolloesCardsShopCell, itemObj)
    cellItem:SetItem(self.goodsList[index])
end

function UIGolloesCardsExShopView:OnItemMoveOut( itemObj, index)
    self.scroll_view:RemoveComponent(itemObj.name, UIGolloesCardsShopCell)
end

function UIGolloesCardsExShopView:ClearScroll()
    self.scroll_view:ClearCells()
    self.scroll_view:RemoveComponents(UIGolloesCardsShopCell)
end

return UIGolloesCardsExShopView