---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 29/1/2024 上午10:17
---
local WorldGotoItem = BaseClass("WorldGotoItem", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

local x_input_path = "xInputField"
--local x_input_placeholder_path = "xInputField/Text Area/xPlaceholder"
local y_input_path = "yInputField"
--local y_input_placeholder_path = "yInputField/Text Area/yPlaceholder"
local btn_path = "Goto_Btn"
local posX_text_path = "PosX_Text"
local posY_text_path = "PosY_Text"
local server_text_path = "server_Text"
local server_input_path = "serverInputField"
--local server_input_placeholder_path = "serverInputField/Text Area/serverPlaceholder"
local this_path = ""

local function OnCreate(self)
    base.OnCreate(self)
    self.x_input = self:AddComponent(UITMPInput, x_input_path)
    self.x_input:SetOnEndEdit(function(value)
        self:IptOnXValueChange(value)
    end)
    self.x_inputEvent = self:AddComponent(UIEventTrigger, x_input_path)
    self.x_inputEvent:OnPointerDown(function(eventData)
        self:OnPointerDown(1)
    end)
    --self.x_input_placeholder = self:AddComponent(UITextMeshProUGUIEx, x_input_placeholder_path)
    --self.x_input_placeholder:SetText("")
    self.y_input = self:AddComponent(UITMPInput, y_input_path)
    self.y_input:SetOnEndEdit(function(value)
        self:IptOnYValueChange(value)
    end)
    self.y_inputEvent = self:AddComponent(UIEventTrigger, y_input_path)
    self.y_inputEvent:OnPointerDown(function(eventData)
        self:OnPointerDown(2)
    end)
    --self.y_input_placeholder = self:AddComponent(UITextMeshProUGUIEx, y_input_placeholder_path)
    --self.y_input_placeholder:SetText("")

    self.server_input = self:AddComponent(UITMPInput, server_input_path)
    self.server_input:SetOnEndEdit(function(value)
        self:IptOnServerValueChange(value)
    end)
    self.server_inputEvent = self:AddComponent(UIEventTrigger, server_input_path)
    self.server_inputEvent:OnPointerDown(function(eventData)
        self:OnPointerDown(3)
    end)
    --self.server_input_placeholder = self:AddComponent(UITextMeshProUGUIEx, server_input_placeholder_path)
    --self.server_input_placeholder:SetText("")
    self.btn = self:AddComponent(UIButton, btn_path)
    self.btn:SetOnClick(function()
        CS.GameEntry.Sound:PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnClickJump()
    end)
    self.posX_text = self:AddComponent(UITextMeshProUGUIEx, posX_text_path)
    self.posY_text = self:AddComponent(UITextMeshProUGUIEx, posY_text_path)
    self.server_text = self:AddComponent(UITextMeshProUGUIEx, server_text_path)
    self.posX_text:SetText("X:")
    self.posY_text:SetText("Y:")
    --self.server_text:SetText("#:")

    self.server = -1
    self.x = -1
    self.y = -1
    self.lastTxt = ""
end

local function OnDestroy(self)
    self.x_input = nil
    self.x_inputEvent = nil
    self.y_input = nil
    self.y_inputEvent = nil
    self.btn = nil
    self.posX_text = nil
    self.posY_text = nil
    self.intro_text = nil
    self.server = nil
    self.x = nil
    self.y = nil
    self.lastTxt = nil
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
    self:InitState()
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function InitState(self)
    local data = self.view.ctrl:GetCurrentState()
    self.server = data.serverId
    self.x = data.x
    self.y = data.y
    local serverStr = tostring(self.server)
    --if LuaEntry.Player.serverType == ServerType.EDEN_SERVER then
    --    serverStr = Localization:GetString("111169")
    --    self.server_input_placeholder:SetText(serverStr)
    --end

    self.server_input:SetText(serverStr)
    self.server_input:SetInteractable(LuaEntry.Player.serverType == ServerType.NORMAL or LuaEntry.Player.serverType == ServerType.EDEN_SERVER)
    if self.x >= 0 and self.y >= 0 then
        self.x_input:SetText(tostring(self.x))
        self.y_input:SetText(tostring(self.y))
    else
        self.x_input:SetText("")
        self.y_input:SetText("")
    end
end

local function IptOnServerValueChange(self, value)
    if LuaEntry.Player.serverType == ServerType.NORMAL or LuaEntry.Player.serverType == ServerType.EDEN_SERVER then
        if value == "" then
            value = self.lastTxt
        end
        self.server = tonumber(value)
        self.server_input:SetText(tostring(self.server))
    end
end

local function IptOnXValueChange(self, value)
    if value == "" then
        value = self.lastTxt
    end
    self.x = tonumber(value)
    self.x_input:SetText(tostring(self.x))
    --self.view.ctrl:SaveLastInputXAndY(self.server, self.x, self.y)
end
local function OnPointerDown(self,XorY)
    --self.view:HideBg()
    if XorY == 1 then
        self.lastTxt = self.x_input:GetText()
        self.x_input:SetText("")
    elseif XorY == 2 then
        self.lastTxt = self.y_input:GetText()
        self.y_input:SetText("")
    elseif XorY ==3 then
        if LuaEntry.Player.serverType == ServerType.NORMAL then
            self.lastTxt = self.server_input:GetText()
            self.server_input:SetText("")
        end
    end
end

local function IptOnYValueChange(self, value)
    if value == "" then
        value = self.lastTxt
    end
    self.y = tonumber(value)
    self.y_input:SetText(tostring(self.y))
    --self.view.ctrl:SaveLastInputXAndY(self.server, self.x, self.y)
end

local function OnClickJump(self)
    if self.view.ctrl:CheckCanGo(self.server, self.x, self.y) == false then
        UIUtil.ShowTips(Localization:GetString(CS.GameDialogDefine.OUT_UNLOCK_RANGE_REASON,
                CS.SceneManager.World.CurTileCountXMin, CS.SceneManager.World.CurTileCountYMin,
                CS.SceneManager.World.CurTileCountXMax, CS.SceneManager.World.CurTileCountYMax))
    else
        --local maxServerId = DataCenter.AccountManager:GetMaxServerId()
        local canSearch = DataCenter.AccountManager:CheckIsInServerList(self.server)

        --if maxServerId ==0 then
        --    if self.server ~= LuaEntry.Player:GetSelfServerId() then
        --        canSearch = false
        --    end
        --elseif self.server>maxServerId then
        --    canSearch = false
        --elseif self.server == 11 then
        --    canSearch = false
        --end
        if canSearch then
            self.view.ctrl:OnJumpClick(self.server, self.x, self.y)
        else
            UIUtil.ShowTipsId(110207)
        end
    end
end

WorldGotoItem.OnCreate = OnCreate
WorldGotoItem.OnDestroy = OnDestroy
WorldGotoItem.InitState = InitState
WorldGotoItem.OnEnable = OnEnable
WorldGotoItem.OnDisable = OnDisable
WorldGotoItem.IptOnServerValueChange = IptOnServerValueChange
WorldGotoItem.IptOnXValueChange = IptOnXValueChange
WorldGotoItem.IptOnYValueChange = IptOnYValueChange
WorldGotoItem.OnClickJump = OnClickJump
WorldGotoItem.OnEnable = OnEnable
WorldGotoItem.OnDisable = OnDisable
WorldGotoItem.OnPointerDown = OnPointerDown
return WorldGotoItem