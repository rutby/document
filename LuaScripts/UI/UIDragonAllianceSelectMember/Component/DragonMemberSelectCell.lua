---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/6/8 10:13
---
local DragonMemberSelectCell = BaseClass("DragonMemberSelectCell",UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

local name_path = "NameTxt"
local select_obj_path = "checkBox/Image"
local btn_path = "Button"
local icon_path ="UIPlayerHead/HeadIcon"
local headFg_path = "UIPlayerHead/Foreground"
local function OnCreate(self)
    base.OnCreate(self)
    self.name_txt = self:AddComponent(UIText,name_path)
    self.power_txt = self:AddComponent(UIText,"power")
    self.select_obj = self:AddComponent(UIImage,select_obj_path)
    self.btn = self:AddComponent(UIButton, btn_path)
    self.btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnClick()
    end)
    self.icon = self:AddComponent(UIPlayerHead, icon_path)
    self.headFg = self:AddComponent(UIImage, headFg_path)
end

-- 销毁
local function OnDestroy(self)
    self.name_txt = nil
    self.select_obj = nil
    self.btn = nil
    base.OnDestroy(self)
end

-- 显示
local function OnEnable(self)
    base.OnEnable(self)
end

-- 隐藏
local function OnDisable(self)
    base.OnDisable(self)
end

local function SetItemShow(self,data)
    self.data = data
    self.uid = data.uid
    self.name_txt:SetText(data.name)
    if self.data.uid == LuaEntry.Player.uid then
        self.name_txt:SetColor(BlueColor)
    else
        self.name_txt:SetColor(description1_color)
    end
    self.power_txt:SetText(string.GetFormattedSeperatorNum(data.power))
    local userId = data.uid
    local userPic = data.pic
    local userPicVer = data.picVer
    self.icon:SetData(userId, userPic, userPicVer,true)
    if data.headBg~=nil then
        self.headFg:SetActive(true)
        self.headFg:LoadSprite(data.headBg)
    else
        self.headFg:SetActive(false)
    end
    self:RefreshState()
end
local function OnClick(self)
    if self.view.canSignUp ==false then
        UIUtil.ShowTipsId(376124)
        return
    end
    if DataCenter.AllianceBaseDataManager:IsR4orR5()==false then
        UIUtil.ShowTipsId(376061)
        return
    end
    self.view:ShowTip(self.icon.transform.position,self.uid,self)
end

local function SetState(self,uid,state)
    if self.data~=nil and self.data.uid == uid then
        self.data.state = state
        self:RefreshState()
        self.view:SetPlayerState(uid,state)
        self.view:HideTip()
    end
end
local function RefreshState(self)
    if self.data.state == DragonPlayerState.None then
        self.select_obj:SetActive(false)
    elseif self.data.state == DragonPlayerState.Main then
        self.select_obj:SetActive(true)
        self.select_obj:LoadSprite("Assets/Main/Sprites/UI/Common/New/Common_duihao2.png")
    elseif self.data.state == DragonPlayerState.Sub then
        self.select_obj:SetActive(true)
        self.select_obj:LoadSprite("Assets/Main/Sprites/UI/Common/New/Common_duihao_blue.png")
    end
end

DragonMemberSelectCell.OnCreate = OnCreate
DragonMemberSelectCell.OnClick = OnClick
DragonMemberSelectCell.OnDestroy = OnDestroy
DragonMemberSelectCell.OnEnable = OnEnable
DragonMemberSelectCell.OnDisable = OnDisable
DragonMemberSelectCell.SetItemShow = SetItemShow
DragonMemberSelectCell.RefreshState = RefreshState
DragonMemberSelectCell.SetState =SetState
return DragonMemberSelectCell