---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2021/6/9 17:06
---
local UIFiveStarFeedBackView = BaseClass("UIFiveStarFeedBackView",UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization

local title_path = "UICommonMiniPopUpTitle/Bg_mid/titleText"
local input_path = "ImgBg/InputField"
local input_default_path = "ImgBg/InputField/Placeholder"
local return_btn_path = "UICommonMiniPopUpTitle/panel"
local close_btn_path = "UICommonMiniPopUpTitle/Bg_mid/CloseBtn"
local use_txt_path = "ImgBg/Button/useText"
local use_btn_path ="ImgBg/Button"
local contentLength_path = "ImgBg/contentLength"

local function OnCreate(self)
    base.OnCreate(self)
    -- 界面标题
    self.title = self:AddComponent(UITextMeshProUGUIEx,title_path)
    self.title:SetLocalText(280172) 
    -- 按钮文字
    self.use_txt = self:AddComponent(UIText,use_txt_path)
    self.use_txt:SetLocalText(GameDialogDefine.CONFIRM) 
    -- 发送吐槽按钮
    self.use_btn = self:AddComponent(UIButton, use_btn_path)
    self.use_btn:SetOnClick(function()  
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnFeedbackSend()
    end)
    -- 输入框
    self.input = self:AddComponent(UIInput,input_path)
    self.input:SetOnEndEdit(function (value)
        self:IptOnValueChange(value)
    end)
    -- 默认显示文字
    self.input_default = self:AddComponent(UIText, input_default_path)
    -- self.input_default:SetText(defaultTxtID) 
    -- 关闭按钮
    self.close_btn = self:AddComponent(UIButton, close_btn_path)
    self.close_btn:SetOnClick(function()  
        self.ctrl:CloseSelf()
    end)
    -- 界面关闭区域
    self.return_btn = self:AddComponent(UIButton, return_btn_path)
    self.return_btn:SetOnClick(function()  
        self.ctrl:CloseSelf()
    end)
    -- 已经输入的文字 默认为空
    self.inputValue = ""
    self.input:SetText(inputValue)
    -- 已经输入文字个数label
    self.contentLengthTxtN = self:AddComponent(UIText, contentLength_path)
    self.contentLengthTxtN:SetText(string.len(self.inputValue) .. "/" .. 500)
    self:ResetDefaultLabelText()
end

local function OnDestroy(self)
    self.title = nil
    self.use_txt = nil
    self.use_btn = nil
    self.input = nil
    self.close_btn = nil
    self.return_btn = nil
    self.inputValue = nil
    self.input_default = nil
    self.contentLengthTxtN = nil
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function IptOnValueChange(self,value)
    -- 假如玩家输入了0个字符 重置输入框
    if string.len(value) == 0 then
        self:ResetDefaultLabelText()
        self.inputValue = value
    -- 假如玩家输入了过多的字符 提示输入过多
    elseif string.len(value) > 500 then
        UIUtil.ShowTipsId(120193)
        self.input:SetText(self.inputValue)
    else
        self.inputValue = value
    end
    self.contentLengthTxtN:SetText(string.len(self.inputValue) .. "/" .. 500)
end

local function ResetDefaultLabelText(self)
    self.input_default:SetLocalText(280026)
end

--点击发送吐槽按钮
local function OnFeedbackSend(self)
    -- 假如玩家输入了0个字符 这里不让玩家发送请求
    if string.len(self.inputValue) == 0 then
        return
    end
    self.ctrl:OnSendFeedBack(self.inputValue);
end

UIFiveStarFeedBackView.OnCreate = OnCreate
UIFiveStarFeedBackView.OnDestroy = OnDestroy
UIFiveStarFeedBackView.OnEnable = OnEnable
UIFiveStarFeedBackView.OnDisable = OnDisable
UIFiveStarFeedBackView.IptOnValueChange = IptOnValueChange
UIFiveStarFeedBackView.OnFeedbackSend = OnFeedbackSend
UIFiveStarFeedBackView.ResetDefaultLabelText = ResetDefaultLabelText

return UIFiveStarFeedBackView