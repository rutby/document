---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhangjiabin.
--- DateTime: 2024/3/24 6:39 PM
---

local UIHeroEquipReplaceCell = BaseClass("UIHeroEquipReplaceCell", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

local UIHeroEquipCell = require "UI.UIHeroEquip.Component.UIHeroEquipCell"
local UIHeroCellSmall = require "UI.UIHero2.Common.UIHeroCellSmall"

local equip_cell_path = "UIHeroEquipCell"
local name_text_path = "EquipName"
local power_text_path = "PowerNode/Power"
local replace_btn_path = "ReplaceBtn"
local replace_text_path = "ReplaceBtn/ReplaceBtnText"
local install_btn_path = "InstallBtn"
local install_text_path = "InstallBtn/InstallBtnText"
local red_path = "InstallBtn/RedPointNum"
local using_text_path = "ReplaceBtn/useObj/UsingTxt"
local using_hero_path = "ReplaceBtn/useObj/UIHeroCellSmall"

function UIHeroEquipReplaceCell:OnCreate()
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

function UIHeroEquipReplaceCell:OnDestroy()
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

function UIHeroEquipReplaceCell:ComponentDefine()
    self.equipCell = self:AddComponent(UIHeroEquipCell, equip_cell_path)
    self.equipName = self:AddComponent(UITextMeshProUGUIEx, name_text_path)
    self.equipPower = self:AddComponent(UITextMeshProUGUIEx, power_text_path)
    
    self.replaceBtn = self:AddComponent(UIButton, replace_btn_path)
    self.replaceBtn:SetOnClick(function()
        self:OnReplaceBtnClick()
    end)
    self.replaceBtnText = self:AddComponent(UITextMeshProUGUIEx, replace_text_path)
    self.replaceBtnText:SetLocalText(GameDialogDefine.HERO_EQUIP26)
    
    self.installBtn = self:AddComponent(UIButton, install_btn_path)
    self.installBtn:SetOnClick(function()
        self:OnInstallBtnClick()
    end)
    self.installBtnText = self:AddComponent(UITextMeshProUGUIEx, install_text_path)
    self.installBtnText:SetLocalText(GameDialogDefine.HERO_EQUIP28)

    self.red = self:AddComponent(UIBaseContainer, red_path)
    self.red:SetActive(false)
    
    self.hero = self:AddComponent(UIHeroCellSmall, using_hero_path)
    self.usingText = self:AddComponent(UITextMeshProUGUIEx, using_text_path)
    self.usingText:SetLocalText(GameDialogDefine.HERO_EQUIP29)
end

function UIHeroEquipReplaceCell:ComponentDestroy()

end

function UIHeroEquipReplaceCell:DataDefine()

end

function UIHeroEquipReplaceCell:DataDestroy()

end

function UIHeroEquipReplaceCell:OnAddListener()
    base.OnAddListener(self)
end

function UIHeroEquipReplaceCell:OnRemoveListener()
    base.OnRemoveListener(self)
end

function UIHeroEquipReplaceCell:SetData(equip, targetHeroId, wearEquipUuid)
    if equip == nil then
        return
    end
    
    self.equip = equip
    self.targetHeroId = targetHeroId
    self.wearEquipUuid = wearEquipUuid
    self.equipCell:SetData(self.equip)

    local equipTemplate = DataCenter.HeroEquipTemplateManager:GetTemplate(equip.equipId)
    if equipTemplate ~= nil then
        self.equipName:SetText(Localization:GetString(equipTemplate.name))
    end
    
    local power = DataCenter.HeroEquipTemplateManager:GetEquipmentPower(self.equip.equipId, self.equip.level, self.equip.promote);
    self.equipPower:SetText(string.GetFormattedSeperatorNum(power))

    if equip.heroId ~= 0 then
        self.hero:InitWithConfigId(equip.heroId, nil, nil, true)
        self.hero:SetStarActive(false)
        self.hero:SetCampActive(false)
        self.replaceBtn:SetActive(true)
        self.installBtn:SetActive(false)
    else
        self.replaceBtn:SetActive(false)
        self.installBtn:SetActive(true)
    end
end

function UIHeroEquipReplaceCell:SetRedVisible(visible)
    self.red:SetActive(visible)
end

function UIHeroEquipReplaceCell:OnReplaceBtnClick()
    if self.equip == nil then
        return
    end
    
    local equipList = {}
    table.insert(equipList, self.equip.uuid)
    DataCenter.HeroEquipManager:HeroEquipInstall(self.targetHeroId, equipList);

    self.view.ctrl.CloseSelf()
end

function UIHeroEquipReplaceCell:OnInstallBtnClick()
    if self.equip == nil then 
        return
    end
    
    local equipList = {}
    table.insert(equipList, self.equip.uuid)
    DataCenter.HeroEquipManager:HeroEquipInstall(self.targetHeroId, equipList);

    self.view.ctrl.CloseSelf()
end

return UIHeroEquipReplaceCell