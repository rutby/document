---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhangliheng.
--- DateTime: 2022/3/29 16:21
---

local UIPVEHeadBar = BaseClass('UIPVEHeadBar', UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

local function __init(self)
    self.power = 0
    self.maxHp = 0
    self.curHp = 0
end

local function __delete(self)
    self.power = nil
    self.maxHp = nil
    self.curHp = nil
end

local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    
    self:UpdateBar()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.hpBar     = self:AddComponent(UISlider, 'HpBar')
    self.textHp    = self:AddComponent(UIText, 'HpBar/TextValue')
    self.imgIcon   = self:AddComponent(CircleImage, 'IconBg/UIPlayerHead/HeadIcon')
    self.textPower = self:AddComponent(UIText, 'IconBg/TextPower')
    self.uiPlayerHead = self:AddComponent(UIPlayerHead, 'IconBg/UIPlayerHead/HeadIcon')
end

local function ComponentDestroy(self)
end

local function SetPlayerHead(self, uid, pic, picVer)
    self.uiPlayerHead:SetData(uid, pic, picVer)
end

local function SetIcon(self, path)
    self.imgIcon:LoadSprite(path)
end

local function UpdateBar(self)
    if self.maxHp == nil or self.maxHp <= 0 then
        self.hpBar:SetValue(1)
        self.textHp:SetText('')
        return
    end

    local lastValue = self.hpBar:GetValue()
    local value = Mathf.Clamp(self.curHp/ self.maxHp, 0, 1)
    self.hpBar:SetValue(value)
    local str = ""
    if (self.curHp ~= self.maxHp) then
        str = string.GetFormattedStr(tonumber(self.curHp)) .. '/' .. string.GetFormattedStr(tonumber(self.maxHp))
    else
        str = string.GetFormattedStr(tonumber(self.maxHp))
    end
    self.textHp:SetText(str)
    --todo later: tween value
end

local function SetPower(self, power)
    self.power = power
    local str = string.GetFormattedStr(tonumber(power))
    self.textPower:SetText(str)
end

local function SetMaxHp(self, maxHp)
    self.maxHp = maxHp
    self:UpdateBar()
end

local function SetCurHp(self, curHp)
    self.curHp = curHp
    self:UpdateBar()
end

UIPVEHeadBar.__init = __init
UIPVEHeadBar.__delete = __delete

UIPVEHeadBar.OnCreate= OnCreate
UIPVEHeadBar.OnDestroy = OnDestroy
UIPVEHeadBar.ComponentDefine = ComponentDefine
UIPVEHeadBar.ComponentDestroy = ComponentDestroy

UIPVEHeadBar.SetPlayerHead = SetPlayerHead
UIPVEHeadBar.SetIcon = SetIcon

UIPVEHeadBar.UpdateBar = UpdateBar
UIPVEHeadBar.SetPower = SetPower
UIPVEHeadBar.SetMaxHp = SetMaxHp
UIPVEHeadBar.SetCurHp = SetCurHp

return UIPVEHeadBar