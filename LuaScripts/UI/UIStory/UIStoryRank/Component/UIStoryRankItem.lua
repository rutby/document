---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/9/1 17:23
---

local UIStoryRankItem = BaseClass("UIStoryRankItem", UIBaseContainer)
local base = UIBaseContainer

local rank_path = "Rank"
local rank_icon_path = "RankIcon"
local head_btn_path = "UIPlayerHead"
local head_path = "UIPlayerHead/HeadIcon"
local head_fg_path = "UIPlayerHead/Foreground"
local name_path = "Name"
local alliance_name_path = "AllianceName"
local country_path = "Country"
local score_path = "Score"

local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.rank_text = self:AddComponent(UITextMeshProUGUIEx, rank_path)
    self.rank_icon_image = self:AddComponent(UIImage, rank_icon_path)
    self.player_head_btn = self:AddComponent(UIButton, head_btn_path)
    self.player_head_btn:SetOnClick(function()
        self:OnHeadClick()
    end)
    self.player_head = self:AddComponent(UIPlayerHead, head_path)
    self.player_head_fg = self:AddComponent(UIImage, head_fg_path)
    self.name_text = self:AddComponent(UITextMeshProUGUIEx, name_path)
    self.alliance_name_text = self:AddComponent(UITextMeshProUGUIEx, alliance_name_path)
    self.country_image = self:AddComponent(UIImage, country_path)
    self.score_text = self:AddComponent(UITextMeshProUGUIEx, score_path)
end

local function ComponentDestroy(self)

end

local function DataDefine(self)
    self.data = nil
    self.onClick = nil
end

local function DataDestroy(self)

end

local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function SetData(self, data)
    self.data = data
    if data.rank <= 0 then
        self.rank_text:SetActive(true)
        self.rank_text:SetText("-")
        self.rank_icon_image:SetActive(false)
    elseif data.rank <= 3 then
        self.rank_text:SetActive(false)
        self.rank_icon_image:SetActive(true)
        self.rank_icon_image:LoadSprite("Assets/Main/Sprites/UI/UIAlliance/rank/UIalliance_rankingbg0" .. data.rank)
    else
        self.rank_text:SetActive(true)
        self.rank_text:SetText(data.rank)
        self.rank_icon_image:SetActive(false)
    end

    self.player_head:SetData(data.uid, data.pic, data.picVer)
    local headBgImg = DataCenter.DecorationDataManager:GetHeadFrame(data.headSkinId, data.headSkinET)
    if headBgImg ~= nil then
        self.player_head_fg:SetActive(true)
        self.player_head_fg:LoadSprite(headBgImg)
    else
        self.player_head_fg:SetActive(false)
    end
    self.name_text:SetText(data.name)
    if string.IsNullOrEmpty(data.allianceName) then
        self.alliance_name_text:SetText("")
    else
        self.alliance_name_text:SetText(string.format("[%s] %s", data.abbr, data.allianceName))
    end
    if LuaEntry.Player:IsHideCountryFlag() then
        self.country_image:SetActive(false)
    else
        local flagTemplate = DataCenter.NationTemplateManager:GetNationTemplate(data.country)
        self.country_image:LoadSprite(flagTemplate:GetNationFlagPath())
        self.country_image:SetActive(true)
    end
    self.score_text:SetText(string.GetFormattedSeperatorNum(data.score))
end

local function SetOnClick(self, onClick)
    self.onClick = onClick
end

local function OnClick(self)
    if self.onClick then
        self.onClick()
    end
end

local function OnHeadClick(self)
    if self.data.uid ~= LuaEntry.Player.uid then
        UIManager:GetInstance():OpenWindow(UIWindowNames.UIOtherPlayerInfo, { anim = true}, self.data.uid)
    else
        UIManager:GetInstance():OpenWindow(UIWindowNames.UIPlayerInfo, LuaEntry.Player.uid)
    end
end

UIStoryRankItem.OnCreate = OnCreate
UIStoryRankItem.OnDestroy = OnDestroy
UIStoryRankItem.ComponentDefine = ComponentDefine
UIStoryRankItem.ComponentDestroy = ComponentDestroy
UIStoryRankItem.DataDefine = DataDefine
UIStoryRankItem.DataDestroy = DataDestroy
UIStoryRankItem.OnAddListener = OnAddListener
UIStoryRankItem.OnRemoveListener = OnRemoveListener
UIStoryRankItem.OnEnable = OnEnable
UIStoryRankItem.OnDisable = OnDisable

UIStoryRankItem.SetData = SetData
UIStoryRankItem.SetOnClick = SetOnClick
UIStoryRankItem.OnClick = OnClick
UIStoryRankItem.OnHeadClick = OnHeadClick

return UIStoryRankItem