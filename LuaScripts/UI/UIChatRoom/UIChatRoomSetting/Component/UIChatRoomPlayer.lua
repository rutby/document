---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/4/6 15:39
---

local UIChatRoomPlayer = BaseClass("UIChatRoomPlayer", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

local head_btn_path = "UIPlayerHead"
local head_path = "UIPlayerHead/HeadIcon"
local head_fg_path = "UIPlayerHead/Foreground"
local name_path = "Name"

local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.player_head_btn = self:AddComponent(UIButton, head_btn_path)
    self.player_head_btn:SetOnClick(function()
        self:OnClick()
    end)
    self.player_head = self:AddComponent(UIPlayerHead, head_path)
    self.player_head_fg = self:AddComponent(UIImage, head_fg_path)
    self.name_text = self:AddComponent(UIText, name_path)
end

local function ComponentDestroy(self)
    self.player_head = nil
    self.player_head_fg = nil
    self.name_text = nil
end

local function DataDefine(self)
    self.data = nil
end

local function DataDestroy(self)
    self.data = nil
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function SetData(self, data)
    self.data = data
    self.player_head:SetData(data.uid, data.headPic, data.headPicVer)
    local headBgImg = DataCenter.DecorationDataManager:GetHeadFrame(data.headSkinId, data.headSkinET)
    if headBgImg ~= nil then
        self.player_head_fg:SetActive(true)
        self.player_head_fg:LoadSprite(headBgImg)
    else
        self.player_head_fg:SetActive(false)
    end
    if string.IsNullOrEmpty(data.allianceSimpleName) then
        self.name_text:SetText(data.userName)
    else
        self.name_text:SetText(string.format("[%s] %s", data.allianceSimpleName, data.userName))
    end
end

local function OnClick(self)
    if self.data.uid ~= LuaEntry.Player.uid then
        UIManager:GetInstance():OpenWindow(UIWindowNames.UIOtherPlayerInfo, self.data)
    else
        UIManager:GetInstance():OpenWindow(UIWindowNames.UIPlayerInfo, LuaEntry.Player.uid)
    end
end

UIChatRoomPlayer.OnCreate= OnCreate
UIChatRoomPlayer.OnDestroy = OnDestroy
UIChatRoomPlayer.ComponentDefine = ComponentDefine
UIChatRoomPlayer.ComponentDestroy = ComponentDestroy
UIChatRoomPlayer.DataDefine = DataDefine
UIChatRoomPlayer.DataDestroy = DataDestroy
UIChatRoomPlayer.OnEnable = OnEnable
UIChatRoomPlayer.OnDisable = OnDisable
UIChatRoomPlayer.OnAddListener = OnAddListener
UIChatRoomPlayer.OnRemoveListener = OnRemoveListener

UIChatRoomPlayer.SetData = SetData
UIChatRoomPlayer.OnClick = OnClick

return UIChatRoomPlayer