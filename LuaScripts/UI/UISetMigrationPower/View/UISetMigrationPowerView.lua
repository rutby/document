---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/4/18 19:25
---
local UISetMigrationPowerView = BaseClass("UISetMigrationPowerView",UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization

local txt_title_path ="UICommonMidPopUpTitle/bg_mid/titleText"
local close_btn_path = "UICommonMidPopUpTitle/bg_mid/CloseBtn"
local return_btn_path = "UICommonMidPopUpTitle/panel"
local toggle_path = "ImgBg/Content/toggle"
local button_path = "ImgBg/Button"
local des_text_path = "ImgBg/ScrollView/Viewport/Content/desText"
local select_text_path = "ImgBg/selectDes"
local red_dot_path = "ImgBg/Button/RedDot"
local red_dot_num_path = "ImgBg/Button/RedDot/redNum"
--创建
local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

-- 销毁
local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.txt_title = self:AddComponent(UIText, txt_title_path)
    self.txt_title:SetText(Localization:GetString("250353"))
    self.txt_des = self:AddComponent(UIText,des_text_path)
    self.txt_des:SetText(Localization:GetString("250354"))
    self.select_des = self:AddComponent(UIText,select_text_path)
    self.select_des:SetText(Localization:GetString("250355"))
    self.close_btn = self:AddComponent(UIButton, close_btn_path)
    self.return_btn = self:AddComponent(UIButton, return_btn_path)
    self.red_dot = self:AddComponent(UIBaseContainer, red_dot_path)
    self.red_dot_num = self:AddComponent(UIText, red_dot_num_path)
    self.btn = self:AddComponent(UIButton, button_path)
    local itemList = self.ctrl:GetItemList()
    self.curIndex = self.ctrl:GetCurIndex(itemList)
    self.toggleList = {}
    for i = 1, 6 do
        local togglePath = toggle_path .. i
        local tempTog = self:AddComponent(UIToggle, togglePath)
        tempTog:SetIsOn(i == self.curIndex)
        local TogTxtN = tempTog:AddComponent(UIText, "Name")
        local str = ""
        if i == 6 then
            str = Localization:GetString("150014")
        else
            str = string.GetFormattedSeperatorNum(tonumber(itemList[i]))
        end
        TogTxtN:SetText(str)
        table.insert(self.toggleList, tempTog)
    end

    for i = 1, #self.toggleList do
        local toggle = self.toggleList[i]
        toggle:SetOnValueChanged(function(tf)
            if tf then
                self:SetSelectedIndex(i)
            end
        end)
    end

    self.close_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.return_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.btn:SetOnClick(function()
        self:OnApplyListClick()
    end)
end

local function ComponentDestroy(self)
    self.txt_title = nil
    self.close_btn = nil
    self.return_btn = nil
end


local function DataDefine(self)
end

local function DataDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
    self:RefreshMigrate()
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function OnAddListener(self)
    base.OnAddListener(self)
    self:AddUIListener(EventId.OnRefreshMigrateRedPot, self.RefreshMigrate)
end

local function OnRemoveListener(self)
    self:RemoveUIListener(EventId.OnRefreshMigrateRedPot, self.RefreshMigrate)
    base.OnRemoveListener(self)
end

local function SetSelectedIndex(self, tempIndex)
    self.curSelectIndex = tempIndex
    self.ctrl:OnSetClick(self.curSelectIndex)
end

local function OnApplyListClick(self)
    UIManager:GetInstance():OpenWindow(UIWindowNames.UIMigrateApplyList)
end

local function RefreshMigrate(self)
    local count =0
    local data = DataCenter.MigrateDataManager:GetApplyList()
    if data~=nil then
        count = table.count(data)
    end
    if count>0 then
        self.red_dot:SetActive(true)
        self.red_dot_num:SetText(count)
    else
        self.red_dot:SetActive(false)
    end
end
UISetMigrationPowerView.OnCreate= OnCreate
UISetMigrationPowerView.OnDestroy = OnDestroy
UISetMigrationPowerView.OnEnable = OnEnable
UISetMigrationPowerView.OnDisable = OnDisable
UISetMigrationPowerView.ComponentDefine = ComponentDefine
UISetMigrationPowerView.ComponentDestroy = ComponentDestroy
UISetMigrationPowerView.DataDefine = DataDefine
UISetMigrationPowerView.DataDestroy = DataDestroy
UISetMigrationPowerView.SetSelectedIndex =SetSelectedIndex
UISetMigrationPowerView.OnApplyListClick = OnApplyListClick
UISetMigrationPowerView.OnAddListener = OnAddListener
UISetMigrationPowerView.OnRemoveListener = OnRemoveListener
UISetMigrationPowerView.RefreshMigrate = RefreshMigrate
return UISetMigrationPowerView