---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/4/18 19:25
---
local UISetMigrationPowerCtrl = BaseClass("UISetMigrationPowerCtrl", UIBaseCtrl)

local function CloseSelf(self)
    UIManager:GetInstance():DestroyWindow(UIWindowNames.UISetMigrationPower)
end

local function Close(self)
    UIManager:GetInstance():DestroyWindowByLayer(UILayer.Normal)
end

local function GetItemList(self)
    local arr = {}
    local serverLimit = LuaEntry.DataConfig:TryGetStr("aps_migrate_server", "k2")
    local sArr = string.split(serverLimit,"|")
    if sArr~=nil and #sArr>0 then
        local season = DataCenter.SeasonDataManager:GetSeason() or 0
        season = season +1
        if season>#sArr then
            season = #sArr
        end
        local str = sArr[season]
        arr = string.split(str,";")
    end
    
    return arr
end
local function GetCurIndex(self,list)
    local power = DataCenter.MigrateDataManager:GetPowerLimit()
    local index = 6
    if #list>0 and power>0 then
        for i=1,#list do
            if i<6 then
                local num = tonumber(list[i])
                if power<=num then
                    return i
                end
            end
        end
    end
    
    return index
end

local function OnSetClick(self,index)
    SFSNetwork.SendMessage(MsgDefines.MigrateSetPowerLimit,index-1)
end

UISetMigrationPowerCtrl.CloseSelf = CloseSelf
UISetMigrationPowerCtrl.Close = Close
UISetMigrationPowerCtrl.OnSetClick =OnSetClick
UISetMigrationPowerCtrl.GetCurIndex = GetCurIndex
UISetMigrationPowerCtrl.GetItemList = GetItemList
return UISetMigrationPowerCtrl