---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/11/9 16:11
---

local UITaskInfoItem = BaseClass("UITaskInfoItem", UIBaseContainer)
local base = UIBaseContainer
local notComplete_path = "NotComplete"
local complete_path = "Complete"
local taskInfoTxt_path = "taskInfoTxt"
local Localization = CS.GameEntry.Localization

function UITaskInfoItem : OnCreate()
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

function UITaskInfoItem : OnDestroy()
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

function UITaskInfoItem : ComponentDefine()
    self.notComplete = self:AddComponent(UIBaseContainer, notComplete_path)
    self.complete = self:AddComponent(UIBaseContainer, complete_path)
    self.taskInfoTxt = self:AddComponent(UITextMeshProUGUIEx, taskInfoTxt_path)
end

function UITaskInfoItem : ComponentDestroy()

end

function UITaskInfoItem : DataDefine()
    self.questId = nil
end

function UITaskInfoItem : DataDestroy()
    self.questId = nil
end

function UITaskInfoItem : OnAddListener()
    base.OnAddListener(self)
end

function UITaskInfoItem : OnRemoveListener()
    base.OnRemoveListener(self)
end

function UITaskInfoItem : Refresh(questId)
    self.questId = questId
    self:SetActive(self.questId ~= nil)
    if self.questId == nil then
        return
    end

    local taskData = DataCenter.ChapterTaskManager:FindTaskInfo(tostring(self.questId))
    if taskData == nil then
        taskData = DataCenter.TaskManager:FindTaskInfo(tostring(self.questId))
        if taskData == nil then
            taskData = DataCenter.DailyTaskManager:FindTaskInfo(tostring(self.questId))
        end
    end

    if taskData == nil then
        self:SetActive(false)
        return
    end
    local template = LocalController:instance():getLine(DataCenter.QuestTemplateManager:GetTableName(), taskData.id)
    local str = ""
    if tonumber(template.progressshow) == 1 then
        local num = 0
        if taskData.num >= template.para2 then
            num = template.para2
        else
            num = taskData.num
        end
        str = string.format(" ( %d/%d ) ",num, template.para2)
    else
        str = ""
    end
    if taskData.state == TaskState.CanReceive then
        str = Localization:GetString("170537")
        self.complete:SetActive(true)
        self.notComplete:SetActive(false)
        self.taskInfoTxt:SetColor(Color.New(126/255,70/255,16/255,1))
    else
        self.complete:SetActive(false)
        self.notComplete:SetActive(true)
        self.taskInfoTxt:SetColor(Color.New(94/255,69/255,64/255,1))
    end
    self.taskInfoTxt:SetText(DataCenter.QuestTemplateManager:GetDesc(template)..str)
end

return UITaskInfoItem