---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl
--- DateTime:
--- 
local UIActMonsterTowerRewardView = BaseClass("UIActMonsterTowerRewardView", UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization
local UIActMTRewardCell = require "UI.UIActMonsterTowerReward.Component.UIActMTRewardCell"

local title_path = "UICommonPopUpTitle/bg_mid/titleText"
local scroll_view_path = "ImgBg/ScrollView"
local closeBtn_path = "UICommonPopUpTitle/bg_mid/CloseBtn"
local maskBtn_path = "UICommonPopUpTitle/panel"


local function OnCreate(self)
    base.OnCreate(self)
    self.actId = self:GetUserData()
    self:ComponentDefine()
    self:DataDefine()
    self:ReInit()
end

local function OnDestroy(self)
    self:SetCellDestroy()
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function ComponentDefine(self)
    self.closeBtnN = self:AddComponent(UIButton, closeBtn_path)
    self.closeBtnN:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.maskBtnN = self:AddComponent(UIButton, maskBtn_path)
    self.maskBtnN:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.titleTxtN = self:AddComponent(UITextMeshProUGUIEx, title_path)
    
    self.scroll_view = self:AddComponent(UIScrollView, scroll_view_path)
    self.scroll_view:SetOnItemMoveIn(function(itemObj, index)
        self:OnCreateCell(itemObj, index)
    end)
    self.scroll_view:SetOnItemMoveOut(function(itemObj, index)
        self:OnDeleteCell(itemObj, index)
    end)
end

local function ComponentDestroy(self)
    --self.testN = nil
    self.goalN = nil
    self.tip1N = nil
    self.tip2N = nil
    self.tip3N = nil
    self.tip4N = nil
    self.joinBtnN = nil
    self.joinBtnTxtN = nil
    self.createBtnN = nil
    self.createBtnTxtN = nil
    self.closeBtnN = nil
end

local function DataDefine(self)

end

local function DataDestroy(self)
    
end

local function OnAddListener(self)
    base.OnAddListener(self)
    self:AddUIListener(EventId.ActMonTowerGetReward, self.OnRefresh)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
    self:RemoveUIListener(EventId.ActMonTowerGetReward, self.OnRefresh)
end

local function ReInit(self)
    self.titleTxtN:SetLocalText(372413)
    SFSNetwork.SendMessage(MsgDefines.GetChallengeActLevelRewardInfo,self.actId)
end

local function OnRefresh(self)
    self.actData = DataCenter.ActMonsterTowerData:GetInfoByActId(self.actId)
    self.listReward = self.actData:GetReward()
    self.scroll_view:SetTotalCount(#self.listReward)
    local index = self.actData.challengeInfo.curLevel == 0 and 1 or self.actData.challengeInfo.curLevel
    if index > #self.listReward - 3 then
        index = #self.listReward - 2
    end
    self.scroll_view:RefillCells(index)
end

local function OnCreateCell(self, itemObj, index)
    itemObj.name = tostring(index)
    local item = self.scroll_view:AddComponent(UIActMTRewardCell, itemObj)
    local isSelf = self.actData.challengeInfo.curLevel == index
    item:ShowRewards(self.listReward[index],isSelf)
end

local function OnDeleteCell(self, itemObj, index)
    self.scroll_view:RemoveComponent(itemObj.name, UIActMTRewardCell)
end

local function SetCellDestroy(self)
    self.scroll_view:ClearCells()
    self.scroll_view:RemoveComponents(UIActMTRewardCell)
    self.model = {}
end

UIActMonsterTowerRewardView.OnCreate = OnCreate
UIActMonsterTowerRewardView.OnDestroy = OnDestroy
UIActMonsterTowerRewardView.ComponentDefine = ComponentDefine
UIActMonsterTowerRewardView.DataDefine = DataDefine
UIActMonsterTowerRewardView.DataDestroy = DataDestroy
UIActMonsterTowerRewardView.OnAddListener = OnAddListener
UIActMonsterTowerRewardView.OnRemoveListener = OnRemoveListener
UIActMonsterTowerRewardView.OnRefresh = OnRefresh
UIActMonsterTowerRewardView.ReInit = ReInit
UIActMonsterTowerRewardView.SetCellDestroy = SetCellDestroy
UIActMonsterTowerRewardView.OnEnable = OnEnable
UIActMonsterTowerRewardView.OnDisable = OnDisable
UIActMonsterTowerRewardView.ComponentDestroy = ComponentDestroy
UIActMonsterTowerRewardView.OnCreateCell = OnCreateCell
UIActMonsterTowerRewardView.OnDeleteCell = OnDeleteCell
return UIActMonsterTowerRewardView