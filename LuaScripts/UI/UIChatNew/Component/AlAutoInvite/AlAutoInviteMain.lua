---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2022/7/14 17:12
---

local AlAutoInviteMain = BaseClass("AlAutoInviteMain", UIBaseContainer)
local base = UIBaseContainer
local AlAutoInviteItem = require "UI.UIChatNew.Component.AlAutoInvite.AlAutoInviteItem"

local inviteContent_path = "Content"
local inviteSr_path = ""

-- 创建
local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

-- 销毁
local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

-- 显示
local function OnEnable(self)
    base.OnEnable(self)
    DataCenter.AllianceAutoInviteManager:ResetUnreadCount()
    EventManager:GetInstance():Broadcast(EventId.OnGetNewAllianceAutoInvite)
end

-- 隐藏
local function OnDisable(self)
    base.OnDisable(self)
end


--控件的定义
local function ComponentDefine(self)
    self.inviteSrN = self:AddComponent(UIBaseContainer, inviteSr_path)
    self.inviteContentN = self:AddComponent(GridInfinityScrollView, inviteContent_path)
    self.inviteItemsTb = {}
end

--控件的销毁
local function ComponentDestroy(self)
    self:SetAllCellDestroy()
    self.inviteContentN = nil
    self.inviteSrN = nil
    self.inviteItemsTb = nil
end

--变量的定义
local function DataDefine(self)
    self.inviteList = {}
end

--变量的销毁
local function DataDestroy(self)
    self.inviteList = nil
end

local function OnAddListener(self)
    base.OnAddListener(self)
    --self:AddUIListener(EventId.OnSpecialTaskUpdate, self.UpdateView)
end


local function OnRemoveListener(self)
    base.OnRemoveListener(self)
    --self:RemoveUIListener(EventId.OnSpecialTaskUpdate, self.UpdateView)
end

local function Refresh(self)
    self:SetAllCellDestroy()
    local bindFunc1 = BindCallback(self, self.OnInitScroll)
    local bindFunc2 = BindCallback(self, self.OnUpdateScroll)
    local bindFunc3 = BindCallback(self, self.OnDestroyScrollItem)
    self.inviteContentN:Init(bindFunc1,bindFunc2, bindFunc3)
    
    self.inviteList = DataCenter.AllianceAutoInviteManager:GetAutoInviteList()
    local tempCount = #self.inviteList
    if tempCount > 0 then
        self.inviteContentN:SetItemCount(tempCount)
    end
end


local function OnInitScroll(self,go,index)
    local item = self.inviteSrN:AddComponent(AlAutoInviteItem, go)
    self.inviteItemsTb[go] = item
end

local function OnUpdateScroll(self,go,index)
    local inviteInfo = self.inviteList[index + 1]
    local cellItem = self.inviteItemsTb[go]
    if inviteInfo == nil then 
        return
    end
    cellItem:SetItem(inviteInfo)
end

local function OnDestroyScrollItem(self,go, index)
    
end

local function SetAllCellDestroy(self)
    self.inviteSrN:RemoveComponents(AlAutoInviteItem)
    self.inviteContentN:DestroyChildNode()
end



AlAutoInviteMain.OnCreate = OnCreate
AlAutoInviteMain.OnDestroy = OnDestroy
AlAutoInviteMain.OnEnable = OnEnable
AlAutoInviteMain.OnDisable = OnDisable
AlAutoInviteMain.ComponentDefine = ComponentDefine
AlAutoInviteMain.ComponentDestroy = ComponentDestroy
AlAutoInviteMain.DataDefine = DataDefine
AlAutoInviteMain.DataDestroy = DataDestroy
AlAutoInviteMain.OnAddListener = OnAddListener
AlAutoInviteMain.OnRemoveListener = OnRemoveListener

AlAutoInviteMain.Refresh = Refresh
AlAutoInviteMain.OnInitScroll = OnInitScroll
AlAutoInviteMain.OnUpdateScroll = OnUpdateScroll
AlAutoInviteMain.OnDestroyScrollItem = OnDestroyScrollItem
AlAutoInviteMain.SetAllCellDestroy = SetAllCellDestroy
return AlAutoInviteMain