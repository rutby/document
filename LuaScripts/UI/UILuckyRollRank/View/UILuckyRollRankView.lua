---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl
--- DateTime:
--- 
local UILuckyRollRankView = BaseClass("UILuckyRollRankView", UIBaseView)
local base = UIBaseView
local LuckRollRewardRank = require "UI.UILuckyRollRank.Component.LuckRollRewardRank"
local LuckRollPersonRank = require "UI.UILuckyRollRank.Component.LuckRollPersonRank"
function UILuckyRollRankView:OnCreate()
    base.OnCreate(self)
    
    self._title_txt = self:AddComponent(UITextMeshProUGUIEx,"UICommonPopUpTitle/bg_mid/titleText")
    self._title_txt:SetLocalText(390040)
    
    self._close_btn = self:AddComponent(UIButton,"UICommonPopUpTitle/bg_mid/CloseBtn")
    self._close_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.toogle1 = self:AddComponent(UIToggle,"ImgBg/ToggleGroupBg/ToggleGroup/Toggle1")
    self.toogle1:SetIsOn(true)
    self.toogle1:SetOnValueChanged(function(tf)
        if tf then
            self:ToggleControlBorS()
        end
    end)
    self.toogle1.choose = self.toogle1:AddComponent(UIBaseContainer, "Background/Checkmark1")
    self.toogle1.arrow = self.toogle1:AddComponent(UIBaseContainer, "Background/Checkmark1/arrow1")
    self.toogle1.unselectName = self.toogle1:AddComponent(UITextMeshProUGUIEx, "text1")
    self.toogle1.selectName = self.toogle1:AddComponent(UITextMeshProUGUIEx, "checkText1")
    self.toogle1.unselectName:SetLocalText(302043)
    self.toogle1.selectName:SetLocalText(302043)

    self.toogle2 = self:AddComponent(UIToggle, "ImgBg/ToggleGroupBg/ToggleGroup/Toggle2")
    self.toogle2:SetIsOn(false)
    self.toogle2:SetOnValueChanged(function(tf)
        if tf then
            self:ToggleControlBorS()
        end
    end)
    self.toogle2.choose = self.toogle2:AddComponent(UIBaseContainer, "Background/Checkmark2")
    self.toogle2.arrow = self.toogle2:AddComponent(UIBaseContainer, "Background/Checkmark2/arrow2")
    self.toogle2.unselectName = self.toogle2:AddComponent(UITextMeshProUGUIEx, "text2")
    self.toogle2.selectName = self.toogle2:AddComponent(UITextMeshProUGUIEx, "checkText2")
    self.toogle2.unselectName:SetLocalText(450084)
    self.toogle2.selectName:SetLocalText(450084)
    
    self.rewardObj = self:AddComponent(LuckRollRewardRank,"ImgBg/reward")
    self.rankObj = self:AddComponent(LuckRollPersonRank,"ImgBg/rank")
    self.receiveMessage = false
    self.selectTab = 1
end

function UILuckyRollRankView:OnDestroy()
    base.OnDestroy(self)
end

function UILuckyRollRankView:OnEnable()
    base.OnEnable(self)
    local actId,serverStr = self:GetUserData()
    self.isServerRank = false
    if serverStr then
        self.isServerRank = true
    --    self._title_txt:SetLocalText(372614,serverStr)
    --else
    --    self._title_txt:SetLocalText(390040)
    end
    self:RefreshRank(actId)
    self:ToggleControlBorS()
end

function UILuckyRollRankView:OnDisable()
    base.OnDisable(self)
end

function UILuckyRollRankView:OnAddListener()
    base.OnAddListener(self)
    self:AddUIListener(EventId.ActLuckyRollRankUpdate, self.OnRefresh)
end

function UILuckyRollRankView:OnRemoveListener()
    base.OnRemoveListener(self)
    self:RemoveUIListener(EventId.ActLuckyRollRankUpdate, self.OnRefresh)
end

function UILuckyRollRankView:RefreshRank(activityId)
    self.activityId = activityId
    SFSNetwork.SendMessage(MsgDefines.GetLuckRollRank,activityId)
end

function UILuckyRollRankView:ToggleControlBorS()
    self.toogle1.selectName:SetActive(self.toogle1:GetIsOn())
    self.toogle2.selectName:SetActive(self.toogle2:GetIsOn())
    self.toogle1.unselectName:SetActive(self.toogle1:GetIsOn()==false)
    self.toogle2.unselectName:SetActive(self.toogle2:GetIsOn()==false)
    self.toogle1.arrow:SetActive(self.toogle1:GetIsOn())
    self.toogle2.arrow:SetActive(self.toogle2:GetIsOn())
    if self.toogle1:GetIsOn() then
        self.selectTab = 1
        self.rankObj:SetActive(true)
        self.rewardObj:SetActive(false)
    elseif self.toogle2:GetIsOn() then
        self.selectTab = 2
        self.rankObj:SetActive(false)
        self.rewardObj:SetActive(true)
    end
    self:OnRefresh()
end

function UILuckyRollRankView:OnRefresh()
    self.actData = DataCenter.ActLuckyRollInfo:GetInfoByActId(tonumber(self.activityId))
    if self.actData then
        self.receiveMessage = true
        if self.selectTab ==1 then
            self.rankObj:OnRefresh(self.actData)
        elseif self.selectTab ==2 then
            self.rewardObj:OnRefresh(self.actData)
        end
    end
end


return UILuckyRollRankView