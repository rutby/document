---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 22/2/2024 上午10:55
---
local LuckyRollRewardItem = BaseClass("LuckyRollRewardItem", UIBaseContainer)
local base = UIBaseContainer
local MailRewardItem = require "UI.UIMailNew.UIMailMainPanel.Component.MailRewardItem"

local content_path = "rankInfo/Rewards"
local rankNum_path = "rankInfo/rank"
local rankImg_path = "rankInfo/rankImg"

local function OnCreate(self)
    base.OnCreate(self)

    self.rewardModels ={}
    self.rewardItemsList = {}
    self.rankNumN = self:AddComponent(UITextMeshProUGUIEx, rankNum_path)
    self.rankImgN = self:AddComponent(UIImage, rankImg_path)
    self.contentN = self:AddComponent(UIBaseContainer, content_path)
end

local function OnDestroy(self)
    self:SetAllRewardsDestroy()
    base.OnDestroy(self)
end


local function ShowRewards(self,rewardItem)
    local startRank = rewardItem.startN
    local endRank = rewardItem.endN
    if startRank == endRank then
        if startRank<4 then
            self.rankImgN:SetActive(true)
            self.rankNumN:SetActive(false)
            self.rankImgN:LoadSprite("Assets/Main/Sprites/UI/Common/UIalliance_rankingbg0" .. startRank)
        else
            self.rankNumN:SetActive(true)
            self.rankImgN:SetActive(false)
            self.rankNumN:SetText(startRank)
        end
    else
        self.rankNumN:SetActive(true)
        self.rankImgN:SetActive(false)
        self.rankNumN:SetText(startRank.."-"..endRank)
    end
    local list = rewardItem.reward
    self:SetAllRewardsDestroy()
    self.rewardModelCount =0
    if list~=nil and #list>0 then
        for i = 1, table.length(list) do
            --复制基础prefab，每次循环创建一次
            self.rewardModelCount= self.rewardModelCount+1
            if self.rewardModelCount<=5 then
                self.rewardModels[self.rewardModelCount] = self:GameObjectInstantiateAsync(UIAssets.UICommonItemSize, function(request)
                    if request.isError then
                        return

                    end
                    local go = request.gameObject;
                    go.gameObject:SetActive(true)
                    go.transform:SetParent(self.contentN.transform)
                    go.transform.localScale = Vector3.one
                    local nameStr = tostring(NameCount)
                    go.name = nameStr
                    NameCount = NameCount + 1
                    local cell = self.contentN:AddComponent(MailRewardItem,nameStr)
                    cell:ShowCount(hideCount)
                    local param = {}
                    param.itemId = list[i].itemId
                    param.rewardType = list[i].rewardType
                    param.count = list[i].count
                    cell:RefreshData(param)
                    cell:SetNameText("")
                    CS.UnityEngine.UI.LayoutRebuilder.ForceRebuildLayoutImmediate(self.rectTransform)
                    table.insert(self.rewardItemsList,cell)
                end)
            end
            
        end
    end
end


local function SetAllRewardsDestroy(self)
    self.contentN:RemoveComponents(MailRewardItem)
    if self.rewardModels~=nil then
        for k,v in pairs(self.rewardModels) do
            if v ~= nil then
                self:GameObjectDestroy(v)
            end
        end
    end
    self.rewardModels ={}
    self.rewardItemsList = {}
end


LuckyRollRewardItem.OnCreate = OnCreate
LuckyRollRewardItem.OnDestroy = OnDestroy


LuckyRollRewardItem.ShowRewards = ShowRewards
LuckyRollRewardItem.SetAllRewardsDestroy = SetAllRewardsDestroy

return LuckyRollRewardItem