---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 22/2/2024 上午10:15
---
local LuckRollPersonRank = BaseClass("LuckRollPersonRank", UIBaseContainer)
local base = UIBaseContainer
local LuckyRollRankItem = require "UI.UILuckyRollRank.Component.LuckyRollRankItem"
function LuckRollPersonRank:OnCreate()
    base.OnCreate(self)
    self.selfRank = self:AddComponent(LuckyRollRankItem,"selfObj")
    self.scroll_view = self:AddComponent(UIScrollView, "ScrollView")
    self.scroll_view:SetOnItemMoveIn(function(itemObj, index)
        self:OnRankItemMoveIn(itemObj, index)
    end)
    self.scroll_view:SetOnItemMoveOut(function(itemObj, index)
        self:OnRankItemMoveOut(itemObj, index)
    end)
    self.isInit = false
end

function LuckRollPersonRank:OnDestroy()
    self:ClearScroll()
    base.OnDestroy(self)
end

function LuckRollPersonRank:OnEnable()
    base.OnEnable(self)
end

function LuckRollPersonRank:OnDisable()
    base.OnDisable(self)
end

function LuckRollPersonRank:OnRefresh(actData)
    if self.isInit == true then
        return
    end
    self.actData = actData
    if self.actData then
        local selfData = {}
        local selfRank = self.actData.selfRank
        if selfRank ~= -1 then
            selfData.rank = selfRank
        else
            selfData.rank = 999
        end
        selfData.serverId = LuaEntry.Player:GetSelfServerId()
        selfData.name = LuaEntry.Player.name
        selfData.score = self.actData.selfScore
        selfData.uid = LuaEntry.Player.uid
        selfData.pic = LuaEntry.Player.pic
        selfData.picVer = LuaEntry.Player.picVer
        selfData.isMonthCardShow = DataCenter.MonthCardNewManager:CheckIfMonthCardActive()
        self.selfRank:SetItemShow(selfData)
        self:ClearScroll()
        self.rankList = self.actData.rankList
        if self.rankList and #self.rankList >0 then
            self.scroll_view:SetTotalCount(#self.rankList)
            self.scroll_view:RefillCells()
        --else
        --    self._noRank_txt:SetActive(true)
        --    self._noRank_txt:SetLocalText(110534)
        end
        self.isInit = true
    end
end

function LuckRollPersonRank:OnRankItemMoveIn(itemObj, index)
    itemObj.name = tostring(index)
    local cellItem = self.scroll_view:AddComponent(LuckyRollRankItem, itemObj)
    cellItem:SetItemShow(self.rankList[index])
end

function LuckRollPersonRank:OnRankItemMoveOut( itemObj, index)
    self.scroll_view:RemoveComponent(itemObj.name, LuckyRollRankItem)
end

function LuckRollPersonRank:ClearScroll()
    self.scroll_view:ClearCells()
    self.scroll_view:RemoveComponents(LuckyRollRankItem)
end


return LuckRollPersonRank