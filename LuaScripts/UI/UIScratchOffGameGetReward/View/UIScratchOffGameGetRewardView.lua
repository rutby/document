---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1020.
--- DateTime: 2023/5/23 15:32
---

local UIScratchOffGameGetRewardView = BaseClass("UIScratchOffGameGetRewardView", UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization
local ScratchOffLuckyIconItem = require "UI.UIScratchOffGameGetReward.Comp.ScratchOffLuckyIconItem"
local UICommonItem = require "UI.UICommonItem.UICommonItem"

local nextOrCloseBtn_path = "UICommonRewardPopUp/Panel"
local titleTxt_path = "UICommonRewardPopUp/Panel/ImgTitleBg/TextTitle"
local tenDrawRoot_path = "Root/tenDrawRoot"
local oneDrawRoot_path = "Root/oneDrawRoot"
local tenLuckyIconItem_path = "Root/tenDrawRoot/Bottom/ScratchOffLuckyIconItem"
local oneLuckyIconItem_path = "Root/oneDrawRoot/Bottom/oneDrawLuckyIconItem"
local tenCommonResItem_path = "Root/tenDrawRoot/Top/UICommonItem"
local oneCommonResItem_path = "Root/oneDrawRoot/Top/oneDrawResItem"
local luckyPatternTxt_path = "Root/luckyPatternTxt"
local rewardDesTxt_path = "Root2/DesRoot/rewardDesTxt"
local rewardResNumTxt_path = "Root2/DesRoot/NeedResCell/resNumTxt"
local lotteryResRoot_path = "Root"
local getRewardRoot_path = "Root2"
local diamondEff_path = "Root2/diamondImg/diamondEff" 
local anim_path = ""
local titleAnim_path = "UICommonRewardPopUp"

local tenNum = 10

function UIScratchOffGameGetRewardView : OnCreate()
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

function UIScratchOffGameGetRewardView : OnDestroy()
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

function UIScratchOffGameGetRewardView : OnEnable()
    self.activityId = self:GetUserData()
	self:RefreshView()
    base.OnEnable(self)
end

function UIScratchOffGameGetRewardView : DataDefine()
    self.tenLuckyIconItemList = {}
    self.oneLuckIconItem = nil
    self.tenCommonResItemList = {}
    self.oneCommonResItem = nil
end

function UIScratchOffGameGetRewardView : DataDestroy()
    
end

function UIScratchOffGameGetRewardView : ComponentDefine()
    self.nextOrCloseBtn = self:AddComponent(UIButton, nextOrCloseBtn_path)
    self.nextOrCloseBtn:SetOnClick(function()
        self:OnClickNextOrCloseBtn()
    end)
    
    self.titleTxt = self:AddComponent(UIText, titleTxt_path)
    self.titleTxt:SetLocalText(128027)

    self.tenDrawRoot = self:AddComponent(UIBaseContainer, tenDrawRoot_path)
    self.oneDrawRoot = self:AddComponent(UIBaseContainer, oneDrawRoot_path)
    
    for i = 1, tenNum do
        local luckyIconItem = self:AddComponent(ScratchOffLuckyIconItem, tenLuckyIconItem_path..i)
        table.insert(self.tenLuckyIconItemList, luckyIconItem)
        local commonResItem = self:AddComponent(UICommonItem, tenCommonResItem_path..i)
        table.insert(self.tenCommonResItemList, commonResItem)
    end
    local luckyIconItem = self:AddComponent(ScratchOffLuckyIconItem, oneLuckyIconItem_path)
    self.oneLuckIconItem = luckyIconItem
    local commonResItem = self:AddComponent(UICommonItem, oneCommonResItem_path)
    self.oneCommonResItem = commonResItem
    
    self.luckyPatternTxt = self:AddComponent(UIText, luckyPatternTxt_path)
    self.luckyPatternTxt:SetLocalText(372927)
    self.rewardDesTxt = self:AddComponent(UIText, rewardDesTxt_path)
    self.rewardResNumTxt = self:AddComponent(UIText, rewardResNumTxt_path)

    self.lotteryResRoot = self:AddComponent(UIBaseContainer, lotteryResRoot_path)
    self.getRewardRoot = self:AddComponent(UIBaseContainer, getRewardRoot_path)
    
    self.diamondEff = self:AddComponent(UIBaseContainer, diamondEff_path)
    self.anim = self:AddComponent(UIAnimator, anim_path)
    self.titleAnim = self:AddComponent(UIAnimator, titleAnim_path)
end

function UIScratchOffGameGetRewardView : ComponentDestroy()
    
end

function UIScratchOffGameGetRewardView : RefreshView()
    local lotteryResInfo = self.ctrl:GetRecentLotteryRes(self.activityId)
    if lotteryResInfo then
        self.lotteryResInfo = lotteryResInfo
        self.ifLottery = lotteryResInfo.ifLottery
        if self.ifLottery then
            self.curShowDiamondInfoIndex = 1
            self.diamondInfoList = lotteryResInfo.diamondInfoList
        end
        self:ShowLotteryRes()
    end
end

function UIScratchOffGameGetRewardView : ShowLotteryRes()
    self.lotteryResRoot:SetActive(true)
    self.getRewardRoot:SetActive(false)
    local lotteryCount = self.lotteryResInfo.lotteryCount
    if lotteryCount == tenNum then
        self.tenDrawRoot:SetActive(true)
        self.oneDrawRoot:SetActive(false)
        for i = 1, tenNum do
            self.tenLuckyIconItemList[i]:SetData(self.lotteryResInfo.luckyIconItemInfoList[i])
            self.tenCommonResItemList[i]:ReInit(self.lotteryResInfo.commonResItemInfoList[i])
        end
    else
        self.tenDrawRoot:SetActive(false)
        self.oneDrawRoot:SetActive(true)
        self.oneLuckIconItem:SetData(self.lotteryResInfo.luckyIconItemInfoList[1])
        self.oneCommonResItem:ReInit(self.lotteryResInfo.commonResItemInfoList[1])
    end
end

function UIScratchOffGameGetRewardView : ShowGetDiamond()
    self.lotteryResRoot:SetActive(false)
    self.getRewardRoot:SetActive(true)

    --local text = Localization:GetString("372932",self.diamondInfoList[self.curShowDiamondInfoIndex].levelTxt,self.diamondInfoList[self.curShowDiamondInfoIndex].diamond)
    self.rewardDesTxt:SetLocalText(372932)
    self.rewardResNumTxt:SetText(self.diamondInfoList[self.curShowDiamondInfoIndex].diamond)
    self.curShowDiamondInfoIndex = self.curShowDiamondInfoIndex + 1
    
    --self.anim:SetActive(false)
    --self.anim:SetActive(true)
    self.diamondEff:SetActive(false)
    local ret1,time1 = self.anim:PlayAnimationReturnTime("CommonPopup_movein")
    self.titleAnim:PlayAnimationReturnTime("V_ui_jiesuan_title_anim")
    TimerManager:GetInstance():DelayInvoke(function()
        self.diamondEff:SetActive(true)
    end, time1)
end

function UIScratchOffGameGetRewardView : OnAddListener()
    base.OnAddListener(self)
    --self:AddUIListener(EventId.ScratchOffGameRewardLotteryInfoUpdate, self.RefreshView)
end

function UIScratchOffGameGetRewardView : OnRemoveListener()
    --self:RemoveUIListener(EventId.ScratchOffGameRewardLotteryInfoUpdate, self.RefreshView)
    base.OnRemoveListener(self)
end

function UIScratchOffGameGetRewardView : OnClickNextOrCloseBtn()
    if self.ifLottery and self.diamondInfoList and self.curShowDiamondInfoIndex <= #self.diamondInfoList then
        self:ShowGetDiamond()
    else
        self.ctrl:CloseSelf()
    end
end

return UIScratchOffGameGetRewardView