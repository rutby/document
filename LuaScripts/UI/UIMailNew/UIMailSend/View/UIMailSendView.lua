---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by guq.
--- DateTime: 2020/12/17 22:09
---
local UIMailSendView = BaseClass("UIMailSendView",UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization

local mailTo_path = "offset/container/receiver"
local titleTxt_path = "offset/container/titleTxt"
local text_path = "offset/container/text"
local mailTitleInput_path = "offset/container/inputTitle"
local mailTitleTxt_path = "offset/container/inputTitle/Text Area/titlePlaceholder"
local sendBtn_path = "offset/container/sendBtn"
local sendBtnTxt_path = "offset/container/sendBtn/sendTxt"
local closeBtn_path = "offset/common/closeBtn"
local mailContentInput_path = "offset/container/inputContent"
local mailContentTxt_path = "offset/container/inputContent/Text Area/contentPlaceholder"
local mailContentLength_path = "offset/container/contentLength"

local function OnCreate(self)
    base.OnCreate(self)
    self.mailType = 0
    self.maxTitleL = 50--MK: LuaEntry.DataConfig:TryGetNum("mail_max_word", "k1")
    self.maxContentL = 2000--MK: LuaEntry.DataConfig:TryGetNum("mail_max_word", "k2")
    self.mailTitle = ""
    self.mailContent = ""
    
    self.titleTxtN = self:AddComponent(UITextMeshProUGUIEx, titleTxt_path)
    self.titleTxtN:SetLocalText(450033)
    self.textN = self:AddComponent(UITextMeshProUGUIEx, text_path)
    self.textN:SetLocalText(450034)
    self.mailToN = self:AddComponent(UITextMeshProUGUIEx, mailTo_path)
    self.mailTitleInputN = self:AddComponent(UITMPInput, mailTitleInput_path)
    self.mailTitleInputN:SetOnEndEdit(function (value)
        self:OnInputMailTitle(value)
    end)
    self.mailTitleTxtN = self:AddComponent(UITextMeshProUGUIEx, mailTitleTxt_path)
    self.sendBtnN = self:AddComponent(UIButton, sendBtn_path)
    self.sendBtnN:SetOnClick(function()
        self:OnClickSendBtn()
    end)
    self.sendBtnTxtN = self:AddComponent(UITextMeshProUGUIEx, sendBtnTxt_path)
    self.closeBtnN = self:AddComponent(UIButton, closeBtn_path)
    self.closeBtnN:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.mailContentInputN = self:AddComponent(UITMPInput, mailContentInput_path)
    self.mailContentInputN:SetOnEndEdit(function (value)
        self:OnInputMailContent(value)
    end)
    self.mailContentTxtN = self:AddComponent(UITextMeshProUGUIEx, mailContentTxt_path)
    self.mailContentLengthN = self:AddComponent(UITextMeshProUGUIEx, mailContentLength_path)
    
    self:InitUI()
end

local function OnDestroy(self)
    self.mailType = 0
    self.mailToN = nil
    self.mailTitleInputN = nil
    self.mailTitleTxtN = nil
    self.sendBtnN = nil
    self.closeBtnN = nil
    self.mailContentInputN = nil
    self.mailContentTxtN = nil
    self.mailContentLengthN = nil
    base.OnDestroy(self)
end

local function InitUI(self)
    self.mailType = self:GetUserData()
    self.mailToN:SetLocalText(141053)
    self.mailTitleTxtN:SetLocalText(141054)
    self.mailContentTxtN:SetLocalText(141055)
    self.sendBtnTxtN:SetLocalText(141056)
    self.mailContentLengthN:SetText(string.len(self.mailContent) .. "/" .. 2000)
    self.mailTitleInputN:SetText("")
    self.mailContentInputN:SetText("")
    self:ShowDes()
end

local function OnInputMailTitle(self, str)
    if string.len(str) > self.maxTitleL then
        UIUtil.ShowTips(Localization:GetString("141057", Localization:GetString("141061")))
    else
        self.mailTitle = str
    end
    self.mailTitleInputN:SetText(self.mailTitle)
end

local function OnInputMailContent(self, str)
    if string.len(str) > self.maxContentL then
        UIUtil.ShowTips(Localization:GetString("141058", Localization:GetString("141062")))
    else
        self.mailContent = str
    end
    self.mailContentInputN:SetText(self.mailContent)
    self.mailContentLengthN:SetText(string.len(self.mailContent) .. "/" .. 2000)
end

local function OnClickSendBtn(self)
    if string.IsNullOrEmpty(self.mailTitle) then
        UIUtil.ShowTipsId(141059)
        return
    end
    if string.IsNullOrEmpty(self.mailContent) then
        UIUtil.ShowTipsId(141060)
        return
    end
    if self.mailType == MailType.MAIL_ALLIANCE_ALL then
        self.ctrl:OnSendClick(MailType.MAIL_ALLIANCE_ALL, LuaEntry.Player.uid, LuaEntry.Player.name, self.mailTitle, self.mailContent, LuaEntry.Player.allianceId)
    elseif self.mailType == MailType.MAIL_PRESIDENT_SEND then
        self.ctrl:OnSendClick(MailType.MAIL_PRESIDENT_SEND, nil, nil, self.mailTitle, self.mailContent, nil)
    else
        self.ctrl:OnSendClick(MailType.MAIL_SELF_SEND, LuaEntry.Player.uid, LuaEntry.Player.name, self.mailTitle, self.mailContent, LuaEntry.Player.allianceId)
    end
end

function UIMailSendView:ShowDes()
    if self.mailType == MailType.MAIL_ALLIANCE_ALL then
        self.mailToN:SetLocalText(141053)
    elseif self.mailType == MailType.MAIL_PRESIDENT_SEND then
        self.mailToN:SetLocalText(GameDialogDefine.MAIL_TO_ALL)
    elseif self.mailType == MailType.MAIL_SELF_SEND then
        self.mailToN:SetLocalText(141053)
    end
end

UIMailSendView.OnCreate= OnCreate
UIMailSendView.OnDestroy = OnDestroy
UIMailSendView.InitUI = InitUI
UIMailSendView.OnClickSendBtn = OnClickSendBtn
UIMailSendView.OnInputMailTitle = OnInputMailTitle
UIMailSendView.OnInputMailContent = OnInputMailContent

return UIMailSendView