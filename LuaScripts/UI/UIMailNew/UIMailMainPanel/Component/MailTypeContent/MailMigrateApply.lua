---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/4/19 10:23
---
local MailMigrateApply = BaseClass("MailMigrateApply",UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local base64 = require "Framework.Common.base64"
local rapidjson = require "rapidjson"
local MailParseHelper = require "DataCenter.MailData.MailParseHelper"
local _cp_this = ""
local _cp_txtMainTitle = "UIMailItemTitle/txtMainTitle"
local _cp_txtSubTitle = "UIMailItemTitle/txtSubTitle"
local _cp_txtTime = "UIMailItemTitle/txtTime"
local _cp_txtDesc = "txtDesc"
local _cp_btn_obj = "objBtn"
local _cp_btn = "objBtn/btn"
local _cp_btn_txt = "objBtn/btn/txtBtn"

function MailMigrateApply:OnCreate()
    base.OnCreate(self)
    self.go = self:AddComponent(UIBaseContainer, _cp_this)
    self._txtMainTitle = self:AddComponent(UITextMeshProUGUIEx, _cp_txtMainTitle)
    self._txtSubTitle = self:AddComponent(UITextMeshProUGUIEx, _cp_txtSubTitle)
    self._txtTime = self:AddComponent(UITextMeshProUGUIEx, _cp_txtTime)
    self._txtDesc = self:AddComponent(UITextMeshProUGUIEx, _cp_txtDesc)
    self._btn_txt = self:AddComponent(UITextMeshProUGUIEx, _cp_btn_txt)
    self.btn_obj = self:AddComponent(UIBaseContainer, _cp_btn_obj)
    self.btn = self:AddComponent(UIButton, _cp_btn)
    self.btn:SetOnClick(function()
        self:OnJumpClick()
    end)
end


function MailMigrateApply:OnDisable()
    base.OnDisable(self)
end


function MailMigrateApply:setData( maildata )
    self._mailData = maildata
    -- 设置数据
    local _strTitle = MailShowHelper.GetMainTitle(maildata)
    self._txtMainTitle:SetText(_strTitle)
    local _strSubTitle = MailShowHelper.GetMailSubTitle(maildata)
    self._txtSubTitle:SetText(_strSubTitle)
    local _strTime = MailShowHelper.GetAbstractCreateTime(maildata)
    self._txtTime:SetText(_strTime)
    local ext = self._mailData:GetMailExt()
    local strDes = ""
    if ext~=nil then
        self.extData = ext
        if self.extData~=nil then
            if self.extData.type ==1 then
                strDes = Localization:GetString("250360",self.extData.serverId)
                self._btn_txt:SetText(Localization:GetString("110003"))
            elseif self.extData.type ==2 then
                strDes = Localization:GetString("250362",self.extData.serverId)
                self._btn_txt:SetText(Localization:GetString("250328"))
            end
        end
    end
    self._txtDesc:SetText(strDes)
end

function MailMigrateApply:OnJumpClick()
    if self.extData~=nil then
        if self.extData.type ==1 then
            UIManager:GetInstance():OpenWindow(UIWindowNames.UIMigrateList,self.extData.serverId)
        elseif self.extData.type == 2 then
            if self.extData.king~=nil then
                local userId = self.extData.king["uid"]
                local userName = self.extData.king["name"]
                if userId~=nil and userId~="" then
                    local roomId = ChatManager2:GetInstance().Room:GetPrivateRoomByUserId(userId)
                    local param = {}
                    param["roomId"] = roomId
                    param["userId"] = userId
                    param["username"] = userName
                    GoToUtil.GotoOpenView(UIWindowNames.UIChatNew,{anim = false, hideTop = true ,UIMainAnim = UIMainAnimType.AllHide},param)
                    return
                end
            end
        end
    end
end
return MailMigrateApply