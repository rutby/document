---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/5/11 16:22
---

local UIMailDefenceDetailItem = BaseClass("UIMailDefenceDetailItem", UIBaseContainer)
local base = UIBaseContainer
local UIMailDefenceDetailCell = require "UI.UIMailNew.UIMailDefenceDetail.Component.UIMailDefenceDetailCell"

local name_path = "titleObj/txtUserName"
local total_path = "titleObj/txttotal"
local dead_path = "titleObj/txtdead"
local injured_path = "titleObj/txtinjure"
local wounded_path = "titleObj/txtwounded"
local cured_path = "titleObj/txtcurve"
local alive_path = "titleObj/txtalive"
local prefab_path = "totalMsg"
local content_path = "objInfolist"
local show_path = "titleObj/btnShow"
local open_path = "titleObj/btnShow/imgOpen"
local close_path = "titleObj/btnShow/imgClose"

local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    self:ClearCells()
    base.OnDisable(self)
end

local function ComponentDefine(self)
    self.name_text = self:AddComponent(UIText, name_path)
    self.total_text = self:AddComponent(UIText, total_path)
    self.dead_text = self:AddComponent(UIText, dead_path)
    self.injured_text = self:AddComponent(UIText, injured_path)
    self.wounded_text = self:AddComponent(UIText, wounded_path)
    self.cured_text = self:AddComponent(UIText, cured_path)
    self.alive_text = self:AddComponent(UIText, alive_path)
    self.content_go = self:AddComponent(UIBaseContainer, content_path)
    self.prefab_go = self:AddComponent(UIBaseContainer, prefab_path)
    self.prefab_go.gameObject:GameObjectCreatePool()
    self.show_btn = self:AddComponent(UIButton, show_path)
    self.show_btn:SetOnClick(function()
        self:OnShowClick()
    end)
    self.open_go = self:AddComponent(UIBaseContainer, open_path)
    self.close_go = self:AddComponent(UIBaseContainer, close_path)
end

local function ComponentDestroy(self)
    
end

local function DataDefine(self)
    self.show = false
    self.list = {}
    self.cells = {}
end

local function DataDestroy(self)
    
end

local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function SetData(self, data)
    self.name_text:SetText(data.name)
    self.name_text:SetColor(data.nameColor)
    self.total_text:SetText(string.GetFormattedSeperatorNum(data.total))
    self.dead_text:SetText(string.GetFormattedSeperatorNum(data.dead))
    self.injured_text:SetText(string.GetFormattedSeperatorNum(data.injured))
    self.wounded_text:SetText(string.GetFormattedSeperatorNum(data.wounded))
    self.cured_text:SetText(string.GetFormattedSeperatorNum(data.cured))
    self.alive_text:SetText(string.GetFormattedSeperatorNum(data.alive))
    self.list = data.list
    self:ShowCells()
    self:SetShow(true)
end

local function SetShow(self, show)
    self.show = show
    self.open_go:SetActive(show)
    self.close_go:SetActive(not show)
    for _, cell in pairs(self.cells) do
        cell:SetActive(show)
    end
end

local function ShowCells(self)
    self:ClearCells()
    for i, data in ipairs(self.list) do
        local go = self.prefab_go.gameObject:GameObjectSpawn(self.content_go.transform)
        go.name = tostring(i)
        local cell = self.content_go:AddComponent(UIMailDefenceDetailCell, go.name)
        cell:SetData(data)
        self.cells[i] = cell
    end
end

local function ClearCells(self)
    self.prefab_go.gameObject:GameObjectRecycleAll()
    self.content_go:RemoveComponents(UIMailDefenceDetailCell)
end

local function OnShowClick(self)
    self:SetShow(not self.show)
end

UIMailDefenceDetailItem.OnCreate = OnCreate
UIMailDefenceDetailItem.OnDestroy = OnDestroy
UIMailDefenceDetailItem.OnEnable = OnEnable
UIMailDefenceDetailItem.OnDisable = OnDisable
UIMailDefenceDetailItem.ComponentDefine = ComponentDefine
UIMailDefenceDetailItem.ComponentDestroy = ComponentDestroy
UIMailDefenceDetailItem.DataDefine = DataDefine
UIMailDefenceDetailItem.DataDestroy = DataDestroy
UIMailDefenceDetailItem.OnAddListener = OnAddListener
UIMailDefenceDetailItem.OnRemoveListener = OnRemoveListener

UIMailDefenceDetailItem.SetData = SetData
UIMailDefenceDetailItem.SetShow = SetShow
UIMailDefenceDetailItem.ShowCells = ShowCells
UIMailDefenceDetailItem.ClearCells = ClearCells
UIMailDefenceDetailItem.OnShowClick = OnShowClick

return UIMailDefenceDetailItem