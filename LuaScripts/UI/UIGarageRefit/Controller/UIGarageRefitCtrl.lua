---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2022/2/25 17:31
---

local UIGarageRefitCtrl = BaseClass("UIGarageRefitCtrl", UIBaseCtrl)

local function CloseSelf(self)
    UIManager:GetInstance():DestroyWindow(UIWindowNames.UIGarageRefit)
end

local function Close(self)
    UIManager.Instance:DestroyWindowByLayer(UILayer.Background, false)
end

local function GetFormation(self, garage)
    local formationList = DataCenter.ArmyFormationDataManager:GetArmyFormationList()
    local garageIndex = DataCenter.BuildManager:GetGarageIndex(garage)
    for _, formation in pairs(formationList) do
        if formation.index == garageIndex or ( garage == BuildingTypes.FUN_BUILD_TRAINFIELD_4 and formation.index ==4 )then
            return formation
        end
    end
    return nil
end

local function ShowFormationHeroes(self, formation)
    local march = DataCenter.WorldMarchDataManager:GetOwnerFormationMarch(LuaEntry.Player.uid, formation.uuid, LuaEntry.Player.allianceId)
    if march ~= nil then
        return true
    else
        local formationForm = DataCenter.ArmyFormationDataManager:GetArmyFormInfoByUuid(formation.uuid)
        if formationForm and table.count(formationForm:GetCurHeroes()) > 0 or
           formation.state == ArmyFormationState.March and table.count(formation:GetCurHeroes()) > 0 then
            return true
        end
    end
    return false
end

UIGarageRefitCtrl.CloseSelf = CloseSelf
UIGarageRefitCtrl.Close = Close
UIGarageRefitCtrl.GetFormation = GetFormation
UIGarageRefitCtrl.ShowFormationHeroes = ShowFormationHeroes

return UIGarageRefitCtrl