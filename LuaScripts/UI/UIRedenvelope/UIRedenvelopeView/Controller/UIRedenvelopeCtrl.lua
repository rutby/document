---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl.
--- DateTime: 2022/2/22
---
local UIRedenvelopeCtrl = BaseClass("UIRedenvelopeCtrl", UIBaseCtrl)
local Localization = CS.GameEntry.Localization

local function CloseSelf(self)
    UIManager:GetInstance():DestroyWindow(UIWindowNames.UIRedenvelopeView)
end

local function Close(self)
    UIManager:GetInstance():DestroyWindowByLayer(UILayer.Normal)
end

local function GetRedRecord(self)
	local list = {}
	local redList = DataCenter.AllianceRedPacketManager:GetRedPacket()
	for i, v in pairs(redList) do
		if v.status ~= RedPacketState.PREPARE_SEND and v.status ~= RedPacketState.TIMEOUT then
			table.insert(list,v)
		end
	end
	table.sort(list, function(a, b)
		if a.time > b.time then
			return true
		else
			return false
		end
	end)
	return list
end

local function OpenRed(self,data)
	if data.status == RedPacketState.ALREADY_GET or data.status == RedPacketState.COST_ALL then
		local param = {}
		param.serverId = LuaEntry.Player.serverId
		param.redPacketId = data.uuid
		param.isViewOnly = true
		SFSNetwork.SendMessage(MsgDefines.GetRedPack,param)
		return
	end
	local param = {}
	param.serverId = LuaEntry.Player.serverId
	param.redPacketId = data.uuid
	param.reasonId = data.reasonId
	local sfsObj = SFSObject.New()
	sfsObj:PutInt("reasonId", data.reasonId)
	sfsObj:PutInt("resType",data.resType)
	sfsObj:PutUtfString("userName", data.name)
	sfsObj:PutUtfString("uid", data.uid)
	sfsObj:PutUtfString("headPic", data.pic)
	sfsObj:PutInt("headPicVer", data.picV)
	sfsObj:PutInt("mCardET", data.mCardET)
	param.extra = sfsObj
	SFSNetwork.SendMessage(MsgDefines.RedPacketStatus,param)
end


UIRedenvelopeCtrl.CloseSelf = CloseSelf
UIRedenvelopeCtrl.Close = Close
UIRedenvelopeCtrl.GetRedRecord = GetRedRecord
UIRedenvelopeCtrl.OpenRed = OpenRed
return UIRedenvelopeCtrl