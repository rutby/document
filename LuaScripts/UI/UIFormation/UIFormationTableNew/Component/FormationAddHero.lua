---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2021/7/8 12:05
---
local FormationAddHero = BaseClass("FormationAddHero",UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local btn_path = ""
local add_img_path = "bg"
local index_txt_path = "indexTxt"
local add_path = "add"
local lock_path ="lock"
local select_effect_path = "add/select"

local function OnCreate(self)
    base.OnCreate(self)
    self.add_img = self:AddComponent(UIImage,add_img_path)
    self.index_text = self:AddComponent(UITextMeshProUGUIEx,index_txt_path)
    self.add = self:AddComponent(UIImage,add_path)
    self.lock = self:AddComponent(UIImage,lock_path)
    self.select_effect = self:AddComponent(UIBaseContainer,select_effect_path)
    self.click_btn = self:AddComponent(UIButton, btn_path)
    self.click_btn:SetOnClick(function ()
        self:OnSelectClick()
    end)
end

local function OnDestroy(self)
    self.index_text = nil
    self.click_btn = nil
    base.OnDestroy(self)
end

local function InitData(self,index,garage)
    --local unlockLevel = DataCenter.GarageRefitManager:GetSlotUnlockLevel(garage, index)
    --local refitData = DataCenter.GarageRefitManager:GetGarageRefitData(garage)
    --local isLock = refitData and refitData.level < unlockLevel
    
    self.index = index
    self.index_text:SetText(self.index)
    
    local maxNum = self.view.ctrl:GetMaxHeroNum()
    --Logger.Log("max num", maxNum)
    --Logger.Log("self index", index)
    self.isLock = (index>maxNum)
    
    --self.isLock = isLock
    self.unlockLevel = 0--unlockLevel
    self.garage = garage
    self.add:SetActive(self.isLock == false)
    self.lock:SetActive(self.isLock)
    self.add_img:SetAlpha(self.isLock and 0.4 or 1)
    self.select_effect:SetActive(false)
    self:OnSelectHeroRefresh()
end
local function OnSelectClick(self)
    --self.view.ctrl:SetCurIndex(self.index)
    if self.isLock==false then
        if self.view.ctrl.isMarch>0 then
            return
        end
        if self.view.normalState == true then
            self.view:OnHeroSelectClick()
        end
    else
        if self.unlockLevel > 0 then
            local tip = Localization:GetString("140329", self.unlockLevel)
            UIUtil.ShowMessage(tip, 2, GameDialogDefine.GOTO, GameDialogDefine.CANCEL, function()
                GoToUtil.GoToGarageRefit(self.garage)
            end)
        end
        
        --local scienceId = self.view.ctrl:GetScienceIdByUnlock(self.index)
        --if scienceId~=nil then
        --    local scienceLv = math.fmod(scienceId,100)
        --    local realScienceId = scienceId - scienceLv
        --    local template = DataCenter.ScienceTemplateManager:GetScienceTemplate(realScienceId,scienceLv)
        --    if template ~= nil then
        --        Logger.Log("unlcok science", scienceId)
        --        UIUtil.ShowSingleTip(Localization:GetString("150210",Localization:GetString(template.name)))
        --    end
        --end
        --local formationIndex =self.view.ctrl.curIndex
    end
end

local function OnAddListener(self)
    base.OnAddListener(self)
    self:AddUIListener(EventId.OnSelectHeroSelect, self.OnSelectHeroRefresh)
    self:AddUIListener(EventId.OnCancelHeroSelect, self.OnSelectHeroRefresh)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
    self:RemoveUIListener(EventId.OnSelectHeroSelect, self.OnSelectHeroRefresh)
    self:RemoveUIListener(EventId.OnCancelHeroSelect, self.OnSelectHeroRefresh)
end

local function OnSelectHeroRefresh(self)
    if self.view.ctrl.isMarch>0 then
        return
    end
    
    if self.isLock == false then
        local num = self.view.ctrl:GetCanAddHeroNum()
        self.select_effect:SetActive(num>0)
    end
end

local function GetDeleteObj(self)
end

local function CheckShowChange(self)
end

function FormationAddHero:GetGuideObj()
    return self.click_btn.gameObject
end


FormationAddHero.OnCreate = OnCreate
FormationAddHero.OnDestroy = OnDestroy
FormationAddHero.InitData =InitData
FormationAddHero.OnSelectClick = OnSelectClick
FormationAddHero.OnSelectHeroRefresh = OnSelectHeroRefresh
FormationAddHero.OnAddListener =OnAddListener
FormationAddHero.OnRemoveListener =OnRemoveListener
FormationAddHero.GetDeleteObj = GetDeleteObj
FormationAddHero.CheckShowChange= CheckShowChange
return FormationAddHero