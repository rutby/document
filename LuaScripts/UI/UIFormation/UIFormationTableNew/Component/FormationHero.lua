---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2021/7/8 12:04
---
local FormationHero = BaseClass("FormationHero",UIBaseContainer)
local base = UIBaseContainer
local hero_quality_path = "btnSelect/heroQuality"
local hero_mask_path = "btnSelect/heroQualityMask"
local hero_img_path = "btnSelect/heroImg"
--local index_txt_path = "indexTxt"
local level_txt_path = "btnSelect/campIcon/levelTxt"
local camp_icon_path = "btnSelect/campIcon"
local select_btn_path = "btnSelect"
local delete_btn_path ="btn_delete"
local hero_ark_grade_path = "btnSelect/ImgArkGrade"
local UIHeroEtoileList = require "UI.UIHero2.Common.UIHeroEtoileList"
local season_path = "seasonBg"
local season_text_path = "seasonBg/seasonTxt"
local change_effect_path = "btnSelect/ChangeAnim"
local function OnCreate(self)
    base.OnCreate(self)
    self.hero_img = self:AddComponent(UIImage,hero_img_path)
    self.hero_quality = self:AddComponent(UIImage,hero_quality_path)
    self.camp_icon = self:AddComponent(UIImage,camp_icon_path)
    self.hero_quality_mask = self:AddComponent(UIImage,hero_mask_path)
    --self.hero_rarity = self:AddComponent(UIImage,hero_rarity_path)
    self.hero_ark_grade = self:AddComponent(UIImage,hero_ark_grade_path)
    self.level = self:AddComponent(UITextMeshProUGUIEx,level_txt_path)
    --self.index_text = self:AddComponent(UITextMeshProUGUIEx,index_txt_path)
    self.click_btn = self:AddComponent(UIButton, select_btn_path)
    self.click_btn:SetOnClick(function ()
        if self.view.ctrl.isMarch>0 then
            return
        end
        self:OnSelectClick()
    end)
    self.delete_btn = self:AddComponent(UIButton, delete_btn_path)
    self.delete_btn:SetOnClick(function ()
        if self.view.ctrl.isMarch>0 then
            return
        end
        self:OnDeleteClick()
    end)
    self.star = self:AddComponent(UIHeroEtoileList, "UIHeroEtoileList")
    self.season = self:AddComponent(UIBaseContainer, season_path)
    self.seasonTxt = self:AddComponent(UITextMeshProUGUIEx, season_text_path)
    self.change_effect = self:AddComponent(UIBaseContainer,change_effect_path)
end

local function OnDestroy(self)
    self.hero_img = nil
    self.camp_icon = nil
    self.index_text = nil
    self.level = nil
    self.click_btn = nil
    self.delete_btn = nil
    --self.hero_rarity = nil
    self.hero_ark_grade = nil
    base.OnDestroy(self)
end

local function InitData(self,heroUuid,index)
    self.uuid = heroUuid
    self.index = index
    self.data = self.view.ctrl:GetHeroDataByUuid(self.uuid)
    self.hero_quality:LoadSprite(self.data.quality)
    self.hero_quality_mask:LoadSprite(self.data.quality.."_mask")
    --self.hero_rarity:LoadSprite(self.data.hero_rarity)
    self.hero_ark_grade:SetActive(self.data.rankId > 1)
    self.hero_ark_grade:LoadSprite(HeroUtils.GetMilitaryRankIcon(self.data.rankId))
    local param = {}
    param.showStarNum = self.data.qualityIndex
    param.maxStarNum = HeroUtils.GetMaxStarByRarity(self.data.rarity)
    self.star:SetRankId(self.data.rankId)
    self.star:SetActive(true)
    self.hero_img:LoadSprite("Assets/Main/Sprites/HeroIconFull/"..self.data.icon)
    self.level:SetText("Lv. "..self.data.level)
    --self.index_text:SetText(self.index)
    self.camp_icon:LoadSprite(self.data.camp)
    --if index == 1 then
    --    self.camp_icon.transform:Set_localScale(1,1,1)
    --elseif index == 2 or index == 3 then
    --    self.camp_icon.transform:Set_localScale((1/0.9),(1/0.9),(1/0.9))
    --else
    --    self.camp_icon.transform:Set_localScale((1/0.8),(1/0.8),(1/0.8))
    --end
    self.delete_btn:SetActive(self.view.ctrl.isMarch<=0)
    self:SetSeason(self.data.season)
end
local function OnSelectClick(self)
    --self.view.ctrl:SetCurIndex(self.index)
    if self.view.ctrl:NeedTakeArmy() then
        self.view:OnSelectClick()
    end
end

local function OnDeleteClick(self)
    self.view.ctrl:OnDeleteHeroByIndex(self.index)
    self.view:OnSelectHeroFinish(self.index)
    if self.view.normalState == true then
        self.view:OnHeroSelectClick()
    end
end

local function GetDeleteObj(self)
    return self.delete_btn.gameObject
end

local function SetSeason(self, season)
    season = season or 0
    self.season:SetActive(season > 0)
    self.seasonTxt:SetText("S"..season)
end

local function CheckShowChange(self,formationUuid)
    local heroUuid,targetHeroUuid = self.view.ctrl:GetFormationHeroCanChangeHigherUuidByQuality(formationUuid,self.uuid)
    if heroUuid~=nil and targetHeroUuid~=nil then
        self.change_effect:SetActive(true)
    else
        self.change_effect:SetActive(false)
    end
end
FormationHero.SetSeason = SetSeason

FormationHero.OnCreate = OnCreate
FormationHero.OnDestroy = OnDestroy
FormationHero.InitData =InitData
FormationHero.OnSelectClick = OnSelectClick
FormationHero.OnDeleteClick = OnDeleteClick
FormationHero.GetDeleteObj =GetDeleteObj
FormationHero.CheckShowChange =CheckShowChange
return FormationHero
