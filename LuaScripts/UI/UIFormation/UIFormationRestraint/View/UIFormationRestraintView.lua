---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2022/4/8 12:05
---

local UIFormationRestraintView = BaseClass("UIFormationRestraintView", UIBaseView)
local base = UIBaseView
local FormationRestraintItem = require "UI.UIFormation.UIFormationRestraint.Component.FormationRestraintItem"
--local UIShowReason = require "UI.UIShowReason.UIShowReason"
local Localization = CS.GameEntry.Localization

local return_btn_path = "Panel" 
local des_txt_path = "tips/common_img_tipsbg/desTxt"
local camp_obj_path = "tips/CampObj"
local lock_txt_path = "tips/CampObj/lockDesTxt"
local camp_des_txt_path = "tips/desTxtCamp"
local tips_anim_path = "tips"
local item_path = "tips/layout/FormationRestraintCamp%s"
--local reason_path = "UIShowReason"

local ITEM_COUNT = 3

local function OnCreate(self)
    base.OnCreate(self)
    self.restraintInfo, self.posX, self.posY, self.isOther, self.isSimple,self.isHideColor = self:GetUserData()
    self.tips = self:AddComponent(UIAnimator, tips_anim_path)
    self.tips.transform.position = Vector3.New(self.posX, self.posY, 0)
    self.tips:Play("CommonPopup_movein", 0, 0)
    self.des_txt = self:AddComponent(UITextMeshProUGUIEx, des_txt_path)
    self.des_txt:SetLocalText(133115)
    self.camp_obj = self:AddComponent(UIBaseComponent, camp_obj_path)
    self.camp_obj:SetActive(not self.isSimple)
    self.lock_txt = self:AddComponent(UITextMeshProUGUIEx, lock_txt_path)
    self.lock_txt:SetLocalText(120050)
    self.camp_des_txt = self:AddComponent(UITextMeshProUGUIEx, camp_des_txt_path)
    self.return_btn = self:AddComponent(UIButton, return_btn_path)
    self.return_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.items = {}
    for i = 1, ITEM_COUNT do
        self.items[i] = self:AddComponent(FormationRestraintItem, string.format(item_path, i))
        self.items[i]:SetOnClick(function()
            self:OnItemClick(i)
        end)
    end
    --self.reason = self:AddComponent(UIShowReason, reason_path)
end

local function OnDestroy(self)
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
    self:RefreshData()
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function RefreshData(self)
    for i, item in ipairs(self.items) do
        item:InitData(self.restraintInfo, i, self.isSimple)
    end
    if self.isHideColor then
        self.camp_des_txt:SetText(Localization:GetString("150247"))
    else
        if self.isOther and not self.isSimple then
            self.camp_des_txt:SetText("")
        else
            if self.restraintInfo.camp >= 0 then
                local restraintCamp = HeroUtils.GetHeroRestraintType(self.restraintInfo.camp)
                local name = HeroUtils.GetCampNameAndDesc(restraintCamp)
                if restraintCamp == HeroCamp.ZELOT then
                    name = "<color=#FA8843>" ..name.. "</color>"
                elseif restraintCamp == HeroCamp.UNION then
                    name = "<color=#5FA3ED>" ..name.. "</color>"
                elseif restraintCamp == HeroCamp.MAFIA then
                    name = "<color=#A66CF0>" ..name.. "</color>"
                end
                self.camp_des_txt:SetText(Localization:GetString("150225",name))
            else
                self.camp_des_txt:SetText(Localization:GetString("150232"))
            end
        end
    end
    
    
end

local function OnItemClick(self, i)
end

UIFormationRestraintView.OnCreate= OnCreate
UIFormationRestraintView.OnDestroy = OnDestroy
UIFormationRestraintView.OnEnable= OnEnable
UIFormationRestraintView.OnDisable = OnDisable

UIFormationRestraintView.RefreshData = RefreshData
UIFormationRestraintView.OnItemClick = OnItemClick

return UIFormationRestraintView