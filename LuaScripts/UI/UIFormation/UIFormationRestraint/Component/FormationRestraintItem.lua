---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2022/9/26 16:22
---
local FormationRestraintItem = BaseClass("FormationRestraintItem",UIBaseContainer)
local base = UIBaseContainer

local this_path = ""
local des_txt_path = "desTxt"
local icon_path = "CampRestraintItem/icon"
local camp_img_path = "CampRestraintItem/icon/camp_faction"
local num_path = "CampRestraintItem/icon/num"
local value_txt_path = "valueTxt"
local detail_path = "Detail"

local Localization = CS.GameEntry.Localization

local function OnCreate(self)
    base.OnCreate(self)
    self.bg_btn = self:AddComponent(UIButton, this_path)
    self.bg_btn:SetOnClick(function()
        self:OnClick()
    end)
    self.des_txt = self:AddComponent(UITextMeshProUGUIEx, des_txt_path)
    self.icon = self:AddComponent(UIImage, icon_path)
    self.camp_img = self:AddComponent(UIImage, camp_img_path)
    self.num = self:AddComponent(UITextMeshProUGUIEx, num_path)
    self.value_txt = self:AddComponent(UITextMeshProUGUIEx, value_txt_path)
    self.detail_go = self:AddComponent(UIBaseContainer, detail_path)
    self.onClick = nil
end

local function OnDestroy(self)
    self.bg_btn = nil
    self.des_txt = nil
    self.icon = nil
    self.camp_img = nil
    self.num = nil
    self.value_txt = nil
    self.detail_go = nil
    self.onClick = nil
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function InitData(self, restraintInfo, index, isSimple)
    local str = LuaEntry.DataConfig:TryGetStr("battle_config", "k31") or ""
    local spls = string.split(str, ";")
    local baseVal = tonumber(spls[index]) or 0
    local needNum = index + 2
    if isSimple and restraintInfo.num ~= needNum then
        self:SetActive(false)
        return
    end
    self:SetActive(true)
    baseVal = baseVal+restraintInfo.baseExtra
    local totalValue = (baseVal)*(1+(restraintInfo.extraVal/100))
    local extraVal = totalValue-baseVal
    local diaStr = ""
    --local valStr = Localization:GetString("220053") ..  .. "%"
    if restraintInfo.camp >= 0 then
        self.icon:LoadSprite(HeroUtils.GetCampIconPath(restraintInfo.camp))
        self.camp_img:LoadSprite(HeroUtils.GetCampCircleImgPath(restraintInfo.camp))
        local show = (self.view.isHideColor ==nil or self.view.isHideColor == false)
        if restraintInfo.num == needNum and show then
            self.bg_btn:LoadSprite("Assets/Main/Sprites/UI/UITroopsNew/UITroopsNew_img_huang.png")
            -- self.des_txt:SetColor(Color.New(0.86,0.49,0,1))
            -- self.value_txt:SetColor(Color.New(1,0.43,0.21,1))
            self.bg_btn:SetInteractable(true)
            self.detail_go:SetActive(false)
            local valStr = toInt(baseVal)+100
            --if extraVal>0 then
            --    valStr =  toInt(baseVal).."%".."<color=#00B200>".."+"..toInt(extraVal).."%".."</color>"
            --else
            --    valStr = toInt(baseVal) .. "%"
            --end
            diaStr = Localization:GetString("150248",valStr)
        else
            -- self.des_txt:SetColor(Color.New(0.66,0.66,0.66,1))
            -- self.value_txt:SetColor(Color.New(0.66,0.66,0.66,1))
            self.bg_btn:LoadSprite("Assets/Main/Sprites/UI/UITroopsNew/UITroopsNew_img_hui.png")
            self.bg_btn:SetInteractable(false)
            self.detail_go:SetActive(false)
            local valStr = toInt(baseVal)+100
            --valStr = toInt(baseVal) .. "%"
            diaStr = Localization:GetString("150248",valStr)
        end
        local name, desc = HeroUtils.GetCampNameAndDesc(restraintInfo.camp)
        self.des_txt:SetText(Localization:GetString("150223", needNum, name))
    else
        -- self.des_txt:SetColor(Color.New(0.66,0.66,0.66,1))
        -- self.value_txt:SetColor(Color.New(0.66,0.66,0.66,1))
        self.bg_btn:LoadSprite("Assets/Main/Sprites/UI/UITroopsNew/UITroopsNew_img_hui.png")
        self.icon:LoadSprite("Assets/Main/Sprites/UI/UIHeroList/ui_camp_-1.png")
        self.camp_img:LoadSprite("Assets/Main/Sprites/UI/UIHeroList/hero_faction_-1.png")
        self.des_txt:SetText(Localization:GetString("150223", needNum, Localization:GetString("150224")))
        self.bg_btn:SetInteractable(false)
        self.detail_go:SetActive(false)
        local valStr = toInt(baseVal)+100
        diaStr = Localization:GetString("150248",valStr)
    end
    self.num:SetText(needNum)
    self.value_txt:SetText(diaStr)
end

local function SetOnClick(self, onClick)
    self.onClick = onClick
end

local function OnClick(self)
    if self.onClick then
        self.onClick()
    end
end

FormationRestraintItem.OnCreate = OnCreate
FormationRestraintItem.OnDestroy = OnDestroy
FormationRestraintItem.OnEnable = OnEnable
FormationRestraintItem.OnDisable = OnDisable
FormationRestraintItem.InitData = InitData
FormationRestraintItem.SetOnClick = SetOnClick
FormationRestraintItem.OnClick = OnClick

return FormationRestraintItem