---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 23/1/2024 下午7:13
---
local FormationAddItem = BaseClass("FormationAddItem", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local name_text_path = "name_text"
local des_text_path = "des_text"
local select_btn_path = "select_btn"
local select_btn_text_path = "select_btn/select_btn_text"

function FormationAddItem:OnCreate()
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

function FormationAddItem:OnDestroy()
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

function FormationAddItem:OnEnable()
    base.OnEnable(self)
end

function FormationAddItem:OnDisable()
    base.OnDisable(self)
end

function FormationAddItem:ComponentDefine()
    self.des_text = self:AddComponent(UITextMeshProUGUIEx, des_text_path)
    self.name_text = self:AddComponent(UITextMeshProUGUIEx, name_text_path)
    self.select_btn = self:AddComponent(UIButton, select_btn_path)
    self.select_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnSelectBtnClick()
    end)
    self.select_btn_text = self:AddComponent(UITextMeshProUGUIEx, select_btn_text_path)
    self.select_btn_text:SetLocalText(110003)
end

function FormationAddItem:ComponentDestroy()
end

function FormationAddItem:DataDefine()
end

function FormationAddItem:DataDestroy()
end

function FormationAddItem:OnAddListener()
    base.OnAddListener(self)
end

function FormationAddItem:OnRemoveListener()
    base.OnRemoveListener(self)
end


function FormationAddItem:Refresh(param)
    self.scienceId = param.scienceId
    self.scienceLevel =param.scienceLevel
    self.monthCard = param.monthCard
    if self.scienceId~=nil then
        self.select_btn_text:SetLocalText(441033)
        if not DataCenter.ScienceManager:HasScienceByIdAndLevel(scienceId,scienceLevel) then
            CS.UIGray.SetGray(self.select_btn.transform, false, true)
        else
            CS.UIGray.SetGray(self.select_btn.transform, true, false)
        end
        self.name_text:SetLocalText(140207)
        self.des_text:SetLocalText(441035)
    elseif self.monthCard~=nil then
        self.select_btn_text:SetLocalText(441034)
        self.name_text:SetLocalText(321400)
        self.des_text:SetLocalText(441037)
        local hasMonthCard = DataCenter.MonthCardNewManager:CheckIfMonthCardActive()
        if hasMonthCard ==false then
            CS.UIGray.SetGray(self.select_btn.transform, false, true)
        else
            CS.UIGray.SetGray(self.select_btn.transform, true, false)
        end
    end
end

function FormationAddItem:OnSelectBtnClick()
    if self.scienceId~=nil then
        local buildId = BuildingTypes.FUN_BUILD_SCIENE
        local list = DataCenter.BuildManager:GetAllBuildingByItemIdWithoutPickUp(buildId)
        if list~=nil and table.count(list)>0 then
            self.view.ctrl:CloseSelf()
            GoToUtil.GotoScience(self.scienceId)
        else
            UIUtil.ShowTipsId(130218)
        end
    elseif self.monthCard~=nil then
        self.view.ctrl:CloseSelf()
        UIManager:GetInstance():OpenWindow(UIWindowNames.UIGiftPackage, { anim = true }, { welfareTagType = WelfareTagType.MonthCard })
    end
end


return FormationAddItem