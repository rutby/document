---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2022/9/29 16:49
---
local UIMailCampRestraintDetailView = BaseClass("UIMailCampRestraintDetailView",UIBaseView)
local FormationRestraintItem = require "UI.UIFormation.UIFormationRestraint.Component.FormationRestraintItem"
local base = UIBaseView
local return_btn_path = "Panel"
local des_txt_path = "tips/common_img_tipsbg/desTxt"
local camp_des_txt_path = "tips/desTxtCamp"
local tips_obj_path = "tips"
local camp_1_path = "tips/layout/FormationRestraintCamp1"
local Localization = CS.GameEntry.Localization
local function OnCreate(self)
    base.OnCreate(self)
    local campIndex,campNum,posX,posY = self:GetUserData()
    self.campNum = tonumber(campNum)
    self.campIndex = tonumber(campIndex)
    self.posX = tonumber(posX)
    self.posY = tonumber(posY)
    self.tips = self:AddComponent(UIBaseContainer, tips_obj_path)
    local v3 = self.tips.transform.position
    v3.x = self.posX
    v3.y = self.posY
    self.tips.transform.position = v3
    self.des_txt = self:AddComponent(UITextMeshProUGUIEx, des_txt_path)
    self.des_txt:SetLocalText(133115)
    self.camp_des_txt = self:AddComponent(UITextMeshProUGUIEx, camp_des_txt_path)
    self.return_btn = self:AddComponent(UIButton, return_btn_path)
    self.return_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    local camp1 = self:AddComponent(FormationRestraintItem, camp_1_path)
    self.campList = {}
    table.insert(self.campList,camp1)
end

local function OnDestroy(self)
    base.OnDestroy(self)
end


local function OnEnable(self)
    base.OnEnable(self)
    self:RefreshData()
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function RefreshData(self)
    local heroRestraintValue = LuaEntry.DataConfig:TryGetStr("battle_config", "k19")
    local arr = string.split(heroRestraintValue,";")
    for i=1,#self.campList do
        if #arr>=i then
            self.campList[i]:SetActive(true)
            self.campList[i]:InitData(self.campIndex,self.campNum,arr[i],i+2)
        else
            self.campList[i]:SetActive(false)
        end
    end
    local restraintCamp = HeroUtils.GetHeroRestraintType(self.campIndex)
    local beRestraintCamp = HeroUtils.GetHeroBeRestraintType(self.campIndex)
    local name, desc = HeroUtils.GetCampNameAndDesc(restraintCamp)
    name = self:GetColorStr(restraintCamp,name)
    local bName,bDesc = HeroUtils.GetCampNameAndDesc(beRestraintCamp)
    bName = self:GetColorStr(beRestraintCamp,bName)
    local cName, cDesc = HeroUtils.GetCampNameAndDesc(self.campIndex)
    cName = self:GetColorStr(self.campIndex,cName)
    self.camp_des_txt:SetText(Localization:GetString("150227",cName,name,bName))
end


local function GetColorStr(self,camp,name)
    local realName = name
    if camp == HeroCamp.ZELOT then
        realName = "<color=#FA8843>" ..name.. "</color>"
    elseif camp == HeroCamp.UNION then
        realName = "<color=#5FA3ED>" ..name.. "</color>"
    elseif camp == HeroCamp.MAFIA then
        realName = "<color=#A66CF0>" ..name.. "</color>"
    end
    return realName
end
UIMailCampRestraintDetailView.OnCreate= OnCreate
UIMailCampRestraintDetailView.OnDestroy = OnDestroy
UIMailCampRestraintDetailView.OnEnable= OnEnable
UIMailCampRestraintDetailView.OnDisable = OnDisable
UIMailCampRestraintDetailView.RefreshData = RefreshData
UIMailCampRestraintDetailView.GetColorStr =GetColorStr
return UIMailCampRestraintDetailView