---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/3/14 10:48
---
local UIMarchAddSpeedCtrl = BaseClass("UIFormationStateCtrl", UIBaseCtrl)

local function CloseSelf(self)
    UIManager:GetInstance():DestroyWindow(UIWindowNames.UIMarchAddSpeed)
end

local function Close(self)
    UIManager:GetInstance():DestroyWindowByLayer(UILayer.Normal)
end

local function GetItemList(self)
    local showList = {}
    local buildData = DataCenter.BuildManager:GetAllBuildingByItemIdWithoutPickUp(BuildingTypes.FUN_BUILD_SPEED)
    if buildData ~= nil and table.count(buildData) > 0 then
        local oneData = {}
        oneData.type = "Build"
        table.insert(showList,oneData)
    end
    local list = DataCenter.ItemData:GetItemList(GOODS_TYPE.SPEED_WORLD_MARCH,GOODS_TYPE2.MarchSpeedItem)
    if list~=nil and #list>0 then
        table.sort(list,function(a,b)
            local goodsTemplate1 = DataCenter.ItemTemplateManager:GetItemTemplate(a.itemId)
            local goodsTemplate2 = DataCenter.ItemTemplateManager:GetItemTemplate(b.itemId)
            if goodsTemplate1 == nil then
                return false
            elseif goodsTemplate2 == nil then
                return true
            else
                if goodsTemplate1.order > goodsTemplate2.order then
                    return false
                elseif goodsTemplate1.order < goodsTemplate2.order then
                    return true
                else
                    local id1 = tonumber(a.itemId)
                    local id2 = tonumber(b.itemId)
                    if id1 > id2 then
                        return true
                    elseif id1 < id2 then
                        return false
                    end
                end
            end
            return false
        end)
        for i =1,#list do
            local data = list[i]
            if data.count>0 then
                local oneData = {}
                oneData.type = "Free"
                oneData.data = list[i]
                table.insert(showList,oneData)
            end
        end
    end
    return showList
end


local function GetMarchData(self,marchUuid)
    local oneData = {}
    local march = DataCenter.WorldMarchDataManager:GetMarch(marchUuid)
    if march~=nil then
        oneData.status = march:GetMarchStatus()
        oneData.targetType = march:GetMarchTargetType()
        oneData.marchUuid = march.uuid
        oneData.targetUuid = march.targetUuid
        oneData.startTime = march.startTime
        oneData.endTime = march.endTime
        oneData.targetPoint = march.targetPos
        oneData.serverId = march.serverId
        return oneData
    end
end

UIMarchAddSpeedCtrl.CloseSelf = CloseSelf
UIMarchAddSpeedCtrl.Close = Close
UIMarchAddSpeedCtrl.GetItemList = GetItemList
UIMarchAddSpeedCtrl.GetMarchData = GetMarchData
return UIMarchAddSpeedCtrl