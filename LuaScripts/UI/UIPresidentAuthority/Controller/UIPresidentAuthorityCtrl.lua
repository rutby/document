---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2023/4/8 18:30
---


local UIPresidentAuthorityCtrl = BaseClass("UIPresidentAuthorityCtrl", UIBaseCtrl)
local Localization = CS.GameEntry.Localization
local function CloseSelf(self)
    UIManager.Instance:DestroyWindow(UIWindowNames.UIPresidentAuthority)
end

local function GetPanelData(self)
    local result = {}
    local para1 = DataCenter.PresidentMineRefreshManager:GetPresidentAuthorityActivityPara1()
    local k4 = LuaEntry.DataConfig:TryGetNum("wonder_stone_skill", "k4")
    local hours = Mathf.Round(k4 / 60)

    if para1 then
        result.skillIcon = para1.skillIcon
        result.skillName = para1.skillName
        result.skillDesc = Localization:GetString(para1.skillDesc, hours) 
    end
    local info = DataCenter.PresidentMineRefreshManager:GetInfo()
    if info then
        result.isInCd = info:IsInCD()
        result.endTime = info.nextRefreshTime
    end

    return result
end

local function ActiveSkill(self)
    if not DataCenter.GovernmentManager:IsSelfPresident() then
        UIUtil.ShowTipsId(305036)
        return
    end
    if CrossServerUtil:GetIsCrossServer() then
        return
    end
    if SceneUtils.GetIsInWorld() then
        GoToUtil.CloseAllWindows()
        UIManager:GetInstance():OpenWindow(UIWindowNames.UIPresidentRefreshMine, {anim = true})
    else
        SceneUtils.ChangeToWorld(function()
            TimerManager:GetInstance():DelayInvoke(function()
                UIManager:GetInstance():OpenWindow(UIWindowNames.UIPresidentRefreshMine, {anim = true})
            end, 1)
        end, true)
    end
end

UIPresidentAuthorityCtrl.CloseSelf = CloseSelf
UIPresidentAuthorityCtrl.GetPanelData = GetPanelData
UIPresidentAuthorityCtrl.ActiveSkill = ActiveSkill

return UIPresidentAuthorityCtrl