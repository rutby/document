---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/3/16 14:27
---

local UIMasterySkillIntro = BaseClass("UIMasterySkillIntro", UIBaseView)
local base = UIBaseView
local UIMasterySkillBtn = require "UI.UIMasterySkill.Component.UIMasterySkillBtn"

local title_path = "UICommonMiniPopUpTitle/Bg_mid/titleText"
local close_path = "UICommonMiniPopUpTitle/Bg_mid/CloseBtn"
local return_path = "UICommonMiniPopUpTitle/panel"
local icon_path = "Icon"
local desc_path = "ScrollView/Viewport/Content/Desc"
local skill_btn_path = "SkillBtn"

local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
    self:ReInit()
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function ComponentDefine(self)
    self.title_text = self:AddComponent(UITextMeshProUGUIEx, title_path)
    self.close_btn = self:AddComponent(UIButton, close_path)
    self.close_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.return_btn = self:AddComponent(UIButton, return_path)
    self.return_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.icon_image = self:AddComponent(UIImage, icon_path)
    self.desc_text = self:AddComponent(UIText, desc_path)
    self.skill_btn = self:AddComponent(UIMasterySkillBtn, skill_btn_path)
end

local function ComponentDestroy(self)
    self.title_text = nil
    self.close_btn = nil
    self.return_btn = nil
    self.icon_image = nil
    self.desc_text = nil
    self.skill_btn = nil
end

local function DataDefine(self)
    
end

local function DataDestroy(self)
    
end

local function OnAddListener(self)
    base.OnAddListener(self)
    self:AddUIListener(EventId.MasteryUseSkill, self.OnMasteryUseSkill)
end

local function OnRemoveListener(self)
    self:RemoveUIListener(EventId.MasteryUseSkill, self.OnMasteryUseSkill)
    base.OnRemoveListener(self)
end

local function ReInit(self)
    local skill = self:GetUserData()
    local plan = DataCenter.MasteryManager:GetCurPlan()
    local template = DataCenter.MasteryManager:GetTemplateBySkill(skill)
    local skillTemplate = DataCenter.MasteryManager:GetSkillTemplate(skill)
    local level = plan:GetGroupLevel(template.group)
    self.title_text:SetLocalText(skillTemplate:getValue("name"))
    self.icon_image:LoadSprite(LoadPath.UIMastery .. template.tempData:getValue("icon"))
    self.desc_text:SetText(DataCenter.MasteryManager:GetDescStr(template.tempData:getValue("id")))
    self.skill_btn:SetData(skill)
end

local function OnMasteryUseSkill(self, skill)
    self.ctrl:CloseSelf()
end

UIMasterySkillIntro.OnCreate = OnCreate
UIMasterySkillIntro.OnDestroy = OnDestroy
UIMasterySkillIntro.OnEnable = OnEnable
UIMasterySkillIntro.OnDisable = OnDisable
UIMasterySkillIntro.ComponentDefine = ComponentDefine
UIMasterySkillIntro.ComponentDestroy = ComponentDestroy
UIMasterySkillIntro.DataDefine = DataDefine
UIMasterySkillIntro.DataDestroy = DataDestroy
UIMasterySkillIntro.OnAddListener = OnAddListener
UIMasterySkillIntro.OnRemoveListener = OnRemoveListener

UIMasterySkillIntro.ReInit = ReInit

UIMasterySkillIntro.OnMasteryUseSkill = OnMasteryUseSkill

return UIMasterySkillIntro