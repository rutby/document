---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/3/13 14:51
---

local UIMasteryOverview = BaseClass("UIMasteryOverview", UIBaseView)
local base = UIBaseView
local UIMasteryOverviewItem = require "UI.UIMasteryOverview.Component.UIMasteryOverviewItem"
local Localization = CS.GameEntry.Localization

local title_path = "UICommonPopUpTitle/bg_mid/titleText"
local close_path = "UICommonPopUpTitle/bg_mid/CloseBtn"
local return_path = "UICommonPopUpTitle/panel"
local content_path = "ScrollView/Viewport/Content"

local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
    self:ReInit()
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function ComponentDefine(self)
    self.title_text = self:AddComponent(UIText, title_path)
    self.title_text:SetLocalText(110707)
    self.close_btn = self:AddComponent(UIButton, close_path)
    self.close_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self.ctrl:CloseSelf()
    end)
    self.return_btn = self:AddComponent(UIButton, return_path)
    self.return_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.content_go = self:AddComponent(UIBaseContainer, content_path)
end

local function ComponentDestroy(self)
    self.title_text = nil
    self.close_btn = nil
    self.return_btn = nil
    self.content_go = nil
end

local function DataDefine(self)
    self.itemReqs = {}
end

local function DataDestroy(self)
    self.itemReqs = nil
end

local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function ReInit(self)
    self:CreateItems()
end

local function CreateItems(self)
    self:ClearItems()
    local homes = table.values(MasteryHome)
    table.sort(homes)
    for _, home in ipairs(homes) do
        self.itemReqs[home] = self:GameObjectInstantiateAsync(UIAssets.UIMasteryOverviewItem, function(req)
            if req.isError then
                return
            end
            local go = req.gameObject
            go:SetActive(true)
            go.transform:SetParent(self.content_go.transform)
            go.transform:Set_localScale(ResetScale.x, ResetScale.y, ResetScale.z)
            go.name = tostring(home)
            local item = self.content_go:AddComponent(UIMasteryOverviewItem, go.name)
            item:SetData(home)
            CS.UnityEngine.UI.LayoutRebuilder.ForceRebuildLayoutImmediate(self.content_go.transform)
        end)
    end
end

local function ClearItems(self)
    self.content_go:RemoveComponents(UIMasteryOverviewItem)
    for _, req in pairs(self.itemReqs) do
        req:Destroy()
    end
    self.itemReqs = {}
end

UIMasteryOverview.OnCreate = OnCreate
UIMasteryOverview.OnDestroy = OnDestroy
UIMasteryOverview.OnEnable = OnEnable
UIMasteryOverview.OnDisable = OnDisable
UIMasteryOverview.ComponentDefine = ComponentDefine
UIMasteryOverview.ComponentDestroy = ComponentDestroy
UIMasteryOverview.DataDefine = DataDefine
UIMasteryOverview.DataDestroy = DataDestroy
UIMasteryOverview.OnAddListener = OnAddListener
UIMasteryOverview.OnRemoveListener = OnRemoveListener

UIMasteryOverview.ReInit = ReInit
UIMasteryOverview.CreateItems = CreateItems
UIMasteryOverview.ClearItems = ClearItems

return UIMasteryOverview