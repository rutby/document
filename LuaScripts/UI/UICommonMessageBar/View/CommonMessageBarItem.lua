---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2021/8/26 21:13
---

local CommonMessageBarItem = BaseClass("CommonMessageBarItem", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local UIHeroCellSmall = require "UI.UIHero2.Common.UIHeroCellSmall"
local msgTxt_path = "doTween/Text"
local playerHead_path = "doTween/UIPlayerHead"
local playerHeadIcon_path = "doTween/UIPlayerHead/HeadIcon"
local playerHeadFg_path = "doTween/UIPlayerHead/Foreground"
local canvasGroup_path = "doTween"
local heroHead_path = "doTween/Text/UIHeroCellSmall"

local TweenPosY = {
    Start = -50,
    Idle = 0,
    End = 50,
}


local function OnCreate(self)
    base.OnCreate(self)
    self.msgTxtN = self:AddComponent(UITextMeshProUGUIEx, msgTxt_path)
    self.playerHeadN = self:AddComponent(UIBaseContainer, playerHead_path)
    self.playerHeadIconN = self:AddComponent(UIPlayerHead, playerHeadIcon_path)
    self.playerHeadFg = self:AddComponent(UIImage, playerHeadFg_path)
    self.canvasGroupN = self:AddComponent(UICanvasGroup, canvasGroup_path)
    self.heroHead = self:AddComponent(UIHeroCellSmall,heroHead_path)
end

local function OnDestroy(self)
    self.msgTxtN = nil
    
    base.OnDestroy(self)
end

--从开始显示到准备隐藏的时间为 timeBeforeFadeOut
--隐藏动画时长不能超过上面的值，不然两个预制不够
local function FadeIn(self, tipInfo)
    self:ResetItem()
    
    local msg = tipInfo.msg
    local msgId = tipInfo.msgId
    --local showType = tipInfo.showType
    if msg~=nil and msg~="" then
        self.msgTxtN:SetText(msg)
    elseif msgId ~= nil then
        self.msgTxtN:SetLocalText(msgId)
    else
        self.msgTxtN:SetLocalText(100378) 
    end
    
    --有'自定义'头像才显示
    if tipInfo and tipInfo.playerHead and not string.IsNullOrEmpty(tipInfo.playerHead.pic) then
        self.heroHead:SetActive(false)
        self.playerHeadN:SetActive(true)
        self.playerHeadIconN:SetData(tipInfo.playerHead.uid, tipInfo.playerHead.pic, tipInfo.playerHead.picVer)
        if tipInfo.playerHead.HeadBg then
            self.playerHeadFg:SetActive(true)
            self.playerHeadFg:LoadSprite(tipInfo.playerHead.HeadBg)
        else
            self.playerHeadFg:SetActive(false)
        end
    elseif tipInfo and tipInfo.heroHead and tipInfo.heroHead.heroId then
        self.playerHeadN:SetActive(false)
        self.heroHead:SetActive(true)
        self.heroHead:InitWithConfigId(tipInfo.heroHead.heroId,tipInfo.heroHead.quality,tipInfo.heroHead.level)
    else
        self.playerHeadN:SetActive(false)
        self.heroHead:SetActive(false)
    end
    --if showType~=nil then
    --    if showType == MessageBarType.Cost then
    --        self.msgTxtN:SetColor(MessageBarCostColor)
    --    elseif showType == MessageBarType.Lack then
    --        self.msgTxtN:SetColor(MessageBarLackColor)
    --    else
    --        self.msgTxtN:SetColor(MessageBarGetColor)
    --    end
    --else
    --    self.msgTxtN:SetColor(MessageBarGetColor)
    --end

    --self.msgTxtN:SetColor(MessageBarGetColor)

    self.canvasGroupN.rectTransform:GetComponent(typeof(CS.UnityEngine.CanvasGroup)):DOFade(1, 0.3)--:SetEase(CS.DG.Tweening.Ease.InOutCubic)
    self.canvasGroupN.rectTransform:DOAnchorPosY(TweenPosY.Idle, 0.3)--:SetEase(CS.DG.Tweening.Ease.InOutQuint)
    --rootRt:DOScale(Vector3.New(1.1, 1.1, 0), 0.15):OnComplete(function()
    --    rootRt:DOScale(Vector3.one, 0.1)
    --end):SetEase(CS.DG.Tweening.Ease.InOutCubic)
end

local function FadeOut(self)
    self.canvasGroupN.rectTransform:GetComponent(typeof(CS.UnityEngine.CanvasGroup)):DOFade(0, 0.4):OnComplete(function()
        --self:ResetItem()
    end):SetEase(CS.DG.Tweening.Ease.OutCubic)
    
    self.canvasGroupN.rectTransform:DOAnchorPosY(TweenPosY.End, 0.4):OnComplete(function()
            --self:ResetItem()
        end)--:SetEase(CS.DG.Tweening.Ease.OutCubic)
end

local function ResetItem(self)
    self.canvasGroupN:SetAlpha(0)
    self.canvasGroupN.rectTransform:Set_localPosition(0, TweenPosY.Start, 0)
end


CommonMessageBarItem.OnCreate = OnCreate
CommonMessageBarItem.OnDestroy = OnDestroy

CommonMessageBarItem.FadeIn = FadeIn
CommonMessageBarItem.FadeOut = FadeOut
CommonMessageBarItem.ResetItem = ResetItem

return CommonMessageBarItem