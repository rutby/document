---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/4/18 18:44
---
local MigrateApplyItem = BaseClass("MigrateApplyItem",UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local first_name_path = "firstNameTxt"
local accept_btn_path = "acceptBtn"
local refuse_btn_path = "refuseBtn"
local power_txt_path = "power"
local head_btn_path = "UIPlayerHead"
local playerHead_path = "UIPlayerHead/HeadIcon"
local playerHeadFg_path = "UIPlayerHead/Foreground"
local specialFlag_path = "specialFlag"
local special_txt_path = "specialFlag/specialDes"
local flag_path = "flag"
local function OnCreate(self)
    base.OnCreate(self)
    self.first_txt= self:AddComponent(UIText,first_name_path)
    self.power_txt= self:AddComponent(UIText,power_txt_path)
    self.playerHead = self:AddComponent(UIPlayerHead, playerHead_path)
    self.playerHeadFg = self:AddComponent(UIImage, playerHeadFg_path)
    self.specialFlag = self:AddComponent(UIImage, specialFlag_path)
    self.special_txt = self:AddComponent(UIText, special_txt_path)
    self.head_btn = self:AddComponent(UIButton,head_btn_path)
    self.flag = self:AddComponent(UIImage,flag_path)
    self.head_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnHeadClick()
    end)
    self.accept_btn = self:AddComponent(UIButton,accept_btn_path)
    self.accept_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnAcceptClick()
    end)
    self.refuse_btn = self:AddComponent(UIButton,refuse_btn_path)
    self.refuse_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnRefuseClick()
    end)
end

local function SetItemShow(self, data)
    self.data = data
    local name = self.data.name
    if self.data.abbr~=nil and self.data.abbr~="" then
        name = "["..self.data.abbr.."]"..self.data.name
    end
    if self.data.serverId~=nil and self.data.serverId>0 then
        name = "#"..self.data.serverId.." "..name
    end
    self.first_txt:SetText(name)
    self.power_txt:SetText(string.GetFormattedSeperatorNum(self.data.power))
    self.playerHead:SetData(self.data.uid, self.data.pic, self.data.picVer)
    if self.data.headBg then
        self.playerHeadFg:SetActive(true)
        self.playerHeadFg:LoadSprite(self.data.headBg)
    else
        self.playerHeadFg:SetActive(false)
    end
    if self.data.specialApply == 1 then
        self.specialFlag:LoadSprite("Assets/Main/Sprites/UI/UIInterstellarMigration/UIemigrate_icon_purple.png")
        self.special_txt:SetText(Localization:GetString("100185"))
    else
        self.specialFlag:LoadSprite("Assets/Main/Sprites/UI/UIInterstellarMigration/UIemigrate_icon_green.png")
        self.special_txt:SetText(Localization:GetString("110136"))
    end

    if LuaEntry.Player:IsHideCountryFlag() then
        self.flag:SetActive(false)
    else
        self.flag:SetActive(true)
        local nationTemplate = DataCenter.NationTemplateManager:GetNationTemplate(self.data.country)
        if nationTemplate~=nil then
            self.flag:LoadSprite(nationTemplate:GetNationFlagPath())
        else
            self.flag:LoadSprite("Assets/Main/Sprites/CountryFlag/UN.png")
        end
    end
    
    --self.playerHead
end

local function OnHeadClick(self)
    self.view.ctrl:OnPlayerDetailClick(self.data.uid)
end
local function OnAcceptClick(self)
    self.view.ctrl:OnAcceptClick(self.data.uid,self.data.specialApply)
end
local function OnRefuseClick(self)
    self.view.ctrl:OnRefuseClick(self.data.uid)
end

MigrateApplyItem.OnCreate = OnCreate
MigrateApplyItem.SetItemShow = SetItemShow
MigrateApplyItem.OnHeadClick = OnHeadClick
MigrateApplyItem.OnAcceptClick = OnAcceptClick
MigrateApplyItem.OnRefuseClick = OnRefuseClick
return MigrateApplyItem