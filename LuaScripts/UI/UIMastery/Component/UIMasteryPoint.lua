---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/3/10 11:28
---

local UIMasteryPoint = BaseClass("UIMasteryPoint", UIBaseContainer)
local base = UIBaseContainer
local UIHeroTipView = require "UI.UIHero2.UIHeroTip.View.UIHeroTipView"
local Localization = CS.GameEntry.Localization

local this_path = ""
local icon_path = "Icon"
local reset_path = "Reset"
local point_path = "Point"

local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.btn = self:AddComponent(UIButton, this_path)
    self.btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnClick()
    end)
    self.icon_image = self:AddComponent(UIImage, icon_path)
    self.reset_btn = self:AddComponent(UIButton, reset_path)
    self.reset_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnResetClick()
    end)
    self.point_text = self:AddComponent(UIText, point_path)
end

local function ComponentDestroy(self)
    self.icon_image = nil
    self.reset_btn = nil
    self.point_text = nil
end

local function DataDefine(self)
    
end

local function DataDestroy(self)
    
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function Refresh(self)
    local plan = DataCenter.MasteryManager:GetCurPlan()
    local usePoint = plan:GetUsePoint()
    local restPoint = DataCenter.MasteryManager:GetRestPoint()
    self.point_text:SetText(string.GetFormattedSeperatorNum(restPoint))
    self.reset_btn:SetActive(usePoint > 0)
end

local function OnClick(self)
    local param = UIHeroTipView.Param.New()
    param.content = Localization:GetString("110723")
    param.dir = UIHeroTipView.Direction.BELOW
    param.defWidth = 350
    param.pivot = 0.5
    param.position = self.btn.transform.position + Vector3.New(0, -25, 0)
    UIManager:GetInstance():OpenWindow(UIWindowNames.UIHeroTip, { anim = false }, param)
end

local function OnResetClick(self)
    local tempPlanIndex = DataCenter.MasteryManager:GetTempPlanIndex()
    if tempPlanIndex and tempPlanIndex ~= 0 and tempPlanIndex ~= DataCenter.MasteryManager:GetCurPlanIndex() then
        DataCenter.MasteryManager:SendResetDesertTalentOtherPage(tempPlanIndex)
    else
        UIManager:GetInstance():OpenWindow(UIWindowNames.UIMasteryPointReset)
    end
    --DataCenter.MasteryManager:ResetPoint()
end

UIMasteryPoint.OnCreate= OnCreate
UIMasteryPoint.OnDestroy = OnDestroy
UIMasteryPoint.ComponentDefine = ComponentDefine
UIMasteryPoint.ComponentDestroy = ComponentDestroy
UIMasteryPoint.DataDefine = DataDefine
UIMasteryPoint.DataDestroy = DataDestroy
UIMasteryPoint.OnEnable = OnEnable
UIMasteryPoint.OnDisable = OnDisable
UIMasteryPoint.OnAddListener = OnAddListener
UIMasteryPoint.OnRemoveListener = OnRemoveListener

UIMasteryPoint.Refresh = Refresh

UIMasteryPoint.OnClick = OnClick
UIMasteryPoint.OnResetClick = OnResetClick

return UIMasteryPoint