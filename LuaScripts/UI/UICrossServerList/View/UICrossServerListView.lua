---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2022/8/8 11:19

local CrossServerListCell = require "UI.UICrossServerList.Component.CrossServerListCell"
local UICrossServerListView = BaseClass("UICrossServerListView",UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization
local txt_title_path ="UICommonMidPopUpTitle/bg_mid/titleText"
local close_btn_path = "UICommonMidPopUpTitle/bg_mid/CloseBtn"
local return_btn_path = "UICommonMidPopUpTitle/panel"
local scrollList_view_path = "ScrollViewList"
local des_txt_path = "Image/des_txt"
local activity_detail_btn = "Image/activity_detail_btn"
local first_btn_name_path = "Image/activity_detail_btn/Txt_FirstBtnName"
--创建
function UICrossServerListView:OnCreate()
    base.OnCreate(self)
    DataCenter.MigrateDataManager:GetMigrateRequest()
    self:ComponentDefine()
    self:DataDefine()
    self:ReInit()
end

-- 销毁
function UICrossServerListView:OnDestroy()
    self:SetAllCellsDestroy()
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

function UICrossServerListView:ComponentDefine()
    self.txt_title = self:AddComponent(UIText, txt_title_path)
    self.close_btn = self:AddComponent(UIButton, close_btn_path)
    self.return_btn = self:AddComponent(UIButton, return_btn_path)
    self._first_btn = self:AddComponent(UIButton, activity_detail_btn)
    self._first_btn:SetOnClick(function()
        self:OnClickInfo()
    end)
    self._firstName_txt= self:AddComponent(UIText,first_btn_name_path)
    self._firstName_txt:SetLocalText(250324)
    self.scrollList_view = self:AddComponent(UIScrollView, scrollList_view_path)
    self.scrollList_view:SetOnItemMoveIn(function(itemObj, index)
        self:OnCellMoveInList(itemObj, index)
    end)
    self.scrollList_view:SetOnItemMoveOut(function(itemObj, index)
        self:OnCellMoveOutList(itemObj, index)
    end)

    self.close_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.return_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)

    self.des_txt = self:AddComponent(UIText,des_txt_path)
end

function UICrossServerListView:ComponentDestroy()
end

function UICrossServerListView:DataDefine()
end

function UICrossServerListView:DataDestroy()
    self.list = {}
end

function UICrossServerListView:OnEnable()
    base.OnEnable(self)
    self:ShowCells()
end

function UICrossServerListView:OnDisable()
    base.OnDisable(self)
end

function UICrossServerListView:ReInit()
    self.txt_title:SetLocalText(104264)
    self.des_txt:SetLocalText(104265)
end

-- 表现销毁
function UICrossServerListView:SetAllCellsDestroy()
    self:ClearScroll()
end

function UICrossServerListView:OnAddListener()
    base.OnAddListener(self)
    --self:AddUIListener(EventId.ServerListRefresh, self.ShowCells)
end

function UICrossServerListView:OnRemoveListener()
    base.OnRemoveListener(self)
    --self:RemoveUIListener(EventId.ServerListRefresh, self.ShowCells)
end

function UICrossServerListView:ShowCells()
    self:ClearScroll()
    self.list = DataCenter.AccountManager:GetCheckServerList()
    if #self.list>0 then
        self.scrollList_view:SetTotalCount(#self.list)
        self.scrollList_view:RefillCells()
    end
    local showBtn = false
    local actData = nil
    local dataList = DataCenter.ActivityListDataManager:GetActivityDataByType(ActivityEnum.ActivityType.ActNoOne)
    if table.count(dataList) > 0 then
        actData = dataList[1]
        local curTime = UITimeManager:GetInstance():GetServerTime()
        if actData.startTime < curTime and curTime < actData.endTime then
            showBtn = true
        end
    end
    self._first_btn:SetActive(showBtn)
end


--}}}
--{{{List
function UICrossServerListView:OnCellMoveInList(itemObj, index)
    local tempType = self.list[index]
    itemObj.name = NameCount
    NameCount = NameCount + 1
    local cellItem = self.scrollList_view:AddComponent(CrossServerListCell, itemObj)
    cellItem:ReInit(tempType)
    cellItem:SetActive(true)
end

function UICrossServerListView:OnCellMoveOutList(itemObj, index)
    self.scrollList_view:RemoveComponent(itemObj.name, CrossServerListCell)
end
--}}}
function UICrossServerListView:ClearScroll()
    if self.scrollList_view~=nil then
        self.scrollList_view:ClearCells()
        self.scrollList_view:RemoveComponents(CrossServerListCell)
    end
    self.list = {}
end
function UICrossServerListView:OnClickInfo()
    UIUtil.ShowIntro(Localization:GetString("250300"), Localization:GetString("100239"),Localization:GetString("250385"))
end
return UICrossServerListView