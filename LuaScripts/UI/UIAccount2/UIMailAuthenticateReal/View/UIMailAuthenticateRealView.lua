---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/6/28 20:58
---
local UIMailAuthenticateRealView = BaseClass("UIMailAuthenticateRealView",UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization

local function OnCreate(self)
    base.OnCreate(self)
    self.mailStr = self:GetUserData()
    self:ComponentDefine()
    --self:OnOpen()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.textTitle = self:AddComponent(UITextMeshProUGUIEx, 'UICommonMidPopUpTitle/bg_mid/titleText')
    self.des = self:AddComponent(UITextMeshProUGUIEx, 'Root/destext')
    self.textTitleAccount  = self:AddComponent(UITextMeshProUGUIEx, 'Root/InputFieldMail/TextTitleMail')
    self.textPlaceHolder1  = self:AddComponent(UITextMeshProUGUIEx, 'Root/InputFieldMail/TextPlaceholder1')

    self.textBtnLogin = self:AddComponent(UITextMeshProUGUIEx, 'Root/BtnLogin/TextLogin')

    self.btnClose = self:AddComponent(UIButton, 'UICommonMidPopUpTitle/bg_mid/CloseBtn')
    self.btnLogin = self:AddComponent(UIButton, 'Root/BtnLogin')
    self.textBtnStart = self:AddComponent(UITextMeshProUGUIEx, 'Root/BtnStart/TextStart')
    self.btnStart = self:AddComponent(UIButton, 'Root/BtnStart')
    self.btnStart:SetOnClick(BindCallback(self, self.OnBtnStartClick))
    self.inputAccount = self:AddComponent(UITMPInput, 'Root/InputFieldMail')

    self.btnClose:SetOnClick(BindCallback(self.ctrl, self.ctrl.Close))
    self.btnLogin:SetOnClick(BindCallback(self, self.OnBtnLoginClick))

    self.textTitle:SetLocalText(208266)
    self.des:SetLocalText(208268)
    self.textTitleAccount:SetText(self.mailStr)
    self.textPlaceHolder1:SetLocalText(280102)
    self.textBtnLogin:SetLocalText(110008)
    self.textBtnStart:SetLocalText(280045)
end

local function ComponentDestroy(self)
    self.textTitle = nil
    self.textTitleAccount  = nil
    self.textPlaceHolder1  = nil

    self.textBtnLogin = nil

    self.btnClose = nil
    self.btnLogin = nil
    self.dropdown = nil

    self.inputAccount = nil
end

local function OnOpen(self)
    self:ShowAccount()
end

local function OnBtnLoginClick(self)
    local mail = self.inputAccount:GetText()

    --邮箱输入为空
    if mail == nil or mail == "" then
        UIUtil.ShowTipsId(280122)
        return
    end
    --邮箱格式不正确
    local regex = '^[%w%._%-%+]+@[%w%._%-%+]+%a$'
    if not mail:match(regex) then
        UIUtil.ShowTipsId(280112)
        return
    end
    SFSNetwork.SendMessage(MsgDefines.AccountVerifyDevice,mail,0)
end

local function OnBtnStartClick(self)
    UIUtil.ShowMessage(Localization:GetString("280096"), 1, GameDialogDefine.CONFIRM, GameDialogDefine.CANCEL, function()
        LuaEntry.DataConfig:ClearMd5()
        CS.UnityEngine.PlayerPrefs.DeleteAll()
        CS.ApplicationLaunch.Instance:ReStartGame()
    end)
end

UIMailAuthenticateRealView.OnCreate= OnCreate
UIMailAuthenticateRealView.OnDestroy = OnDestroy
UIMailAuthenticateRealView.ComponentDefine = ComponentDefine
UIMailAuthenticateRealView.ComponentDestroy = ComponentDestroy
UIMailAuthenticateRealView.OnOpen = OnOpen

UIMailAuthenticateRealView.OnBtnLoginClick = OnBtnLoginClick
UIMailAuthenticateRealView.OnBtnStartClick = OnBtnStartClick
return UIMailAuthenticateRealView