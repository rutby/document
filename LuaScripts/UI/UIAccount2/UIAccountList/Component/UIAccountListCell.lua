---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhangliheng.
--- DateTime: 8/12/21 9:53 PM
---



local UIAccountListCell = BaseClass("UIAccountListCell", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local UIGray = CS.UIGray


local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.textName = self:AddComponent(UIText, 'TextName')
    self.textZone = self:AddComponent(UIText, 'TextZone')
    self.textMail = self:AddComponent(UIText, 'TextMail')
    self.textCurrent = self:AddComponent(UIText, 'TextCurrent')
    self.playerHead = self:AddComponent(UIPlayerHead, 'UIPlayerHead/HeadIcon')
    
    self.textCurrent:SetLocalText(208185) 
    
    self.btnSelect = self:AddComponent(UIButton, '')
    self.btnDelete = self:AddComponent(UIButton, 'BtnDelete')

    self.btnSelect:SetOnClick(BindCallback(self, self.OnBtnSelectClick))
    self.btnDelete:SetOnClick(BindCallback(self, self.OnBtnDeleteClick))
end

local function ComponentDestroy(self)
    self.textName = nil
    self.textZone = nil
    self.textMail = nil
    self.btnSelect = nil
    self.btnDelete = nil
end

local function SetData(self, data, callback)
    self.data = data
    self.callback = callback
    
    self.textName:SetText(data.name)
    self.textZone:SetText(Localization:GetString('280068') .. data.server)
    --self.alliance:SetLocalText(100217, param.data.server) 
    self.textMail:SetText(data.account)
    self.playerHead:SetData(data.uid, data.pic, data.picVer)

    local account = Setting:GetString(SettingKeys.GAME_ACCOUNT, "")
    self.isCurrentAccount = account == data.account
    self.textCurrent:SetActive(self.isCurrentAccount)
end

local function OnBtnSelectClick(self)
    if self.isCurrentAccount then
        UIUtil.ShowTipsId(208184) 
        return
    end
    
    SFSNetwork.SendMessage(MsgDefines.AccountLogin,{ userName = self.data.account,pwd = self.data.password })
end

local function OnBtnDeleteClick(self)
    local tip = Localization:GetString('280160') .. '\n' .. self.data.account
    UIUtil.ShowMessage(tip, 1, 'confirm', GameDialogDefine.CANCEL, function()
        --移除缓存账号
        DataCenter.AccountManager:RemoveAccount(self.data.account)
        UIUtil.ShowTipsId(120082) 
        if self.callback ~= nil then
            self.callback()
        end
    end)
end

UIAccountListCell.OnCreate = OnCreate
UIAccountListCell.OnDestroy = OnDestroy
UIAccountListCell.ComponentDefine = ComponentDefine
UIAccountListCell.ComponentDestroy = ComponentDestroy

UIAccountListCell.SetData = SetData

UIAccountListCell.OnBtnSelectClick = OnBtnSelectClick
UIAccountListCell.OnBtnDeleteClick = OnBtnDeleteClick

return UIAccountListCell