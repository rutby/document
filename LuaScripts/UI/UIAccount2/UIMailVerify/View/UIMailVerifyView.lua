---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/5/16 17:05
---
local UIMailVerifyView = BaseClass("UIMailVerifyView",UIBaseView)
local base = UIBaseView
local VERIFY_CODE_LEN = 6


local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.textTitle = self:AddComponent(UITextMeshProUGUIEx, 'UICommonMiniPopUpTitle/Bg_mid/titleText')

    self.TextTip1  = self:AddComponent(UITextMeshProUGUIEx, 'UICommonMiniPopUpTitle/TextTip1')
    self.TextTip2  = self:AddComponent(UITextMeshProUGUIEx, 'UICommonMiniPopUpTitle/TextTip2')
    self.textBtnSubmit = self:AddComponent(UITextMeshProUGUIEx, 'UICommonMiniPopUpTitle/BtnGo/BtnSubmit/TextSubmit')

    self.btnClose = self:AddComponent(UIButton, 'UICommonMiniPopUpTitle/Bg_mid/CloseBtn')
    self.btnSubmit = self:AddComponent(UIButton, 'UICommonMiniPopUpTitle/BtnGo/BtnSubmit')
    self.btnGoBack = self:AddComponent(UIButton,'UICommonMiniPopUpTitle/Btn_GoBack')

    self.inputField = self:AddComponent(UITMPInput, 'Root/InputField')
    self.btnClose:SetOnClick(BindCallback(self.ctrl, self.ctrl.CloseSelf))
    self.btnSubmit:SetOnClick(BindCallback(self, self.OnBtnSubmitClick))
    self.btnGoBack:SetOnClick(BindCallback(self.ctrl, self.ctrl.CloseSelf))

    self.boxTexts = {}
    for k=1, VERIFY_CODE_LEN do
        local textBox = self:AddComponent(UITextMeshProUGUIEx, 'Root/NodeVerifyBox/Box'.. k .. '/Text' .. k)
        table.insert(self.boxTexts, textBox)
    end

    self.textTitle:SetLocalText(280109)
    self.TextTip1:SetLocalText(208190)

    self.textBtnSubmit:SetLocalText(280108)

    self.inputField:SetOnValueChange(BindCallback(self, self.OnValueChange))
end

local function ComponentDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
    --verifyType:1,登陆；2,删除设备
    local mail,verifyType = self:GetUserData()
    self.mail = mail
    self.verifyType = verifyType
    if self.verifyType ==0 then
        self.TextTip2:SetLocalText(208209,mail)
    else
        self.TextTip2:SetLocalText(208270,mail)
    end
    
    self.inputField:SetText('')
end

local function OnBtnSubmitClick(self)
    local code = self.inputField:GetText()
    if code == nil or code == '' or string.len(code) < 6 then
        --UIUtil.ShowTipsId() 
        return
    end
    if self.verifyType == 0 then
        SFSNetwork.SendMessage(MsgDefines.AccountVerifyDevice,self.mail,1,code)
    elseif self.verifyType == 1 then
        SFSNetwork.SendMessage(MsgDefines.AccountDeleteVerifyDevice,1,code)
    end
end

local function OnValueChange(self, value)
    local len = string.len(value)
    for k, v in ipairs(self.boxTexts) do
        v:SetText( k<=len and value:sub(k, k) or '')
    end
end

UIMailVerifyView.OnCreate= OnCreate
UIMailVerifyView.OnDestroy = OnDestroy
UIMailVerifyView.OnEnable = OnEnable

UIMailVerifyView.ComponentDefine = ComponentDefine
UIMailVerifyView.ComponentDestroy = ComponentDestroy

UIMailVerifyView.OnBtnSubmitClick = OnBtnSubmitClick
UIMailVerifyView.OnValueChange = OnValueChange

return UIMailVerifyView