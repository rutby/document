---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/10/9 19:26
---
local RuinRewardItem = require "UI.UIRuinsRewardPreview.Component.RuinRewardItem"
local RuinRewardDetailItem = BaseClass("RuinRewardDetailItem",UIBaseContainer)
local base = UIBaseContainer

local score_path = "codeTxt"
local rank_path = "numTxt"
local des_txt_path = "Text_des"
local get_txt_path = "Text_get"
local content_path ="ScrollView/Viewport/Content"
local cur_img_path ="Bg2"
local bg_img_path ="Bg1"
local Localization = CS.GameEntry.Localization
local function OnCreate(self)
    base.OnCreate(self)
    self.rank = self:AddComponent(UITextMeshProUGUIEx,rank_path)
    self.score = self:AddComponent(UITextMeshProUGUIEx,score_path)
    self.des_txt = self:AddComponent(UITextMeshProUGUIEx,des_txt_path)
    self.cur_img = self:AddComponent(UIImage,cur_img_path)
    self.bg_img = self:AddComponent(UIImage,bg_img_path)
    self.des_txt:SetLocalText(111246)
    self.get_txt = self:AddComponent(UITextMeshProUGUIEx,get_txt_path)
    self.content = self:AddComponent(UIBaseContainer,content_path)
    self.model = {}
end

local function SetItemShow(self, data,curIndex)
    self.data = data
    self.rank:SetText(self.data.index)
    self.score:SetText(string.GetFormattedSeperatorNum(math.floor(self.data.score)))
    if self.data.isFinish and self.data.index~=curIndex then
        self.get_txt:SetText("")
        self.cur_img:SetActive(false)
        self.bg_img:SetActive(true)
    else
        self.cur_img:SetActive(true)
        self.bg_img:SetActive(false)
        if self.data.index == curIndex then
            self.get_txt:SetLocalText(111247)
            self.get_txt:SetColorRGBA(102/255,131/255,24/255,1)
        else
            self.get_txt:SetLocalText(302112)
            self.get_txt:SetColorRGBA(172/255,142/255,121/255,1)
        end
        
        
    end
    self:SetAllCellDestroy()
    local list = self.data.rewards
    if list~=nil then
        for i = 1, table.length(list) do
            self.model[i] = self:GameObjectInstantiateAsync(UIAssets.RuinsRewardItem, function(request)
                if request.isError then
                    return
                end
                local go = request.gameObject;
                go.gameObject:SetActive(true)
                go.transform:SetParent(self.content.transform)
                go.transform:Set_localScale(ResetScale.x, ResetScale.y, ResetScale.z)
                local nameStr = tostring(NameCount)
                go.name = nameStr
                NameCount = NameCount + 1
                local cell = self.content:AddComponent(RuinRewardItem,nameStr)
                cell:RefreshData(list[i])
            end)
        end
    end

end


local function OnDestroy(self)
    self:SetAllCellDestroy()
    base.OnDestroy(self)
end

local function SetAllCellDestroy(self)
    self.content:RemoveComponents(RuinRewardItem)
    if self.model~=nil then
        for k,v in pairs(self.model) do
            if v ~= nil then
                self:GameObjectDestroy(v)
            end
        end
    end
    self.model ={}
end


RuinRewardDetailItem.OnCreate = OnCreate
RuinRewardDetailItem.SetItemShow = SetItemShow
RuinRewardDetailItem.OnDestroy =OnDestroy
RuinRewardDetailItem.SetAllCellDestroy =SetAllCellDestroy
return RuinRewardDetailItem