---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/8/3 16:06
---
local EdenChooseCityItem = require "UI.UIEdenChooseCity.Component.EdenChooseCityItem"
local UIEdenChooseCityView = BaseClass("UIEdenChooseCityView",UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization
local txt_title_path ="UICommonMidPopUpTitle/bg_mid/titleText"
local close_btn_path = "UICommonMidPopUpTitle/bg_mid/CloseBtn"
local return_btn_path = "UICommonMidPopUpTitle/panel"
local scrollList_view_path = "ScrollViewList"
local des_txt_path = "Image/des_txt"
--创建
function UIEdenChooseCityView:OnCreate()
    base.OnCreate(self)
    self.cityId = self:GetUserData()
    self:ComponentDefine()
    self:DataDefine()
    self:ReInit()
end

-- 销毁
function UIEdenChooseCityView:OnDestroy()
    self:SetAllCellsDestroy()
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

function UIEdenChooseCityView:ComponentDefine()
    self.txt_title = self:AddComponent(UIText, txt_title_path)
    self.txt_title:SetLocalText(376052)
    self.close_btn = self:AddComponent(UIButton, close_btn_path)
    self.return_btn = self:AddComponent(UIButton, return_btn_path)
    self.scrollList_view = self:AddComponent(UIScrollView, scrollList_view_path)
    self.scrollList_view:SetOnItemMoveIn(function(itemObj, index)
        self:OnCellMoveInList(itemObj, index)
    end)
    self.scrollList_view:SetOnItemMoveOut(function(itemObj, index)
        self:OnCellMoveOutList(itemObj, index)
    end)

    self.close_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.return_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)

    self.des_txt = self:AddComponent(UIText,des_txt_path)
    self.des_txt:SetLocalText(111154)
end

function UIEdenChooseCityView:ComponentDestroy()
end

function UIEdenChooseCityView:DataDefine()
end

function UIEdenChooseCityView:DataDestroy()
    self.list = {}
end

function UIEdenChooseCityView:OnEnable()
    base.OnEnable(self)
    self:ShowCells()
end

function UIEdenChooseCityView:OnDisable()
    base.OnDisable(self)
end

function UIEdenChooseCityView:ReInit()
end

-- 表现销毁
function UIEdenChooseCityView:SetAllCellsDestroy()
    self:ClearScroll()
end

function UIEdenChooseCityView:OnAddListener()
    base.OnAddListener(self)
    --self:AddUIListener(EventId.ServerListRefresh, self.ShowCells)
end

function UIEdenChooseCityView:OnRemoveListener()
    base.OnRemoveListener(self)
    --self:RemoveUIListener(EventId.ServerListRefresh, self.ShowCells)
end

function UIEdenChooseCityView:ShowCells()
    self:ClearScroll()
    self.list = self.ctrl:GetNearCityList(self.cityId)
    if #self.list>0 then
        self.scrollList_view:SetTotalCount(#self.list)
        self.scrollList_view:RefillCells()
    end
end


--}}}
--{{{List
function UIEdenChooseCityView:OnCellMoveInList(itemObj, index)
    local tempType = self.list[index]
    itemObj.name = NameCount
    NameCount = NameCount + 1
    local cellItem = self.scrollList_view:AddComponent(EdenChooseCityItem, itemObj)
    cellItem:ReInit(tempType)
    cellItem:SetActive(true)
end

function UIEdenChooseCityView:OnCellMoveOutList(itemObj, index)
    self.scrollList_view:RemoveComponent(itemObj.name, EdenChooseCityItem)
end
--}}}
function UIEdenChooseCityView:ClearScroll()
    if self.scrollList_view~=nil then
        self.scrollList_view:ClearCells()
        self.scrollList_view:RemoveComponents(EdenChooseCityItem)
    end
    self.list = {}
end
return UIEdenChooseCityView