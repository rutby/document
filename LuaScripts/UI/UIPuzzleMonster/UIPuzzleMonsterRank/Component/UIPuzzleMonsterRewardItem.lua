---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2022/4/24 12:02
---
local RewardItem = require "UI.UIWorldPoint.Component.WorldPointRewardItem"
local UIPuzzleMonsterRewardItem = BaseClass("UIPuzzleMonsterRewardItem",UIBaseContainer)
local base = UIBaseContainer

local flag_path = "mainContent/rank/rankImg"
local rank_num_path = "mainContent/rank/rankNumTxt"
local rank_path = "mainContent/rank"

local createUser_path = "mainContent/createUser"
local createUser_name_path = "mainContent/createUser/createUserName"
local createUser_title_path = "mainContent/createUser/createUserTitle"

local attackReward_path = "mainContent/attackReward"
local attackReward_text_path = "mainContent/attackReward/attackRewardText"

local content_path ="mainContent/Content"
local cur_tips_text_path ="mainContent/cur_tips_text"
local select_img_path ="Common_supple"

local Localization = CS.GameEntry.Localization
local function OnCreate(self)
    base.OnCreate(self)
    self.rank_num = self:AddComponent(UIText,rank_num_path)
    self.flag = self:AddComponent(UIImage,flag_path)
    self.rank = self:AddComponent(UIBaseContainer, rank_path)

    self.createUser = self:AddComponent(UIBaseContainer, createUser_path)
    self.createUser_name = self:AddComponent(UIText, createUser_name_path)
    self.createUser_title = self:AddComponent(UIText, createUser_title_path)
    self.createUser_title:SetLocalText(372268)

    self.attackReward = self:AddComponent(UIBaseContainer, attackReward_path)
    self.attackReward_text = self:AddComponent(UIText, attackReward_text_path)
    
    self.content = self:AddComponent(UIBaseContainer,content_path)
    self.cur_tips_text = self:AddComponent(UIText,cur_tips_text_path)
    self.select_img = self:AddComponent(UIImage,select_img_path)
    self.model = {}
end

local function SetItemShow(self, data)
    self.data = data
    self.rank:SetActive(false)
    self.createUser:SetActive(false)
    self.attackReward:SetActive(false)
    if not string.IsNullOrEmpty(data.rankStr) then
        self.rank:SetActive(true)
        if data.rankStr=="1-1" then
            self.rank_num:SetText("")
            self.flag:SetActive(true)
            self.flag:LoadSprite("Assets/Main/Sprites/UI/UIAlliance/rank/UIalliance_rankingbg01.png")
        elseif data.rankStr =="2-2" then
            self.rank_num:SetText("")
            self.flag:SetActive(true)
            self.flag:LoadSprite("Assets/Main/Sprites/UI/UIAlliance/rank/UIalliance_rankingbg02.png")
        elseif data.rankStr =="3-3" then
            self.rank_num:SetText("")
            self.flag:SetActive(true)
            self.flag:LoadSprite("Assets/Main/Sprites/UI/UIAlliance/rank/UIalliance_rankingbg03.png")
        else
            self.rank_num:SetText(data.rankStr)
            self.flag:SetActive(false)
        end

        if data.select then
            self.select_img:LoadSprite(string.format(LoadPath.CommonNewPath,"Common_bg_item_supple1"))
        else
            self.select_img:LoadSprite(string.format(LoadPath.CommonNewPath,"Common_bg_item_supple"))
        end

        if data.selectStr ~= nil and data.selectStr ~= "" then
            self.cur_tips_text:SetActive(true)
            self.cur_tips_text:SetText(data.selectStr)
        else
            self.cur_tips_text:SetActive(false)
        end
    else
        if not string.IsNullOrEmpty(data.createrName) then
            self.createUser:SetActive(true)
            self.createUser_name:SetText(data.createrName)
        elseif data.attacked ~= nil then
            self.attackReward:SetActive(true)
            if data.attacked == 1 then
                self.attackReward_text:SetLocalText(372270)
            else
                self.attackReward_text:SetLocalText(372269)
            end
        end
        self.select_img:LoadSprite(string.format(LoadPath.CommonNewPath,"Common_bg_item_supple"))
        self.cur_tips_text:SetActive(false)
    end
    self:SetAllCellDestroy()
    local list = self.data.rewardStr
    if list ~= nil then
        for i = 1, table.length(list) do
            self.model[i] = self:GameObjectInstantiateAsync(UIAssets.WorldPointRewardItem, function(request)
                if request.isError then
                    return
                end
                local go = request.gameObject;
                go.gameObject:SetActive(true)
                go.transform:SetParent(self.content.transform)
                go.transform:Set_localScale(ResetScale.x, ResetScale.y, ResetScale.z)
                local nameStr = tostring(NameCount)
                go.name = nameStr
                NameCount = NameCount + 1
                local cell = self.content:AddComponent(RewardItem,nameStr)
                cell:RefreshData(list[i])
            end)
        end
    end

end


local function OnDestroy(self)
    base.OnDestroy(self)
end

local function SetAllCellDestroy(self)
    self.content:RemoveComponents(RewardItem)
    if self.model~=nil then
        for k,v in pairs(self.model) do
            if v ~= nil then
                self:GameObjectDestroy(v)
            end
        end
    end
    self.model ={}
end


UIPuzzleMonsterRewardItem.OnCreate = OnCreate
UIPuzzleMonsterRewardItem.SetItemShow = SetItemShow
UIPuzzleMonsterRewardItem.OnDestroy =OnDestroy
UIPuzzleMonsterRewardItem.SetAllCellDestroy =SetAllCellDestroy
return UIPuzzleMonsterRewardItem