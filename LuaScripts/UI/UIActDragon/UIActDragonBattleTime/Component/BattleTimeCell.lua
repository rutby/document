---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl
--- DateTime: 
---
local BattleTimeCell = BaseClass("BattleTimeCell", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

-- 创建
function BattleTimeCell:OnCreate()
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

-- 销毁
function BattleTimeCell:OnDestroy()

    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

--控件的定义
function BattleTimeCell:ComponentDefine()
    self._period_txt = self:AddComponent(UIText,"Txt_Period")
    self._startTime_txt = self:AddComponent(UIText,"Txt_StartTime")
    self._endTime_txt = self:AddComponent(UIText,"Txt_EndTime")
    self._periodNum_txt = self:AddComponent(UIText,"Txt_Period/Txt_PeriodNum")
    self._enroll_btn = self:AddComponent(UIButton,"Btn_Enroll")
    self._enroll_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:ClickEnroll()
    end)
    self._enroll_txt = self:AddComponent(UIText,"Btn_Enroll/Txt_Enroll")
    self._state_txt = self:AddComponent(UIText,"Txt_State")
end

--控件的销毁
function BattleTimeCell:ComponentDestroy()

end

--变量的定义
function BattleTimeCell:DataDefine()

end

--变量的销毁
function BattleTimeCell:DataDestroy()

end

function BattleTimeCell:SetData(data)
    self.data = data
    --self._period_txt:SetText(data.battlePeriod)
    self._startTime_txt:SetText(Localization:GetString("376020")..": ".. UITimeManager:GetInstance():TimeStampToTimeForServer(data.startTime))
    --self._endTime_txt:SetText(Localization:GetString("302838")..": ".. UITimeManager:GetInstance():TimeStampToTimeForServer(data.endTime))
    self._periodNum_txt:SetText(Localization:GetString("376102")..data.num)
  
    if self.view.battlePeriod and self.view.battlePeriod ~= 0 and self.view.battlePeriod == data.battlePeriod then
        --self._enroll_txt:SetLocalText(302039)
        self._state_txt:SetActive(true)
        self._state_txt:SetLocalText(302039)
        self._enroll_btn:SetActive(false)
    else
        self._state_txt:SetActive(false)
        self._enroll_btn:SetActive(true)
        self._enroll_txt:SetLocalText(390924)
    end
end

function BattleTimeCell:ClickEnroll()
    if DataCenter.AllianceBaseDataManager:IsR4orR5() then
        --检查是否已经报名过
        if self.view.battlePeriod and self.view.battlePeriod ~= 0 then
            if self.view.battlePeriod == self.data.battlePeriod then
                return
            else
                --不是同一场为修改报名场次
                DataCenter.ActDragonManager:SendModifyBattlePeriod(self.data.battlePeriod)
            end
        else
            DataCenter.ActDragonManager:SendSignUp(self.data.battlePeriod)
        end
        UIManager:GetInstance():DestroyWindow(UIWindowNames.UIActDragonBattleTime)
    else
        UIUtil.ShowTipsId(308027)
    end
end

return BattleTimeCell