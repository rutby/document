---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 24224.
--- DateTime: 2022/12/12 14:47
---
local SeasonAllianceRewardFlag = require "UI.UISeason.UISeasonAllianceReward.Component.SeasonAllianceRewardFlag"
local SeasonAllianceAttrDetail = require "UI.UISeason.UISeasonAllianceRewardDisplayMain.Component.SeasonAllianceAttrDetail"
local UISeasonAllianceRewardDisplayMainView = BaseClass("UISeasonAllianceRewardDisplayMainView", UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization
function UISeasonAllianceRewardDisplayMainView:OnCreate()
    base.OnCreate(self)
    SFSNetwork.SendMessage(MsgDefines.SeasonBalancePackageViewOpen)
    self:ComponentDefine()
    self:DataDefine()
end

function UISeasonAllianceRewardDisplayMainView:ComponentDefine()
    self._close_btn = self:AddComponent(UIButton, "safeArea/Back")
    self._close_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self.ctrl:CloseSelf()
    end)
    self._title_txt = self:AddComponent(UIText, "safeArea/Title")
    self._title_txt:SetLocalText(110295)
    self.displayNormal = self:AddComponent(UIBaseContainer, "content/displayNormal")
    self.displayS5 = self:AddComponent(UIBaseContainer, "content/displayS5")
    self._alliance_txt = self:AddComponent(UIText, "content/displayNormal/Text_lv")
    self._alliance_txt:SetLocalText(110293)
    self._alliance_txt_S5 = self:AddComponent(UIText, "content/displayS5/ImageB/Text_B")
    self._alliance_txt_S5:SetLocalText(110293)
    self._detail_txt_S5 = self:AddComponent(UIText, "content/displayS5/ImageA/Text_A")
    self._detail_txt_S5:SetLocalText(100092)
    self._rank_name = self:AddComponent(UIText, "content/displayS5/Order/rankName")
    self._rank_des = self:AddComponent(UIText, "content/displayS5/DesTxt")
    self.img = self:AddComponent(UIImage, "content/displayS5/Order/rankImg")
    self.layout1 = self:AddComponent(SeasonAllianceAttrDetail, "content/displayNormal/layoutNormal/layoutCell1")
    self.layout2 = self:AddComponent(SeasonAllianceAttrDetail, "content/displayNormal/layoutNormal/layoutCell2")
    self.layout3 = self:AddComponent(SeasonAllianceAttrDetail, "content/displayNormal/layoutNormal/layoutCell3")
    --self.layout4 = self:AddComponent(SeasonAllianceAttrDetail,"content/display/layout/layoutCell4")
    self.layout5 = self:AddComponent(SeasonAllianceAttrDetail, "content/displayS5/layoutS5/layoutCell5")
    self.layout6 = self:AddComponent(SeasonAllianceAttrDetail, "content/displayS5/layoutS5/layoutCell6")
    self.firstReward = self:AddComponent(SeasonAllianceRewardFlag, "content/alliance/first/firstBg")
    self.firstReward:InitData(1)
    self.secondReward = self:AddComponent(SeasonAllianceRewardFlag, "content/alliance/second/secondBg")
    self.secondReward:InitData(2)
    self.thirdReward = self:AddComponent(SeasonAllianceRewardFlag, "content/alliance/third/thirdBg")
    self.thirdReward:InitData(3)
    self.firstBtn = self:AddComponent(UIButton, "content/alliance/first/firstBg")
    self.firstBtn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnFirstClick()
    end)
    self.secondBtn = self:AddComponent(UIButton, "content/alliance/second/secondBg")
    self.secondBtn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnSecondClick()
    end)
    self.thirdBtn = self:AddComponent(UIButton, "content/alliance/third/thirdBg")
    self.thirdBtn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnThirdClick()
    end)
    self._left_btn = self:AddComponent(UIButton, "content/displayS5/Order/left")
    self._left_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnLeftClick()
    end)
    self._right_btn = self:AddComponent(UIButton, "content/displayS5/Order/right")
    self._right_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnRightClick()
    end)
    self.receiveMsg = false
    local seasonId = DataCenter.SeasonDataManager:GetSeasonId()
    self.displayNormal:SetActive(seasonId < 5)
    self.displayS5:SetActive(seasonId >= 5)
    self.topIndex = 1
    self:RefreshBtn()
end

function UISeasonAllianceRewardDisplayMainView:DataDefine()
end

function UISeasonAllianceRewardDisplayMainView:OnDestroy()
    base.OnDestroy(self)
end

function UISeasonAllianceRewardDisplayMainView:OnEnable()
    base.OnEnable(self)
    self:OnInitLeft()
end

function UISeasonAllianceRewardDisplayMainView:OnDisable()
    base.OnDisable(self)
end

function UISeasonAllianceRewardDisplayMainView:OnAddListener()
    base.OnAddListener(self)
    self:AddUIListener(EventId.GetSeasonRewardData, self.RefreshList)
end

function UISeasonAllianceRewardDisplayMainView:OnRemoveListener()
    base.OnRemoveListener(self)
    self:RemoveUIListener(EventId.GetSeasonRewardData, self.RefreshList)
end

function UISeasonAllianceRewardDisplayMainView:OnInitLeft()
    --local dic = DataCenter.DesertDataManager:GetAllMyDesert()
    --local maxNum = DataCenter.DesertDataManager:GetDesertMaxNum()
    --local value1 = string.GetFormattedSeperatorNum(math.floor(table.count(dic))).."/"..string.GetFormattedSeperatorNum(math.floor(maxNum))
    --self.layout1:InitData(Localization:GetString("110277"),value1)

    local rank = 1
    local forceRank = 5000
    local allianceData = DataCenter.AllianceBaseDataManager:GetAllianceBaseData()
    if allianceData ~= nil then
        rank = allianceData.rank
        forceRank = allianceData.forceRank
    end
    local value2 = ""
    if rank >= 5 then
        value2 = Localization:GetString("302336")
    else
        value2 = "R" .. rank
    end
    self.layout1:InitData(Localization:GetString("110296"), value2)
    self.layout5:InitData(Localization:GetString("110296"), value2)
    local occupyNum = DataCenter.WorldAllianceCityDataManager:GetMyAllianceCityLevelNum(6)
    local occupy7Num = DataCenter.WorldAllianceCityDataManager:GetMyAllianceCityLevelNum(7)
    local value3 = ""
    if occupyNum <= 0 then
        value3 = Localization:GetString("100206")
    else
        value3 = occupyNum
    end
    self.layout2:InitData(Localization:GetString("110297"), value3)
    --local value4 = ""
    --if occupy7Num<=0 then
    --    value4 = Localization:GetString("100289")
    --else
    --    value4 = Localization:GetString("100288")
    --end
    --self.layout3:InitData(Localization:GetString("110298"),value4)
    local value5 = ""
    if forceRank <= 0 or forceRank >= 5000 then
        value5 = Localization:GetString("361054")
    else
        value5 = forceRank
    end
    self.layout6:InitData(Localization:GetString("110529"), value5)
    if SeasonUtil.IsInSeasonDesertMode() then
        self.layout3:SetActive(true)
        self.layout3:InitData(Localization:GetString("110529"), value5)
    else
        self.layout3:SetActive(false)
    end
end

function UISeasonAllianceRewardDisplayMainView:OnLeftClick()
    self.topIndex = 1
    self:RefreshBtn()
    self:RefreshList()
end

function UISeasonAllianceRewardDisplayMainView:OnRightClick()
    self.topIndex = 2
    self:RefreshBtn()
    self:RefreshList()
end
function UISeasonAllianceRewardDisplayMainView:RefreshBtn()
    self._left_btn:SetActive(self.topIndex == 2)
    self._right_btn:SetActive(self.topIndex == 1)
    if self.topIndex == 1 then
        self._rank_name:SetLocalText(111107)
        self._rank_des:SetLocalText(111105)
        self.img:LoadSprite("Assets/Main/Sprites/UI/UISeasonRobots/UI_s5_jin")
    elseif self.topIndex == 2 then
        self._rank_name:SetLocalText(111108)
        self._rank_des:SetLocalText(111106)
        self.img:LoadSprite("Assets/Main/Sprites/UI/UISeasonRobots/UI_s5_yin")
    end
    
end
function UISeasonAllianceRewardDisplayMainView:RefreshList()
    self.receiveMsg = true
    local data1 = self.ctrl:GetRewardAllianceData(1)
    self.firstReward:InitData(1, nil, data1, self.topIndex)
    local data2 = self.ctrl:GetRewardAllianceData(2)
    self.secondReward:InitData(2, nil, data2, self.topIndex)
    local data3 = self.ctrl:GetRewardAllianceData(3)
    self.thirdReward:InitData(3, nil, data3, self.topIndex)
end

function UISeasonAllianceRewardDisplayMainView:OnFirstClick()
    if self.receiveMsg == true then
        UIManager:GetInstance():OpenWindow(UIWindowNames.UISeasonAllianceRewardDisplayDetail, { anim = true, hideTop = true }, 1,self.topIndex)
        --self.ctrl:CloseSelf()
    end
end
function UISeasonAllianceRewardDisplayMainView:OnSecondClick()
    if self.receiveMsg == true then
        UIManager:GetInstance():OpenWindow(UIWindowNames.UISeasonAllianceRewardDisplayDetail, { anim = true, hideTop = true }, 2,self.topIndex)
        --self.ctrl:CloseSelf()
    end
end
function UISeasonAllianceRewardDisplayMainView:OnThirdClick()
    if self.receiveMsg == true then
        UIManager:GetInstance():OpenWindow(UIWindowNames.UISeasonAllianceRewardDisplayDetail, { anim = true, hideTop = true }, 3,self.topIndex)
        --self.ctrl:CloseSelf()
    end
end
return UISeasonAllianceRewardDisplayMainView