---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2023/1/6 15:52
---


local UISeasonRecruitItemIntroView = BaseClass("UISeasonRecruitItemIntroView", UIBaseView)
local base = UIBaseView
local CampRecruitBgPath = 'Assets/Main/TextureEx/UIHeroRecruitBg/%s.png'

local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
    self:RefreshSeasonPanel()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    local btnBack = self:AddComponent(UIButton, "Panel")
    btnBack:SetOnClick(function()
        self.ctrl:CloseSelf(self.tipParam)
    end)

    self.textTitle       = self:AddComponent(UIText, "Root/TextTitle")

    --self.textTitle:SetLocalText(110021)
    --self.imgBg           = self:AddComponent(UIImage, 'ImgBg')
    self.btnInfo         = self:AddComponent(UIButton, "Root/BtnInfo")
    self.btnInfo:SetOnClick(BindCallback(self, self.OnBtnInfoClick))

    self.seasonPanel = self:AddComponent(UIImage, "Root/SeasonPanel")
    self.seasonTips1 = self:AddComponent(UIText, "Root/SeasonPanel/SeasonTips1")

    self.seasonTips2 = self:AddComponent(UIText, "Root/SeasonPanel/SeasonTips2")
    self.seasonTips3 = self:AddComponent(UIText, "Root/SeasonPanel/SeasonTips3")
    self.seasonImage = self:AddComponent(UIImage, "Root/SeasonPanel/SeasonImage")
    self.seasonTime = self:AddComponent(UIText, "Root/SeasonPanel/SeasonTime")
    self.seasonLeftTime = self:AddComponent(UIText, "Root/SeasonPanel/SeasonLeftTime")
    self.timeIcon = self:AddComponent(UIImage, "Root/SeasonPanel/TimeIcon")
    --self.percent = self:AddComponent(UIBaseContainer, "Root/RightPanel/PercentBg")
    --self.percentText1 = self:AddComponent(UIText, "Root/SeasonPanel/PercentBg/PercentText1")
    --self.percentText2 = self:AddComponent(UIText, "Root/SeasonPanel/PercentBg/PercentText2")
    --self.percentText3 = self:AddComponent(UIText, "Root/SeasonPanel/PercentBg/PercentText3")
    --self.percentText1:SetLocalText(320476)
    --self.percentText3:SetLocalText(320582)
end

local function ComponentDestroy(self)
    
end

local function DataDefine(self)
    local itemId, tipParam = self:GetUserData()
    self.lotteryData = self.ctrl:GetLotteryData(itemId)
    self.tipParam = tipParam
end

local function DataDestroy(self)

end

local function UpdateBg(self)
    if self.lotteryData == nil then
        return
    end
    local vec = string.split(self.lotteryData.picture, "|")
    if table.count(vec) == 2 then
        --local path = string.format(CampRecruitBgPath, vec[1])
        local heroPath = string.format(CampRecruitBgPath, vec[2])
        --self.imgBg:LoadSprite(path)
        if self.ctrl:IsNotNormal(self.lotteryData) then
            self.seasonPanel:LoadSprite(heroPath)
        end
    elseif table.count(vec) == 1 then
        --local path = string.format(CampRecruitBgPath, vec[1])
        --self.imgBg:LoadSprite(path)
    end
end


local function RefreshSeasonPanel(self)
    if self.lotteryData == nil then
        return
    end
    --self.percentText2:SetText(self.lotteryData.panel_rate)
    --self.percent:SetActive(not string.IsNullOrEmpty(self.lotteryData.panel_rate))
    self.seasonPanel:SetActive(self.ctrl:IsNotNormal(self.lotteryData))
    self.seasonTime:SetText("")
    self.seasonLeftTime:SetText("")
    self.timeIcon:SetActive(false)
    local data = DataCenter.LotteryDataManager:GetLotteryDataById(tostring(self.lotteryData.id))
    self.btnInfo:SetActive(data ~= nil)
    if self.ctrl:IsNotNormal(self.lotteryData) then
        self.seasonTips1:SetLocalText(toInt(self.lotteryData.panel_tips1))
        self.seasonTips2:SetLocalText(toInt(self.lotteryData.panel_tips2))
        self.seasonTips3:SetLocalText(GameDialogDefine.HERO_RECRUIT_DES, HeroUtils.GetDropSpecialHeroesNameList(self.lotteryData.id))

        self.seasonTips1:SetColor(self.ctrl:GetTextColor(self.lotteryData))
        self.seasonImage:SetColor(self.ctrl:GetTextColor(self.lotteryData))
    end
    self:UpdateBg()
end
local function OnBtnInfoClick(self)
    UIManager:GetInstance():OpenWindow(UIWindowNames.UIHeroRecruitTip, {anim = true}, tostring(self.lotteryData.id))
end

UISeasonRecruitItemIntroView.OnCreate= OnCreate
UISeasonRecruitItemIntroView.OnDestroy = OnDestroy
UISeasonRecruitItemIntroView.ComponentDefine = ComponentDefine
UISeasonRecruitItemIntroView.ComponentDestroy = ComponentDestroy
UISeasonRecruitItemIntroView.DataDefine = DataDefine
UISeasonRecruitItemIntroView.DataDestroy = DataDestroy
UISeasonRecruitItemIntroView.RefreshSeasonPanel = RefreshSeasonPanel
UISeasonRecruitItemIntroView.UpdateBg = UpdateBg
UISeasonRecruitItemIntroView.OnBtnInfoClick = OnBtnInfoClick

return UISeasonRecruitItemIntroView
