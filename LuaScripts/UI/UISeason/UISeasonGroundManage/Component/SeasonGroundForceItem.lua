---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/1/13 17:22
---
local SeasonGroundForceItem = BaseClass("SeasonGroundForceItem", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

local CLICK_TYPE = 
{
    None =0,
    OldMoney = 1,
    OldCrystal = 2,
    Reward = 3,
}
-- 创建
function SeasonGroundForceItem:OnCreate()
    base.OnCreate(self)
    self._des_txt = self:AddComponent(UIText,"Text_des")
    self._des_txt:SetLocalText("110456")
    self._value_txt = self:AddComponent(UIText,"Text_value")
    self.btn = self:AddComponent(UIButton,"btn")
    self.btn:SetOnClick(function()
        self:OnGetRewardClick()
    end)
    self.btn_detail = self:AddComponent(UIButton,"btn_detail")
    self.btn_detail:SetOnClick(function()
        self:OnDesClick()
    end)
    self.red_dot = self:AddComponent(UIBaseContainer,"btn/red_dot")
    self.red_dot:SetActive(false)
end

-- 销毁
function SeasonGroundForceItem:OnDestroy()
    base.OnDestroy(self)
end

-- 显示
function SeasonGroundForceItem:OnEnable()
    base.OnEnable(self)
end

-- 隐藏
function SeasonGroundForceItem:OnDisable()
    base.OnDisable(self)
end
function SeasonGroundForceItem:InitData()
    self.ClickType = CLICK_TYPE.None
    local showMoneyNum = LuaEntry.Effect:GetGameEffect(EffectDefine.SEASON_FORCE_REWARD_MONEY)
    local showCrystalNum = LuaEntry.Effect:GetGameEffect(EffectDefine.SEASON_FORCE_REWARD_BOX)
    local hasOldMoney = DataCenter.DesertDataManager:GetHasOldMoney()
    if hasOldMoney == true and showMoneyNum>0 then
        self.ClickType = CLICK_TYPE.OldMoney
        self._value_txt:SetLocalText(110474)
        self.red_dot:SetActive(true)
		return
    end
    local hasOldCrystal = DataCenter.DesertDataManager:GetHasOldCrystal()
    if hasOldCrystal == true and showCrystalNum>0 then
        self.ClickType = CLICK_TYPE.OldCrystal
        self._value_txt:SetLocalText(110474)
        self.red_dot:SetActive(true)
		return
    end
    local canGetNum = self.view.ctrl:GetCanGetForceRewardNum()
    if canGetNum>0 then
        self.ClickType = CLICK_TYPE.Reward
        local valueDes = Localization:GetString("110458")..": "..canGetNum
        self._value_txt:SetText(valueDes)
        self.red_dot:SetActive(true)
    else
        self.ClickType = CLICK_TYPE.None
        local valueDes = Localization:GetString("110458")..": "..0
        self._value_txt:SetText(valueDes)
        self.red_dot:SetActive(false)
    end
end

function SeasonGroundForceItem:OnGetRewardClick()
    if self.ClickType == CLICK_TYPE.OldCrystal then
        SFSNetwork.SendMessage(MsgDefines.SeasonForceGetBattlePassReward,SeasonForceRewardPackageType.CRYSTAL_BOX)
    elseif self.ClickType == CLICK_TYPE.OldMoney then
        SFSNetwork.SendMessage(MsgDefines.SeasonForceGetBattlePassReward,SeasonForceRewardPackageType.MONEY)
    elseif self.ClickType == CLICK_TYPE.Reward then
        SFSNetwork.SendMessage(MsgDefines.SeasonForceGetAllReward)
    end
end

function SeasonGroundForceItem:OnDesClick()
    UIManager:GetInstance():OpenWindow(UIWindowNames.UISeasonForceRewardDetail)
end 
return SeasonGroundForceItem