---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2022/12/27 14:15
---
local UIHeroTipView = require "UI.UIHero2.UIHeroTip.View.UIHeroTipView"
local SeasonResItem = BaseClass("SeasonResItem", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

-- 创建
function SeasonResItem:OnCreate()
    base.OnCreate(self)
    self._des_txt = self:AddComponent(UIText,"Background/addNum")
    self._value_txt = self:AddComponent(UIText,"Background/desertNum")
    self.icon = self:AddComponent(UIImage,"resourceIcon/GoodsIcon")
    self.btn = self:AddComponent(UIButton,"btn")
    self.btn:SetOnClick(function()
        self:OnDesClick()
    end)
end

-- 销毁
function SeasonResItem:OnDestroy()
    base.OnDestroy(self)
end

-- 显示
function SeasonResItem:OnEnable()
    base.OnEnable(self)
end

-- 隐藏
function SeasonResItem:OnDisable()
    base.OnDisable(self)
end
function SeasonResItem:InitData(resType)
    self.resType = resType
    local iconStr = DataCenter.ResourceManager:GetResourceIconByType(self.resType) 
    self.icon:LoadSprite(iconStr)
    self:RefreshNum()
end

function SeasonResItem:RefreshNum()
    local value = LuaEntry.Resource:GetCntByResType(self.resType)
    local valueMax = LuaEntry.Resource:GetMaxStorageByResType(self.resType)
    self._value_txt:SetText(string.GetFormattedStr(math.floor(value)).."/"..string.GetFormattedStr(math.floor(valueMax)))
    if self.resType == ResourceType.FLINT then
        local speed = self.view.ctrl:GetAttrNumByType(PlayerDesertAttr.ResSpeedFlint)
        self._des_txt:SetText(speed)
    elseif self.resType == ResourceType.Oil then
        local speed = self.view.ctrl:GetAttrNumByType(PlayerDesertAttr.ResSpeedGas)
        self._des_txt:SetText(speed)
    end
end

function SeasonResItem:OnDesClick()
    local scaleFactor = UIManager:GetInstance():GetScaleFactor()
    local position = self.btn.gameObject.transform.position + Vector3.New(-105, -20, 0) * scaleFactor
    local des = ""
    local param = UIHeroTipView.Param.New()
    if self.resType == ResourceType.FLINT then
        des = Localization:GetString("110436")
    elseif self.resType == ResourceType.Oil then
        des = Localization:GetString("110437")
    end
    param.content = des
    param.dir = UIHeroTipView.Direction.BELOW
    param.defWidth = 250
    param.pivot = 0.5
    param.position = position
    UIManager:GetInstance():OpenWindow(UIWindowNames.UIHeroTip, { anim = false }, param)
end

return SeasonResItem