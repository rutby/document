---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 24224.
--- DateTime: 2022/11/29 21:48
---
local UISeasonAllianceSelectMemberCtrl = BaseClass("UISeasonAllianceSelectMemberCtrl", UIBaseCtrl)
local Localization = CS.GameEntry.Localization
function UISeasonAllianceSelectMemberCtrl:CloseSelf()
    UIManager:GetInstance():DestroyWindow(UIWindowNames.UISeasonAllianceSelectMember)
end

function UISeasonAllianceSelectMemberCtrl:Close()
    UIManager:GetInstance():DestroyWindowByLayer(UILayer.Normal)
end

function UISeasonAllianceSelectMemberCtrl:GetAllMemberList()
    local showList = {}
    local menuList = DataCenter.DesertDataManager:GetSelfAllianceSendList()
    local all = DataCenter.AllianceMemberDataManager:GetAllMember()
    if all ~= nil then
        local list = table.values(all)
        for k,v in pairs(list) do
            if menuList[v.uid] ==nil and v.uid ~= LuaEntry.Player.uid then
                local oneData = {}
                oneData.uid = v.uid
                oneData.power = v.power
                oneData.name = v.name
                oneData.rank = v.rank
                oneData.headBg = v:GetHeadBgImg()
                oneData.pic = v.pic
                oneData.picVer = v.picVer
                table.insert(showList,oneData)
            end
        end
    end
    return showList
end
function UISeasonAllianceSelectMemberCtrl:GetMenuList()
    return DataCenter.DesertDataManager:GetSelfAllianceSendList()
end

function UISeasonAllianceSelectMemberCtrl:GetPackageData(packageId)
    local data = DataCenter.DesertDataManager:GetSelfAllianceSeasonReward()
    if data ~=nil and data.packagesList~=nil then
        return data.packagesList[packageId]
    end
end

function UISeasonAllianceSelectMemberCtrl:GetRewards(rewardList)
    local reward = {}
    if rewardList == nil then
        return reward
    end
    table.walk(rewardList, function (_, v)
        local item = {}
        item.count = v.count
        item.itemColor = DataCenter.ItemTemplateManager:GetToolBgByColor(ItemColor.WHITE)
        item.rewardType = v.rewardType
        local desc = DataCenter.RewardManager:GetDescByType(v.rewardType, v.itemId)
        local name = DataCenter.RewardManager:GetNameByType(v.rewardType, v.itemId)
        item.itemName = name
        item.itemDesc = desc
        item.isLocal = true
        if v.rewardType == RewardType.GOODS then
            if v.itemId ~= nil then
                --物品或英雄
                --item.itemName = Localization:GetString(name)
                local goods = DataCenter.ItemTemplateManager:GetItemTemplate(v.itemId)
                if goods ~= nil then
                    local join_method = -1
                    local icon_join = nil
                    if goods.join_method ~= nil and goods.join_method > 0 and goods.icon_join ~= nil and goods.icon_join ~= "" then
                        join_method = goods.join_method
                        icon_join = goods.icon_join
                    end

                    if join_method > 0 and icon_join ~= nil and icon_join ~= "" then
                        local tempJoin = string.split(icon_join, ";")
                        if #tempJoin > 1 then
                            item.itemColor = tempJoin[2]
                        end
                        if #tempJoin > 2 then
                            item.iconName = tempJoin[3]
                        end
                    else
                        --物品
                        item.itemColor = DataCenter.ItemTemplateManager:GetToolBgByColor(goods.color)
                        local itemType = goods.type
                        item.goodsType = goods.type
                        item.para2 = goods.para2
                        if itemType == 2 then
                            -- SPD
                            if goods.para1 ~= nil and goods.para1 ~= "" then
                                local para1 = goods.para1
                                local temp = string.split(para1, ';')
                                if temp ~= nil and #temp > 1 then
                                    item.itemFlag = temp[1] .. temp[2]
                                end
                            end
                        elseif itemType == 3 then
                            -- USE
                            local type2 = goods.type2
                            if type2 ~= 999 and goods.para ~= nil and goods.para ~= "" then
                                local res_num = tonumber(goods.para)
                                item.itemFlag = string.GetFormattedStr(res_num)
                            end
                        end

                        item.iconName = string.format(LoadPath.ItemPath, goods.icon)
                    end
                end
            end
        elseif v.rewardType == RewardType.GOLD then
            item.iconName = DataCenter.ResourceManager:GetResourceIconByType(ResourceType.Gold)
            item.itemColor = DataCenter.ItemTemplateManager:GetToolBgByColor(ItemColor.PURPLE)
        elseif v.rewardType == RewardType.OIL or v.rewardType == RewardType.METAL or v.rewardType == RewardType.FORMATION_STAMINA
                or v.rewardType == RewardType.WATER or v.rewardType == RewardType.PVE_POINT or v.rewardType == RewardType.DETECT_EVENT
                or v.rewardType == RewardType.MONEY or v.rewardType == RewardType.ELECTRICITY then
            item.iconName = DataCenter.RewardManager:GetPicByType(v.rewardType)
            item.itemColor = DataCenter.ItemTemplateManager:GetToolBgByColor(ItemColor.PURPLE)
        elseif v.rewardType == RewardType.EXP then
            item.itemColor = DataCenter.ItemTemplateManager:GetToolBgByColor(ItemColor.GREEN)
            item.iconName = "Assets/Main/Sprites/UI/Common/New/Common_icon_exp.png"
        end
        table.insert(reward, item)
    end)
    return reward
end

return UISeasonAllianceSelectMemberCtrl