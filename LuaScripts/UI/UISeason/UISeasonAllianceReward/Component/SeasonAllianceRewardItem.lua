---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 24224.
--- DateTime: 2022/11/29 16:00
---
local SeasonAllianceRewardItem = BaseClass("SeasonAllianceRewardItem", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

-- 创建
function SeasonAllianceRewardItem:OnCreate()
    base.OnCreate(self)
    self.title = self:AddComponent(UIText,"Text_title")
    self.slider = self:AddComponent(UISlider,"Slider")
    self._num_txt = self:AddComponent(UIText,"rewardNum")
    self._get_btn = self:AddComponent(UIButton,"getBtn")
    self._get_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnMemberSelectClick()
    end)
    self.img = self:AddComponent(UIImage,"boxObj/ItemIcon")
    self._get_txt = self:AddComponent(UIText,"getBtn/getTxt")
    self._get_txt:SetText(Localization:GetString("110304"))
end

-- 销毁
function SeasonAllianceRewardItem:OnDestroy()
    base.OnDestroy(self)
end

-- 显示
function SeasonAllianceRewardItem:OnEnable()
    base.OnEnable(self)
end

-- 隐藏
function SeasonAllianceRewardItem:OnDisable()
    base.OnDisable(self)
end

function SeasonAllianceRewardItem:OnMemberSelectClick()
    if self.curIndex == 1 then
        local giftId = self.view.ctrl:GetSelfPackageId()
        SFSNetwork.SendMessage(MsgDefines.SeasonBalanceReceivePackage,giftId)
    else
        UIManager:GetInstance():OpenWindow(UIWindowNames.UISeasonAllianceSelectMember,self.data.packageId)
    end
end

function SeasonAllianceRewardItem:InitData(data,index)
    self.data = data
    self.curIndex = index
    if self.data~=nil then
        local percent = math.min(1,(self.data.numRest/math.max(self.data.numTotal,1)))
        self.slider:SetValue(percent)
        self._num_txt:SetText(Localization:GetString("110315",(self.data.numRest.."/"..self.data.numTotal)))
    end
    
    CS.UIGray.SetGray(self._get_btn.transform, false, true)
    if index == 1 then
        self._get_btn:SetActive(true)
        self.title:SetText(Localization:GetString("361021"))
        local canClaim = false
        local selfInfo = DataCenter.DesertDataManager:GetSelfRewardData()
        if selfInfo ~=nil then
            canClaim = selfInfo.selfStatus == 1
        end
        if canClaim then
            CS.UIGray.SetGray(self._get_btn.transform, false, true)
            self._get_txt:SetText(Localization:GetString("170004"))
            self.slider:SetValue(1)
            self._num_txt:SetText(Localization:GetString("110315","1/1"))
        else
            CS.UIGray.SetGray(self._get_btn.transform, true, false)
            self._get_txt:SetText(Localization:GetString("170003"))
            self.slider:SetValue(0)
            self._num_txt:SetText(Localization:GetString("110315","0/1"))
        end
    elseif index == 2 then
        self.title:SetText(Localization:GetString("110301"))
        self._get_btn:SetActive(self.data.numRest>0)
    elseif index == 3 then
        self.title:SetText(Localization:GetString("110302"))
        self._get_btn:SetActive(self.data.numRest>0)
    else
        self.title:SetText(Localization:GetString("110303"))
        self._get_btn:SetActive(self.data.numRest>0)
    end
    if index ==1 or index ==2 then
        self.img:LoadSprite("Assets/Main/Sprites/UI/UIAllianceArmament/UIAllianceArmament_img_reward05.png")
    elseif index ==3 then
        self.img:LoadSprite("Assets/Main/Sprites/UI/UIAllianceArmament/UIAllianceArmament_img_reward03.png")
    else
        self.img:LoadSprite("Assets/Main/Sprites/UI/UIAllianceArmament/UIAllianceArmament_img_reward01.png")
    end
end


return SeasonAllianceRewardItem