---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 24224.
--- DateTime: 2022/12/9 15:11
---
local UIHeroTipView = require "UI.UIHero2.UIHeroTip.View.UIHeroTipView"
local SeasonAllianceRewardFlag = BaseClass("SeasonAllianceRewardFlag", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

-- 创建
function SeasonAllianceRewardFlag:OnCreate()
    base.OnCreate(self)
    self.img = self:AddComponent(UIImage,"Image")
    self._name_txt = self:AddComponent(UIText,"name")
    self.alliance_obj = self:AddComponent(UIBaseContainer,"allianceTable")
    self.infoBtnN = self:AddComponent(UIButton, "allianceTable/infoBtn")
    self.infoBtnN:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnClickInfoBtn()
    end)
    self._alliance_name_txt = self:AddComponent(UIText,"allianceTable/allianceName")
end

-- 销毁
function SeasonAllianceRewardFlag:OnDestroy()
    base.OnDestroy(self)
end

-- 显示
function SeasonAllianceRewardFlag:OnEnable()
    base.OnEnable(self)
end

-- 隐藏
function SeasonAllianceRewardFlag:OnDisable()
    base.OnDisable(self)
end

function SeasonAllianceRewardFlag:InitData(stageType,subStageType,allianceList,topIndex)
    self.allianceList = allianceList
    self.allianceStr = ""
    local seasonId = DataCenter.SeasonDataManager:GetSeasonId() or 0
    if stageType == 1 then
        self.img:LoadSprite("Assets/Main/Sprites/UI/UISeasonRobots/competition_img_dominate.png")
    elseif stageType ==2 then
        self.img:LoadSprite("Assets/Main/Sprites/UI/UISeasonRobots/competition_img_conquer.png")
    elseif stageType ==3 then
        self.img:LoadSprite("Assets/Main/Sprites/UI/UISeasonRobots/competition_img_explore.png")
    end
    if stageType ==1 then
        if subStageType ==1 then
            if topIndex == 1 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111109"))
            elseif topIndex == 2 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111116"))
            else
                self._name_txt:SetText(Localization:GetString("302952"))
            end
            
        elseif subStageType ==2 then
            if topIndex == 1 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111110"))
            elseif topIndex == 2 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111117"))
            else
                self._name_txt:SetText(Localization:GetString("302953"))
            end
            
        else
            if topIndex == 1 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111123"))
            elseif topIndex == 2 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111126"))
            else
                self._name_txt:SetText(Localization:GetString("110305"))
            end
            
        end
        self._name_txt:SetColor(Color.New(158/255, 78/255, 19/255, 1))
    elseif stageType == 2 then
        if subStageType ==1 then
            if topIndex == 1 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111111"))
            elseif topIndex == 2 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111118"))
            else
                self._name_txt:SetText(Localization:GetString("302954"))
            end
            
        elseif subStageType ==2 then
            if topIndex == 1 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111112"))
            elseif topIndex == 2 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111119"))
            else
                self._name_txt:SetText(Localization:GetString("302955"))
            end
            
        else
            if topIndex == 1 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111124"))
            elseif topIndex == 2 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111127"))
            else
                self._name_txt:SetText(Localization:GetString("110306"))
            end
            
        end
        
        self._name_txt:SetColor(Color.New(104/255, 46/255, 191/255, 1))
    elseif stageType == 3 then
        if subStageType ==1 then
            if topIndex == 1 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111113"))
            elseif topIndex == 2 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111120"))
            else
                self._name_txt:SetText(Localization:GetString("110310"))
            end
            
        elseif subStageType ==2 then
            if topIndex == 1 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111114"))
            elseif topIndex == 2 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111121"))
            else
                self._name_txt:SetText(Localization:GetString("110311"))
            end
            
        elseif subStageType == 3 then
            if topIndex == 1 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111115"))
            elseif topIndex == 2 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111122"))
            else
                self._name_txt:SetText(Localization:GetString("302957"))
            end
            
        else
            if topIndex == 1 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111125"))
            elseif topIndex == 2 and seasonId >= 5 then
                self._name_txt:SetText(Localization:GetString("111128"))
            else
                self._name_txt:SetText(Localization:GetString("110309"))
            end
            
        end
        self._name_txt:SetColor(Color.New(50/255, 82/255, 173/255, 1))
    end
    if self.allianceList~=nil and #self.allianceList>0 then
        self.alliance_obj:SetActive(true)
        local oneData = self.allianceList[1]
        local str = "["..oneData.allianceAbbr.."]"..oneData.allianceName
        self._alliance_name_txt:SetText(str)
        for i=1,#self.allianceList do
            local data = self.allianceList[i]
            local strSub = "["..data.allianceAbbr.."]"..data.allianceName
            if i~=#self.allianceList then
                self.allianceStr = self.allianceStr..strSub .."\n"
            else
                self.allianceStr = self.allianceStr..strSub
            end
        end
    else
        self.alliance_obj:SetActive(false)
    end
end

function SeasonAllianceRewardFlag:OnClickInfoBtn()
    local scaleFactor = UIManager:GetInstance():GetScaleFactor()
    local position = self.infoBtnN.gameObject.transform.position + Vector3.New(0, -20, 0) * scaleFactor

    local param = UIHeroTipView.Param.New()
    param.title = Localization:GetString("110516")
    param.content = self.allianceStr
    param.dir = UIHeroTipView.Direction.BELOW
    param.defWidth = 240
    param.pivot = 0.2
    param.position = position
    UIManager:GetInstance():OpenWindow(UIWindowNames.UIHeroTip, { anim = false }, param)
end


return SeasonAllianceRewardFlag