---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2023/4/24 16:31
---

local UIReserveToSoldierCell = BaseClass("UIReserveToSoldierCell",UIBaseContainer)
local base = UIBaseContainer

local input_path = "InputField"
local slider_path = "Slider"
local icon_path = "soldierIcon"
local level_path = "levelTxt"
local solider_name_path = "soldierName"

local function OnCreate(self)
    base.OnCreate(self)
    self.input = self:AddComponent(UIInput,input_path)
    self.input:SetText(0)
    self.input:SetOnEndEdit(function (value)
        self:IptOnValueChange(value)
    end)
    self.slider = self:AddComponent(UISlider,slider_path)
    self.slider:SetValue(0)
    self.slider:SetOnValueChanged(function (value)
        self:OnValueChange(value)
    end)
    self.icon = self:AddComponent(UIImage,icon_path)
    self.level = self:AddComponent(UIText,level_path)
    self.solider_name = self:AddComponent(UIText,solider_name_path)
end

local function OnDestroy(self)
    self.input = nil
    self.slider = nil
    self.icon = nil
    self.level = nil
    self.solider_name= nil
    base.OnDestroy(self)
end

local function InitData(self, data)
    self.data = data
    self.icon:LoadSprite(self.data.icon)
    local maxNum = 0
    if self.data.maxNum ~= nil then
        maxNum = self.data.maxNum
    end
    self.maxNum = maxNum
    self.level:SetText(NumToRoman(self.data.level))
    self.solider_name:SetText(self.data.name)
    self:RefreshData()
end
local function RefreshData(self)
    local curNum = self.view.ctrl:GetCurrentSoldierNum(self.data.armyId)
    local percent = curNum/math.max(1, self.data.maxNum)
    self.slider:SetValue(percent)
end

local function OnValueChange(self,val)
    local cnt = math.floor(val * self.maxNum +0.5)
    cnt = self.view.ctrl:SetNumAndCheckMax(self.data.armyId, cnt)

    self.input:SetText(string.GetFormattedSeperatorNum(math.floor(cnt)))
    self:RefreshData()
end

local function IptOnValueChange(self,value)
    local cnt = tonumber(value)
    cnt = self.view.ctrl:SetNumAndCheckMax(self.data.armyId, math.floor(cnt+0.5))
    self:RefreshData()
end

UIReserveToSoldierCell.OnCreate= OnCreate
UIReserveToSoldierCell.OnDestroy = OnDestroy
UIReserveToSoldierCell.InitData= InitData
UIReserveToSoldierCell.RefreshData = RefreshData
UIReserveToSoldierCell.OnValueChange= OnValueChange
UIReserveToSoldierCell.IptOnValueChange= IptOnValueChange

return UIReserveToSoldierCell