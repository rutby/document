---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2023/4/24 16:31
---

local UIReserveToSoldierView = BaseClass("UIReserveToSoldierView", UIBaseView)
local base = UIBaseView
local ListCell = require "UI.UIReServeToSoldier.Component.UIReserveToSoldierCell"

local closeBtn_path = "UICommonMidPopUpTitle/bg_mid/CloseBtn"
local titleTxt_path = "UICommonMidPopUpTitle/bg_mid/titleText"
local return_path = "UICommonMidPopUpTitle/panel"
local scroll_view = "ScrollView"
local slider_path = "Slider"
local num_text_path = "Slider/NumText"

local confirm_btn_path = "ConfirmBtn"
local confirm_btn_text_path = "ConfirmBtn/ConfirmBtnText"

local convert_title_path = "ConvertTitle"
local total_title_path = "TotalNumTitle"
--创建
local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
    self:ReInit()
end

-- 销毁
local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self._title_txt = self:AddComponent(UITextMeshProUGUIEx, titleTxt_path)
    self._title_txt:SetLocalText(111033)
    self.covert_title = self:AddComponent(UIText, convert_title_path)
    self.covert_title:SetLocalText(111028)
    self.num_text = self:AddComponent(UIText, num_text_path)
    self._close_btn = self:AddComponent(UIButton, closeBtn_path)
    self._return_btn = self:AddComponent(UIButton, return_path)
    self._close_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self.ctrl:CloseSelf()
    end)
    self._return_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self.ctrl:CloseSelf()
    end)

    self.scroll_view = self:AddComponent(UIScrollView, scroll_view)
    self.scroll_view:SetOnItemMoveIn(function(itemObj, index)
        self:OnCreateCell(itemObj, index)
    end)
    self.scroll_view:SetOnItemMoveOut(function(itemObj, index)
        self:OnDeleteCell(itemObj, index)
    end)

    self.slider_bar = self:AddComponent(UISlider, slider_path)
    self.confirm_btn = self:AddComponent(UIButton, confirm_btn_path)
    self.confirm_btn_text = self:AddComponent(UIText, confirm_btn_text_path)
    self.confirm_btn_text:SetLocalText(111030)
    self.confirm_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnConfirmClick()
    end)
    self.total_title = self:AddComponent(UIText, total_title_path)
    self.total_title:SetLocalText(111029)
end

local function ComponentDestroy(self)
    self:ClearScroll()
end


local function DataDefine(self)

end

local function DataDestroy(self)

end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end


local function ReInit(self)
    self.dataList, self.soliderInfo = self.ctrl:GetPanelData()

    if next(self.dataList) then
        self.scroll_view:SetTotalCount(#self.dataList)
        self.scroll_view:RefillCells()
    end
    self:RefreshSlider()
end

local function OnCreateCell(self,itemObj, index)
    itemObj.name = tostring(index)
    local cellItem = self.scroll_view:AddComponent(ListCell, itemObj)
    local data =  self.dataList[index]
    cellItem:InitData(data)
end

local function OnDeleteCell(self,itemObj, index)
    self.scroll_view:RemoveComponent(itemObj.name, ListCell)
end

local function ClearScroll(self)
    self.scroll_view:ClearCells()
    self.scroll_view:RemoveComponents(ListCell)
end

local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function RefreshSlider(self)
    local showMax = self.soliderInfo.max
    local current = self.soliderInfo.current
    local max = math.max(showMax, 1)
    local percent = current / max
    percent = Mathf.Clamp(percent, 0, 1)
    self.num_text:SetText(string.GetFormattedSeperatorNum(current).."/"..string.GetFormattedSeperatorNum(showMax))
    self.slider_bar:SetValue(percent)
end

local function OnConfirmClick(self)
    self.ctrl:DoConvert()
end

UIReserveToSoldierView.OnAddListener = OnAddListener
UIReserveToSoldierView.OnRemoveListener = OnRemoveListener
UIReserveToSoldierView.OnCreate = OnCreate
UIReserveToSoldierView.OnDestroy = OnDestroy
UIReserveToSoldierView.OnEnable = OnEnable
UIReserveToSoldierView.OnDisable = OnDisable
UIReserveToSoldierView.ComponentDefine = ComponentDefine
UIReserveToSoldierView.ComponentDestroy = ComponentDestroy
UIReserveToSoldierView.DataDefine = DataDefine
UIReserveToSoldierView.DataDestroy = DataDestroy
UIReserveToSoldierView.ReInit = ReInit
UIReserveToSoldierView.OnCreateCell = OnCreateCell
UIReserveToSoldierView.OnDeleteCell = OnDeleteCell
UIReserveToSoldierView.ClearScroll = ClearScroll
UIReserveToSoldierView.RefreshSlider = RefreshSlider
UIReserveToSoldierView.OnConfirmClick = OnConfirmClick

return UIReserveToSoldierView