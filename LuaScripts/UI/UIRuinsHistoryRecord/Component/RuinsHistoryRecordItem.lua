---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/10/10 17:09
---
local RuinsHistoryRecordItem = BaseClass("RuinsHistoryRecordItem", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local cityLvTxt_path = "icon/level"
local cityPosTxt_path = "icon/position"
local cityPosBtn_path = "icon/position/posBtn"
local city_name_path = "cityName"
local city_des_path = "cityDes"
local first_obj_path = "firstObj"
local first_txt_path = "firstObj/firstTxt"

local rank_1_head_path ="player1Obj/UIPlayerHead1"
local rank_2_head_path ="player2Obj/UIPlayerHead2"
local rank_3_head_path ="player3Obj/UIPlayerHead3"
local name_1_path = "player1Obj/name_1"
local name_2_path ="player2Obj/name_2"
local name_3_path ="player3Obj/name_3"
local score_1_path = "player1Obj/score_1"
local score_2_path = "player2Obj/score_2"
local score_3_path = "player3Obj/score_3"

local detail_btn_path = "detailBtn"

local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.cityName = self:AddComponent(UITextMeshProUGUIEx, city_name_path)
    self.cityDes = self:AddComponent(UITextMeshProUGUIEx, city_des_path)
    self.first_obj = self:AddComponent(UIBaseContainer,first_obj_path)
    self.first_txt = self:AddComponent(UITextMeshProUGUIEx, first_txt_path)
    self.first_txt:SetLocalText(111257)
    self.cityLvTxtN = self:AddComponent(UITextMeshProUGUIEx, cityLvTxt_path)
    self.cityPosTxtN = self:AddComponent(UITextMeshProUGUIEx, cityPosTxt_path)
    self.cityPosBtnN = self:AddComponent(UIButton, cityPosBtn_path)
    self.cityPosBtnN:SetOnClick(function()
        self:OnClickJumpBtn()
    end)
    self.detail_btn = self:AddComponent(UIButton, detail_btn_path)
    self.detail_btn:SetOnClick(function()
        self:OnClickDetailBtn()
    end)
    self.player_head_1 = self:AddComponent(UIPlayerHead, rank_1_head_path)
    self.player_head_2 = self:AddComponent(UIPlayerHead, rank_2_head_path)
    self.player_head_3 = self:AddComponent(UIPlayerHead, rank_3_head_path)

    self.name_1 = self:AddComponent(UITextMeshProUGUIEx, name_1_path)
    self.name_2 = self:AddComponent(UITextMeshProUGUIEx, name_2_path)
    self.name_3 = self:AddComponent(UITextMeshProUGUIEx, name_3_path)
    self.score_1 = self:AddComponent(UITextMeshProUGUIEx, score_1_path)
    self.score_2 = self:AddComponent(UITextMeshProUGUIEx, score_2_path)
    self.score_3 = self:AddComponent(UITextMeshProUGUIEx, score_3_path)
end

local function ComponentDestroy(self)

end

local function DataDefine(self)
    self.data = nil
    self.onClick = nil
end

local function DataDestroy(self)

end

local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end
local function SetData(self, data)
    self.data = data
    self.pos = nil
    local cityId = self.data.cityId
    local cityData = DataCenter.AllianceCityTemplateManager:GetTemplate(cityId)
    if cityData~=nil then
        self.cityLvTxtN:SetText(cityData.level)
        self.pos = cityData.center
        self.cityPosTxtN:SetLocalText(300015, cityData.pos.x, cityData.pos.y)
        self.cityName:SetLocalText(cityData.name)
    end
    self.cityDes:SetText(Localization:GetString("111251")..": "..UITimeManager:GetInstance():TimeStampToTimeForServer(self.data.recordTime))
    
    self.first_obj:SetActive(self.data.recordState == AllianceCityRecordState.HISTORY_FIRST_OCCUPY)
    local firstData = self.data.rankList[1]
    local secondData = self.data.rankList[2]
    local thirdData = self.data.rankList[3]
    if firstData~=nil then
        self.player_head_1:SetData(firstData.uid, firstData.pic, firstData.picVer)
        self.name_1:SetText(firstData.name)
        self.score_1:SetText(string.GetFormattedSeperatorNum(firstData.score))
    else
        self.player_head_1:SetData("")
        self.name_1:SetLocalText(302233)
        self.score_1:SetText("0")
    end

    if secondData~=nil then
        self.player_head_2:SetData(secondData.uid, secondData.pic, secondData.picVer)
        self.name_2:SetText(secondData.name)
        self.score_2:SetText(string.GetFormattedSeperatorNum(secondData.score))
    else
        self.player_head_2:SetData("")
        self.name_2:SetLocalText(302233)
        self.score_2:SetText("0")
    end

    if thirdData~=nil then
        self.player_head_3:SetData(thirdData.uid, thirdData.pic, thirdData.picVer)
        self.name_3:SetText(thirdData.name)
        self.score_3:SetText(string.GetFormattedSeperatorNum(thirdData.score))
    else
        self.player_head_3:SetData("")
        self.name_3:SetLocalText(302233)
        self.score_3:SetText("0")
    end
end


local function OnClickDetailBtn(self)
    if self.data~=nil and self.data.uuid~=nil then
        UIManager:GetInstance():OpenWindow(UIWindowNames.UIRuinsRankDetail,{anim = true,isBlur = true},self.data.uuid,false)
    end
end

local function OnClickJumpBtn(self)
    if self.pos~=nil then
        local position = SceneUtils.TileToWorld(self.pos, ForceChangeScene.World)
        GoToUtil.CloseAllWindows()
        GoToUtil.GotoWorldPos(position,nil,nil,function()
            WorldArrowManager:GetInstance():ShowArrowEffect(0,position,ArrowType.Building)
        end)
    end
end

RuinsHistoryRecordItem.OnCreate = OnCreate
RuinsHistoryRecordItem.OnDestroy = OnDestroy
RuinsHistoryRecordItem.ComponentDefine = ComponentDefine
RuinsHistoryRecordItem.ComponentDestroy = ComponentDestroy
RuinsHistoryRecordItem.DataDefine = DataDefine
RuinsHistoryRecordItem.DataDestroy = DataDestroy
RuinsHistoryRecordItem.OnAddListener = OnAddListener
RuinsHistoryRecordItem.OnRemoveListener = OnRemoveListener
RuinsHistoryRecordItem.OnEnable = OnEnable
RuinsHistoryRecordItem.OnDisable = OnDisable

RuinsHistoryRecordItem.SetData = SetData
RuinsHistoryRecordItem.OnClickDetailBtn = OnClickDetailBtn
RuinsHistoryRecordItem.OnClickJumpBtn = OnClickJumpBtn

return RuinsHistoryRecordItem