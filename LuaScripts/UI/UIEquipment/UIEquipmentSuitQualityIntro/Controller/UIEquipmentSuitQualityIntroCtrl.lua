---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2023/3/6 15:05
---

local UIEquipmentSuitQualityIntroCtrl = BaseClass("UIEquipmentSuitQualityIntroCtrl", UIBaseCtrl)
local Localization = CS.GameEntry.Localization

local function CloseSelf(self)
    UIManager:GetInstance():DestroyWindow(UIWindowNames.UIEquipmentSuitQualityIntro)
end

local function GetPanelData(self, suitId, quality)
    local suitTemplate = DataCenter.EquipmentSuitTemplateManager:GetTemplate(suitId)
    local result = {}
    result.name = suitTemplate.name
    
    local equipments = {}
    if suitTemplate then
        for _, v in ipairs(suitTemplate.includeEquip) do
            local lv = 1
            if quality == EquipmentConst.EquipmentColor.EquipmentColor_Orange then
                lv = 100
            else
                lv = DataCenter.EquipmentTemplateManager:GetQualityUnlockLv(v, quality + 1)
            end
            local equipmentId = v + lv - 1
            local template = DataCenter.EquipmentTemplateManager:GetTemplate(equipmentId)
            local para = {}
            para.equipmentId = equipmentId
            para.name = template.name
            para.lv = lv
            para.icon = EquipmentUtil.GetEquipmentIcon(equipmentId)
            local attrList = EquipmentUtil.GetEquipmentAttr(equipmentId)
            para.attrList = attrList
            
            table.insert(equipments, para)
        end
    end
    
    local suitAttr = {}
    for i = 1, EquipmentConst.MaxSuitAttr do
        local suitIntro = EquipmentUtil.GetEquipmentSuitAttr(suitId, i)
        if suitIntro then
            local para = {}
            para.name = suitIntro.name
            para.effect = suitIntro:GetDescription()
            --para.unlockStr = suitIntro:GetUnlockTip(0)
            if EquipmentConst.SuitEffectDesc[i] ~= nil then
                para.unlockStr = Localization:GetString(EquipmentConst.SuitEffectDesc[i]) 
            else
                para.unlockStr = ""
            end
            para.iconName = suitTemplate:GetSkillQualityIconNameByIndex(i)
            table.insert(suitAttr, para)
        end
    end
    
    local addTitle = function(str)
        local para = {}
        para.type = EquipmentConst.EquipmentSuitQualityViewCellType.EquipmentSuitQualityViewCellType_Title
        para.title = str
        return para
    end
    
    local list = {}
    result.list = list
    local title1 = addTitle(270000)
    table.insert(list, title1)

    local equipPara
    for index, v in ipairs(equipments) do
        --if math.fmod(index, EquipmentConst.EquipmentSuitQualityViewCellNumPerLine) == 1 then
            equipPara = {}
            equipPara.type = EquipmentConst.EquipmentSuitQualityViewCellType.EquipmentSuitQualityViewCellType_Equipment
            equipPara.list = {}
            table.insert(list, equipPara)
        --end
        table.insert(equipPara.list, v)
    end
    
    local title2 = addTitle(270001)
    table.insert(list, title2)

    local suitPara
    for index, v in ipairs(suitAttr) do
        if math.fmod(index, EquipmentConst.EquipmentSuitQualityViewCellSuitNumPerLine) == 1 then
            suitPara = {}
            suitPara.type = EquipmentConst.EquipmentSuitQualityViewCellType.EquipmentSuitQualityViewCellType_Suit
            suitPara.list = {}
            table.insert(list, suitPara)
        end
        table.insert(suitPara.list, v)
    end

    return result
end

UIEquipmentSuitQualityIntroCtrl.CloseSelf = CloseSelf
UIEquipmentSuitQualityIntroCtrl.GetPanelData = GetPanelData

return UIEquipmentSuitQualityIntroCtrl