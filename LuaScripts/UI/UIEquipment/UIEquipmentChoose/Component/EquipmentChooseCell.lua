---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2023/3/1 16:15
---


local EquipmentChooseCell = BaseClass('EquipmentChooseCell', UIBaseContainer)
local base = UIBaseContainer
local EquipmentCell = require "UI.UIEquipment.Common.EquipmentCell"

local cell_path = ""
local formation_path = "InFormation"
local formation_text_path = "InFormation/InFormationText"
local select_path = "SelectIcon"
local lock_path = "lock"

local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.cell = self:AddComponent(EquipmentCell, cell_path)
    self.formation = self:AddComponent(UIBaseContainer, formation_path)
    self.formation_text = self:AddComponent(UITextMeshProUGUIEx, formation_text_path)
    self.select = self:AddComponent(UIBaseContainer, select_path)
    self.lock = self:AddComponent(UIBaseContainer, lock_path)
    self.select:SetActive(false)
end

local function ComponentDestroy(self)

end

local function SetData(self, data)
    self.data = data
    self.cell:SetData(self.data, BindCallback(self, self.OnClickCell))
    self.select:SetActive(false)
    self.formation:SetActive(self.data.selfCarIndex ~= nil and EquipmentUtil.IsNormalCarIndex(self.data.selfCarIndex))
    self.formation_text:SetText(self.data.selfCarIndex or "")
    self.lock:SetActive(self.data.uuid == nil)
end

local function OnClickCell(self)
    local para = {}
    para.equipmentUid = self.data.uuid
    para.equipmentId = self.data.equipmentId
    para.carIndex = self.data.carIndex
    para.type = self.data.type
    para.currentPosUid = self.data.currentPosUid
    para.fromType = EquipmentConst.EquipmentInfoViewType.EquipmentInfoViewType_Change_View
    para.posX = 400 * UIManager:GetInstance():GetScaleFactor()
    para.isLeft = true
    UIManager:GetInstance():OpenWindow(UIWindowNames.UIEquipmentInfo, { anim = false, playEffect = false}, para)
    self.select:SetActive(true)
end

local function OnAddListener(self)
    base.OnAddListener(self)
    self:AddUIListener(EventId.EquipInfoClose, self.OnSelectEvent)
end

local function OnRemoveListener(self)
    self:AddUIListener(EventId.EquipInfoClose, self.OnSelectEvent)
    base.OnRemoveListener(self)
end

local function OnSelectEvent(self, para)
    self.select:SetActive(false)
end

EquipmentChooseCell.OnAddListener = OnAddListener
EquipmentChooseCell.OnRemoveListener = OnRemoveListener
EquipmentChooseCell.OnSelectEvent = OnSelectEvent
EquipmentChooseCell.OnCreate= OnCreate
EquipmentChooseCell.OnDestroy = OnDestroy
EquipmentChooseCell.ComponentDefine = ComponentDefine
EquipmentChooseCell.ComponentDestroy = ComponentDestroy
EquipmentChooseCell.SetData = SetData
EquipmentChooseCell.OnClickCell = OnClickCell

return EquipmentChooseCell