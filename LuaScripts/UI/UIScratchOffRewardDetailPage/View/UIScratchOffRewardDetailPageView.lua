---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1020.
--- DateTime: 2023/5/23 15:32
---

local UIScratchOffRecordPageView = BaseClass("UIScratchOffRecordPageView", UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization

local ScratchOffCommonRewardPanel = require "UI.UIScratchOffRewardDetailPage.Comp.ScratchOffCommonRewardPanel"
local ScratchOffLuckyRewardPanel = require "UI.UIScratchOffRewardDetailPage.Comp.ScratchOffLuckyRewardPanel"

local title_path = "UICommonPopUpTitle/bg_mid/titleText"
local closeBtn_path = "UICommonPopUpTitle/bg_mid/CloseBtn"
local toggle_path = "ImgBg/Tab/Toggle"

local subPanelConf = {
    {
        PanelPath = "ImgBg/Container/ScratchOffCommonRewardPanel",
        Script = ScratchOffCommonRewardPanel,
        TabName = "372512",
    },
    {
		PanelPath = "ImgBg/Container/ScratchOffLuckyRewardPanel",
        Script = ScratchOffLuckyRewardPanel,
        TabName = "372933",
    },
}

local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
    self:InitUI()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.title = self:AddComponent(UIText, title_path)
    self.closeBtnN = self:AddComponent(UIButton, closeBtn_path)
    self.closeBtnN:SetOnClick(function()
        self:OnClickCloseBtn()
    end)
    
    for i = 1, #subPanelConf do
        local tempPath = toggle_path .. i
        local toggle = self:AddComponent(UIToggle, tempPath)
        toggle:SetOnValueChanged(function(tf)
            if tf then
                self:ChangeShowType(i)
            end
        end)
        
        local newTog = {}
        newTog.toggle = toggle
        newTog.redN = toggle:AddComponent(UIBaseContainer, "ImgWarn")
        newTog.redCountN = toggle:AddComponent(UIText, "ImgWarn/TxtNum")
        newTog.chooseN = toggle:AddComponent(UIBaseContainer, "Choose")
        newTog.unselectNameN = toggle:AddComponent(UIText, "unselectName")
        newTog.unselectNameN:SetLocalText(subPanelConf[i].TabName)
        newTog.selectNameN = toggle:AddComponent(UIText, "Choose/selectName")
        newTog.selectNameN:SetLocalText(subPanelConf[i].TabName)
        table.insert(self.toggleList, newTog)
        
        local panel = self:AddComponent(subPanelConf[i].Script, subPanelConf[i].PanelPath)
        table.insert(self.panelList, panel)
    end
end

local function ComponentDestroy(self)
    
end

local function DataDefine(self)
    self.curTabIndex = 1
    self.toggleList = {}
    self.panelList = {}
    local activityId, curTabIndex = self:GetUserData()
    self.activityId = tonumber(activityId)
    self.curTabIndex = tonumber(curTabIndex)
end

local function DataDestroy(self)
    self.curTabIndex = nil
    self.toggleList = nil
    self.panelList = nil
end

local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function InitUI(self)
    self:ChangeShowType(self.curTabIndex)
end

local function ChangeShowType(self, tabIndex)
    for i = 1, #subPanelConf do
        self.toggleList[i].chooseN:SetActive(i == tabIndex)
        self.toggleList[i].selectNameN:SetActive(i == tabIndex)
        self.toggleList[i].unselectNameN:SetActive(i ~= tabIndex)
    end

	if not self.panelList[tabIndex] then
		return
	else
		for i = 1, #self.panelList do
			self.panelList[i]:SetActive(i == tabIndex)
		end
		self.curTabIndex = tabIndex
		self:RefreshOnShowPanel()
	end
end

local function RefreshOnShowPanel(self)
    self.title:SetLocalText(subPanelConf[self.curTabIndex].TabName)
    self.panelList[self.curTabIndex]:RefreshPanel(self.activityId)
end


local function OnClickCloseBtn(self)
    self.ctrl:CloseSelf()
end

UIScratchOffRecordPageView.OnCreate = OnCreate
UIScratchOffRecordPageView.OnDestroy = OnDestroy
UIScratchOffRecordPageView.ComponentDefine = ComponentDefine
UIScratchOffRecordPageView.ComponentDestroy = ComponentDestroy
UIScratchOffRecordPageView.DataDefine = DataDefine
UIScratchOffRecordPageView.DataDestroy = DataDestroy
UIScratchOffRecordPageView.OnAddListener = OnAddListener
UIScratchOffRecordPageView.OnRemoveListener = OnRemoveListener

UIScratchOffRecordPageView.InitUI = InitUI
UIScratchOffRecordPageView.ChangeShowType = ChangeShowType
UIScratchOffRecordPageView.RefreshOnShowPanel = RefreshOnShowPanel
UIScratchOffRecordPageView.OnClickCloseBtn = OnClickCloseBtn

return UIScratchOffRecordPageView