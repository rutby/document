---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2021/8/24 16:58
---
local UISeasonRankRewardCell = BaseClass("UISeasonRankRewardCell", UIBaseContainer)
local base = UIBaseContainer
local UICommonItem = require "UI.UICommonItem.UICommonItem"

local function OnCreate(self)
    base.OnCreate(self)

    self.rewardModels ={}
    self.rewardItemsList = {}
    
    self.titleN = self:AddComponent(UIText, "numTxt")
    self.contentN = self:AddComponent(UIBaseContainer, "Rect_Reward")
    
    self.first_flag = self:AddComponent(UIBaseContainer,"firstImg")
    self.second_flag = self:AddComponent(UIBaseContainer,"secondImg")
    self.third_flag = self:AddComponent(UIBaseContainer,"thirdImg")
end

local function OnDestroy(self)
    self.rewardModels = nil
    self.rewardItemsList = nil
    
    self.titleN = nil
    self.tipN = nil
    self.contentN = nil
    base.OnDestroy(self)
end


local function ShowRewards(self, title, rewards, hideCount)

    self.titleN:SetActive(true)
    self.first_flag:SetActive(false)
    self.third_flag:SetActive(false)
    self.second_flag:SetActive(false)
    local strTitle = string.split(title,"-")
    if tonumber(strTitle[1]) == tonumber(strTitle[2]) then
        if tonumber(strTitle[1]) == 1 or tonumber(strTitle[1]) == 2 or tonumber(strTitle[1]) == 3 then
            self.titleN:SetActive(false)
        end
        self.first_flag:SetActive(tonumber(strTitle[1]) ==1)
        self.third_flag:SetActive(tonumber(strTitle[1]) ==3)
        self.second_flag:SetActive(tonumber(strTitle[1]) ==2)
        self.titleN:SetLocalText(280138,strTitle[1])
    elseif #strTitle == 1 then
        self.titleN:SetLocalText(372278,strTitle[1])
    else
        self.titleN:SetLocalText(280138,title)
    end
    local list = {}
    local strReward = string.split(rewards,";")
    for i = 1, #strReward do
        list[i] = {}
        local str = string.split(strReward[i],",")
        list[i].itemId = tonumber(str[1])
        list[i].rewardType = tonumber(str[2])
        list[i].count = tonumber(str[3])
    end
    self:SetAllRewardsDestroy()
    self.rewardModelCount =0
    if list~=nil and #list>0 then
        for i = 1, table.length(list) do
            --复制基础prefab，每次循环创建一次
            self.rewardModelCount= self.rewardModelCount+1
            self.rewardModels[self.rewardModelCount] = self:GameObjectInstantiateAsync(UIAssets.UICommonItem, function(request)
                if request.isError then
                    return
                    
                end
                local go = request.gameObject;
                go.gameObject:SetActive(true)
                go.transform:SetParent(self.contentN.transform)
                go.transform.localScale = Vector3.New(0.5, 0.5, 0.5)
                local nameStr = tostring(NameCount)
                go.name = nameStr
                NameCount = NameCount + 1
                local cell = self.contentN:AddComponent(UICommonItem,nameStr)
                local param = {}
                param.itemId = list[i].itemId
                param.rewardType = list[i].rewardType
                param.count = list[i].count
                cell:ReInit(param)
                cell:SetNameText("")
                CS.UnityEngine.UI.LayoutRebuilder.ForceRebuildLayoutImmediate(self.rectTransform)
                table.insert(self.rewardItemsList,cell)
            end)
        end
    end
end


local function SetAllRewardsDestroy(self)
    self.contentN:RemoveComponents(UICommonItem)
    if self.rewardModels~=nil then
        for k,v in pairs(self.rewardModels) do
            if v ~= nil then
                self:GameObjectDestroy(v)
            end
        end
    end
    self.rewardModels ={}
    self.rewardItemsList = {}
end


UISeasonRankRewardCell.OnCreate = OnCreate
UISeasonRankRewardCell.OnDestroy = OnDestroy


UISeasonRankRewardCell.ShowRewards = ShowRewards
UISeasonRankRewardCell.SetAllRewardsDestroy = SetAllRewardsDestroy

return UISeasonRankRewardCell