---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2022/1/19 16:51
---

local UIHeroStationValUpItem = BaseClass("UIHeroStationValUpItem", UIBaseContainer)
local base = UIBaseContainer
local UIHeroCellSmall = require "UI.UIHero2.Common.UIHeroCellSmall"

local old_hero_path = "OldCell"
local new_hero_path = "NewCell"
local blue_glow_path = "BlueGlow"
local purple_glow_path = "PurpleGlow"
local gold_glow_path = "GoldGlow"

local BLUE_QUALITY = 2
local PURPLE_QUALITY = 4
local GOLD_QUALITY = 6

local TWEEN_NUM_DURATION = 0.425
local TWEEN_NUM_DELAY = 0.3
local TWEEN_NUM_SCALE = 1.2

local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.old_hero = self:AddComponent(UIHeroCellSmall, old_hero_path)
    self.new_hero = self:AddComponent(UIHeroCellSmall, new_hero_path)
    self.blue_glow_particle = self.transform:Find(blue_glow_path):GetComponent(typeof(CS.UnityEngine.ParticleSystem))
    self.purple_glow_particle = self.transform:Find(purple_glow_path):GetComponent(typeof(CS.UnityEngine.ParticleSystem))
    self.gold_glow_particle = self.transform:Find(gold_glow_path):GetComponent(typeof(CS.UnityEngine.ParticleSystem))
end

local function ComponentDestroy(self)
    self.old_hero = nil
    self.new_hero = nil
    self.blue_glow_particle = nil
    self.purple_glow_particle = nil
    self.gold_glow_particle = nil
end

local function DataDefine(self)
    self.active = true
end

local function DataDestroy(self)
    self.active = nil
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function SetData(self, data)
    local prefix, suffix = DataCenter.HeroStationManager:GetSkillEffectAffix(data.skillId)
    
    self.old_hero:SetData(data.heroUuid, nil, nil, true)
    self.old_hero:SetHeroStationSkill(data.skillId)
    self.old_hero:SetQuality(data.old.quality)
    self.old_hero.text_level:SetText("Lv." .. data.old.level)
    self.old_hero.text_level:SetColor(WhiteColor)
    self.old_hero.in_station_des:SetText(prefix .. data.old.val .. suffix)
    self.old_hero:SetRank(data.old.rank, true)
    
    self.new_hero:SetData(data.heroUuid, nil, nil, true)
    self.new_hero:SetHeroStationSkill(data.skillId)
    self.new_hero.in_station_des:SetAffix(prefix, suffix)
    self.new_hero.in_station_des:SetNum(data.old.val)
    self.new_hero:SetRank(data.new.rank, true)
    
    TimerManager:GetInstance():DelayInvoke(function()
        if self.active then
            if data.new.quality >= GOLD_QUALITY then
                self.gold_glow_particle:Play()
            elseif data.new.quality >= PURPLE_QUALITY then
                self.purple_glow_particle:Play()
            elseif data.new.quality >= BLUE_QUALITY then
                self.blue_glow_particle:Play()
            end
            self.new_hero.in_station_des:TweenToNum(data.new.val, TWEEN_NUM_DURATION, TWEEN_NUM_DELAY)
        end
    end, 0.6)
end

UIHeroStationValUpItem.OnCreate= OnCreate
UIHeroStationValUpItem.OnDestroy = OnDestroy
UIHeroStationValUpItem.ComponentDefine = ComponentDefine
UIHeroStationValUpItem.ComponentDestroy = ComponentDestroy
UIHeroStationValUpItem.DataDefine = DataDefine
UIHeroStationValUpItem.DataDestroy = DataDestroy
UIHeroStationValUpItem.OnEnable = OnEnable
UIHeroStationValUpItem.OnDisable = OnDisable

UIHeroStationValUpItem.SetData = SetData

return UIHeroStationValUpItem