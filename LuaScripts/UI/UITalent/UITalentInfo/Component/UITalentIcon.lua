---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2022/6/27 18:47
---

local UITalentIcon = BaseClass('UITalentIcon', UIBaseContainer)
local base = UIBaseContainer
local UIGray = CS.UIGray

local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.icon = self:AddComponent(UIImage, "talentIcon")
    self.iconBg = self:AddComponent(UIImage, "iconBg")
    self.lvText = self:AddComponent(UITextMeshProUGUIEx, "talentLevel")
    self.btn = self:AddComponent(UIButton, "talentIcon")
    self.btn:SetOnClick(function()
        self:ShowGroupInfo()
    end)

end

local function ComponentDestroy(self)
    self:StopLightEffect()
end

local function SetData(self, data)
    self:StopLightEffect()
    self.data = data
    self.lvText:SetLocalText(300665, data.level, "")
    self.icon:LoadSprite(data.icon)
    if data.level == 0 then
        self.lvText:SetActive(false)
        UIGray.SetGray(self.iconBg.transform, true, true)
        UIGray.SetGray(self.icon.transform, true, true)
    else
        self.lvText:SetActive(true)
        UIGray.SetGray(self.iconBg.transform, false, true)
        UIGray.SetGray(self.icon.transform, false, true)
    end
    if data.forceHighLight == true then
        UIGray.SetGray(self.iconBg.transform, false, true)
        UIGray.SetGray(self.icon.transform, false, true)
        self:StartShowLightEffect()
    end
end

local function StartShowLightEffect(self)
    local spr = self.icon.unity_image
    if spr == nil then
        return
    end
    local fadeTime = 1.0

    local sequence = CS.DG.Tweening.DOTween.Sequence()
    sequence:Append(spr:DOFade(1, 0))
    sequence:Append(spr:DOFade(0.5, fadeTime))
    sequence:Append(spr:DOFade(1, fadeTime))
    sequence:SetLoops(-1)
    self.tweenSequence = sequence
end

local function StopLightEffect(self)
    if self.tweenSequence ~= nil then
        self.tweenSequence:Pause()
        self.tweenSequence:Kill()
        self.tweenSequence = nil
        self.icon:SetAlpha(1)
    end
end

local function ShowGroupInfo(self)
    --, pos, cellW
    local cellW = self.rectTransform.sizeDelta.x
    self.view:ShowGroupInfo(self.data.group, self.data.index, self.data.total, self.transform.position, cellW)
end

UITalentIcon.OnCreate= OnCreate
UITalentIcon.OnDestroy = OnDestroy
UITalentIcon.ComponentDefine = ComponentDefine
UITalentIcon.ComponentDestroy = ComponentDestroy
UITalentIcon.SetData = SetData
UITalentIcon.ShowGroupInfo = ShowGroupInfo
UITalentIcon.StartShowLightEffect = StartShowLightEffect
UITalentIcon.StopLightEffect = StopLightEffect

return UITalentIcon