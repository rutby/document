---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1020.
--- DateTime: 2023/4/11 16:10
---

local SevenDayBoxItem = BaseClass("SevenDayBoxItem",UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local UICommonItemChange = require "UI.UICommonItem.UICommonItemChange"
local color1 = "482E28"
local color2 = "EA4242"
-- 创建 
function SevenDayBoxItem : OnCreate()
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

-- 销毁
function SevenDayBoxItem : OnDestroy()
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

--变量的定义
function SevenDayBoxItem : DataDefine()
    self.index = nil
end

--变量的销毁
function SevenDayBoxItem : DataDestroy()
    self.index = nil
end

--控件的定义
function SevenDayBoxItem : ComponentDefine()
    self._vip_txt = self:AddComponent(UITextMeshProUGUIEx, "Txt_Vip")
    self.normalReward = self:AddComponent(UICommonItemChange, "Rect_NormalReward")
    self.vipReward = self:AddComponent(UICommonItemChange, "Rect_VipReward")
    self._tips1_txt = self:AddComponent(UITextMeshProUGUIEx, "Txt_Tips1")
    self._tips2_txt = self:AddComponent(UITextMeshProUGUIEx, "Txt_Tips2")
    self._vipLock_rect = self:AddComponent(UIBaseContainer,"Rect_VipReward/UICommonItem/clickBtn/Img_Lock")
    
    self._effect_normal = self:AddComponent(UIBaseComponent,"Rect_NormalReward/Effect_Normal")
    self._effect_vip = self:AddComponent(UIBaseComponent,"Rect_VipReward/Effect_Vip")
    self.eff_VipDi =self:AddComponent(UIBaseContainer, "Eff_VipDi")
end

--控件的销毁
function SevenDayBoxItem : ComponentDestroy()
    
end

function SevenDayBoxItem : ReInit(data,score,index)
    self.index = index
    local normalReward = DataCenter.RewardManager:ReturnRewardParamForView(data.reward)
    local vipReward = DataCenter.RewardManager:ReturnRewardParamForView(data.specialReward)
    self.normalReward:ReInit(normalReward[1])
    self.vipReward:ReInit(vipReward[1])
    local vipInfo = DataCenter.VIPManager:GetVipData()
    self.isGetRewardNormal = false    --是否可领奖
    self.isGetRewardVip = false    --是否可领奖
    self._effect_normal:SetActive(false)
    self._effect_vip:SetActive(false)
    self.eff_VipDi:SetActive(false)
    self.isRewardClick = false  --Vip奖励状态
    local color = color1
    --分数不够
    if score < data.needScore then
        self.normalReward:SetCheckActive(true)
        self.vipReward:SetCheckActive(true)
        color = color2
        self.isRewardClick = true
    else
        --普通奖励
        if data.rewardFlag == 1 then
            self.normalReward:SetCheckActive(true,true)
        else
            self.isGetRewardNormal = true
            --分够且没领取
            self.normalReward:SetCheckActive()
            self._effect_normal:SetActive(true)
        end
        --vip奖励
        if data.specialRewardFlag == 1 then
            self.vipReward:SetCheckActive(true,true)
            self.isRewardClick = true
        else
            self.isGetRewardVip = vipInfo.level >= data.needVip
            if self.isGetRewardVip then
                self._effect_vip:SetActive(true)
            end
            self.vipReward:SetCheckActive()
            self.eff_VipDi:SetActive(true)
        end
    end
    self._vip_txt:SetLocalText(321335,data.needVip)
    
    local txt1 = Localization:GetString("321321",data.needScore)
    local txt2 = string.format("<color=#%s>%s</color>",color,score)
    local txt3 = string.format("(%s/%s)", txt2,data.needScore)
    self._tips1_txt:SetText(txt1..txt3)
    
    --self._tips1_txt:SetLocalText(321321,data.needScore)
    --local txt1 = string.format("<color=#%s>%s</color>",color,score)
    --self._tips2_txt:SetText(string.format("(%s/%s)", txt1,data.needScore))
    
    self._vipLock_rect:SetActive(vipInfo.level < data.needVip)
    self.normalReward:SetOnClick(function() self:OnClick(0) end)
    self.vipReward:SetOnClick(function() self:OnClick(1) end)
end

function SevenDayBoxItem:OnClick(type)
    if type == 0 then
        if self.isGetRewardNormal then
            --领奖
            SFSNetwork.SendMessage(MsgDefines.UserDayActReward,self.index,type)
        else
            self.normalReward:OnClickItem()
        end
    elseif type == 1 then
        if self.isGetRewardVip then
            --领奖
            SFSNetwork.SendMessage(MsgDefines.UserDayActReward,self.index,type)
        else
            if self.isRewardClick then              --分不够/领过了
                self.vipReward:OnClickItem()
            else
                UIUtil.ShowMessage(Localization:GetString("321324"),2,"","", function()
                    UIManager:GetInstance():OpenWindow(UIWindowNames.UIVip,{anim = true})
                end, function()
                end)
            end
        end
    end
end

return SevenDayBoxItem