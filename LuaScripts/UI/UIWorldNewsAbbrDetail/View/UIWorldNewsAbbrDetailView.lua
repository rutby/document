---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2022/4/12 16:49
---
local BattleAbbr = require "UI.UIWorldBattleNews.Component.BattleAbbr"
local UIWorldNewsAbbrDetailView = BaseClass("UIWorldNewsAbbrDetailView",UIBaseView)
local base = UIBaseView
local return_btn_path = "Panel"
local tips_obj_path = "tips"
local content_path = "tips/layout/allianceContent"
local Localization = CS.GameEntry.Localization
local function OnCreate(self)
    base.OnCreate(self)
    local pointId,posX,posY = self:GetUserData()
    self.pointId = tonumber(pointId)
    self.posX = tonumber(posX)
    self.posY = tonumber(posY)
    self.tips = self:AddComponent(UIBaseContainer, tips_obj_path)
    local v3 = self.tips.transform.position
    v3.x = self.posX
    v3.y = self.posY
    self.tips.transform.position = v3
    self.return_btn = self:AddComponent(UIButton, return_btn_path)
    self.return_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.content = self:AddComponent(UIBaseContainer, content_path)
    self.model = {}
end

local function OnDestroy(self)
    base.OnDestroy(self)
end


local function OnEnable(self)
    base.OnEnable(self)
    self:InitData()
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function InitData(self)
    self:OnClearList()
    local data = self.ctrl:GetAreaData(self.pointId)
    if #data.allianceAbbrList>0 then
        for k,v in pairs(data.allianceAbbrList) do
            if self.model[k]==nil then
                self.model[k] = self:GameObjectInstantiateAsync(UIAssets.WorldBattleAbbr, function(request)
                    if request.isError then
                        return
                    end
                    local go = request.gameObject
                    local go_tf = go.transform
                    go.gameObject:SetActive(true)
                    go_tf:SetParent(self.content.transform)
                    go_tf:Set_localScale(ResetScale.x, ResetScale.y, ResetScale.z)
                    go_tf:Set_localPosition(ResetPosition.x, ResetPosition.y, ResetPosition.z)
                    go.name = k
                    local cell = self.content:AddComponent(BattleAbbr,go.name)
                    cell:SetText(v)
                end)
            end
        end
    end
end

local function OnClearList(self)
    self.content:RemoveComponents(BattleAbbr)
    if self.model~=nil then
        for k,v in pairs(self.model) do
            if v ~= nil then
                self:GameObjectDestroy(v)
            end
        end
    end
    self.model = {}
end

local function OnAddListener(self)
    self:AddUIListener(EventId.ChangeCameraLod, self.UpdateLod)
end

local function OnRemoveListener(self)
    self:RemoveUIListener(EventId.ChangeCameraLod, self.UpdateLod)
end
local function UpdateLod(self,lod)
    self.ctrl:CloseSelf()
end
UIWorldNewsAbbrDetailView.OnCreate= OnCreate
UIWorldNewsAbbrDetailView.OnDestroy = OnDestroy
UIWorldNewsAbbrDetailView.OnEnable= OnEnable
UIWorldNewsAbbrDetailView.OnDisable = OnDisable
UIWorldNewsAbbrDetailView.OnClearList =OnClearList
UIWorldNewsAbbrDetailView.InitData =InitData
UIWorldNewsAbbrDetailView.OnAddListener =OnAddListener
UIWorldNewsAbbrDetailView.OnRemoveListener =OnRemoveListener
UIWorldNewsAbbrDetailView.UpdateLod =UpdateLod
return UIWorldNewsAbbrDetailView