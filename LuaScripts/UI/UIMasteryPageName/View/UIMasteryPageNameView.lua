---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl.
--- DateTime: 
---
local UIMasteryPageNameView = BaseClass("UIMasteryPageNameView",UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization

local title_path = "UICommonMiniPopUpTitle/Bg_mid/titleText"
local des_path = "ImgBg/desText"
local input_path = "ImgBg/InputField"
local return_btn_path = "UICommonMiniPopUpTitle/panel"
local close_btn_path = "UICommonMiniPopUpTitle/Bg_mid/CloseBtn"
local warn_path = "ImgBg/warnText"
local first_use_txt_path = "ImgBg/Button/firstUseText"
local use_btn_path ="ImgBg/Button"

function UIMasteryPageNameView:OnCreate()
    base.OnCreate(self)
	
    self.title = self:AddComponent(UITextMeshProUGUIEx,title_path)
    self.title:SetLocalText(390306) 
    self.first_use_txt = self:AddComponent(UIText,first_use_txt_path)
    self.first_use_txt:SetLocalText(130126)
    self.first_use_txt:SetActive(false)
	
    
    self.warn = self:AddComponent(UIText,warn_path)
    self.warn:SetText("")
	
	self.des = self:AddComponent(UIText,des_path)
	self.des:SetLocalText(390132)
	
    
    self.use_btn = self:AddComponent(UIButton, use_btn_path)
    self.use_btn:SetOnClick(function()  
SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
       self:OnChangeNameClick()
    end)

    self.input = self:AddComponent(UIInput,input_path)
    self.input:SetOnValueChange(function (value)
        self:IptOnValueChange(value)
    end)
	self.input:SetOnEndEdit(function (value)
			self:IptOnValueChange(value)
	end)
	
    
    self.close_btn = self:AddComponent(UIButton, close_btn_path)
    self.close_btn:SetOnClick(function()  
        self.ctrl:CloseSelf()
    end)
    self.return_btn = self:AddComponent(UIButton, return_btn_path)
    self.return_btn:SetOnClick(function()  
        self.ctrl:CloseSelf()
    end)
	
	self.first_use_txt:SetLocalText(110006)
	self.first_use_txt:SetActive(true)
end

function UIMasteryPageNameView:OnDestroy()
    self.title = nil
    self.warn = nil
	
    self.use_btn = nil
    self.input = nil
    self.close_btn = nil
    self.return_btn = nil
    self.inputValue = nil

	
    self.diamondNum = nil
    
    base.OnDestroy(self)
end

function UIMasteryPageNameView:OnEnable()
    base.OnEnable(self)
	self.page = self:GetUserData()
    self:InitButtonState()
end

function UIMasteryPageNameView:OnDisable()
    base.OnDisable(self)
end

function UIMasteryPageNameView:InitButtonState()
	self.input:SetText("")
    self.inputValue=""
end

function UIMasteryPageNameView:IptOnValueChange(value)

    self.inputValue = value
	self.state = self.ctrl:CheckName(self.inputValue)
    if self.state == CheckNameType.None then
		self.isSendCheck = true
		--在此先关闭服务器检查
		self.warn:SetText("")
        self.ctrl:SendCheckNameMessage(self.inputValue)
    else
        self:CheckNameChangeState(self.state)
    end
end

function UIMasteryPageNameView:OnChangeNameClick()
	local state = self.state
	if self.inputValue=="" then
		state = CheckNameType.MinNameChar
	end
	
    if state == CheckNameType.IllegalChar then
		UIUtil.ShowTipsId(129082) 
	return
	elseif state == CheckNameType.MinNameChar or state == CheckNameType.MaxNameChar then
		UIUtil.ShowTipsId(120193) 
		return
	elseif state == CheckNameType.Exist then
		UIUtil.ShowTipsId(280038) 
		return
	elseif state == CheckNameType.SensitiveWords then
		UIUtil.ShowTipsId(280073) 
		return
	end
	if self.isSendCheck then
		return
	end
	self.ctrl:SendChangeNameMessage(self.page,self.inputValue)
	self.ctrl:CloseSelf()
end
function UIMasteryPageNameView:OnCheckNameBack(data)
	self.isSendCheck = false --检查完毕
    local state = data
    self:CheckNameChangeState(state)
end
function UIMasteryPageNameView:CheckNameChangeState(type)
	if self.inputValue=="" then
		self.warn:SetText("")
		return
	end
    if type == CheckNameType.None then
        self.warn:SetText("")
    else
        if type == CheckNameType.MinNameChar or type == CheckNameType.MaxNameChar then
            self.warn:SetLocalText(120193) 
        elseif type == CheckNameType.Exist then
            self.warn:SetLocalText(280038) 
        elseif type == CheckNameType.IllegalChar then
            self.warn:SetLocalText(129082) 
        elseif type == CheckNameType.SensitiveWords then
            self.warn:SetLocalText(280073) 
        else
            self.warn:SetText("")
        end
    end
end
function UIMasteryPageNameView:OnAddListener()
    base.OnAddListener(self)
    self:AddUIListener(EventId.PageNameCheckEvent, self.OnCheckNameBack)
end

function UIMasteryPageNameView:OnRemoveListener()
    base.OnRemoveListener(self)
    self:RemoveUIListener(EventId.PageNameCheckEvent,self.OnCheckNameBack)
end

return UIMasteryPageNameView