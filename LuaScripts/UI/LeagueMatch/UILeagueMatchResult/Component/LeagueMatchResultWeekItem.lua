---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2022/3/22 12:03
--- LeagueMatchResultWeekItem.lua

local LeagueMatchResultWeekItem = BaseClass("LeagueMatchResultWeekItem",UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local LeagueMatchResultVsItem = require "UI.LeagueMatch.UILeagueMatchResult.Component.LeagueMatchResultVsItem"

local weekName_path = "TitleLine/weekIndex"
local content_path = "result"

-- 创建 
local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

-- 销毁
local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

--控件的定义
local function ComponentDefine(self)
    self.weekNameN = self:AddComponent(UITextMeshProUGUIEx, weekName_path)
    self.contentN = self:AddComponent(UIBaseContainer, content_path)
end

--控件的销毁
local function ComponentDestroy(self)
    self.weekNameN = nil
    self.contentN = nil
end

--变量的定义
local function DataDefine(self)
    self.weekIndex = 1
    self.allianceList = {}
    self.vsItems = {}
    self.allianceItems = {}
end

--变量的销毁
local function DataDestroy(self)
    self.weekIndex = nil
    self.allianceList = nil
    self.vsItems = nil
    self.allianceItems = nil
end


local function OnAddListener(self)
    base.OnAddListener(self)
    --self:AddUIListener(EventId.OnUpdateAlLeaderCandidates, self.OnCandidateInfoUpdated)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
    --self:RemoveUIListener(EventId.OnUpdateAlLeaderCandidates, self.OnCandidateInfoUpdated)
end

local function SetItem(self, weekIndex, allianceList)
    self.weekIndex = weekIndex
    self.allianceList = allianceList
    
    self.weekNameN:SetLocalText(372632, weekIndex)
    self:RefreshAllianceList()
end

local function RefreshAllianceList(self)
    if #self.allianceList ~= LeagueMatchGroupAllianceCount then
        return
    end

    if #self.allianceItems == LeagueMatchGroupAllianceCount then
        for i = 1, LeagueMatchGroupAllianceCount / 2 do
            local vsStartIndex = i * 2 - 1
            v:SetItem(self.allianceList[vsStartIndex], self.allianceList[vsStartIndex + 1], self.weekIndex)
        end
    else
        if not self.reqList then
            self.reqList = {}
            for i = 1, LeagueMatchGroupAllianceCount / 2 do
                --复制基础prefab，每次循环创建一次
                self.reqList[i] = self:GameObjectInstantiateAsync(UIAssets.LeagueMatchResultVsItem, function(request)
                    if request.isError then
                        return
                    end
                    local go = request.gameObject;
                    go.transform:SetParent(self.contentN.transform)
                    go.transform:Set_localScale(1, 1, 1)
                    go.name ="item" .. i
                    local cell = self.contentN:AddComponent(LeagueMatchResultVsItem, go.name)
                    local vsStartIndex = i * 2 - 1
                    cell:SetItem(self.allianceList[vsStartIndex], self.allianceList[vsStartIndex + 1], self.weekIndex)
                    table.insert(self.allianceItems, cell)
                end)
            end
        end
    end
end


LeagueMatchResultWeekItem.OnCreate = OnCreate
LeagueMatchResultWeekItem.OnDestroy = OnDestroy
LeagueMatchResultWeekItem.ComponentDefine = ComponentDefine
LeagueMatchResultWeekItem.ComponentDestroy = ComponentDestroy
LeagueMatchResultWeekItem.DataDefine = DataDefine
LeagueMatchResultWeekItem.DataDestroy = DataDestroy
LeagueMatchResultWeekItem.OnAddListener = OnAddListener
LeagueMatchResultWeekItem.OnRemoveListener = OnRemoveListener

LeagueMatchResultWeekItem.SetItem = SetItem
LeagueMatchResultWeekItem.RefreshAllianceList = RefreshAllianceList

return LeagueMatchResultWeekItem