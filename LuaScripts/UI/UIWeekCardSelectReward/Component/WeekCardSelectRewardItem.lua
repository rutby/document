---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2022/3/22 12:03
---WeekCardSelectRewardItem.lua


local WeekCardSelectRewardItem = BaseClass("WeekCardSelectRewardItem",UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local UICommonItem = require "UI.UICommonItem.UICommonItem"--require "UI.UICommonItem.UICommonItem_TextMeshPro"

local item_path = "UICommonItemSize"
local select_path = "selected"
local btn_path = "btn"

-- 创建 
local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

-- 销毁
local function OnDestroy(self)
    if self.timer then
        self.timer:Stop()
        self.timer = nil
    end
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

-- 显示
local function OnEnable(self)
    base.OnEnable(self)
end

-- 隐藏
local function OnDisable(self)
    base.OnDisable(self)
end


--控件的定义
local function ComponentDefine(self)
    self.itemN = self:AddComponent(UICommonItem, item_path)
    self.selectN = self:AddComponent(UIBaseContainer, select_path)
    self.btnTriggerN = self:AddComponent(UIEventTrigger, btn_path)
    self.btnTriggerN:OnPointerDown(function(eventData)
        self:OnPointerDown(eventData)
    end)
    self.btnTriggerN:OnPointerUp(function(eventData)
        self:OnPointerUp(eventData)
    end)
end

--控件的销毁
local function ComponentDestroy(self)
    self.itemN = nil
    self.selectN = nil
    self.btnN = nil
end

--变量的定义
local function DataDefine(self)
    self.stageIndex = 1
    self.curIndex = 1
    self.callback = nil
    self.pressTimeMs = LongMaxValue
end

--变量的销毁
local function DataDestroy(self)
    self.stageIndex = nil
    self.curIndex = nil
    self.callback = nil
    self.pressTimeMs = nil
end


local function OnAddListener(self)
    base.OnAddListener(self)
    --self:AddUIListener(EventId.OnUpdateAlLeaderCandidates, self.OnCandidateInfoUpdated)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
    --self:RemoveUIListener(EventId.OnUpdateAlLeaderCandidates, self.OnCandidateInfoUpdated)
end

local function SetData(self, stageIndex, index, callback)
    self.stageIndex = stageIndex
    self.curIndex = index
    self.callback = callback
    
    self:RefreshItem()
end

local function RefreshItem(self)
    local rewardInfo, isSelect = self.view:GetReward(self.stageIndex, self.curIndex)
    self.itemN:ReInit(rewardInfo)
    self.selectN:SetActive(isSelect)
end

local function OnPointerDown(self)
    self.pressTimeMs = UITimeManager:GetInstance():GetServerTime()
    self.timer = TimerManager:GetInstance():DelayInvoke(function()
        self.pressTimeMs = LongMaxValue
        self.itemN:OnBtnClick()
        self.timer = nil
    end, 0.5)
end

local function OnPointerUp(self)
    local tempTimeMs = UITimeManager:GetInstance():GetServerTime()
    if tempTimeMs >= self.pressTimeMs then
        if self.callback then
            self.callback(self.stageIndex, self.curIndex)
        end
    end
    if self.timer then
        self.timer:Stop()
        self.timer = nil
    end
    self.pressTimeMs = LongMaxValue
end

local function OnClickSelectBtn(self)
    
end

WeekCardSelectRewardItem.OnCreate = OnCreate
WeekCardSelectRewardItem.OnDestroy = OnDestroy
WeekCardSelectRewardItem.OnEnable = OnEnable
WeekCardSelectRewardItem.OnDisable = OnDisable
WeekCardSelectRewardItem.ComponentDefine = ComponentDefine
WeekCardSelectRewardItem.ComponentDestroy = ComponentDestroy
WeekCardSelectRewardItem.DataDefine = DataDefine
WeekCardSelectRewardItem.DataDestroy = DataDestroy
WeekCardSelectRewardItem.OnAddListener = OnAddListener
WeekCardSelectRewardItem.OnRemoveListener = OnRemoveListener

WeekCardSelectRewardItem.SetData = SetData
WeekCardSelectRewardItem.RefreshItem = RefreshItem
WeekCardSelectRewardItem.OnPointerDown = OnPointerDown
WeekCardSelectRewardItem.OnPointerUp = OnPointerUp
WeekCardSelectRewardItem.OnClickSelectBtn = OnClickSelectBtn

return WeekCardSelectRewardItem