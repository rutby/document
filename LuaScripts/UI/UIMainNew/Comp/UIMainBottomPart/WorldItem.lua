---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/12/4 21:27
---
local WorldItem = BaseClass("WorldItem", UIBaseContainer)
local base = UIBaseContainer

local Btn_path = "Button"
local Txt_path = "Txt"

function WorldItem : OnCreate()
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

function WorldItem : OnDestroy()
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

function WorldItem : OnEnable()
    base.OnEnable(self)
    self:CheckText()
end

function WorldItem : OnDisable()
    base.OnDisable(self)
end

function WorldItem : ComponentDefine()
    self.Btn = self:AddComponent(UIButton, Btn_path)
    self.Btn:SetOnClick(function ()
        self:OnClickBtn()
    end)
    self.Txt = self:AddComponent(UITextMeshProUGUIEx, Txt_path)
    self.canClick = true
end

function WorldItem : ComponentDestroy()

end

function WorldItem : DataDefine()

end

function WorldItem : DataDestroy()

end

function WorldItem : CheckText()
    if SceneUtils.GetIsInCity() then
        self.Txt:SetLocalText(100171)
    elseif SceneUtils.GetIsInWorld() then
        self.Txt:SetLocalText(104315)
    end
end

function WorldItem:ResetBtnState()
    CS.UIGray.SetGray(self.Btn.transform, false, true)
    self.canClick = true
    self:CheckText()
end

function WorldItem:SetLod(lod)
    self.lod = lod
end
function WorldItem : OnClickBtn()
    local curScene = CS.SceneManager.CurrSceneID
    if self.canClick == false then
        return
    end
    local canUnlock,lock_tips = SceneUtils.CheckIsWorldUnlock()
    if canUnlock ==false then
        if lock_tips ~= 0 then
            UIUtil.ShowTipsId(lock_tips)
        end
    else
        if curScene == SceneManagerSceneID.World and self.lod~=nil and self.lod>3 then
            self.view.ctrl:OnClickBackHomeBtn()
            return
        end
        if curScene == SceneManagerSceneID.City or curScene == SceneManagerSceneID.World then
            CS.UIGray.SetGray(self.Btn.transform, true, true)
            self.canClick = false
            if curScene == SceneManagerSceneID.World then
                --CS.UnityEditor.EditorApplication.isPaused = true
                if CrossServerUtil:GetIsCrossServer() then
                    GoToUtil.GotoWorldPos(SceneUtils.TileIndexToWorld(LuaEntry.Player:GetMainWorldPos()),nil,0.02,function()
                        SceneUtils.ChangeToCity(function()
                            CS.UIGray.SetGray(self.Btn.transform, false, true)
                            self.canClick = true
                            self:CheckText()
                        end)
                    end,LuaEntry.Player:GetSelfServerId())
                else
                    SceneUtils.ChangeToCity(function()
                        local pos = DataCenter.CityCameraManager:GetCacheZoomPos()
                        local zoom = DataCenter.CityCameraManager:GetCurZoom()
                        if pos~=nil and zoom~=nil then
                            GoToUtil.GotoCityPos(pos, zoom,0.02)
                            DataCenter.CityCameraManager:SetCacheZoomValue(-1,nil)
                        end
                        CS.UIGray.SetGray(self.Btn.transform,false, true)
                        self.canClick = true
                        self:CheckText()
                    end)
                end
            else
                local worldPos = CS.SceneManager.World.CurTarget
                DataCenter.CityCameraManager:SetCacheZoomValue(CS.SceneManager.World.Zoom,worldPos)
                --CS.UnityEditor.EditorApplication.isPaused = true
                SceneUtils.ChangeToWorld(function()
                    CS.UIGray.SetGray(self.Btn.transform, false, true)
                    self.canClick = true
                    self:CheckText()
                end)

            end
        end
    end
end

return WorldItem