---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 4/2/2024 下午5:27
---
local BountyStar = require "UI.UIHeroBountyMain.Component.BountyStar"
local UIHeroBountyDetailInfo = BaseClass("UIHeroBountyDetailInfo", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

local close_btn_path = "panel"
local normal_path = "info/normal"
local max_path = "info/max"

local upgrade_condition_title_path = "info/Upgrade_Condition_Title"

local upgrade_condition_text_path = "info/normal/bg3/Upgrade_Condition_Text"
local upgrade_condition_des_path = "info/normal/bg3/Upgrade_Condition_Des"
local cur_lv_path = "info/normal/levelLayout/Current_Lv_BG/Current_Lv_Text"
local cur_star_path = "info/normal/bg1/Current_Lv_star"
local cur_num_path = "info/normal/bg2/Current_lv_num"

local next_lv_path = "info/normal/levelLayout/Next_Lv_BG/Next_Lv_Text"
local next_star_path = "info/normal/bg1/Next_Lv_star"
local next_num_path = "info/normal/bg2/Next_lv_num"

local star_title_path = "info/normal/bg1/star_title"
local num_title_path = "info/normal/bg2/num_title"


local max_lv_path ="info/max/Current_Lv_BG/Max_Lv_Text"
local max_star_path = "info/max/bg1/Max_Lv_star"
local max_num_path = "info/max/bg2/Max_event_Max_Num_Text"

local max_star_title_path = "info/max/bg1/Max_star_title"
local max_num_title_path = "info/max/bg2/Max_num_title"


local upgrade_title_path ="info/normal/bg3/Upgrade_title"
local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
end

local function ComponentDefine(self)
    self.normal = self:AddComponent(UIBaseContainer,normal_path)
    self.max = self:AddComponent(UIBaseContainer,max_path)

    self.close_btn = self:AddComponent(UIButton, close_btn_path)
    self.close_btn:SetOnClick(function()
        self:CloseView()
    end)
    
    self.upgrade_condition_title = self:AddComponent(UITextMeshProUGUIEx, upgrade_condition_title_path)
    self.upgrade_condition_title:SetLocalText(137022)
    self.upgrade_condition_text = self:AddComponent(UITextMeshProUGUIEx, upgrade_condition_text_path)
    self.upgrade_title = self:AddComponent(UITextMeshProUGUIEx, upgrade_title_path)
    self.upgrade_title:SetLocalText(450079)
    self.cur_lv = self:AddComponent(UITextMeshProUGUIEx, cur_lv_path)
    self.cur_star = self:AddComponent(BountyStar,cur_star_path)
    self.cur_num =self:AddComponent(UITextMeshProUGUIEx,cur_num_path)

    self.next_lv = self:AddComponent(UITextMeshProUGUIEx, next_lv_path)
    self.next_star = self:AddComponent(BountyStar,next_star_path)
    self.next_num =self:AddComponent(UITextMeshProUGUIEx,next_num_path)

    self.max_lv =self:AddComponent(UITextMeshProUGUIEx,max_lv_path)
    self.max_star = self:AddComponent(BountyStar,max_star_path)
    self.max_num = self:AddComponent(UITextMeshProUGUIEx,max_num_path)
    
    self.star_title =self:AddComponent(UITextMeshProUGUIEx,star_title_path)
    self.max_star_title =self:AddComponent(UITextMeshProUGUIEx,max_star_title_path)
    self.star_title:SetLocalText(450078)
    self.max_star_title:SetLocalText(450078)
    
    self.num_title = self:AddComponent(UITextMeshProUGUIEx,num_title_path)
    self.max_num_title = self:AddComponent(UITextMeshProUGUIEx,max_num_title_path)
    self.num_title:SetLocalText(450077)
    self.max_num_title:SetLocalText(450077)
    
end

local function OnDestroy(self)
    self:ComponentDestroy()

    base.OnDestroy(self)
end

local function ComponentDestroy(self)
end

local function ReInit(self)
    
    local level = 1
    local buildData = DataCenter.BuildManager:GetFunbuildByItemID(BuildingTypes.FUN_BUILD_HERO_BOUNTY)
    if buildData~=nil then
        level = buildData.level
    end
    local buildLevelTemplate = DataCenter.BuildTemplateManager:GetBuildingLevelTemplate(BuildingTypes.FUN_BUILD_HERO_BOUNTY,level)
    local buildTemplate = DataCenter.BuildTemplateManager:GetBuildingDesTemplate(BuildingTypes.FUN_BUILD_HERO_BOUNTY)
    if buildLevelTemplate~=nil and buildTemplate ~= nil then
        local maxLv = DataCenter.BuildTemplateManager:GetBuildMaxLevel(buildTemplate)
        if level>=maxLv then
            self.normal:SetActive(false)
            self.max:SetActive(true)
            self.max_lv:SetText(level)
            local para1 = buildLevelTemplate.para1
            local arr1 = string.split(para1,";")
            self.max_num:SetText(#arr1)
            self.max_star:SetData(arr1[1],true)
        else
            self.normal:SetActive(true)
            self.max:SetActive(false)
            self.cur_lv:SetText(level)
            local unLockMsg = DataCenter.HeroBountyDataManager:GetNextLevelBuildUnlockMsg()
            if #unLockMsg>=2 then
                local type = tonumber(unLockMsg[1])
                local nextLv = tonumber(unLockMsg[2])
                local nextLevelTemplate = DataCenter.BuildTemplateManager:GetBuildingLevelTemplate(BuildingTypes.FUN_BUILD_HERO_BOUNTY,nextLv)
                if nextLevelTemplate~=nil then
                    self.next_lv:SetText(nextLv)
                    local para1 = buildLevelTemplate.para1
                    local nextPara1 = nextLevelTemplate.para1
                    local arr1 = string.split(para1,";")
                    local arr2 = string.split(nextPara1,";")
                    self.cur_num:SetText(#arr1)
                    self.next_num:SetText(#arr2)
                    self.cur_star:SetData(arr1[1],true)
                    self.next_star:SetData(arr2[1],true)
                    self.upgrade_condition_text:SetLocalText(450080,nextLv)
                end
            end
        end
    end
end

local function CloseView(self)
    self.view:HideDetail()
end
UIHeroBountyDetailInfo.OnCreate = OnCreate
UIHeroBountyDetailInfo.OnDestroy = OnDestroy
UIHeroBountyDetailInfo.ComponentDefine = ComponentDefine
UIHeroBountyDetailInfo.ComponentDestroy = ComponentDestroy
UIHeroBountyDetailInfo.ReInit = ReInit
UIHeroBountyDetailInfo.CloseView = CloseView
return UIHeroBountyDetailInfo