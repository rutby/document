---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2021/9/15 16:38
---UICollectRewardView.lua

local base = UIBaseView--Variable
local UICollectRewardView = BaseClass("UICollectRewardView", base)--Variable
local Localization = CS.GameEntry.Localization
local CollectRewardItem = require "UI.UICollectReward.Component.CollectRewardItem"

local title_path = "UICommonPopUpTitle/bg_mid/titleText"
local closeBtn_path = "UICommonPopUpTitle/bg_mid/CloseBtn"
local bgBtn_path = "UICommonPopUpTitle/panel"
local collectSv_path = "ImgBg/ScrollView"
local collectContent_path = "ImgBg/ScrollView/Viewport/Content"
local claimBtn_path = "ImgBg/claimBtn"
local claimBtnTxt_path = "ImgBg/claimBtn/claimBtnTxt"
local targetTxt_path = "ImgBg/select/targetTxt"
local rewardTxt_path = "ImgBg/select/rewardTxt"

local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
    self:InitUI()
end

local function OnDestroy(self)
    EventManager:GetInstance():Broadcast(EventId.RefreshMonsterRewardBag)--red
    self:ClearScroll()
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.titleN = self:AddComponent(UITextMeshProUGUIEx, title_path)
    self.titleN:SetLocalText(104292)
    self.closeBtnN = self:AddComponent(UIButton, closeBtn_path)
    self.closeBtnN:SetOnClick(function()
        self:OnClickCloseBtn()
    end)
    self.bgBtnN = self:AddComponent(UIButton, bgBtn_path)
    self.bgBtnN:SetOnClick(function()
        self:OnClickCloseBtn()
    end)
    self.collectSvN = self:AddComponent(UIScrollView, collectSv_path)
    self.collectSvN:SetOnItemMoveIn(function(itemObj, index)
        self:OnItemMoveIn(itemObj, index)
    end)
    self.collectSvN:SetOnItemMoveOut(function(itemObj, index)
        self:OnItemMoveOut(itemObj, index)
    end)
    self.collectContentN = self:AddComponent(UIBaseContainer, collectContent_path)
    self.claimBtnN = self:AddComponent(UIButton, claimBtn_path)
    self.claimBtnN:SetOnClick(function()
        self:OnClickClaimBtn()
    end)
    self.claimBtnTxtN = self:AddComponent(UITextMeshProUGUIEx, claimBtnTxt_path)
    self.claimBtnTxtN:SetLocalText(110132)
    self.targetTxtN = self:AddComponent(UITextMeshProUGUIEx, targetTxt_path)
    self.targetTxtN:SetLocalText(104293)
    self.rewardTxtN = self:AddComponent(UITextMeshProUGUIEx, rewardTxt_path)
    self.rewardTxtN:SetLocalText(104294)
end

local function ComponentDestroy(self)
    self.titleN = nil
    self.closeBtnN = nil
    self.bgBtnN = nil
    self.collectSvN = nil
    self.collectContentN = nil
end

local function DataDefine(self)
    self.collectList = {}
end

local function DataDestroy(self)
    self.collectList = nil
end


local function OnAddListener(self)
    base.OnAddListener(self)
    --self:AddUIListener(EventId.OnOneActivityOverviewRedChange, self.RefreshAll)
end

local function OnRemoveListener(self)
    --self:RemoveUIListener(EventId.OnOneActivityOverviewRedChange, self.RefreshAll)
    base.OnRemoveListener(self)
end

local function InitUI(self)
    self:RefreshAll()
end

local function RefreshAll(self)
    self.collectList = DataCenter.CollectRewardDataManager:GetRewardListBySort()
    self.collectSvN:SetTotalCount(#self.collectList)
    self.collectSvN:RefillCells()
end


local function OnItemMoveIn(self,itemObj, index)
    itemObj.name = tostring(index)
    local cellItem = self.collectSvN:AddComponent(CollectRewardItem, itemObj)
    cellItem:SetItem(self.collectList[index])
end

local function OnItemMoveOut(self, itemObj, index)
    self.collectSvN:RemoveComponent(itemObj.name, CollectRewardItem)
end

local function ClearScroll(self)
    self.collectSvN:ClearCells()
    self.collectSvN:RemoveComponents(CollectRewardItem)
end


local function OnClickCloseBtn(self)
    self.ctrl:CloseSelf()
end

local function OnClickClaimBtn(self)
    local uuidList = {}
    for i, collect in ipairs(self.collectList) do
        table.insert(uuidList, collect.uuid)
    end

    if #uuidList > 0 then
        SFSNetwork.SendMessage(MsgDefines.GatherCollectReward, uuidList)
        self.ctrl:CloseSelf()
    end
end

UICollectRewardView.OnCreate = OnCreate 
UICollectRewardView.OnDestroy = OnDestroy
UICollectRewardView.OnAddListener = OnAddListener
UICollectRewardView.OnRemoveListener = OnRemoveListener
UICollectRewardView.ComponentDefine = ComponentDefine
UICollectRewardView.ComponentDestroy = ComponentDestroy
UICollectRewardView.DataDefine = DataDefine
UICollectRewardView.DataDestroy = DataDestroy

UICollectRewardView.InitUI = InitUI
UICollectRewardView.RefreshAll = RefreshAll
UICollectRewardView.OnItemMoveIn = OnItemMoveIn
UICollectRewardView.OnItemMoveOut = OnItemMoveOut
UICollectRewardView.ClearScroll = ClearScroll
UICollectRewardView.OnClickCloseBtn = OnClickCloseBtn
UICollectRewardView.OnClickClaimBtn = OnClickClaimBtn

return UICollectRewardView