---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2022/12/27 17:08
---
local base = UIBaseView--Variable
local UIRobotWarsPreView = BaseClass("UIRobotWarsPreView", base)--Variable
local Localization = CS.GameEntry.Localization

local closeBtn_path = "BtnClose"
local title1_path = "Top/title1"
local title3_path = "Top/title3"
local infoBtn_path = "Top/infoBtn"
local gotoBtn_path = "Top/Button"
local gotoBtnTxt_path = "Top/Button/btnTxt"
local seasonImg_path = "Top/Image"
local bgImg_path = "Bg1"

local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
    self:InitData()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.closeBtnN = self:AddComponent(UIButton, closeBtn_path)
    self.closeBtnN:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnClickGotoBtn()
    end)
    self.title1N = self:AddComponent(UIText, title1_path)
    self.title1N:SetLocalText(302339)
    --self.title2N = self:AddComponent(UIText, title2_path)
    --self.title2N:SetLocalText(302340)
    self.title3N = self:AddComponent(UIText, title3_path)
    self.title3N:SetLocalText(302344)
    self.infoBtnN = self:AddComponent(UIButton, infoBtn_path)
    self.infoBtnN:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnClickInfoBtn()
    end)
    self.gotoBtnTxtN = self:AddComponent(UIText,gotoBtnTxt_path)
    self.gotoBtnTxtN:SetLocalText(110003)
    self.gotoBtnN = self:AddComponent(UIButton, gotoBtn_path)
    self.gotoBtnN:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnClickGotoBtn()
    end)
    self.seasonImgN = self:AddComponent(UIImage, seasonImg_path)
    self.bgImgN = self:AddComponent(UIImage, bgImg_path)
end

local function ComponentDestroy(self)
end

local function DataDefine(self)

end

local function DataDestroy(self)

end

--[[
local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end
--]]

local function InitData(self)
    self:RefreshAll()
end

local function RefreshAll(self)
    local seasonId = DataCenter.SeasonDataManager:GetSeasonId()
    local iconImg = GetTableData(TableName.APS_Season,seasonId, 'icon')
    local bgImg = GetTableData(TableName.APS_Season,seasonId, 'bg')
    if bgImg then
        self.bgImgN:LoadSprite(string.format("Assets/Main/TextureEx/UIActivity/%s.png", bgImg))
    end
    if iconImg then
        self.seasonImgN:LoadSprite(string.format("Assets/Main/Sprites/UI/UISeasonRobots/%s.png", iconImg))
    end
end

local function OnClickGotoBtn(self)
    local seasonId = DataCenter.SeasonDataManager:GetSeasonId()
    if seasonId == 5 then
        local dataInfo = DataCenter.RobotWarsManager:GetActivityInfo()
        if dataInfo ==nil then
            self.ctrl:CloseSelf()
            return
        end
        if LuaEntry.Player:IsInCrossFight()==false then
            if dataInfo.edenMatch and dataInfo.edenMatch.targetServer and dataInfo.edenMatch.targetServer ~= 0 then
                local targetServer = dataInfo.edenMatch.targetServer
                self.ctrl:CloseSelf()
                SFSNetwork.SendMessage(MsgDefines.MoveCrossServer,targetServer,0, 2)
                EventManager:GetInstance():Broadcast(EventId.OnSetEdenUI,UISetEdenType.Open)
            else
                self.ctrl:CloseSelf()
            end
        end
    else
        UIManager:GetInstance():OpenWindow(UIWindowNames.UISeasonIntro, { anim = true }, true)
        self.ctrl:CloseSelf()
    end

    --SceneUtils.ChangeToWorld()
end

local function OnClickInfoBtn(self)
    UIUtil.ShowIntro(Localization:GetString("302339"), Localization:GetString("170001"), Localization:GetString("302343"))
end

UIRobotWarsPreView.OnCreate = OnCreate
UIRobotWarsPreView.OnDestroy = OnDestroy
--UIRobotWarsPreView.OnAddListener = OnAddListener
--UIRobotWarsPreView.OnRemoveListener = OnRemoveListener
UIRobotWarsPreView.ComponentDefine = ComponentDefine
UIRobotWarsPreView.ComponentDestroy = ComponentDestroy
UIRobotWarsPreView.DataDefine = DataDefine
UIRobotWarsPreView.DataDestroy = DataDestroy
UIRobotWarsPreView.OnClickInfoBtn =OnClickInfoBtn
UIRobotWarsPreView.InitData = InitData
UIRobotWarsPreView.RefreshAll = RefreshAll
UIRobotWarsPreView.OnClickGotoBtn = OnClickGotoBtn
return UIRobotWarsPreView