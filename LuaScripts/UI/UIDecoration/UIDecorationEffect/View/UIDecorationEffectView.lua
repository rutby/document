---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2022/12/13 17:48
---


local UIDecorationEffectView = BaseClass("UIDecorationEffectView", UIBaseView)
local UIDecorationEffectCell = require "UI.UIDecoration.UIDecorationEffect.Component.UIDecorationEffectCell"
local base = UIBaseView
local Localization = CS.GameEntry.Localization

local closeBtn_path = "UICommonMidPopUpTitle/bg_mid/CloseBtn"
local titleTxt_path = "UICommonMidPopUpTitle/bg_mid/titleText"
local return_path = "UICommonMidPopUpTitle/panel"
local scroll_view = "Rect_Content/ScrollView"

--创建
local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
    self:ReInit()
end

-- 销毁
local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self._title_txt = self:AddComponent(UITextMeshProUGUIEx, titleTxt_path)
    self._close_btn = self:AddComponent(UIButton, closeBtn_path)
    self._return_btn = self:AddComponent(UIButton, return_path)
    self._close_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self.ctrl:CloseSelf()
    end)
    self._return_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self.ctrl:CloseSelf()
    end)

    self.scroll_view = self:AddComponent(UIScrollView, scroll_view)
    self.scroll_view:SetOnItemMoveIn(function(itemObj, index)
        self:OnCreateCell(itemObj, index)
    end)
    self.scroll_view:SetOnItemMoveOut(function(itemObj, index)
        self:OnDeleteCell(itemObj, index)
    end)

end

local function ComponentDestroy(self)
    self:ClearScroll()
end


local function DataDefine(self)

end

local function DataDestroy(self)

end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end


local function ReInit(self)
    self._title_txt:SetLocalText(320566)
    self.dataList = self.ctrl:GetPanelData()

    if next(self.dataList) then
        self.scroll_view:SetTotalCount(#self.dataList)
        self.scroll_view:RefillCells()
    end
end

local function OnCreateCell(self,itemObj, index)
    itemObj.name = tostring(index)
    local cellItem = self.scroll_view:AddComponent(UIDecorationEffectCell, itemObj)
    local data =  self.dataList[index]
    cellItem:ReInit(data)
end

local function OnDeleteCell(self,itemObj, index)
    self.scroll_view:RemoveComponent(itemObj.name, UIDecorationEffectCell)
end

local function ClearScroll(self)
    self.scroll_view:ClearCells()
    self.scroll_view:RemoveComponents(UIDecorationEffectCell)
end

UIDecorationEffectView.OnCreate = OnCreate
UIDecorationEffectView.OnDestroy = OnDestroy
UIDecorationEffectView.OnEnable = OnEnable
UIDecorationEffectView.OnDisable = OnDisable
UIDecorationEffectView.ComponentDefine = ComponentDefine
UIDecorationEffectView.ComponentDestroy = ComponentDestroy
UIDecorationEffectView.DataDefine = DataDefine
UIDecorationEffectView.DataDestroy = DataDestroy
UIDecorationEffectView.ReInit = ReInit
UIDecorationEffectView.OnCreateCell = OnCreateCell
UIDecorationEffectView.OnDeleteCell = OnDeleteCell
UIDecorationEffectView.ClearScroll = ClearScroll

return UIDecorationEffectView