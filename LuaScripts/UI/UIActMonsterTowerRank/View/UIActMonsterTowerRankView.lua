---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl
--- DateTime:
--- 
local UIActMonsterTowerRankView = BaseClass("UIActMonsterTowerRankView", UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization
local UIActMTRankCell = require "UI.UIActMonsterTowerRank.Component.UIActMTRankCell"
function UIActMonsterTowerRankView:OnCreate()
    base.OnCreate(self)
    
    self._title_txt = self:AddComponent(UITextMeshProUGUIEx,"UICommonPopUpTitle/bg_mid/titleText")
    self._title_txt:SetLocalText(390040)
    
    self._close_btn = self:AddComponent(UIButton,"UICommonPopUpTitle/bg_mid/CloseBtn")
    self._close_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    
    self.scroll_view = self:AddComponent(UIScrollView, "ImgBg/ScrollView")
    self.scroll_view:SetOnItemMoveIn(function(itemObj, index)
        self:OnItemMoveIn(itemObj, index)
    end)
    self.scroll_view:SetOnItemMoveOut(function(itemObj, index)
        self:OnItemMoveOut(itemObj, index)
    end)
end

function UIActMonsterTowerRankView:OnDestroy()
    self:ClearScroll()
    base.OnDestroy(self)
end

function UIActMonsterTowerRankView:OnEnable()
    base.OnEnable(self)
    local actId = self:GetUserData()
    self:RefreshRank(actId)
end

function UIActMonsterTowerRankView:OnDisable()
    base.OnDisable(self)
end

function UIActMonsterTowerRankView:OnAddListener()
    base.OnAddListener(self)
    self:AddUIListener(EventId.ActMonTowerGetRank, self.OnRefresh)
end

function UIActMonsterTowerRankView:OnRemoveListener()
    base.OnRemoveListener(self)
    self:RemoveUIListener(EventId.ActMonTowerGetRank, self.OnRefresh)
end

function UIActMonsterTowerRankView:RefreshRank(activityId)
    self.activityId = activityId
    self:ClearScroll()
    SFSNetwork.SendMessage(MsgDefines.GetChallengeActMemberInfo,activityId)
end

function UIActMonsterTowerRankView:OnRefresh()
    self.actData = DataCenter.ActMonsterTowerData:GetInfoByActId(tonumber(self.activityId))
    if self.actData then
        self.rankList = self.actData:GetMember()

        if #self.rankList >0 then
            self.scroll_view:SetTotalCount(#self.rankList)
            self.scroll_view:RefillCells()
        end
    end
end

function UIActMonsterTowerRankView:OnItemMoveIn(itemObj, index)
    itemObj.name = tostring(index)
    local cellItem = self.scroll_view:AddComponent(UIActMTRankCell, itemObj)
    cellItem:SetData(self.rankList[index])
end

function UIActMonsterTowerRankView:OnItemMoveOut( itemObj, index)
    self.scroll_view:RemoveComponent(itemObj.name, UIActMTRankCell)
end

function UIActMonsterTowerRankView:ClearScroll()
    self.scroll_view:ClearCells()
    self.scroll_view:RemoveComponents(UIActMTRankCell)
end

function UIActMonsterTowerRankView:OnClickSelfHead()
    UIManager:GetInstance():OpenWindow(UIWindowNames.UIPlayerInfo,LuaEntry.Player.uid)
end


return UIActMonsterTowerRankView