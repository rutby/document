---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/10/31 14:45
---
local UIUseEdenMissileTipView = BaseClass("UIUseEdenMissileTipView", UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization

local title_path = "UICommonMiniPopUpTitle/Bg_mid/titleText"
local close_path = "UICommonMiniPopUpTitle/panel"
local return_path = "UICommonMiniPopUpTitle/Bg_mid/CloseBtn"
local buyBtn_path = "Declare"
local buyBtnTxt_path = "Declare/DeclareText"
local tip_path = "Desc"
local des_path = "desTxt"
local cost_des_path = "layout/costDes"
local cost_num_path = "layout/cost"
local function OnCreate(self)
    base.OnCreate(self)
    self.targetUuid,self.targetServer = self:GetUserData()
    self.title_text = self:AddComponent(UITextMeshProUGUIEx,title_path)
    self.title_text:SetLocalText(100378)
    self.close_btn = self:AddComponent(UIButton, close_path)
    self.close_btn:SetOnClick(function() self.ctrl:CloseSelf() end)
    self.return_btn = self:AddComponent(UIButton, return_path)
    self.return_btn:SetOnClick(function() self.ctrl:CloseSelf() end)
    self.buyBtnN = self:AddComponent(UIButton, buyBtn_path)
    self.buyBtnN:SetOnClick(function()
        self:OnClickBuyBtn()
    end)
    self.buyBtnTxtN = self:AddComponent(UIText, buyBtnTxt_path)
    self.buyBtnTxtN:SetLocalText(110006)
    self.tip = self:AddComponent(UIText, tip_path)
    self.tip:SetLocalText(309008)
    self.des = self:AddComponent(UIText, des_path)
    self.des:SetLocalText(111267)
    self.cost_des = self:AddComponent(UIText, cost_des_path)
    self.cost_des:SetLocalText(111266)
    self.cost_num = self:AddComponent(UIText, cost_num_path)
end

local function OnDestroy(self)
    self.title_text = nil
    self.intro_text = nil
    self.close_btn = nil
    self.return_btn = nil
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
    self:RefreshData()
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function RefreshData(self)
    self.isCostEnough = false
    local costNum = LuaEntry.DataConfig:TryGetNum("eden_alliance_missile", "k2")
    local ownNum = DataCenter.AllianceStorageManager:GetResCountByRewardType(RewardType.SAPPHIRE)
    if ownNum >= costNum then
        self.isCostEnough = true
    end
    local str = string.GetFormattedSeperatorNum(math.ceil(costNum))
    if self.isCostEnough == false then
        str = "<color=#FF0000>"..str.."</color>"
    end
    self.cost_num:SetText(str)
end

local function OnClickBuyBtn(self)
    if self.isCostEnough ==true then
        SFSNetwork.SendMessage(MsgDefines.BuyAndUseEdenMissile,self.targetUuid,self.targetServer)
        self.ctrl:CloseSelf()
    else
        local strLack = Localization:GetString("391090")
        UIUtil.ShowMessage(strLack, 2, GameDialogDefine.CONFIRM, "110088",function()
        end, function()
            self.ctrl:CloseSelf()
            UIManager:GetInstance():OpenWindow(UIWindowNames.UIAllianceCity,{ anim = true, isBlur = true }, 2)
        end)
    end
end
UIUseEdenMissileTipView.OnCreate = OnCreate
UIUseEdenMissileTipView.OnDestroy = OnDestroy
UIUseEdenMissileTipView.OnEnable = OnEnable
UIUseEdenMissileTipView.OnDisable = OnDisable
UIUseEdenMissileTipView.RefreshData =RefreshData
UIUseEdenMissileTipView.OnClickBuyBtn =OnClickBuyBtn
UIUseEdenMissileTipView.OnAddListener = OnAddListener
UIUseEdenMissileTipView.OnRemoveListener = OnRemoveListener
return UIUseEdenMissileTipView