---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2024/4/15 21:08
---

local UICitySiegeTip = BaseClass("UICitySiegeTip", UIBaseView)
local base = UIBaseView

local desc_path = "Root/Mask/Desc"

local Speed = 120
local MaxWidth = 650
local DelayBefore = 1.5
local DelayAfter = 1.5

local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

local function OnDestroy(self)
    self:DataDestroy()
    self:ComponentDestroy()
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
    self.active = true
    self:ReInit()
end

local function OnDisable(self)
    self.active = false
    base.OnDisable(self)
end

local function ComponentDefine(self)
    self.desc_text = self:AddComponent(UITextMeshProUGUIEx, desc_path)
end

local function ComponentDestroy(self)

end

local function DataDefine(self)
    self.seq = nil
end

local function DataDestroy(self)
    if self.seq then
        self.seq:Kill()
        self.seq = nil
    end
end

local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function ReInit(self)
    local desc, callback = self:GetUserData()
    self.desc_text:SetLocalText(desc)
    CS.UnityEngine.UI.LayoutRebuilder.ForceRebuildLayoutImmediate(self.desc_text.rectTransform)
    local width = self.desc_text.rectTransform.sizeDelta.x
    local diff = width - MaxWidth
    local duration = diff / Speed
    if diff > 0 then
        self.desc_text.rectTransform.anchoredPosition = Vector2.New(0, 0)
    else
        self.desc_text.rectTransform.anchoredPosition = Vector2.New(diff * -0.5, 0)
    end
    
    self.seq = DOTween.Sequence()
    self.seq:AppendInterval(DelayBefore)
    if diff > 0 then
        self.seq:Append(self.desc_text.rectTransform:DOAnchorPosX(-diff, duration))
    end
    self.seq:AppendInterval(DelayAfter)
    self.seq:AppendCallback(function()
        if callback then
            callback()
        end
        self.ctrl:CloseSelf()
    end)
end

local function OnKeyEscape(self)
    
end

UICitySiegeTip.OnCreate = OnCreate
UICitySiegeTip.OnDestroy = OnDestroy
UICitySiegeTip.OnEnable = OnEnable
UICitySiegeTip.OnDisable = OnDisable
UICitySiegeTip.ComponentDefine = ComponentDefine
UICitySiegeTip.ComponentDestroy = ComponentDestroy
UICitySiegeTip.DataDefine = DataDefine
UICitySiegeTip.DataDestroy = DataDestroy
UICitySiegeTip.OnAddListener = OnAddListener
UICitySiegeTip.OnRemoveListener = OnRemoveListener

UICitySiegeTip.ReInit = ReInit
UICitySiegeTip.OnKeyEscape = OnKeyEscape

return UICitySiegeTip