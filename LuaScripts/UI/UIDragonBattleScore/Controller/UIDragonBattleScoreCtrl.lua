---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/6/14 20:32
---

local UIDragonBattleScoreCtrl = BaseClass("UIDragonBattleScoreCtrl", UIBaseCtrl)
local Localization = CS.GameEntry.Localization
function UIDragonBattleScoreCtrl:CloseSelf()
    UIManager:GetInstance():DestroyWindow(UIWindowNames.UIDragonBattleScore)
end

function UIDragonBattleScoreCtrl:Close()
    UIManager:GetInstance():DestroyWindowByLayer(UILayer.Info)
end

function UIDragonBattleScoreCtrl:GetAllMemberList(allianceId)
    local showList = {}
    local dic = DataCenter.ActDragonManager:GetDragonRecord()
    if dic ~=nil then
        if dic[allianceId]~=nil then
            local list = dic[allianceId].userArr
            if list~=nil then
                for k,v in pairs(list) do
                    local oneData = {}
                    oneData.uid = v.uid
                    oneData.name = v.name
                    oneData.headBg = v:GetHeadBgImg()
                    oneData.pic = v.pic
                    oneData.picVer = v.picVer
                    oneData.score = v.score
                    table.insert(showList,oneData)
                end
                table.sort(showList,function(a,b)
                    return a.score>b.score
                end)
            end
        end
    end
    return showList
end

function UIDragonBattleScoreCtrl:GetBattleScoreData()
    local dic = DataCenter.ActDragonManager:GetDragonRecord()
    local data = {}
    data.icon = ""
    data.abbr = ""
    data.name = ""
    data.score = 0
    data.serverId = 0
    data.playerNum = 0
    data.allianceId = ""
    data.enemyAllianceId = ""
    data.enemyIcon = ""
    data.enemyAbbr = ""
    data.enemyName = ""
    data.enemyScore = 0
    data.enemyServerId = 0
    data.enemyPlayerNum =0
    if dic ~=nil then
        for k,v in pairs(dic) do
            if v.allianceId ==LuaEntry.Player.allianceId then
                data.icon = v.icon
                data.abbr = v.abbr
                data.name = v.name
                data.serverId = v.serverId
                data.score = v.score
                data.allianceId = v.allianceId
                
                local list = v.userArr
                if list~=nil then
                    data.playerNum = table.count(list)
                end
            else
                data.enemyAllianceId = v.allianceId
                data.enemyIcon = v.icon
                data.enemyAbbr = v.abbr
                data.enemyName = v.name
                data.enemyScore = v.score
                data.enemyServerId = v.serverId
                local list = v.userArr
                if list~=nil then
                    data.enemyPlayerNum = table.count(list)
                end
            end
        end
    end
    return data
end

return UIDragonBattleScoreCtrl