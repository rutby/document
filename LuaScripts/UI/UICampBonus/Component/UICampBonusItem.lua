---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/2/10 11:34
---

local UICampBonusItem = BaseClass("UICampBonusItem", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local UICampBonusFetter = require "UI.UICampBonus.Component.UICampBonusFetter"

local this_path = ""
local top_path = "Top"
local bottom_path = "Bottom"
local fetter_path = "UICampBonusFetter"

local BG_ON_PATH = string.format(LoadPath.UITroopsNew, "UITroopsNew_img_msgbg2")
local BG_OFF_PATH = string.format(LoadPath.UITroopsNew, "UITroopsNew_img_msgbg_gray")

local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.bg_image = self:AddComponent(UIImage, this_path)
    self.top_text = self:AddComponent(UITextMeshProUGUIEx, top_path)
    self.bottom_text = self:AddComponent(UITextMeshProUGUIEx, bottom_path)
    self.fetter = self:AddComponent(UICampBonusFetter, fetter_path)
end

local function ComponentDestroy(self)
    self.bg_image = nil
    self.top_text = nil
    self.bottom_text = nil
    self.fetter = nil
end

local function DataDefine(self)
    
end

local function DataDestroy(self)
    
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function SetData(self, data)
    self.bg_image:LoadSprite(data.isOn and BG_ON_PATH or BG_OFF_PATH)
    self.top_text:SetLocalText(data.template.des)
    --策划杨波要求：没有阵营，默认要给一个黑手党阵营
    local camps = {HeroCamp.MAFIA}
    if data.camps~=nil and #data.camps>0 then
        camps = data.camps
    end
    local effectList = MarchUtil.GetCampBonusBaseEffectList(camps,data.template.id)
    local baseEffect = 0
    for a,b in pairs(effectList) do
        baseEffect = baseEffect+ LuaEntry.Effect:GetGameEffect(b)
    end
    local bottomStrs = {}
    for k, val in pairs(data.template.effect) do
        local str = ""
        if k == 2 then
            local base = baseEffect+val
            local valStr = ""
            if data.effectExtra > 0 and data.isOn then
                local delta = data.effectExtra-base
                if delta>0 then
                    valStr = string.format("%d%%<color=#00B200>(+%d%%)</color>", base,delta)
                else
                    valStr = toInt(base) .. "%"
                end
                
            else
                valStr = toInt(base) .. "%"
            end
            str = Localization:GetString("129030") .. valStr
        end
        table.insert(bottomStrs, str)
    end
    self.bottom_text:SetText(string.join(bottomStrs, "\n"))
    
    self.fetter:SetData(data.template.id, data.camps, not data.isOn)
end

UICampBonusItem.OnCreate = OnCreate
UICampBonusItem.OnDestroy = OnDestroy
UICampBonusItem.ComponentDefine = ComponentDefine
UICampBonusItem.ComponentDestroy = ComponentDestroy
UICampBonusItem.DataDefine = DataDefine
UICampBonusItem.DataDestroy = DataDestroy
UICampBonusItem.OnEnable = OnEnable
UICampBonusItem.OnDisable = OnDisable

UICampBonusItem.SetData = SetData

return UICampBonusItem