---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zzl
--- DateTime:
---
local UIHeroTrialRewardView = BaseClass("UIHeroTrialRewardView", UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization
local HeroTrialRewardCell = require "UI.UIHeroTrialReward.Component.UIHeroTrialRewardCell"
local title_path = "UICommonMidPopUpTitle/bg_mid/titleText"
local scroll_view_path = "ScrollView"
local closeBtn_path = "UICommonMidPopUpTitle/bg_mid/CloseBtn"
local maskBtn_path = "UICommonMidPopUpTitle/panel"


function UIHeroTrialRewardView:OnCreate()
    base.OnCreate(self)
    self.activityId = self:GetUserData()
    self:ComponentDefine()
    self:OnRefresh()
end

function UIHeroTrialRewardView:OnDestroy()
    self:SetCellDestroy()
    self:ComponentDestroy()
    base.OnDestroy(self)
end

function UIHeroTrialRewardView:OnEnable()
    base.OnEnable(self)
end

function UIHeroTrialRewardView:OnDisable()
    base.OnDisable(self)
end

function UIHeroTrialRewardView:ComponentDefine()
    self.closeBtnN = self:AddComponent(UIButton, closeBtn_path)
    self.closeBtnN:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.maskBtnN = self:AddComponent(UIButton, maskBtn_path)
    self.maskBtnN:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.titleTxtN = self:AddComponent(UITextMeshProUGUIEx, title_path)
    self.titleTxtN:SetLocalText(111239)

    self.scroll_view = self:AddComponent(UIScrollView, scroll_view_path)
    self.scroll_view:SetOnItemMoveIn(function(itemObj, index)
        self:OnCreateCell(itemObj, index)
    end)
    self.scroll_view:SetOnItemMoveOut(function(itemObj, index)
        self:OnDeleteCell(itemObj, index)
    end)
end

function UIHeroTrialRewardView:ComponentDestroy()
    self.goalN = nil
    self.tip1N = nil
    self.tip2N = nil
    self.tip3N = nil
    self.tip4N = nil
    self.joinBtnN = nil
    self.joinBtnTxtN = nil
    self.createBtnN = nil
    self.createBtnTxtN = nil
    self.closeBtnN = nil
end

function UIHeroTrialRewardView:OnAddListener()
    base.OnAddListener(self)
end

function UIHeroTrialRewardView:OnRemoveListener()
    base.OnRemoveListener(self)
end

function UIHeroTrialRewardView:OnRefresh()
    self.actData = DataCenter.ActSevenDayData:GetInfoByActId(tonumber(self.activityId))
    self.listReward = self.actData.scoreReward
    self.scroll_view:SetTotalCount(#self.listReward)
    --local index = self.actData.curMaxScoreReward + 1--self.actData.challengeInfo.curLevel == 0 and 1 or self.actData.challengeInfo.curLevel
    --if index > #self.listReward - 3 then
    --    index = #self.listReward - 2
    --end
    self.scroll_view:RefillCells(1)
end

function UIHeroTrialRewardView:OnCreateCell(itemObj, index)
    itemObj.name = tostring(index)
    local item = self.scroll_view:AddComponent(HeroTrialRewardCell, itemObj)
    local isSelf = (self.actData.curMaxScoreReward + 1) == index
    item:ShowRewards(self.listReward[index],isSelf,index)
end

function UIHeroTrialRewardView:OnDeleteCell(itemObj, index)
    self.scroll_view:RemoveComponent(itemObj.name, HeroTrialRewardCell)
end

function UIHeroTrialRewardView:SetCellDestroy()
    self.scroll_view:ClearCells()
    self.scroll_view:RemoveComponents(HeroTrialRewardCell)
    self.model = {}
end

return UIHeroTrialRewardView