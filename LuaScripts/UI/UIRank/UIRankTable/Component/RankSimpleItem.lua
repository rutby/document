---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by guqu.
--- DateTime: 2020/9/2 20:22
---
local RankSimpleItem = BaseClass("RankSimpleItem",UIBaseContainer)
local base = UIBaseContainer

local title_path = "desTxt"
local first_name_path = "firstNameTxt"
local second_name_path = "secondNameTxt"
local flag_bg_path = "flagBg"
--local flag_icon_path = "flagBg/flagIcon"
local flag_icon_path = "flagIcon"
local btn_path = "BgButton"
local Localization = CS.GameEntry.Localization
local function OnCreate(self)
    base.OnCreate(self)
    self.title = self:AddComponent(UITextMeshProUGUIEx,title_path)
    self.first_name = self:AddComponent(UITextMeshProUGUIEx,first_name_path)
    self.second_name = self:AddComponent(UITextMeshProUGUIEx,second_name_path)
    self.flag_bg = self:AddComponent(UIImage,flag_bg_path)
    self.flag_icon = self:AddComponent(UIImage,flag_icon_path)
    self.btn = self:AddComponent(UIButton, btn_path)
    self.btn:SetOnClick(function()  
SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnClick()
    end)
end

local function OnClick(self)
    self.view.ctrl:OnRankItemClick(self.data.type)
    --if self.param == nil or self.param.ranking == nil or self.param.ranking[1] == nil then
    --    UIUtil.ShowTipsId(371004)
    --else
    --    self.view.ctrl:OnRankItemClick(self.data.type)
    --end
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end
local function OnDestroy(self)
    self.title = nil
    self.first_name = nil
    self.second_name = nil
    --self.flag_bg = nil
    self.flag_icon = nil
    self.btn = nil
    self.data =nil
    self.param = nil
    base.OnDestroy(self)
end

local function InitByType(self,data)
    self.data =data
    self.flag_bg:LoadSprite(self.data.bg)
    self.flag_icon:LoadSprite(self.data.pic)
    self.title:SetText(self.data.title)
    self.first_name:SetText(self.data.firstName)
    self.second_name:SetText(self.data.secondName)

end
--排行榜显示
local function RefreshShowData(self,param)
	local nType = param["type"]
    self.param = param
    if param["ranking"] == nil or param["ranking"][1] == nil then
        self.first_name:SetText("-")
        self.second_name:SetText("-")
        return
    end
	local ranking = param["ranking"][1]
	local alliancename = ranking["alliancename"] or ranking["allianceName"] or ""
	local abbr = ranking["abbr"]
	local name = ranking["name"]
	local leader =ranking["leader"]
	if nType== RankType.AlliancePower or nType==RankType.AllianceKill then
		if alliancename=="" then
			self.first_name:SetText("-")
		else
			self.first_name:SetText("["..abbr.."]"..alliancename)
		end
		self.second_name:SetText(Localization:GetString("390020")..ranking["leader"])
	else
		self.first_name:SetText(name)
		if alliancename=="" then
			self.second_name:SetText("-")
		else
			self.second_name:SetText("["..abbr.."]"..alliancename)
		end
	end
end
local function RefreshData(self,data)
    self.data =data
    self.first_name:SetText(self.data.firstName)
    self.second_name:SetText(self.data.secondName)
end

RankSimpleItem.OnCreate = OnCreate
RankSimpleItem.OnDestroy = OnDestroy
RankSimpleItem.OnEnable = OnEnable
RankSimpleItem.OnDisable = OnDisable
RankSimpleItem.OnClick = OnClick
RankSimpleItem.InitByType = InitByType
RankSimpleItem.RefreshData = RefreshData
RankSimpleItem.RefreshShowData = RefreshShowData
return RankSimpleItem