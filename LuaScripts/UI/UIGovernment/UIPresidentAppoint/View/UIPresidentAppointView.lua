---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2023/3/21 17:31
---

local UIPresidentAppointView = BaseClass("UIPresidentAppointView",UIBaseView)
local base = UIBaseView
local Localization = CS.GameEntry.Localization
local Cell = require("UI.UIGovernment.UIPresidentAppoint.Component.UIPresidentAppointCell")

local txt_title_path ="UICommonPopUpTitle/bg_mid/titleText"
local close_btn_path = "UICommonPopUpTitle/bg_mid/CloseBtn"
local return_btn_path = "UICommonPopUpTitle/panel"
local scroll_path = "ImgBg/ScrollView"

local title1_path = "ImgBg/title_1"

local confirm_btn_path = "ImgBg/ConfirmBtn"
local confirm_btn_text_path = "ImgBg/ConfirmBtn/ConfirmBtnText"

local function OnCreate(self)
    base.OnCreate(self)
    local data = self:GetUserData()
    self.data = data
    self.txt_title = self:AddComponent(UITextMeshProUGUIEx, txt_title_path)
    self.txt_title:SetLocalText(250046)

    self.close_btn = self:AddComponent(UIButton, close_btn_path)
    self.close_btn:SetOnClick(function()
        self.ctrl:CloseSelf(self.data, self.user)
    end)

    self.return_btn = self:AddComponent(UIButton, return_btn_path)
    self.return_btn:SetOnClick(function()
        self.ctrl:CloseSelf(self.data, self.user)
    end)

    self.title1 = self:AddComponent(UIText, title1_path)
    self.title1:SetLocalText(250051)
    
    self.ScrollView = self:AddComponent(UIScrollView, scroll_path)
    self.ScrollView:SetOnItemMoveIn(function(itemObj, index)
        self:OnAllianceItemMoveIn(itemObj, index)
    end)
    self.ScrollView:SetOnItemMoveOut(function(itemObj, index)
        self:OnAllianceItemMoveOut(itemObj, index)
    end)

    self.confirm_btn = self:AddComponent(UIButton, confirm_btn_path)
    self.confirm_btn_text = self:AddComponent(UIText, confirm_btn_text_path)
    self.confirm_btn_text:SetLocalText(GameDialogDefine.CONFIRM)
    self.confirm_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnConfirmClick()
    end)
    self.curSelectUuid = nil
    self:GetDataFromServer()
end

local function OnDestroy(self)
    self:ClearScroll()
    self.txt_title = nil
    self.close_btn = nil
    self.return_btn = nil
    self.input = nil
    self.curSelectUuid = nil

    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function OnAllianceItemMoveIn(self,itemObj, index)
    itemObj.name = tostring(index)
    local cellItem = self.ScrollView:AddComponent(Cell, itemObj)
    cellItem:SetData(self.dataList[index], self.curSelectUuid)
end

local function OnAllianceItemMoveOut(self, itemObj, index)
    self.ScrollView:RemoveComponent(itemObj.name, Cell)
end

local function ClearScroll(self)
    self.ScrollView:ClearCells()
    self.ScrollView:RemoveComponents(Cell)
end

local function OnAddListener(self)
    base.OnAddListener(self)
    self:AddUIListener(EventId.SearchSelectUser, self.OnSelect)
    self:AddUIListener(EventId.AllianceMember, self.OnDataBack)
end

local function OnRemoveListener(self)
    self:RemoveUIListener(EventId.AllianceMember, self.OnDataBack)
    self:RemoveUIListener(EventId.SearchSelectUser, self.OnSelect)
    base.OnRemoveListener(self)
end

local function OnSelect(self, para)
    self.curSelectUuid = para
end

local function ShowCells(self)
    self:ClearScroll()
    local count = #self.dataList
    if count == 0 then
        return
    end
    self.ScrollView:SetTotalCount(count)
    self.ScrollView:RefillCells()
end

local function OnConfirmClick(self)
    if string.IsNullOrEmpty(self.curSelectUuid) then
        return
    end
    local name = ""
    for k, v in ipairs(self.dataList) do
        if self.curSelectUuid == v.uid then
            name = v.name
            break
        end
    end
    UIUtil.ShowMessage(Localization:GetString("250052", name),2,"","", function()
        DataCenter.GovernmentManager:ChooseKing(self.curSelectUuid)
        self.ctrl:CloseSelf()
    end, function()
    end)
end

local function OnDataBack(self)
    self.dataList = self.ctrl:GetPanelData()
    self:ShowCells()
end

local function GetDataFromServer(self)
    SFSNetwork.SendMessage(MsgDefines.AlRank, LuaEntry.Player.allianceId)
end

UIPresidentAppointView.OnDataBack = OnDataBack
UIPresidentAppointView.OnSelect = OnSelect
UIPresidentAppointView.OnCreate= OnCreate
UIPresidentAppointView.OnDestroy = OnDestroy
UIPresidentAppointView.OnEnable = OnEnable
UIPresidentAppointView.OnDisable = OnDisable
UIPresidentAppointView.OnAllianceItemMoveIn = OnAllianceItemMoveIn
UIPresidentAppointView.OnAllianceItemMoveOut = OnAllianceItemMoveOut
UIPresidentAppointView.ClearScroll = ClearScroll
UIPresidentAppointView.OnAddListener = OnAddListener
UIPresidentAppointView.OnRemoveListener = OnRemoveListener
UIPresidentAppointView.ShowCells = ShowCells
UIPresidentAppointView.OnConfirmClick = OnConfirmClick
UIPresidentAppointView.GetDataFromServer = GetDataFromServer

return UIPresidentAppointView