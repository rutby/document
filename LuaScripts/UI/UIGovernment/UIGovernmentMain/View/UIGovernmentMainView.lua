---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2023/3/13 14:20
---

local UIGovernmentMainView = BaseClass("UIGovernmentMainView", UIBaseView)
local base = UIBaseView
local TabButton = require "UI.UIGovernment.UIGovernmentMain.Component.TabButton"
local UIPresidentItem = require "UI.UIGovernment.UIPresidentItem"
local UIPresidentTab = require "UI.UIGovernment.UIGovernmentMain.Component.UIPresidentTab"
local UIGovernmentTab = require "UI.UIGovernment.UIGovernmentMain.Component.UIGovernmentTab"

local title_path = "safeArea/Title"
local back_path = "safeArea/Back"
local tab1_path = "safeArea/ImgTabBg/Tabs/PresidentTab"
local tab2_path = "safeArea/ImgTabBg/Tabs/GovernmentTab"

local president_item_path = "content/UIPresidentItem"

local president_path = "content/right/President"
local government_path = "content/right/Government"

--创建
local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
    self:ReInit()
end

-- 销毁
local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self._title_txt = self:AddComponent(UIText, title_path)
    self._return_btn = self:AddComponent(UIButton, back_path)
    self._return_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self.ctrl:CloseSelf()
    end)
    
    self.tab1 = self:AddComponent(TabButton, tab1_path)
    self.tab2 = self:AddComponent(TabButton, tab2_path)
    local d1, d2 = self.ctrl:GetTabButtonData()
    d1.callBack = BindCallback(self, self.SetCurTab)
    d2.callBack = BindCallback(self, self.SetCurTab)
    self.tab1:ReInit(d1)
    self.tab2:ReInit(d2)
    self.presidentItem = self:AddComponent(UIPresidentItem, president_item_path)
    self.presidentTab = self:AddComponent(UIPresidentTab, president_path)
    self.governmentTab = self:AddComponent(UIGovernmentTab, government_path)
end

local function ComponentDestroy(self)
    
end

local function DataDefine(self)
    self.curIndex = -1
end

local function DataDestroy(self)
    self.curIndex = -1
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function ReInit(self)
    local index = self:GetUserData()
    self.curIndex = index or 1
    self:RefreshView()
end

local function SetCurTab(self, tabIndex)
    if self.curIndex == tabIndex then
        return
    end
    self.curIndex = tabIndex
    self:RefreshView()
end

local function RefreshView(self)
    self:RefreshPresidentTab()
    self:RefreshGovernment()
    self:RefreshPresidentItem()
    self:RefreshTabBtns()
end

local function RefreshPresidentTab(self)
    self.presidentTab:SetActive(self.curIndex == 1)
    if self.curIndex == 1 then
        self.presidentTab:ReInit()
    end
end

local function RefreshGovernment(self)
    self.governmentTab:SetActive(self.curIndex == 2)
    if self.curIndex == 2 then
        self.governmentTab:ReInit()
    end
end

local function RefreshPresidentItem(self)
    local info = self.ctrl:GetPresidentInfo()
    self.presidentItem:ReInit(info)
end

local function RefreshTabBtns(self)
    self.tab1:SetCurSelect(self.curIndex)
    self.tab2:SetCurSelect(self.curIndex)
end

local function OnAddListener(self)
    base.OnAddListener(self)
    self:AddUIListener(EventId.KingdomPresidentInfoUpdate, self.RefreshPresidentItem)
end

local function OnRemoveListener(self)
    self:RemoveUIListener(EventId.KingdomPresidentInfoUpdate, self.RefreshPresidentItem)
    base.OnRemoveListener(self)
end

UIGovernmentMainView.RefreshPresidentTab = RefreshPresidentTab
UIGovernmentMainView.RefreshGovernment = RefreshGovernment
UIGovernmentMainView.RefreshPresidentItem = RefreshPresidentItem
UIGovernmentMainView.RefreshTabBtns = RefreshTabBtns
UIGovernmentMainView.OnCreate = OnCreate
UIGovernmentMainView.OnDestroy = OnDestroy
UIGovernmentMainView.OnEnable = OnEnable
UIGovernmentMainView.OnDisable = OnDisable
UIGovernmentMainView.ComponentDefine = ComponentDefine
UIGovernmentMainView.ComponentDestroy = ComponentDestroy
UIGovernmentMainView.DataDefine = DataDefine
UIGovernmentMainView.DataDestroy = DataDestroy
UIGovernmentMainView.ReInit = ReInit
UIGovernmentMainView.SetCurTab = SetCurTab
UIGovernmentMainView.RefreshView = RefreshView
UIGovernmentMainView.OnAddListener = OnAddListener
UIGovernmentMainView.OnRemoveListener = OnRemoveListener

return UIGovernmentMainView