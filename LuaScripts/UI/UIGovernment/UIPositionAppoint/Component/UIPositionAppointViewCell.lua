---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2023/3/20 16:34
---

local UIPositionAppointViewCell = BaseClass("UIPositionAppointViewCell",UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.official_name = self:AddComponent(UIText, "itemBg/official_name")
    self.name_text = self:AddComponent(UIText, "itemBg/player_name")
    self.icon = self:AddComponent(UIImage, "itemBg/iconBg/icon")
    self.iconBg = self:AddComponent(UIBaseContainer, "itemBg/iconBg")
    self.btn = self:AddComponent(UIButton, "itemBg/Btn")
    self.btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnBtnClick()
    end)

    self.player_head = self:AddComponent(UIPlayerHead, "itemBg/UIPlayerHead/HeadIcon")
    self.headBg = self:AddComponent(UIImage, "itemBg/UIPlayerHead")
    self.headFg = self:AddComponent(UIImage, "itemBg/UIPlayerHead/Foreground")
end

local function ComponentDestroy(self)

end

local function SetData(self, data, clickFunc)
    self.data = data
    self.clickFunc = clickFunc
    self:RefreshView()
end

local function RefreshView(self)
    self.official_name:SetLocalText(self.data.name)
    if self.data.positionInfo and not string.IsNullOrEmpty(self.data.positionInfo.uid) then
        self.name_text:SetText(self.data.positionInfo.name)
        self.headBg:SetActive(true)
        self.iconBg:SetActive(false)
        self.player_head:SetData(self.data.positionInfo.uid, self.data.positionInfo.pic, self.data.positionInfo.picVer)
        local headBgImg = DataCenter.DecorationDataManager:GetHeadFrame(self.data.positionInfo.headSkinId, self.data.positionInfo.headSkinET)
        if headBgImg ~= nil then
            self.headFg:SetActive(true)
            self.headFg:LoadSprite(headBgImg)
        else
            self.headFg:SetActive(false)
        end

    else
        self.name_text:SetLocalText(100206)
        self.icon:LoadSprite(self.data.icon)
        self.headBg:SetActive(false)
        self.iconBg:SetActive(true)
    end
end

local function OnBtnClick(self)
    local positionInfo = DataCenter.GovernmentManager:GetPositionInfoByPositionId(self.data.id)
    if positionInfo and positionInfo.uid == self.data.playerUuid then
        local str = Localization:GetString("250142", self.data.playerName or "")
        UIUtil.ShowMessage(str, 2,"","", function()
            DataCenter.GovernmentManager:KingdomPositionAppoint(self.data.playerUuid, self.data.id, 2)
            self.view.ctrl:CloseSelf()
        end, function()
        end)
    else
        if positionInfo then
            if positionInfo:IsInAppointTimeCD() then
                UIUtil.ShowTipsId(250129)
                return
            end
        end
        local str = Localization:GetString("250078", self.data.playerName or "", Localization:GetString(self.data.name or ""))
        UIUtil.ShowMessage(str, 2,"","", function()
            DataCenter.GovernmentManager:KingdomPositionAppoint(self.data.playerUuid, self.data.id, 1)
            self.view.ctrl:CloseSelf()
        end, function()
        end)
    end
end

UIPositionAppointViewCell.OnCreate= OnCreate
UIPositionAppointViewCell.OnDestroy = OnDestroy
UIPositionAppointViewCell.ComponentDefine = ComponentDefine
UIPositionAppointViewCell.ComponentDestroy = ComponentDestroy
UIPositionAppointViewCell.SetData = SetData
UIPositionAppointViewCell.RefreshView = RefreshView
UIPositionAppointViewCell.OnBtnClick = OnBtnClick

return UIPositionAppointViewCell