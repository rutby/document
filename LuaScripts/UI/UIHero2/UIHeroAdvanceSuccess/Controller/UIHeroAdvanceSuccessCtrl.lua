---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhangliheng.
--- DateTime: 2021/6/28 下午6:48
---



local UIHeroAdvanceSuccessCtrl = BaseClass("UIHeroAdvanceSuccessCtrl", UIBaseCtrl)
local Localization = CS.GameEntry.Localization

local function CloseSelf(self)
    UIManager:GetInstance():DestroyWindow(UIWindowNames.UIHeroAdvanceSuccess)
    EventManager:GetInstance():Broadcast(EventId.OnAdvanceSuccessClosed)
end

local function DoWhenAdvance(self, coreHeroUuid, consumeMap)
    local hasOfficial = false
    local hasMaster = false
    local officialHeroNames = ""
    local masterHeroNames = ""

    for _, v in ipairs(consumeMap) do
        local data = DataCenter.HeroDataManager:GetHeroByUuid(v)
        if data ~= nil and data.isMaster then
            local nameStr = HeroUtils.GetHeroNameByConfigId(data.heroId)
            if string.IsNullOrEmpty(masterHeroNames) then
                masterHeroNames = nameStr
            else
                masterHeroNames = masterHeroNames..","..nameStr
            end
            if data.level > 1 or data.rarity == HeroUtils.RarityType.S or data.rarity == HeroUtils.RarityType.A  then
                hasMaster = true
            end

            local official = DataCenter.HeroOfficialManager:GetHeroPos(v)
            if official ~= nil then
                hasOfficial = true
                if string.IsNullOrEmpty(officialHeroNames) then
                    officialHeroNames = nameStr
                else
                    officialHeroNames = officialHeroNames..","..nameStr
                end
            end
        end
    end
    if hasOfficial then
        UIUtil.ShowMessage(Localization:GetString("129277", officialHeroNames), 2, GameDialogDefine.CONFIRM, GameDialogDefine.CANCEL, function()
            SFSNetwork.SendMessage(MsgDefines.HeroAdvance, coreHeroUuid, table.values(consumeMap))
        end)
    elseif hasMaster then
        UIUtil.ShowMessage(Localization:GetString("129276", masterHeroNames), 2, GameDialogDefine.CONFIRM, GameDialogDefine.CANCEL, function()
            SFSNetwork.SendMessage(MsgDefines.HeroAdvance, coreHeroUuid, table.values(consumeMap))
        end)
    else
        SFSNetwork.SendMessage(MsgDefines.HeroAdvance, coreHeroUuid, table.values(consumeMap))
    end
end
UIHeroAdvanceSuccessCtrl.DoWhenAdvance = DoWhenAdvance

UIHeroAdvanceSuccessCtrl.CloseSelf = CloseSelf

return UIHeroAdvanceSuccessCtrl