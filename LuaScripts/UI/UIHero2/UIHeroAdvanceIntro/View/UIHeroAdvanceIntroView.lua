---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2023/2/1 17:24
---


local UIHeroAdvanceIntroView = BaseClass("UIHeroAdvanceIntroView", UIBaseView)
local Cell = require "UI.UIHero2.UIHeroAdvanceIntro.Component.UIHeroAdvanceIntroCell"
local base = UIBaseView
local Localization = CS.GameEntry.Localization
local UIHeroTipView = require "UI.UIHero2.UIHeroTip.View.UIHeroTipView"
local closeBtn_path = "ImgBg/UICommonMidPopUpTitle/bg_mid/CloseBtn"
local titleTxt_path = "ImgBg/UICommonMidPopUpTitle/bg_mid/titleText"
local return_path = "ImgBg/UICommonMidPopUpTitle/panel"
local scroll_view = "ImgBg/ScrollView"
local intro_btn_path = "ImgBg/Common_btn_info"

local s_tab_path = "ImgBg/TabContent/STab"
local s_tab_icon_path = "ImgBg/TabContent/STab/SIcon"

local c_tab_path = "ImgBg/TabContent/CTab"
local c_tab_icon_path = "ImgBg/TabContent/CTab/CIcon"

local IntroPanelTabType = {
    IntroPanelTabType_S = 1,
    IntroPanelTabType_C = 2,
}

local TabToHeroId = {}
TabToHeroId[IntroPanelTabType.IntroPanelTabType_S] = 1006
TabToHeroId[IntroPanelTabType.IntroPanelTabType_C] = 22003

--创建
local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
    self:ReInit()
end

-- 销毁
local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self._title_txt = self:AddComponent(UIText, titleTxt_path)
    self._title_txt:SetLocalText(129250)
    self._close_btn = self:AddComponent(UIButton, closeBtn_path)
    self._return_btn = self:AddComponent(UIButton, return_path)
    self._close_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self.ctrl:CloseSelf()
    end)
    self._return_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self.ctrl:CloseSelf()
    end)

    self.scroll_view = self:AddComponent(UIScrollView, scroll_view)
    self.scroll_view:SetOnItemMoveIn(function(itemObj, index)
        self:OnCreateCell(itemObj, index)
    end)
    self.scroll_view:SetOnItemMoveOut(function(itemObj, index)
        self:OnDeleteCell(itemObj, index)
    end)
    
    self.s_tab = self:AddComponent(UIButton, s_tab_path)
    self.s_tab_icon = self:AddComponent(UIButton, s_tab_icon_path)

    self.c_tab = self:AddComponent(UIButton, c_tab_path)
    self.c_tab_icon = self:AddComponent(UIButton, c_tab_icon_path)
    
    self.s_tab:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:SetCurrentTab(IntroPanelTabType.IntroPanelTabType_S)
    end)
    
    self.c_tab:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:SetCurrentTab(IntroPanelTabType.IntroPanelTabType_C)
    end)
    
    self.intro_btn = self:AddComponent(UIButton, intro_btn_path)
    self.intro_btn:SetOnClick(function()
        SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)
        self:OnIntroClick()
    end)
end

local function ComponentDestroy(self)
    self:ClearScroll()
end


local function DataDefine(self)
    self.curTab = nil
end

local function DataDestroy(self)

end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function ReInit(self)
    self:SetCurrentTab(IntroPanelTabType.IntroPanelTabType_S)
end

local function OnCreateCell(self,itemObj, index)
    itemObj.name = tostring(index)
    local cellItem = self.scroll_view:AddComponent(Cell, itemObj)
    local data =  self.dataList[index]
    cellItem:SetData(data)
end

local function OnDeleteCell(self,itemObj, index)
    self.scroll_view:RemoveComponent(itemObj.name, Cell)
end

local function ClearScroll(self)
    self.scroll_view:ClearCells()
    self.scroll_view:RemoveComponents(Cell)
end

local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function SetCurrentTab(self, tab)
    if self.curTab == tab then
        return 
    end
    self.curTab = tab
    self:RefreshView()
end

local function RefreshView(self)
    self:ShowCells()
    self:RefreshTabBtn()
end

local function RefreshTabBtn(self)
    if self.curTab == IntroPanelTabType.IntroPanelTabType_S then
        self.s_tab:LoadSprite(string.format(LoadPath.CommonNewPath,"Common_btn_tab_up"))
        self.s_tab_icon:LoadSprite(string.format(LoadPath.HeroAdvancePath,"Common_btn_SA"))
        self.c_tab:LoadSprite(string.format(LoadPath.CommonNewPath,"Common_btn_tab_down"))
        self.c_tab_icon:LoadSprite(string.format(LoadPath.HeroAdvancePath,"Common_btn_BC_unchecked"))
    elseif self.curTab == IntroPanelTabType.IntroPanelTabType_C then
        self.s_tab:LoadSprite(string.format(LoadPath.CommonNewPath,"Common_btn_tab_down"))
        self.s_tab_icon:LoadSprite(string.format(LoadPath.HeroAdvancePath,"Common_btn_SA_unchecked"))
        self.c_tab:LoadSprite(string.format(LoadPath.CommonNewPath,"Common_btn_tab_up"))
        self.c_tab_icon:LoadSprite(string.format(LoadPath.HeroAdvancePath,"Common_btn_BC"))
    end
end

local function ShowCells(self)
    local heroId = TabToHeroId[self.curTab]
    if heroId == nil then
        return
    end
    self.dataList = self.ctrl:GetPanelData(heroId)
    if next(self.dataList) then
        self:ClearScroll()
        self.scroll_view:SetTotalCount(#self.dataList)
        self.scroll_view:RefillCells()
    end
end

local function OnIntroClick(self)
    local scaleFactor = UIManager:GetInstance():GetScaleFactor()
    local position = self.intro_btn.transform.position + Vector3.New(0, -30, 0) * scaleFactor

    local param = UIHeroTipView.Param.New()
    param.content = Localization:GetString("129240")
    param.dir = UIHeroTipView.Direction.BELOW
    param.defWidth = 350
    param.pivot = 0.15
    param.position = position

    UIManager:GetInstance():OpenWindow(UIWindowNames.UIHeroTip, { anim = false }, param)
end

UIHeroAdvanceIntroView.ReInit = ReInit
UIHeroAdvanceIntroView.OnAddListener = OnAddListener
UIHeroAdvanceIntroView.OnRemoveListener = OnRemoveListener
UIHeroAdvanceIntroView.OnCreate = OnCreate
UIHeroAdvanceIntroView.OnDestroy = OnDestroy
UIHeroAdvanceIntroView.OnEnable = OnEnable
UIHeroAdvanceIntroView.OnDisable = OnDisable
UIHeroAdvanceIntroView.ComponentDefine = ComponentDefine
UIHeroAdvanceIntroView.ComponentDestroy = ComponentDestroy
UIHeroAdvanceIntroView.DataDefine = DataDefine
UIHeroAdvanceIntroView.DataDestroy = DataDestroy
UIHeroAdvanceIntroView.OnCreateCell = OnCreateCell
UIHeroAdvanceIntroView.OnDeleteCell = OnDeleteCell
UIHeroAdvanceIntroView.ClearScroll = ClearScroll
UIHeroAdvanceIntroView.SetCurrentTab = SetCurrentTab
UIHeroAdvanceIntroView.RefreshView = RefreshView
UIHeroAdvanceIntroView.RefreshTabBtn = RefreshTabBtn
UIHeroAdvanceIntroView.ShowCells = ShowCells
UIHeroAdvanceIntroView.OnIntroClick = OnIntroClick

return UIHeroAdvanceIntroView