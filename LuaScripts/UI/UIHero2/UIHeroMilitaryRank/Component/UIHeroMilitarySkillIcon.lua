---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhangliheng.
--- DateTime: 2022/1/19 11:49
---



local UIHeroMilitarySkillIcon = BaseClass("UIHeroMilitarySkillIcon", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.imgIcon = self:AddComponent(UIImage, 'skillIconBg/skillIcon')
    self.textLv = self:AddComponent(UITextMeshProUGUIEx, 'skillIconBg/skillLvBg/lvNum')
    self.nodeArrow = self:AddComponent(UITextMeshProUGUIEx, 'skillIconBg/NodeArrow')
    
    self.btn = self:AddComponent(UIButton, 'skillIconBg')
    self.btn:SetOnClick(BindCallback(self, self.OnBtnClick))
end

local function ComponentDestroy(self)
end

local function SetData(self, skillId, level, showArrow, pivot, isBigIcon, isTipDown)
    self.skillId = skillId
    self.level = level
    self.pivot = pivot or 0.85
    self.isTipDown = isTipDown or false
    if isBigIcon == true then
        self.imgIcon:LoadSprite(HeroUtils.GetSkillBigIcon(skillId))
    else
        self.imgIcon:LoadSprite(HeroUtils.GetSkillIcon(skillId))
    end
    self.textLv:SetText(level)
    self.nodeArrow:SetActive(showArrow)
end

local function OnBtnClick(self)
    SoundUtil.PlayEffect(SoundAssets.Music_Effect_Button)

    local skillId  = self.skillId
    local level  = self.level

    local scaleFactor = UIManager:GetInstance():GetScaleFactor()
    local position = self.transform.position

    local UIHeroSkillTipView = require "UI.UIHero2.UIHeroSkillTip.View.UIHeroSkillTipView"
    local dir = UIHeroSkillTipView.Direction.ABOVE

    local diffY = 55

    if self.isTipDown then
        dir = UIHeroSkillTipView.Direction.BELOW
        diffY = -55
    end
    local param = UIHeroSkillTipView.Param.New()
    param.content = Localization:GetString("150155")
    param.dir = dir
    param.skillId = skillId
    param.isUnlock = true
    param.skillLevel = level
    param.skillUnlockQuality = unlockQuality or 1
    param.pivot = self.pivot or 0.88
    param.position = position + Vector3.New(0,  diffY, 0) * scaleFactor

    UIManager:GetInstance():OpenWindow(UIWindowNames.UIHeroSkillTip, { anim = false }, param)
end

UIHeroMilitarySkillIcon.OnCreate = OnCreate
UIHeroMilitarySkillIcon.OnDestroy = OnDestroy
UIHeroMilitarySkillIcon.ComponentDefine = ComponentDefine
UIHeroMilitarySkillIcon.ComponentDestroy = ComponentDestroy

UIHeroMilitarySkillIcon.SetData = SetData
UIHeroMilitarySkillIcon.OnBtnClick = OnBtnClick


return UIHeroMilitarySkillIcon