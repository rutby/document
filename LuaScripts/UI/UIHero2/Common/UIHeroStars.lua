---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2022/4/26 21:45
---

local UIHeroStars = BaseClass("UIHeroStars", UIBaseContainer)
local base = UIBaseContainer

local FullStarIcon = string.format(LoadPath.HeroListPath, "ui_img_starA")
local HalfStarIcon = string.format(LoadPath.HeroListPath, "ui_img_starB")
local EmptyStarIcon = string.format(LoadPath.HeroListPath, "ui_img_starC")

local star_bg_path = "star_bg%s"
local star_path = "star_bg%s/star_%s"

local StarCount = 5

local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.star_bg_goes = {}
    self.star_images = {}
    for i = 0, StarCount + 1 do
        self.star_bg_goes[i] = self:AddComponent(UICanvasGroup, string.format(star_bg_path, i))
        self.star_images[i] = self:AddComponent(UIImage, string.format(star_path, i, i))
    end
end

local function ComponentDestroy(self)

end

local function DataDefine(self)
    
end

local function DataDestroy(self)
    
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function SetData(self, param)
    local val = param.showStarNum - 1
    local maxVal = param.maxStarNum - 1
    local is3Star = maxVal < 10
    for i = 1, StarCount do
        if i * 2 <= maxVal then
            if i * 2 <= val then
                -- 全星
                self.star_images[i]:SetActive(true)
                self.star_images[i]:LoadSprite(FullStarIcon)
            elseif i * 2 == val + 1 then
                -- 半星
                self.star_images[i]:SetActive(true)
                self.star_images[i]:LoadSprite(HalfStarIcon)
            else
                -- 有这颗星星的上限，但是未达到
                self.star_images[i]:SetActive(false)
            end
        else
            -- 没有这颗星星的上限
            self.star_images[i]:SetActive(false)
        end
    end
    self.star_bg_goes[0]:SetActive(is3Star)
    self.star_bg_goes[4]:SetActive(not is3Star)
    self.star_bg_goes[5]:SetActive(not is3Star)
    self.star_bg_goes[6]:SetActive(is3Star)

    CS.UnityEngine.UI.LayoutRebuilder.ForceRebuildLayoutImmediate(self.transform)
end

UIHeroStars.OnCreate = OnCreate
UIHeroStars.OnDestroy = OnDestroy
UIHeroStars.ComponentDefine = ComponentDefine
UIHeroStars.ComponentDestroy = ComponentDestroy
UIHeroStars.DataDefine = DataDefine
UIHeroStars.DataDestroy = DataDestroy
UIHeroStars.OnEnable = OnEnable
UIHeroStars.OnDisable = OnDisable

UIHeroStars.SetData = SetData

return UIHeroStars