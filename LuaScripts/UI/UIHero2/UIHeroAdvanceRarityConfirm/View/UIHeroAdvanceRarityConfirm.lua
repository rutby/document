---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhangliheng.
--- DateTime: 2022/2/28 下午6:48
---


local UIHeroAdvanceRarityConfirm = BaseClass("UIHeroAdvanceRarityConfirm", UIBaseView)
local base = UIBaseView

local UIHeroCell = require "UI.UIHero2.Common.UIHeroCellSmall"

local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()

    local confirmCallback = self:GetUserData()
    self.callback = confirmCallback


    local consumeDataMap = HeroAdvanceController:GetInstance():GetCurConsumeMap()
    local requireNum = HeroAdvanceController:GetInstance():GetCurAdvanceRequireNum()
    for k = 1, requireNum do
        local t = self.consumeObjList[k]
        local heroCell = t.heroCell
        --local imgRarity = t.imgRarity

        local heroUuid = consumeDataMap[k]
        --local heroData = DataCenter.HeroDataManager:GetHeroByUuid(heroUuid)
        heroCell:SetData(heroUuid, nil, nil, true)
        --imgRarity:LoadSprite(HeroUtils.GetRarityIconName(heroData.rarity))
        heroCell:SetActive(true)
    end

    for k=requireNum+1, HeroUtils.ConsumeSlotMax do
        self.consumeObjList[k].heroCell:SetActive(false)
    end
end

local function OnDestroy(self)
    self.callback = nil
    self.coreHeroData = nil
    
    self:ComponentDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.textTitle = self:AddComponent(UITextMeshProUGUIEx, "UICommonMiniPopUpTitle/Bg_mid/titleText")
    self.textTip = self:AddComponent(UIText, "TextTip")
    self.textConsume = self:AddComponent(UIText, "TextConsume")
    
    local btnClose = self:AddComponent(UIButton, "UICommonMiniPopUpTitle/Bg_mid/CloseBtn")
    btnClose:SetOnClick(BindCallback(self, self.OnBtnCancelClick))
    
    self.consumeObjList = {}
    for i = 1, HeroUtils.ConsumeSlotMax do
        local hero = self:AddComponent(UIHeroCell, "NodeConsume/UIHeroCell" .. i)
        self.consumeObjList[i] = {heroCell = hero}
    end
    
    local btnConfirm = self:AddComponent(UIButton, "BtnGo/LeftBtn")   
    btnConfirm:SetOnClick(BindCallback(self, self.OnBtnConfirmClick))

    local btnCancel = self:AddComponent(UIButton, "BtnGo/RightBtn")
    btnCancel:SetOnClick(BindCallback(self, self.OnBtnCancelClick))
    
    local textConfirm = self:AddComponent(UIText, "BtnGo/LeftBtn/LeftBtnName")
    local textCancel = self:AddComponent(UIText, "BtnGo/RightBtn/RightBtnName")
    
    textConfirm:SetLocalText(GameDialogDefine.CONFIRM) 
    textCancel:SetLocalText(GameDialogDefine.CANCEL) 
    
    self.textTitle:SetLocalText(100378) 
    self.textTip:SetLocalText(129102) 
    self.textConsume:SetLocalText(129054) 
end

local function ComponentDestroy(self)
end

local function OnBtnConfirmClick(self)
    if self.callback then
        self.callback()
    end

    self.ctrl:CloseSelf()
end

local function OnBtnCancelClick(self)
    self.ctrl:CloseSelf()
end


UIHeroAdvanceRarityConfirm.OnCreate= OnCreate
UIHeroAdvanceRarityConfirm.OnDestroy = OnDestroy
UIHeroAdvanceRarityConfirm.ComponentDefine = ComponentDefine
UIHeroAdvanceRarityConfirm.ComponentDestroy = ComponentDestroy

UIHeroAdvanceRarityConfirm.OnBtnConfirmClick = OnBtnConfirmClick
UIHeroAdvanceRarityConfirm.OnBtnCancelClick = OnBtnCancelClick

return UIHeroAdvanceRarityConfirm
