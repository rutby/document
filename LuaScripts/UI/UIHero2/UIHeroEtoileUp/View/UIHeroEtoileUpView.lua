---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2024/3/25 20:40
---

local UIHeroEtoileUp = BaseClass("UIHeroEtoileUp", UIBaseView)
local base = UIBaseView
local UIHeroInfoSkillItem = require "UI.UIHero2.UIHeroInfo.Component.UIHeroInfoSkillItem"

local bg_path = "Bg"
local panel_path = "Bg/Panel"
local title_path = "Bg/Title"
local power_left_path = "Bg/PowerBg/PowerLeft"
local power_right_path = "Bg/PowerBg/PowerRight"
local skill_bg_path = "Bg/SkillBg"
local skill_desc_path = "Bg/SkillBg/SkillDesc"
local skill_item_path = "Bg/SkillBg/Skill_%s"
local tip_path = "Bg/Tip"

local SkillCount = 5

local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.animator = self:AddComponent(UIAnimator, bg_path)
    local ret, time = self.animator:GetAnimationReturnTime('Eff_Ain_Shengxing_In')
    if ret then
        TimerManager:GetInstance():DelayInvoke(function()
            self.animatorComplete = true
        end, time + 0.1)
    end
    self.panel_btn = self:AddComponent(UIButton, panel_path)
    self.panel_btn:SetOnClick(function()
        self:OnPanelClick()
    end)
    self.title_text = self:AddComponent(UITextMeshProUGUIEx, title_path)
    self.title_text:SetLocalText(321487)
    self.power_left_text = self:AddComponent(UITextMeshProUGUIEx, power_left_path)
    self.power_right_text = self:AddComponent(UITextMeshProUGUIEx, power_right_path)
    CS.UnityEngine.UI.LayoutRebuilder.ForceRebuildLayoutImmediate(self.power_left_text.transform)
    CS.UnityEngine.UI.LayoutRebuilder.ForceRebuildLayoutImmediate(self.power_right_text.transform)
    CS.UnityEngine.UI.LayoutRebuilder.ForceRebuildLayoutImmediate(self.power_right_text.transform.parent)
    self.skill_bg_go = self:AddComponent(UIBaseContainer, skill_bg_path)
    self.skill_desc_text = self:AddComponent(UITextMeshProUGUIEx, skill_desc_path)
    self.skill_desc_text:SetLocalText(321488)
    self.skill_items = {}
    for i = 1, SkillCount do
        self.skill_items[i] = self:AddComponent(UIHeroInfoSkillItem, string.format(skill_item_path, i))
        self.skill_items[i]:SetShowRed(false)
        self.skill_items[i]:SetOnClick(function()
            self:OnSkillClick(i)
        end)
    end
    self.tip_text = self:AddComponent(UITextMeshProUGUIEx, tip_path)
end

local function ComponentDestroy(self)
    
end

local function DataDefine(self)
    self.animatorComplete = false
end

local function DataDestroy(self)
    self.animatorComplete = false
end

local function OnEnable(self)
    base.OnEnable(self)
    self.active = true
    self:ReInit()
end

local function OnDisable(self)
    self.active = false
    base.OnDisable(self)
end

local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function ReInit(self)
    local oldHeroData, newHeroData = self:GetUserData()
    
    local oldPower = HeroUtils.GetHeroPower(oldHeroData)
    local newPower = HeroUtils.GetHeroPower(newHeroData)
    self.power_left_text:SetText(string.GetFormattedSeperatorNum(oldPower))
    self.power_right_text:SetText(string.GetFormattedSeperatorNum(newPower))
    
    local newUnlockSkill = newHeroData:GetRankUnlockSkill()
	if table.IsNullOrEmpty(newUnlockSkill) then
		self.skill_bg_go:SetActive(false)
	else
		self.skill_bg_go:SetActive(true)
		
		local skillCount = #newUnlockSkill
		for i = 1, SkillCount do
			if i <= skillCount then
				self.skill_items[i]:SetActive(true)
				self.skill_items[i]:SetData(newUnlockSkill[i])
			else
				self.skill_items[i]:SetActive(false)
			end
		end
	end
end

local function OnPanelClick(self)
    if not self.animatorComplete then
        return
    end
    self.ctrl:CloseSelf()
end

local function OnSkillClick(self, i)
    
end

UIHeroEtoileUp.OnCreate = OnCreate
UIHeroEtoileUp.OnDestroy = OnDestroy
UIHeroEtoileUp.ComponentDefine = ComponentDefine
UIHeroEtoileUp.ComponentDestroy = ComponentDestroy
UIHeroEtoileUp.DataDefine = DataDefine
UIHeroEtoileUp.DataDestroy = DataDestroy
UIHeroEtoileUp.OnEnable = OnEnable
UIHeroEtoileUp.OnDisable = OnDisable
UIHeroEtoileUp.OnAddListener = OnAddListener
UIHeroEtoileUp.OnRemoveListener = OnRemoveListener

UIHeroEtoileUp.ReInit = ReInit
UIHeroEtoileUp.OnPanelClick = OnPanelClick
UIHeroEtoileUp.OnSkillClick = OnSkillClick

return UIHeroEtoileUp