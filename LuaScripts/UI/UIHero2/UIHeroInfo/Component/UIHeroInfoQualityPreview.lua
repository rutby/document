---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/12/20 18:55
---

local UIHeroInfoQualityPreview = BaseClass("UIHeroInfoQualityPreview", UIBaseContainer)
local base = UIBaseContainer
local UIHeroInfoQualityPreviewItem = require "UI.UIHero2.UIHeroInfo.Component.UIHeroInfoQualityPreviewItem"

local title_path = "TitleBg/Title"
local pve_title_path = "Vert/PveTitle"
local pve_attack_path = "Vert/PveAttack"
local pve_defence_path = "Vert/PveDefence"
local pve_hp_path = "Vert/PveHp"
local world_title_path = "Vert/WorldTitle"
local world_attack_path = "Vert/WorldAttack"
local world_defence_path = "Vert/WorldDefence"
local world_army_path = "Vert/WorldArmy"

local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function ComponentDefine(self)
    self.title_text = self:AddComponent(UITextMeshProUGUIEx, title_path)
    self.title_text:SetLocalText(129250)
    self.pve_title_text = self:AddComponent(UITextMeshProUGUIEx, pve_title_path)
    self.pve_title_text:SetLocalText(321419)
    self.pve_attack = self:AddComponent(UIHeroInfoQualityPreviewItem, pve_attack_path)
    self.pve_attack:SetTitle(321421)
    self.pve_defence = self:AddComponent(UIHeroInfoQualityPreviewItem, pve_defence_path)
    self.pve_defence:SetTitle(321422)
    self.pve_hp = self:AddComponent(UIHeroInfoQualityPreviewItem, pve_hp_path)
    self.pve_hp:SetTitle(321423)
    self.world_title_text = self:AddComponent(UITextMeshProUGUIEx, world_title_path)
    self.world_title_text:SetLocalText(321420)
    self.world_attack = self:AddComponent(UIHeroInfoQualityPreviewItem, world_attack_path)
    self.world_attack:SetTitle(129030)
    self.world_defence = self:AddComponent(UIHeroInfoQualityPreviewItem, world_defence_path)
    self.world_defence:SetTitle(220053)
    self.world_army = self:AddComponent(UIHeroInfoQualityPreviewItem, world_army_path)
    self.world_army:SetTitle(150132)
end

local function ComponentDestroy(self)

end

local function DataDefine(self)

end

local function DataDestroy(self)

end

local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function SetData(self, heroData)
    local curRankId = heroData:GetCurMilitaryRankId()
    local maxRankId = heroData:GetMaxMilitaryRankId()
    local curPveAttack = PveUtil.GetPveHeroAttack(heroData.heroId, heroData.level, curRankId)
    local curPveDefence = PveUtil.GetPveHeroDefence(heroData.heroId, heroData.level, curRankId)
    local curPveHp = PveUtil.GetPveHeroHp(heroData.heroId, heroData.level, curRankId)
    curPveAttack = Mathf.Round(curPveAttack)
    curPveDefence = Mathf.Round(curPveDefence)
    curPveHp = Mathf.Round(curPveHp)
    local curWorldAttack, curWorldDefence = heroData:GetAttrByQuality(nil, nil, curRankId)
    local curWorldArmy = HeroUtils.GetArmyLimit(heroData.level, curRankId, heroData.rarity, heroData.heroId, heroData.quality)
    curWorldAttack = Mathf.Round(curWorldAttack)
    curWorldDefence = Mathf.Round(curWorldDefence)
    curWorldArmy = Mathf.Round(curWorldArmy)
    if curRankId < maxRankId then
        local nextPveAttack = PveUtil.GetPveHeroAttack(heroData.heroId, heroData.level, curRankId + 1)
        local nextPveDefence = PveUtil.GetPveHeroDefence(heroData.heroId, heroData.level, curRankId + 1)
        local nextPveHp = PveUtil.GetPveHeroHp(heroData.heroId, heroData.level, curRankId + 1)
        local addPveAttack = Mathf.Round(nextPveAttack) - curPveAttack
        local addPveDefence = Mathf.Round(nextPveDefence) - curPveDefence
        local addPveHp = Mathf.Round(nextPveHp) - curPveHp
        curPveAttack = string.GetFormattedSeperatorNum(curPveAttack)
        curPveDefence = string.GetFormattedSeperatorNum(curPveDefence)
        curPveHp = string.GetFormattedSeperatorNum(curPveHp)
        addPveAttack = string.format("+%s" , string.GetFormattedSeperatorNum(addPveAttack))
        addPveDefence = string.format("+%s" , string.GetFormattedSeperatorNum(addPveDefence))
        addPveHp = string.format("+%s" , string.GetFormattedSeperatorNum(addPveHp))
        self.pve_attack:SetValue(curPveAttack, addPveAttack)
        self.pve_defence:SetValue(curPveDefence, addPveDefence)
        self.pve_hp:SetValue(curPveHp, addPveHp)
        local nextWorldAttack, nextWorldDefence = heroData:GetAttrByQuality(nil, nil, curRankId + 1)
        local nextWorldArmy = HeroUtils.GetArmyLimit(heroData.level, curRankId + 1, heroData.rarity, heroData.heroId, heroData.quality)
        local addWorldAttack = Mathf.Round(nextWorldAttack) - curWorldAttack
        local addWorldDefence = Mathf.Round(nextWorldDefence) - curWorldDefence
        local addWorldArmy = Mathf.Round(nextWorldArmy) - curWorldArmy
        curWorldAttack = string.format("%.2f%%" , curWorldAttack * 0.01)
        curWorldDefence = string.format("%.2f%%" , curWorldDefence * 0.01)
        curWorldArmy = string.GetFormattedSeperatorNum(curWorldArmy)
        addWorldAttack = string.format("+%.2f%%" , addWorldAttack * 0.01)
        addWorldDefence = string.format("+%.2f%%" , addWorldDefence * 0.01)
        addWorldArmy = string.format("+%s" , string.GetFormattedSeperatorNum(addWorldArmy))
        self.world_attack:SetValue(curWorldAttack, addWorldAttack)
        self.world_defence:SetValue(curWorldDefence, addWorldDefence)
        self.world_army:SetValue(curWorldArmy, addWorldArmy)
    else
        curPveAttack = string.GetFormattedSeperatorNum(curPveAttack)
        curPveDefence = string.GetFormattedSeperatorNum(curPveDefence)
        curPveHp = string.GetFormattedSeperatorNum(curPveHp)
        self.pve_attack:SetValue(curPveAttack)
        self.pve_defence:SetValue(curPveDefence)
        self.pve_hp:SetValue(curPveHp)
        curWorldAttack = string.format("%.2f%%" , curWorldAttack * 0.01)
        curWorldDefence = string.format("%.2f%%" , curWorldDefence * 0.01)
        curWorldArmy = string.GetFormattedSeperatorNum(curWorldArmy)
        self.world_attack:SetValue(curWorldAttack)
        self.world_defence:SetValue(curWorldDefence)
        self.world_army:SetValue(curWorldArmy)
    end
end

UIHeroInfoQualityPreview.OnCreate = OnCreate
UIHeroInfoQualityPreview.OnDestroy = OnDestroy
UIHeroInfoQualityPreview.OnEnable = OnEnable
UIHeroInfoQualityPreview.OnDisable = OnDisable
UIHeroInfoQualityPreview.ComponentDefine = ComponentDefine
UIHeroInfoQualityPreview.ComponentDestroy = ComponentDestroy
UIHeroInfoQualityPreview.DataDefine = DataDefine
UIHeroInfoQualityPreview.DataDestroy = DataDestroy
UIHeroInfoQualityPreview.OnAddListener = OnAddListener
UIHeroInfoQualityPreview.OnRemoveListener = OnRemoveListener

UIHeroInfoQualityPreview.SetData = SetData

return UIHeroInfoQualityPreview