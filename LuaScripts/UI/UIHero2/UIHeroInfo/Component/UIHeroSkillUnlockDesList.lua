---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by admin.
--- DateTime: 2024/4/1 17:16
---

local UIHeroSkillUnlockDesList = BaseClass("UIHeroSkillUnlockDesList", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

local UIHeroSkillUnlockDesNode = require "UI.UIHero2.UIHeroInfo.Component.UIHeroSkillUnlockDesNode"

function UIHeroSkillUnlockDesList:OnCreate()
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

function UIHeroSkillUnlockDesList:OnDestroy()
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

function UIHeroSkillUnlockDesList:ComponentDefine()

end

function UIHeroSkillUnlockDesList:ComponentDestroy()

end

function UIHeroSkillUnlockDesList:DataDefine()
    self.node = {}
end

function UIHeroSkillUnlockDesList:DataDestroy()
    self.node = {}
end

function UIHeroSkillUnlockDesList:OnAddListener()
    base.OnAddListener(self)
end

function UIHeroSkillUnlockDesList:OnRemoveListener()
    base.OnRemoveListener(self)
end

function UIHeroSkillUnlockDesList:SetData(heroId, curRankLv, selectSkillId)
    local starEffectList = HeroUtils.GetSkillStarEffectList(heroId)
    local index = 1
    for i, v in ipairs(starEffectList) do
        if v.lv <= curRankLv then
            index = i
        end
    end

    local starEffect = starEffectList[index]
    if starEffect == nil then
        return
    end

    local desList = starEffect.desList[tonumber(selectSkillId)]
    if desList == nil then
        return
    end

    local effectCount = #desList
    local nodeCount = #self.node
    for i = 1, math.max(effectCount, nodeCount) do
        local unlockLv = starEffectList[i + 1].lv or 0
        if self.node[i] == nil then
            self:GameObjectInstantiateAsync(UIAssets.UIHeroSkillUnlockDesNode, function(request)
                if request.isError then
                    return
                end
                local go = request.gameObject
                local nameStr = tostring(i)
                go.name = nameStr
                
                go.transform:SetParent(self.transform)
                go.transform:Set_localScale(ResetScale.x, ResetScale.y, ResetScale.z)
                self.node[i] = self:AddComponent(UIHeroSkillUnlockDesNode, nameStr)
                self.node[i]:SetData(curRankLv , unlockLv, desList[i])
            end)
        else
            if i <= effectCount then
                self.node[i]:SetActive(true)
                self.node[i]:SetData(curRankLv, unlockLv, desList[i])
            else
                self.node[i]:SetActive(false)
            end
        end
    end
end

return UIHeroSkillUnlockDesList