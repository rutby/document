---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by zhangliheng.
--- DateTime: 2022/3/8 11:38
---

local UIHeroListRow = BaseClass('UIHeroListRow', UIBaseContainer)
local base = UIBaseContainer
local UIHeroMapCell = require 'UI.UIHero2.UIHeroList.Component.UIHeroMapCell'
local ColMax = 4

local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    base.OnDestroy(self)
end

local function ComponentDefine(self)
    self.cellObjList = {}
    for k = 1, ColMax do
        local cell = self:AddComponent(UIHeroMapCell, 'UIMapCell' .. k)
        table.insert(self.cellObjList, cell)
    end
end

local function ComponentDestroy(self)
    self.cellObjList = nil
end

local function SetData(self, dataList, clickFunc)
    for k, cell in ipairs(self.cellObjList) do
        local data = dataList[k]
        if data then
            cell:SetActive(true)
            local uuid = data.uuid
            if uuid then
                local heroData = DataCenter.HeroDataManager:GetHeroByUuid(uuid)
                if heroData ~= nil then
                    cell:SetHeroData(uuid, clickFunc)
                    cell:EnableRedPoint()
                else
                    cell:InitWithHeroPieceItem(uuid, clickFunc)
                    cell.imgBottomArrow:SetActive(false)
                end
            else
                cell:SetMapData(data, { data })
            end
        else
            cell:SetActive(false)
        end
    end
end

local function GetCellPos(self)
    return self.cellObjList[1]:GetCellPos()
end

local function GetCellSizeDelta(self)
    return self.cellObjList[1]:GetCellSizeDelta()
end

local function CheckIsHero(self,heroId)
    if self.cellObjList then
        for i ,v in pairs(self.cellObjList) do
            local pos,size = v:CheckHero(heroId)
            if pos ~= 0 then
                return pos,size
            end
        end
    end
    return 0,0
end

local function GetHeroCellAdvanceGuideBtn(self)
    for _, v in ipairs(self.cellObjList) do
        local heroUuid = v.param
        local heroData = DataCenter.HeroDataManager:GetHeroByUuid(heroUuid)
        if heroData ~= nil then
            local needShowRed = heroData:NeedBeyond()
            if needShowRed then
                return v:GetGuideClickBtn()
            end
        end
    end
    return nil
end

local function GetHeroCellStarGuideBtn(self)
    for _, v in ipairs(self.cellObjList) do
        local heroUuid = v.param
        local heroData = DataCenter.HeroDataManager:GetHeroByUuid(heroUuid)
        if heroData ~= nil then
            local maxQuality = HeroUtils.GetMaxStarByRarity(heroData.rarity)
            if maxQuality > heroData.quality then
                local canAdvance = HeroAdvanceController:GetInstance():HasFullDogForCore(heroData)
                if canAdvance then
                    return v:GetGuideClickBtn()
                end
            end
        end
    end
    return nil
end

local function GetHeroCellMilitaryGuideBtn(self)
    for _, v in ipairs(self.cellObjList) do
        local heroUuid = v.param
        local heroData = DataCenter.HeroDataManager:GetHeroByUuid(heroUuid)
        if heroData ~= nil then
            local canMilitaryUpgrade = heroData:CanUpMilitaryRank()
            if canMilitaryUpgrade then
                return v:GetGuideClickBtn()
            end
        end
    end
    return nil
end

function UIHeroListRow:RefreshHero(heroUuid)
    for _, v in ipairs(self.cellObjList) do
        if v.param == heroUuid then
            v:UpdateRedPoint()
            break
        end
    end
end

function UIHeroListRow:GetHeroItem(heroId)
    for _, v in ipairs(self.cellObjList) do
        local heroUuid = v.param
        local heroData = DataCenter.HeroDataManager:GetHeroByUuid(heroUuid)
        if heroData ~= nil and heroData.heroId == heroId then
            return v:GetGuideClickBtn()
        end
    end
    return nil
end

UIHeroListRow.OnCreate= OnCreate
UIHeroListRow.OnDestroy = OnDestroy
UIHeroListRow.ComponentDefine = ComponentDefine
UIHeroListRow.ComponentDestroy = ComponentDestroy
UIHeroListRow.SetData = SetData
UIHeroListRow.GetCellPos = GetCellPos
UIHeroListRow.GetCellSizeDelta = GetCellSizeDelta
UIHeroListRow.CheckIsHero = CheckIsHero
UIHeroListRow.GetHeroCellAdvanceGuideBtn = GetHeroCellAdvanceGuideBtn
UIHeroListRow.GetHeroCellStarGuideBtn = GetHeroCellStarGuideBtn
UIHeroListRow.GetHeroCellMilitaryGuideBtn = GetHeroCellMilitaryGuideBtn

return UIHeroListRow
