---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Beef.
--- DateTime: 2023/3/21 17:20
---

local UICrossWorm = BaseClass("UICrossWorm", UIBaseView)
local base = UIBaseView
local UICommonTab = require "UI.UICommonTab.UICommonTab"
local UICrossWormSoldier = require "UI.CrossWorm.UICrossWorm.Component.UICrossWormSoldier"
local UICrossWormResource = require "UI.CrossWorm.UICrossWorm.Component.UICrossWormResource"
local Localization = CS.GameEntry.Localization

local panel_path = "Panel"
local return_path = "Panel/UICommonMidPopUpTitle/panel"
local close_path = "Panel/UICommonMidPopUpTitle/bg_mid/CloseBtn"
local title_path = "Panel/UICommonMidPopUpTitle/bg_mid/titleText"
local tab_path = "Panel/TabList/Tab%s"
local soldier_path = "Panel/UICrossWormSoldier"
local resource_path = "Panel/UICrossWormResource"

local PANEL_X_LEFT = -152
local PANEL_X_RIGHT = 0
local PANEL_Y = 0
local PANEL_DURATION = 0.2

local TabType =
{
    Soldier = 1,
    Resource = 2,
}

local function OnCreate(self)
    base.OnCreate(self)
    self:DataDefine()
    self:ComponentDefine()
end

local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

local function OnEnable(self)
    base.OnEnable(self)
    self:ReInit()
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function ComponentDefine(self)
    self.panel_go = self:AddComponent(UIBaseContainer, panel_path)
    self.return_btn = self:AddComponent(UIButton, return_path)
    self.return_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.close_btn = self:AddComponent(UIButton, close_path)
    self.close_btn:SetOnClick(function()
        self.ctrl:CloseSelf()
    end)
    self.title_text = self:AddComponent(UIText, title_path)
    self.title_text:SetLocalText(143599)
    self.tabs = {}
    for i = 1, table.count(TabType) do
        self.tabs[i] = self:AddComponent(UICommonTab, string.format(tab_path, i))
        self.tabs[i]:SetSelected(false)
        self.tabs[i]:SetOnClick(function()
            self:OnTabClick(i)
        end)
    end
    self.tabs[TabType.Soldier]:SetName(Localization:GetString("143649"))
    self.tabs[TabType.Resource]:SetName(Localization:GetString("100024"))
    self.soldier = self:AddComponent(UICrossWormSoldier, soldier_path)
    self.resource = self:AddComponent(UICrossWormResource, resource_path)
    self.tabContent =
    {
        [TabType.Soldier] = self.soldier,
        [TabType.Resource] = self.resource,
    }
end

local function ComponentDestroy(self)
    self.panel_go = nil
    self.return_btn = nil
    self.close_btn = nil
    self.title_text = nil
    self.tabs = nil
    self.soldier = nil
    self.resource = nil
    self.tabContent = nil
end

local function DataDefine(self)
    self.tween = nil
    self.isPlace = false
end

local function DataDestroy(self)
    self.tween = nil
    self.isPlace = nil
end

local function OnAddListener(self)
    base.OnAddListener(self)
end

local function OnRemoveListener(self)
    base.OnRemoveListener(self)
end

local function ReInit(self)
    local tabType, isPlace = self:GetUserData()
    self.isPlace = isPlace
    self:OnTabClick(tabType or TabType.Soldier)
    self:MovePanel(false, true)
    DataCenter.CrossWormManager:SendGetPlunder()
end

local function MovePanel(self, toLeft, immediate)
    if self.tween then
        self.tween:Kill()
    end
    local x = toLeft and PANEL_X_LEFT or PANEL_X_RIGHT
    local y = PANEL_Y
    if immediate then
        self.panel_go.rectTransform:Set_anchoredPosition(x, y)
    else
        self.tween = self.panel_go.rectTransform:DOAnchorPosX(x, PANEL_DURATION)
    end
end

local function OnTabClick(self, index)
    for i = 1, table.count(TabType) do
        self.tabs[i]:SetSelected(i == index)
        self.tabContent[i]:SetActive(i == index)
    end
end

UICrossWorm.OnCreate = OnCreate
UICrossWorm.OnDestroy = OnDestroy
UICrossWorm.OnEnable = OnEnable
UICrossWorm.OnDisable = OnDisable
UICrossWorm.ComponentDefine = ComponentDefine
UICrossWorm.ComponentDestroy = ComponentDestroy
UICrossWorm.DataDefine = DataDefine
UICrossWorm.DataDestroy = DataDestroy
UICrossWorm.OnAddListener = OnAddListener
UICrossWorm.OnRemoveListener = OnRemoveListener

UICrossWorm.ReInit = ReInit
UICrossWorm.MovePanel = MovePanel

UICrossWorm.OnTabClick = OnTabClick

return UICrossWorm