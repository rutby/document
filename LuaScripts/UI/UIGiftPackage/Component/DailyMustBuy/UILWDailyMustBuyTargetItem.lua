---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by 1.
--- DateTime: 2022/2/16 12:12
---
local UILWDailyMustBuyTargetItem = BaseClass("UILWDailyMustBuyTargetItem", UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization
local UIGray = CS.UIGray
local UICommonItem = require "UI.UICommonItem.UICommonItem"
local eff_path = "Eff"
-- 创建
local function OnCreate(self)
    base.OnCreate(self)
    self:ComponentDefine()
    self:DataDefine()
end

-- 销毁
local function OnDestroy(self)
    self:ComponentDestroy()
    self:DataDestroy()
    base.OnDestroy(self)
end

--控件的定义
local function ComponentDefine(self)
    self.item = self:AddComponent(UICommonItem, "")
    self.reward_effect = self:AddComponent(UIBaseContainer, eff_path)
end

--控件的销毁
local function ComponentDestroy(self)
    self.item = nil
    --self.stateFrame = nil
    self.btn = nil
end

--变量的定义
local function DataDefine(self)
end

--变量的销毁
local function DataDestroy(self)
end

local function OnClickSelf(self)
    if not self.stageData then
        return
    end
    if self.stageData.state == 1 then
        if self.item then
            self.item:OnBtnClick(true)
        end
        return
    end
    local curScore = DataCenter.DailyMustBuyManager:GetCurScore()
    if self.stageData.score > curScore then
        if self.item then
            self.item:OnBtnClick(true)
        end
        return
    end
    DataCenter.DailyMustBuyManager:ClaimRewardAtStage(self.stageData.index)
end

local function SetItem(self, stageData)
    if stageData == nil then
        return
    end
    self.stageData = stageData
    self.index = stageData.index
    if not table.IsNullOrEmpty(stageData.showReward) then
        local showData = DeepCopy(stageData.showReward[1])
        self.item:ReInit(showData, function()
            self:OnClickSelf()
        end)
        self.item:SetActive(true)
    else
        self.item:SetActive(false)
    end
    self:RefreshState()
end

local function RefreshState(self)
    if self.stageData == nil then
        return
    end
    local canGet = true
    local hasGot = false
    if self.stageData.state == 0 then
        local curScore = DataCenter.DailyMustBuyManager:GetCurScore()
        canGet = self.stageData.score <= curScore
    elseif self.stageData.state == 1 then
        canGet = true
        hasGot = true
    end

    if hasGot then
        self.item:SetCheckActive(true, true)
        -- UIGray.SetGray(self.transform, true, true)
    else
        -- UIGray.SetGray(self.transform, false, true)
        self.item:SetCheckActive(false, false)
    end

    if canGet and not hasGot then
        self.reward_effect:SetActive(true)
        --self.stateFrame:SetActive(true)
    else
        self.reward_effect:SetActive(false)
        --self.stateFrame:SetActive(false)
    end
end

local function RefreshData(self,stageData)
    if stageData == nil then
        return
    end

    self.stageData = stageData
    RefreshState(self)
end

UILWDailyMustBuyTargetItem.OnCreate = OnCreate
UILWDailyMustBuyTargetItem.OnDestroy = OnDestroy
UILWDailyMustBuyTargetItem.ComponentDefine = ComponentDefine
UILWDailyMustBuyTargetItem.ComponentDestroy = ComponentDestroy
UILWDailyMustBuyTargetItem.DataDefine = DataDefine
UILWDailyMustBuyTargetItem.DataDestroy = DataDestroy
UILWDailyMustBuyTargetItem.OnClickSelf = OnClickSelf
UILWDailyMustBuyTargetItem.RefreshData = RefreshData
UILWDailyMustBuyTargetItem.RefreshState = RefreshState
UILWDailyMustBuyTargetItem.SetItem = SetItem

return UILWDailyMustBuyTargetItem