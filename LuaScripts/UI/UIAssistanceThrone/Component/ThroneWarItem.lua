---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by Imaginaerum.
--- DateTime: 2023/3/20 21:44
---
local ThroneWarItem = BaseClass("ThroneWarItem",UIBaseContainer)
local base = UIBaseContainer
local Localization = CS.GameEntry.Localization

local itembg_img_path = "mainContent/Common_supple"
local war_obj_path = "mainContent/warObj"
local no_war_obj_path = "mainContent/noWarObj"
local atk_des_path = "mainContent/warObj/atkDesTxt"
local des_war_path = "mainContent/warObj/desWarTxt"
local des_path = "mainContent/noWarObj/desTxt"
local bg_btn_path = "mainContent/BgButton"
local left_name_path = "mainContent/left/leftNameTxt"
local left_playerHead_path = "mainContent/left/lefthead/LeftUIPlayerHead/LeftHeadIcon"
local left_playerHeadFg_path = "mainContent/left/lefthead/LeftUIPlayerHead/lForeground"
local LmarchMax_rect_path = "mainContent/left/LeftMarchRect"
local LmarchMax_txt_path = "mainContent/left/LeftMarchRect/LMarchNumRect/LMarchMax_Txt"
local cancel_btn_path = "mainContent/noWarObj/returnButton"
local num_path = "mainContent/nameBg/nameNum"
local function OnCreate(self)
    base.OnCreate(self)
    self.war_obj = self:AddComponent(UIBaseContainer,war_obj_path)
    self.war_obj:SetActive(false)
    self.no_war_obj = self:AddComponent(UIBaseContainer,no_war_obj_path)
    self.no_war_obj:SetActive(true)
    self.itemBg_img = self:AddComponent(UIImage,itembg_img_path)
    self.bg_btn = self:AddComponent(UIButton, bg_btn_path)
    self.bg_btn:SetOnClick(function ()
        self:OnBgClick()
    end)
    self.left_name = self:AddComponent(UITextMeshProUGUIEx,left_name_path)
    self.atk_des = self:AddComponent(UITextMeshProUGUIEx,atk_des_path)
    self.atk_des:SetLocalText(120125)
    self.des = self:AddComponent(UITextMeshProUGUIEx,des_path)
    self.des_war = self:AddComponent(UITextMeshProUGUIEx,des_war_path)
    self.LmarchMax_rect = self:AddComponent(UIBaseContainer,LmarchMax_rect_path)
    self._LmarchNumTab = {}
    for i=1,6 do
        local rectpath = "mainContent/left/LeftMarchRect/LMemberNum"..i
        self._LmarchNumTab[i] = self:AddComponent(UIImage,rectpath)
    end
    self.LmarchMax_txt = self:AddComponent(UITextMeshProUGUIEx,LmarchMax_txt_path)

    self.cancel_btn = self:AddComponent(UIButton, cancel_btn_path)
    self.cancel_btn:SetOnClick(function ()
        self:OnCancelClick()
    end)
    self.left_playerHead = self:AddComponent(UIPlayerHead, left_playerHead_path)
    self.left_playerHeadBg = self:AddComponent(UIImage, left_playerHeadFg_path)
    self.num = self:AddComponent(UITextMeshProUGUIEx,num_path)
    self.isInBattle = false
end

local function OnDestroy(self)
    base.OnDestroy(self)
end

local function RefreshData(self,data,isFirst)
    if data == nil then
        return
    end
    self.dataInfo = data
    self.num:SetText(self.dataInfo.index)
    if self.dataInfo.index == 1 then
        self.des:SetLocalText(250037)
        self.des_war:SetLocalText(250037)
    else
        self.des:SetLocalText(250038,self.dataInfo.index)
        self.des_war:SetLocalText(250038,self.dataInfo.index)
    end
    self:SetUuid(self.dataInfo.uuid)
    self.isFirst = false
    if isFirst ~=nil then
        self.isFirst = isFirst
    end
    self.left_name:SetText(self.dataInfo.leftName)
    self.left_playerHead:SetData(self.dataInfo.attackUid,self.dataInfo.attackIcon,self.dataInfo.ownerIconVer)
    if self.dataInfo.targetHeadBg then
        self.left_playerHeadBg:SetActive(true)
    else
        self.left_playerHeadBg:SetActive(false)
    end
    if (self.dataInfo.isSelfAttack or self.dataInfo.cancel) then
        self.left_name:SetColorRGBA(0.2941177,0.8235294,0.08235294,1)
        self.cancel_btn:SetActive(true)
    else
        self.left_name:SetColorRGBA(0.1607843,0.7137255,0.9411765,1)
        self.cancel_btn:SetActive(false)
    end

    for i = 1, 6 do
        self._LmarchNumTab[i]:SetActive(i <= self.dataInfo.assemblyMarchMax)
        if i <= self.dataInfo.canJoinNum then
            self._LmarchNumTab[i]:SetColorRGBA(0.7176471,0.4,0.1882353,1)
        else
            self._LmarchNumTab[i]:SetColorRGBA(0.8039216,0.7686275,0.6980392,1)
        end
    end
    self.LmarchMax_txt:SetText(self.dataInfo.canJoinNum.."/"..self.dataInfo.assemblyMarchMax)
    self:OnMarchRefresh()
end

local function SetUuid(self,uuid)
    self.uuid = uuid
end

local function OnEnable(self)
    base.OnEnable(self)
end

local function OnDisable(self)
    base.OnDisable(self)
end

local function OnBgClick(self)
    self.view.ctrl:OnOpenClick(self.dataInfo)
end


local function OnCancelClick(self)
    if self.dataInfo~=nil then
        local marchUuid = self.dataInfo.leaderMarchUuid
        UIUtil.ShowMessage(Localization:GetString("110151"),2,nil,nil,function ()
            self.view:OnCancelClick(marchUuid)
        end,nil,nil)
    end
    
end

local function OnMarchRefresh(self)
    local inBattle = false
    if self.dataInfo~=nil then
        local marchUuid = self.dataInfo.leaderMarchUuid
        local info = DataCenter.WorldMarchDataManager:GetMarch(marchUuid)
        if info~=nil and info.inBattle~=nil and info.inBattle == true then
            inBattle = true
        end
    end
    if self.isInBattle~=inBattle then
        self.war_obj:SetActive(inBattle)
        self.no_war_obj:SetActive(inBattle ==false)
        self.isInBattle = true
    end
    
end
ThroneWarItem.OnCreate = OnCreate
ThroneWarItem.OnDestroy = OnDestroy
ThroneWarItem.OnEnable = OnEnable
ThroneWarItem.OnDisable = OnDisable
ThroneWarItem.RefreshData = RefreshData
ThroneWarItem.SetUuid =SetUuid
ThroneWarItem.OnBgClick =OnBgClick
ThroneWarItem.OnCancelClick =OnCancelClick
ThroneWarItem.OnMarchRefresh = OnMarchRefresh
return ThroneWarItem